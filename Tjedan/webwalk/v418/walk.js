(function() {
    /*
  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

    HTTP Live Streaming: https://github.com/video-dev/hls.js
    Copyright (c) 2017 Dailymotion (http://www.dailymotion.com), Apache 2.0 License

    node-qrcode: https://github.com/soldair/node-qrcode
    Copyright (c) 2012 Ryan Day,  MIT License

    Brotli: https://github.com/google/brotli
    Copyright (c) 2009, 2010, 2013-2016 by the Brotli Authors,  MIT License

    Bezier.js: https://github.com/Pomax/bezierjs
    Copyright (c) Pomax, MIT License

    stats.js: https://github.com/mrdoob/stats.js
    Copyright (c) 2022 stats.js authors, MIT License

  and the following open fonts:

    Open Sans: https://fonts.google.com/specimen/Open+Sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
    var k = k || {};
    k.scope = {};
    k.arrayIteratorImpl = function(a) {
        var b = 0;
        return function() {
            return b < a.length ? {
                done: !1,
                value: a[b++]
            } : {
                done: !0
            }
        }
    }
    ;
    k.arrayIterator = function(a) {
        return {
            next: k.arrayIteratorImpl(a)
        }
    }
    ;
    k.ASSUME_ES5 = !1;
    k.ASSUME_NO_NATIVE_MAP = !1;
    k.ASSUME_NO_NATIVE_SET = !1;
    k.SIMPLE_FROUND_POLYFILL = !1;
    k.defineProperty = k.ASSUME_ES5 || "function" == typeof Object.defineProperties ? Object.defineProperty : function(a, b, c) {
        a != Array.prototype && a != Object.prototype && (a[b] = c.value)
    }
    ;
    k.getGlobal = function(a) {
        a = ["object" == typeof window && window, "object" == typeof self && self, "object" == typeof global && global, a];
        for (var b = 0; b < a.length; ++b) {
            var c = a[b];
            if (c && c.Math == Math)
                return c
        }
        return globalThis
    }
    ;
    k.global = k.getGlobal(this);
    k.SYMBOL_PREFIX = "jscomp_symbol_";
    k.initSymbol = function() {
        k.initSymbol = function() {}
        ;
        k.global.Symbol || (k.global.Symbol = k.Symbol)
    }
    ;
    k.SymbolClass = function(a, b) {
        this.$jscomp$symbol$id_ = a;
        k.defineProperty(this, "description", {
            configurable: !0,
            writable: !0,
            value: b
        })
    }
    ;
    k.SymbolClass.prototype.toString = function() {
        return this.$jscomp$symbol$id_
    }
    ;
    k.Symbol = function() {
        function a(c) {
            if (this instanceof a)
                throw new TypeError("Symbol is not a constructor");
            return new k.SymbolClass(k.SYMBOL_PREFIX + (c || "") + "_" + b++,c)
        }
        var b = 0;
        return a
    }();
    k.initSymbolIterator = function() {
        k.initSymbol();
        var a = k.global.Symbol.iterator;
        a || (a = k.global.Symbol.iterator = k.global.Symbol("Symbol.iterator"));
        "function" != typeof Array.prototype[a] && k.defineProperty(Array.prototype, a, {
            configurable: !0,
            writable: !0,
            value: function() {
                return k.iteratorPrototype(k.arrayIteratorImpl(this))
            }
        });
        k.initSymbolIterator = function() {}
    }
    ;
    k.initSymbolAsyncIterator = function() {
        k.initSymbol();
        var a = k.global.Symbol.asyncIterator;
        a || (a = k.global.Symbol.asyncIterator = k.global.Symbol("Symbol.asyncIterator"));
        k.initSymbolAsyncIterator = function() {}
    }
    ;
    k.iteratorPrototype = function(a) {
        k.initSymbolIterator();
        a = {
            next: a
        };
        a[k.global.Symbol.iterator] = function() {
            return this
        }
        ;
        return a
    }
    ;
    k.makeIterator = function(a) {
        var b = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator];
        return b ? b.call(a) : k.arrayIterator(a)
    }
    ;
    k.arrayFromIterator = function(a) {
        for (var b, c = []; !(b = a.next()).done; )
            c.push(b.value);
        return c
    }
    ;
    k.arrayFromIterable = function(a) {
        return a instanceof Array ? a : k.arrayFromIterator(k.makeIterator(a))
    }
    ;
    k.objectCreate = k.ASSUME_ES5 || "function" == typeof Object.create ? Object.create : function(a) {
        function b() {}
        b.prototype = a;
        return new b
    }
    ;
    k.underscoreProtoCanBeSet = function() {
        var a = {
            a: !0
        }
          , b = {};
        try {
            return b.__proto__ = a,
            b.a
        } catch (c) {}
        return !1
    }
    ;
    k.setPrototypeOf = "function" == typeof Object.setPrototypeOf ? Object.setPrototypeOf : k.underscoreProtoCanBeSet() ? function(a, b) {
        a.__proto__ = b;
        if (a.__proto__ !== b)
            throw new TypeError(a + " is not extensible");
        return a
    }
    : null;
    k.inherits = function(a, b) {
        a.prototype = k.objectCreate(b.prototype);
        a.prototype.constructor = a;
        if (k.setPrototypeOf) {
            var c = k.setPrototypeOf;
            c(a, b)
        } else
            for (c in b)
                if ("prototype" != c)
                    if (Object.defineProperties) {
                        var d = Object.getOwnPropertyDescriptor(b, c);
                        d && Object.defineProperty(a, c, d)
                    } else
                        a[c] = b[c];
        a.superClass_ = b.prototype
    }
    ;
    k.polyfill = function(a, b) {
        if (b) {
            var c = k.global;
            a = a.split(".");
            for (var d = 0; d < a.length - 1; d++) {
                var e = a[d];
                e in c || (c[e] = {});
                c = c[e]
            }
            a = a[a.length - 1];
            d = c[a];
            b = b(d);
            b != d && null != b && k.defineProperty(c, a, {
                configurable: !0,
                writable: !0,
                value: b
            })
        }
    }
    ;
    k.FORCE_POLYFILL_PROMISE = !1;
    k.polyfill("Promise", function(a) {
        function b(a) {
            this.state_ = 0;
            this.result_ = void 0;
            this.onSettledCallbacks_ = [];
            var b = this.createResolveAndReject_();
            try {
                a(b.resolve, b.reject)
            } catch (l) {
                b.reject(l)
            }
        }
        function c() {
            this.batch_ = null
        }
        function d(a) {
            return a instanceof b ? a : new b(function(b) {
                b(a)
            }
            )
        }
        if (a && !k.FORCE_POLYFILL_PROMISE)
            return a;
        c.prototype.asyncExecute = function(a) {
            if (null == this.batch_) {
                this.batch_ = [];
                var b = this;
                this.asyncExecuteFunction(function() {
                    b.executeBatch_()
                })
            }
            this.batch_.push(a)
        }
        ;
        var e = k.global.setTimeout;
        c.prototype.asyncExecuteFunction = function(a) {
            e(a, 0)
        }
        ;
        c.prototype.executeBatch_ = function() {
            for (; this.batch_ && this.batch_.length; ) {
                var a = this.batch_;
                this.batch_ = [];
                for (var b = 0; b < a.length; ++b) {
                    var c = a[b];
                    a[b] = null;
                    try {
                        c()
                    } catch (m) {
                        this.asyncThrow_(m)
                    }
                }
            }
            this.batch_ = null
        }
        ;
        c.prototype.asyncThrow_ = function(a) {
            this.asyncExecuteFunction(function() {
                throw a;
            })
        }
        ;
        b.prototype.createResolveAndReject_ = function() {
            function a(a) {
                return function(d) {
                    c || (c = !0,
                    a.call(b, d))
                }
            }
            var b = this
              , c = !1;
            return {
                resolve: a(this.resolveTo_),
                reject: a(this.reject_)
            }
        }
        ;
        b.prototype.resolveTo_ = function(a) {
            if (a === this)
                this.reject_(new TypeError("A Promise cannot resolve to itself"));
            else if (a instanceof b)
                this.settleSameAsPromise_(a);
            else {
                a: switch (typeof a) {
                case "object":
                    var c = null != a;
                    break a;
                case "function":
                    c = !0;
                    break a;
                default:
                    c = !1
                }
                c ? this.resolveToNonPromiseObj_(a) : this.fulfill_(a)
            }
        }
        ;
        b.prototype.resolveToNonPromiseObj_ = function(a) {
            var b = void 0;
            try {
                b = a.then
            } catch (l) {
                this.reject_(l);
                return
            }
            "function" == typeof b ? this.settleSameAsThenable_(b, a) : this.fulfill_(a)
        }
        ;
        b.prototype.reject_ = function(a) {
            this.settle_(2, a)
        }
        ;
        b.prototype.fulfill_ = function(a) {
            this.settle_(1, a)
        }
        ;
        b.prototype.settle_ = function(a, b) {
            if (0 != this.state_)
                throw Error("Cannot settle(" + a + ", " + b + "): Promise already settled in state" + this.state_);
            this.state_ = a;
            this.result_ = b;
            this.executeOnSettledCallbacks_()
        }
        ;
        b.prototype.executeOnSettledCallbacks_ = function() {
            if (null != this.onSettledCallbacks_) {
                for (var a = 0; a < this.onSettledCallbacks_.length; ++a)
                    f.asyncExecute(this.onSettledCallbacks_[a]);
                this.onSettledCallbacks_ = null
            }
        }
        ;
        var f = new c;
        b.prototype.settleSameAsPromise_ = function(a) {
            var b = this.createResolveAndReject_();
            a.callWhenSettled_(b.resolve, b.reject)
        }
        ;
        b.prototype.settleSameAsThenable_ = function(a, b) {
            var c = this.createResolveAndReject_();
            try {
                a.call(b, c.resolve, c.reject)
            } catch (m) {
                c.reject(m)
            }
        }
        ;
        b.prototype.then = function(a, c) {
            function d(a, b) {
                return "function" == typeof a ? function(b) {
                    try {
                        e(a(b))
                    } catch (v) {
                        f(v)
                    }
                }
                : b
            }
            var e, f, g = new b(function(a, b) {
                e = a;
                f = b
            }
            );
            this.callWhenSettled_(d(a, e), d(c, f));
            return g
        }
        ;
        b.prototype.catch = function(a) {
            return this.then(void 0, a)
        }
        ;
        b.prototype.callWhenSettled_ = function(a, b) {
            function c() {
                switch (d.state_) {
                case 1:
                    a(d.result_);
                    break;
                case 2:
                    b(d.result_);
                    break;
                default:
                    throw Error("Unexpected state: " + d.state_);
                }
            }
            var d = this;
            null == this.onSettledCallbacks_ ? f.asyncExecute(c) : this.onSettledCallbacks_.push(c)
        }
        ;
        b.resolve = d;
        b.reject = function(a) {
            return new b(function(b, c) {
                c(a)
            }
            )
        }
        ;
        b.race = function(a) {
            return new b(function(b, c) {
                for (var e = k.makeIterator(a), f = e.next(); !f.done; f = e.next())
                    d(f.value).callWhenSettled_(b, c)
            }
            )
        }
        ;
        b.all = function(a) {
            var c = k.makeIterator(a)
              , e = c.next();
            return e.done ? d([]) : new b(function(a, b) {
                function f(b) {
                    return function(c) {
                        g[b] = c;
                        l--;
                        0 == l && a(g)
                    }
                }
                var g = []
                  , l = 0;
                do
                    g.push(void 0),
                    l++,
                    d(e.value).callWhenSettled_(f(g.length - 1), b),
                    e = c.next();
                while (!e.done)
            }
            )
        }
        ;
        return b
    }, "es6", "es3");
    k.generator = {};
    k.generator.ensureIteratorResultIsObject_ = function(a) {
        if (!(a instanceof Object))
            throw new TypeError("Iterator result " + a + " is not an object");
    }
    ;
    k.generator.Context = function() {
        this.isRunning_ = !1;
        this.yieldAllIterator_ = null;
        this.yieldResult = void 0;
        this.nextAddress = 1;
        this.finallyAddress_ = this.catchAddress_ = 0;
        this.finallyContexts_ = this.abruptCompletion_ = null
    }
    ;
    k.generator.Context.prototype.start_ = function() {
        if (this.isRunning_)
            throw new TypeError("Generator is already running");
        this.isRunning_ = !0
    }
    ;
    k.generator.Context.prototype.stop_ = function() {
        this.isRunning_ = !1
    }
    ;
    k.generator.Context.prototype.jumpToErrorHandler_ = function() {
        this.nextAddress = this.catchAddress_ || this.finallyAddress_
    }
    ;
    k.generator.Context.prototype.next_ = function(a) {
        this.yieldResult = a
    }
    ;
    k.generator.Context.prototype.throw_ = function(a) {
        this.abruptCompletion_ = {
            exception: a,
            isException: !0
        };
        this.jumpToErrorHandler_()
    }
    ;
    k.generator.Context.prototype.return = function(a) {
        this.abruptCompletion_ = {
            return: a
        };
        this.nextAddress = this.finallyAddress_
    }
    ;
    k.generator.Context.prototype.jumpThroughFinallyBlocks = function(a) {
        this.abruptCompletion_ = {
            jumpTo: a
        };
        this.nextAddress = this.finallyAddress_
    }
    ;
    k.generator.Context.prototype.yield = function(a, b) {
        this.nextAddress = b;
        return {
            value: a
        }
    }
    ;
    k.generator.Context.prototype.yieldAll = function(a, b) {
        a = k.makeIterator(a);
        var c = a.next();
        k.generator.ensureIteratorResultIsObject_(c);
        if (c.done)
            this.yieldResult = c.value,
            this.nextAddress = b;
        else
            return this.yieldAllIterator_ = a,
            this.yield(c.value, b)
    }
    ;
    k.generator.Context.prototype.jumpTo = function(a) {
        this.nextAddress = a
    }
    ;
    k.generator.Context.prototype.jumpToEnd = function() {
        this.nextAddress = 0
    }
    ;
    k.generator.Context.prototype.setCatchFinallyBlocks = function(a, b) {
        this.catchAddress_ = a;
        void 0 != b && (this.finallyAddress_ = b)
    }
    ;
    k.generator.Context.prototype.setFinallyBlock = function(a) {
        this.catchAddress_ = 0;
        this.finallyAddress_ = a || 0
    }
    ;
    k.generator.Context.prototype.leaveTryBlock = function(a, b) {
        this.nextAddress = a;
        this.catchAddress_ = b || 0
    }
    ;
    k.generator.Context.prototype.enterCatchBlock = function(a) {
        this.catchAddress_ = a || 0;
        a = this.abruptCompletion_.exception;
        this.abruptCompletion_ = null;
        return a
    }
    ;
    k.generator.Context.prototype.enterFinallyBlock = function(a, b, c) {
        c ? this.finallyContexts_[c] = this.abruptCompletion_ : this.finallyContexts_ = [this.abruptCompletion_];
        this.catchAddress_ = a || 0;
        this.finallyAddress_ = b || 0
    }
    ;
    k.generator.Context.prototype.leaveFinallyBlock = function(a, b) {
        b = this.finallyContexts_.splice(b || 0)[0];
        if (b = this.abruptCompletion_ = this.abruptCompletion_ || b) {
            if (b.isException)
                return this.jumpToErrorHandler_();
            void 0 != b.jumpTo && this.finallyAddress_ < b.jumpTo ? (this.nextAddress = b.jumpTo,
            this.abruptCompletion_ = null) : this.nextAddress = this.finallyAddress_
        } else
            this.nextAddress = a
    }
    ;
    k.generator.Context.prototype.forIn = function(a) {
        return new k.generator.Context.PropertyIterator(a)
    }
    ;
    k.generator.Context.PropertyIterator = function(a) {
        this.object_ = a;
        this.properties_ = [];
        for (var b in a)
            this.properties_.push(b);
        this.properties_.reverse()
    }
    ;
    k.generator.Context.PropertyIterator.prototype.getNext = function() {
        for (; 0 < this.properties_.length; ) {
            var a = this.properties_.pop();
            if (a in this.object_)
                return a
        }
        return null
    }
    ;
    k.generator.Engine_ = function(a) {
        this.context_ = new k.generator.Context;
        this.program_ = a
    }
    ;
    k.generator.Engine_.prototype.next_ = function(a) {
        this.context_.start_();
        if (this.context_.yieldAllIterator_)
            return this.yieldAllStep_(this.context_.yieldAllIterator_.next, a, this.context_.next_);
        this.context_.next_(a);
        return this.nextStep_()
    }
    ;
    k.generator.Engine_.prototype.return_ = function(a) {
        this.context_.start_();
        var b = this.context_.yieldAllIterator_;
        if (b)
            return this.yieldAllStep_("return"in b ? b["return"] : function(a) {
                return {
                    value: a,
                    done: !0
                }
            }
            , a, this.context_.return);
        this.context_.return(a);
        return this.nextStep_()
    }
    ;
    k.generator.Engine_.prototype.throw_ = function(a) {
        this.context_.start_();
        if (this.context_.yieldAllIterator_)
            return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"], a, this.context_.next_);
        this.context_.throw_(a);
        return this.nextStep_()
    }
    ;
    k.generator.Engine_.prototype.yieldAllStep_ = function(a, b, c) {
        try {
            var d = a.call(this.context_.yieldAllIterator_, b);
            k.generator.ensureIteratorResultIsObject_(d);
            if (!d.done)
                return this.context_.stop_(),
                d;
            var e = d.value
        } catch (f) {
            return this.context_.yieldAllIterator_ = null,
            this.context_.throw_(f),
            this.nextStep_()
        }
        this.context_.yieldAllIterator_ = null;
        c.call(this.context_, e);
        return this.nextStep_()
    }
    ;
    k.generator.Engine_.prototype.nextStep_ = function() {
        for (; this.context_.nextAddress; )
            try {
                var a = this.program_(this.context_);
                if (a)
                    return this.context_.stop_(),
                    {
                        value: a.value,
                        done: !1
                    }
            } catch (b) {
                this.context_.yieldResult = void 0,
                this.context_.throw_(b)
            }
        this.context_.stop_();
        if (this.context_.abruptCompletion_) {
            a = this.context_.abruptCompletion_;
            this.context_.abruptCompletion_ = null;
            if (a.isException)
                throw a.exception;
            return {
                value: a.return,
                done: !0
            }
        }
        return {
            value: void 0,
            done: !0
        }
    }
    ;
    k.generator.Generator_ = function(a) {
        this.next = function(b) {
            return a.next_(b)
        }
        ;
        this.throw = function(b) {
            return a.throw_(b)
        }
        ;
        this.return = function(b) {
            return a.return_(b)
        }
        ;
        k.initSymbolIterator();
        this[Symbol.iterator] = function() {
            return this
        }
    }
    ;
    k.generator.createGenerator = function(a, b) {
        b = new k.generator.Generator_(new k.generator.Engine_(b));
        k.setPrototypeOf && k.setPrototypeOf(b, a.prototype);
        return b
    }
    ;
    k.asyncExecutePromiseGenerator = function(a) {
        function b(b) {
            return a.next(b)
        }
        function c(b) {
            return a.throw(b)
        }
        return new Promise(function(d, e) {
            function f(a) {
                a.done ? d(a.value) : Promise.resolve(a.value).then(b, c).then(f, e)
            }
            f(a.next())
        }
        )
    }
    ;
    k.asyncExecutePromiseGeneratorFunction = function(a) {
        return k.asyncExecutePromiseGenerator(a())
    }
    ;
    k.asyncExecutePromiseGeneratorProgram = function(a) {
        return k.asyncExecutePromiseGenerator(new k.generator.Generator_(new k.generator.Engine_(a)))
    }
    ;
    k.polyfill("globalThis", function(a) {
        return a || k.global
    }, "es_next", "es3");
    k.iteratorFromArray = function(a, b) {
        k.initSymbolIterator();
        a instanceof String && (a += "");
        var c = 0
          , d = {
            next: function() {
                if (c < a.length) {
                    var e = c++;
                    return {
                        value: b(e, a[e]),
                        done: !1
                    }
                }
                d.next = function() {
                    return {
                        done: !0,
                        value: void 0
                    }
                }
                ;
                return d.next()
            }
        };
        d[Symbol.iterator] = function() {
            return d
        }
        ;
        return d
    }
    ;
    k.polyfill("Array.prototype.keys", function(a) {
        return a ? a : function() {
            return k.iteratorFromArray(this, function(a) {
                return a
            })
        }
    }, "es6", "es3");
    k.owns = function(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b)
    }
    ;
    k.polyfill("Object.entries", function(a) {
        return a ? a : function(a) {
            var b = [], d;
            for (d in a)
                k.owns(a, d) && b.push([d, a[d]]);
            return b
        }
    }, "es8", "es3");
    k.checkStringArgs = function(a, b, c) {
        if (null == a)
            throw new TypeError("The 'this' value for String.prototype." + c + " must not be null or undefined");
        if (b instanceof RegExp)
            throw new TypeError("First argument to String.prototype." + c + " must not be a regular expression");
        return a + ""
    }
    ;
    k.polyfill("String.prototype.startsWith", function(a) {
        return a ? a : function(a, c) {
            var b = k.checkStringArgs(this, a, "startsWith");
            a += "";
            var e = b.length
              , f = a.length;
            c = Math.max(0, Math.min(c | 0, b.length));
            for (var g = 0; g < f && c < e; )
                if (b[c++] != a[g++])
                    return !1;
            return g >= f
        }
    }, "es6", "es3");
    k.checkEs6ConformanceViaProxy = function() {
        try {
            var a = {}
              , b = Object.create(new k.global.Proxy(a,{
                get: function(c, d, e) {
                    return c == a && "q" == d && e == b
                }
            }));
            return !0 === b.q
        } catch (c) {
            return !1
        }
    }
    ;
    k.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS = !1;
    k.ES6_CONFORMANCE = k.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS && k.checkEs6ConformanceViaProxy();
    k.polyfill("WeakMap", function(a) {
        function b(a) {
            this.id_ = (l += Math.random() + 1).toString();
            if (a) {
                a = k.makeIterator(a);
                for (var b; !(b = a.next()).done; )
                    b = b.value,
                    this.set(b[0], b[1])
            }
        }
        function c() {
            if (!a || !Object.seal)
                return !1;
            try {
                var b = Object.seal({})
                  , c = Object.seal({})
                  , d = new a([[b, 2], [c, 3]]);
                if (2 != d.get(b) || 3 != d.get(c))
                    return !1;
                d.delete(b);
                d.set(c, 4);
                return !d.has(b) && 4 == d.get(c)
            } catch (q) {
                return !1
            }
        }
        function d() {}
        function e(a) {
            var b = typeof a;
            return "object" === b && null !== a || "function" === b
        }
        function f(a) {
            if (!k.owns(a, h)) {
                var b = new d;
                k.defineProperty(a, h, {
                    value: b
                })
            }
        }
        function g(a) {
            var b = Object[a];
            b && (Object[a] = function(a) {
                if (a instanceof d)
                    return a;
                f(a);
                return b(a)
            }
            )
        }
        if (k.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS) {
            if (a && k.ES6_CONFORMANCE)
                return a
        } else if (c())
            return a;
        var h = "$jscomp_hidden_" + Math.random();
        g("freeze");
        g("preventExtensions");
        g("seal");
        var l = 0;
        b.prototype.set = function(a, b) {
            if (!e(a))
                throw Error("Invalid WeakMap key");
            f(a);
            if (!k.owns(a, h))
                throw Error("WeakMap key fail: " + a);
            a[h][this.id_] = b;
            return this
        }
        ;
        b.prototype.get = function(a) {
            return e(a) && k.owns(a, h) ? a[h][this.id_] : void 0
        }
        ;
        b.prototype.has = function(a) {
            return e(a) && k.owns(a, h) && k.owns(a[h], this.id_)
        }
        ;
        b.prototype.delete = function(a) {
            return e(a) && k.owns(a, h) && k.owns(a[h], this.id_) ? delete a[h][this.id_] : !1
        }
        ;
        return b
    }, "es6", "es3");
    k.MapEntry = function() {}
    ;
    k.polyfill("Map", function(a) {
        function b() {
            var a = {};
            return a.previous = a.next = a.head = a
        }
        function c(a, b) {
            var c = a.head_;
            return k.iteratorPrototype(function() {
                if (c) {
                    for (; c.head != a.head_; )
                        c = c.previous;
                    for (; c.next != c.head; )
                        return c = c.next,
                        {
                            done: !1,
                            value: b(c)
                        };
                    c = null
                }
                return {
                    done: !0,
                    value: void 0
                }
            })
        }
        function d(a, b) {
            var c = b && typeof b;
            "object" == c || "function" == c ? g.has(b) ? c = g.get(b) : (c = "" + ++h,
            g.set(b, c)) : c = "p_" + b;
            var d = a.data_[c];
            if (d && k.owns(a.data_, c))
                for (a = 0; a < d.length; a++) {
                    var e = d[a];
                    if (b !== b && e.key !== e.key || b === e.key)
                        return {
                            id: c,
                            list: d,
                            index: a,
                            entry: e
                        }
                }
            return {
                id: c,
                list: d,
                index: -1,
                entry: void 0
            }
        }
        function e(a) {
            this.data_ = {};
            this.head_ = b();
            this.size = 0;
            if (a) {
                a = k.makeIterator(a);
                for (var c; !(c = a.next()).done; )
                    c = c.value,
                    this.set(c[0], c[1])
            }
        }
        function f() {
            if (k.ASSUME_NO_NATIVE_MAP || !a || "function" != typeof a || !a.prototype.entries || "function" != typeof Object.seal)
                return !1;
            try {
                var b = Object.seal({
                    x: 4
                })
                  , c = new a(k.makeIterator([[b, "s"]]));
                if ("s" != c.get(b) || 1 != c.size || c.get({
                    x: 4
                }) || c.set({
                    x: 4
                }, "t") != c || 2 != c.size)
                    return !1;
                var d = c.entries()
                  , e = d.next();
                if (e.done || e.value[0] != b || "s" != e.value[1])
                    return !1;
                e = d.next();
                return e.done || 4 != e.value[0].x || "t" != e.value[1] || !d.next().done ? !1 : !0
            } catch (q) {
                return !1
            }
        }
        if (k.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS) {
            if (a && k.ES6_CONFORMANCE)
                return a
        } else if (f())
            return a;
        k.initSymbolIterator();
        var g = new WeakMap;
        e.prototype.set = function(a, b) {
            a = 0 === a ? 0 : a;
            var c = d(this, a);
            c.list || (c.list = this.data_[c.id] = []);
            c.entry ? c.entry.value = b : (c.entry = {
                next: this.head_,
                previous: this.head_.previous,
                head: this.head_,
                key: a,
                value: b
            },
            c.list.push(c.entry),
            this.head_.previous.next = c.entry,
            this.head_.previous = c.entry,
            this.size++);
            return this
        }
        ;
        e.prototype.delete = function(a) {
            a = d(this, a);
            return a.entry && a.list ? (a.list.splice(a.index, 1),
            a.list.length || delete this.data_[a.id],
            a.entry.previous.next = a.entry.next,
            a.entry.next.previous = a.entry.previous,
            a.entry.head = null,
            this.size--,
            !0) : !1
        }
        ;
        e.prototype.clear = function() {
            this.data_ = {};
            this.head_ = this.head_.previous = b();
            this.size = 0
        }
        ;
        e.prototype.has = function(a) {
            return !!d(this, a).entry
        }
        ;
        e.prototype.get = function(a) {
            return (a = d(this, a).entry) && a.value
        }
        ;
        e.prototype.entries = function() {
            return c(this, function(a) {
                return [a.key, a.value]
            })
        }
        ;
        e.prototype.keys = function() {
            return c(this, function(a) {
                return a.key
            })
        }
        ;
        e.prototype.values = function() {
            return c(this, function(a) {
                return a.value
            })
        }
        ;
        e.prototype.forEach = function(a, b) {
            for (var c = this.entries(), d; !(d = c.next()).done; )
                d = d.value,
                a.call(b, d[1], d[0], this)
        }
        ;
        e.prototype[Symbol.iterator] = e.prototype.entries;
        var h = 0;
        return e
    }, "es6", "es3");
    k.polyfill("Set", function(a) {
        function b(a) {
            this.map_ = new Map;
            if (a) {
                a = k.makeIterator(a);
                for (var b; !(b = a.next()).done; )
                    this.add(b.value)
            }
            this.size = this.map_.size
        }
        function c() {
            if (k.ASSUME_NO_NATIVE_SET || !a || "function" != typeof a || !a.prototype.entries || "function" != typeof Object.seal)
                return !1;
            try {
                var b = Object.seal({
                    x: 4
                })
                  , c = new a(k.makeIterator([b]));
                if (!c.has(b) || 1 != c.size || c.add(b) != c || 1 != c.size || c.add({
                    x: 4
                }) != c || 2 != c.size)
                    return !1;
                var f = c.entries()
                  , g = f.next();
                if (g.done || g.value[0] != b || g.value[1] != b)
                    return !1;
                g = f.next();
                return g.done || g.value[0] == b || 4 != g.value[0].x || g.value[1] != g.value[0] ? !1 : f.next().done
            } catch (h) {
                return !1
            }
        }
        if (k.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS) {
            if (a && k.ES6_CONFORMANCE)
                return a
        } else if (c())
            return a;
        k.initSymbolIterator();
        b.prototype.add = function(a) {
            a = 0 === a ? 0 : a;
            this.map_.set(a, a);
            this.size = this.map_.size;
            return this
        }
        ;
        b.prototype.delete = function(a) {
            a = this.map_.delete(a);
            this.size = this.map_.size;
            return a
        }
        ;
        b.prototype.clear = function() {
            this.map_.clear();
            this.size = 0
        }
        ;
        b.prototype.has = function(a) {
            return this.map_.has(a)
        }
        ;
        b.prototype.entries = function() {
            return this.map_.entries()
        }
        ;
        b.prototype.values = function() {
            return this.map_.values()
        }
        ;
        b.prototype.keys = b.prototype.values;
        b.prototype[Symbol.iterator] = b.prototype.values;
        b.prototype.forEach = function(a, b) {
            var c = this;
            this.map_.forEach(function(d) {
                return a.call(b, d, d, c)
            })
        }
        ;
        return b
    }, "es6", "es3");
    k.polyfill("Object.is", function(a) {
        return a ? a : function(a, c) {
            return a === c ? 0 !== a || 1 / a === 1 / c : a !== a && c !== c
        }
    }, "es6", "es3");
    k.polyfill("Array.prototype.includes", function(a) {
        return a ? a : function(a, c) {
            var b = this;
            b instanceof String && (b = String(b));
            var e = b.length;
            c = c || 0;
            for (0 > c && (c = Math.max(c + e, 0)); c < e; c++) {
                var f = b[c];
                if (f === a || Object.is(f, a))
                    return !0
            }
            return !1
        }
    }, "es7", "es3");
    k.polyfill("String.prototype.includes", function(a) {
        return a ? a : function(a, c) {
            return -1 !== k.checkStringArgs(this, a, "includes").indexOf(a, c || 0)
        }
    }, "es6", "es3");
    k.assign = "function" == typeof Object.assign ? Object.assign : function(a, b) {
        for (var c = 1; c < arguments.length; c++) {
            var d = arguments[c];
            if (d)
                for (var e in d)
                    k.owns(d, e) && (a[e] = d[e])
        }
        return a
    }
    ;
    k.polyfill("Object.assign", function(a) {
        return a || k.assign
    }, "es6", "es3");
    k.polyfill("Object.setPrototypeOf", function(a) {
        return a || k.setPrototypeOf
    }, "es6", "es5");
    k.findInternal = function(a, b, c) {
        a instanceof String && (a = String(a));
        for (var d = a.length, e = 0; e < d; e++) {
            var f = a[e];
            if (b.call(c, f, e, a))
                return {
                    i: e,
                    v: f
                }
        }
        return {
            i: -1,
            v: void 0
        }
    }
    ;
    k.polyfill("Array.prototype.findIndex", function(a) {
        return a ? a : function(a, c) {
            return k.findInternal(this, a, c).i
        }
    }, "es6", "es3");
    k.polyfill("Array.prototype.find", function(a) {
        return a ? a : function(a, c) {
            return k.findInternal(this, a, c).v
        }
    }, "es6", "es3");
    k.polyfill("Number.EPSILON", function() {
        return Math.pow(2, -52)
    }, "es6", "es3");
    k.polyfill("Number.MAX_SAFE_INTEGER", function() {
        return 9007199254740991
    }, "es6", "es3");
    k.polyfill("Number.MIN_SAFE_INTEGER", function() {
        return -9007199254740991
    }, "es6", "es3");
    k.polyfill("Array.from", function(a) {
        return a ? a : function(a, c, d) {
            c = null != c ? c : function(a) {
                return a
            }
            ;
            var b = []
              , f = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator];
            if ("function" == typeof f) {
                a = f.call(a);
                for (var g = 0; !(f = a.next()).done; )
                    b.push(c.call(d, f.value, g++))
            } else
                for (f = a.length,
                g = 0; g < f; g++)
                    b.push(c.call(d, a[g], g));
            return b
        }
    }, "es6", "es3");
    k.polyfill("Array.prototype.values", function(a) {
        return a ? a : function() {
            return k.iteratorFromArray(this, function(a, c) {
                return c
            })
        }
    }, "es8", "es3");
    k.polyfill("Math.log2", function(a) {
        return a ? a : function(a) {
            return Math.log(a) / Math.LN2
        }
    }, "es6", "es3");
    k.polyfill("String.prototype.endsWith", function(a) {
        return a ? a : function(a, c) {
            var b = k.checkStringArgs(this, a, "endsWith");
            a += "";
            void 0 === c && (c = b.length);
            c = Math.max(0, Math.min(c | 0, b.length));
            for (var e = a.length; 0 < e && 0 < c; )
                if (b[--c] != a[--e])
                    return !1;
            return 0 >= e
        }
    }, "es6", "es3");
    k.polyfill("Math.sign", function(a) {
        return a ? a : function(a) {
            a = Number(a);
            return 0 === a || isNaN(a) ? a : 0 < a ? 1 : -1
        }
    }, "es6", "es3");
    k.polyfill("Array.prototype.fill", function(a) {
        return a ? a : function(a, c, d) {
            var b = this.length || 0;
            0 > c && (c = Math.max(0, b + c));
            if (null == d || d > b)
                d = b;
            d = Number(d);
            0 > d && (d = Math.max(0, b + d));
            for (c = Number(c || 0); c < d; c++)
                this[c] = a;
            return this
        }
    }, "es6", "es3");
    k.polyfill("Object.values", function(a) {
        return a ? a : function(a) {
            var b = [], d;
            for (d in a)
                k.owns(a, d) && b.push(a[d]);
            return b
        }
    }, "es8", "es3");
    k.polyfill("Promise.prototype.finally", function(a) {
        return a ? a : function(a) {
            return this.then(function(b) {
                return Promise.resolve(a()).then(function() {
                    return b
                })
            }, function(b) {
                return Promise.resolve(a()).then(function() {
                    throw b;
                })
            })
        }
    }, "es9", "es3");
    (function() {
        function a(a, b, c) {
            return a.call.apply(a.bind, arguments)
        }
        function b(a, b, c) {
            if (!a)
                throw Error();
            if (2 < arguments.length) {
                var d = Array.prototype.slice.call(arguments, 2);
                return function() {
                    var c = Array.prototype.slice.call(arguments);
                    Array.prototype.unshift.apply(c, d);
                    return a.apply(b, c)
                }
            }
            return function() {
                return a.apply(b, arguments)
            }
        }
        function c(d, e, f) {
            c = Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf("native code") ? a : b;
            return c.apply(null, arguments)
        }
        function d(a, b) {
            this.a = a;
            this.m = b || a;
            this.c = this.m.document
        }
        function e(a, b, c, d) {
            b = a.c.createElement(b);
            if (c)
                for (var e in c)
                    c.hasOwnProperty(e) && ("style" == e ? b.style.cssText = c[e] : b.setAttribute(e, c[e]));
            d && b.appendChild(a.c.createTextNode(d));
            return b
        }
        function f(a, b, c) {
            (a = a.c.getElementsByTagName(b)[0]) || (a = document.documentElement);
            a.insertBefore(c, a.lastChild)
        }
        function g(a) {
            a.parentNode && a.parentNode.removeChild(a)
        }
        function h(a, b, c) {
            b = b || [];
            c = c || [];
            for (var d = a.className.split(/\s+/), e = 0; e < b.length; e += 1) {
                for (var f = !1, g = 0; g < d.length; g += 1)
                    if (b[e] === d[g]) {
                        f = !0;
                        break
                    }
                f || d.push(b[e])
            }
            b = [];
            for (e = 0; e < d.length; e += 1) {
                f = !1;
                for (g = 0; g < c.length; g += 1)
                    if (d[e] === c[g]) {
                        f = !0;
                        break
                    }
                f || b.push(d[e])
            }
            a.className = b.join(" ").replace(/\s+/g, " ").replace(/^\s+|\s+$/, "")
        }
        function l(a, b) {
            a = a.className.split(/\s+/);
            for (var c = 0, d = a.length; c < d; c++)
                if (a[c] == b)
                    return !0;
            return !1
        }
        function m(a) {
            if ("string" === typeof a.f)
                return a.f;
            var b = a.m.location.protocol;
            "about:" == b && (b = a.a.location.protocol);
            return "https:" == b ? "https:" : "http:"
        }
        function n(a) {
            return a.m.location.hostname || a.a.location.hostname
        }
        function p(a, b, c) {
            function d() {
                m && g && h && (m(l),
                m = null)
            }
            b = e(a, "link", {
                rel: "stylesheet",
                href: b,
                media: "all"
            });
            var g = !1
              , h = !0
              , l = null
              , m = c || null;
            ma ? (b.onload = function() {
                g = !0;
                d()
            }
            ,
            b.onerror = function() {
                g = !0;
                l = Error("Stylesheet failed to load");
                d()
            }
            ) : setTimeout(function() {
                g = !0;
                d()
            }, 0);
            f(a, "head", b)
        }
        function q(a, b, c, d) {
            var f = a.c.getElementsByTagName("head")[0];
            if (f) {
                var g = e(a, "script", {
                    src: b
                })
                  , h = !1;
                g.onload = g.onreadystatechange = function() {
                    h || this.readyState && "loaded" != this.readyState && "complete" != this.readyState || (h = !0,
                    c && c(null),
                    g.onload = g.onreadystatechange = null,
                    "HEAD" == g.parentNode.tagName && f.removeChild(g))
                }
                ;
                f.appendChild(g);
                setTimeout(function() {
                    h || (h = !0,
                    c && c(Error("Script load timeout")))
                }, d || 5E3);
                return g
            }
            return null
        }
        function r() {
            this.a = 0;
            this.c = null
        }
        function u(a) {
            a.a++;
            return function() {
                a.a--;
                w(a)
            }
        }
        function v(a, b) {
            a.c = b;
            w(a)
        }
        function w(a) {
            0 == a.a && a.c && (a.c(),
            a.c = null)
        }
        function x(a) {
            this.a = a || "-"
        }
        function y(a, b) {
            this.c = a;
            this.f = 4;
            this.a = "n";
            (a = (b || "n4").match(/^([nio])([1-9])$/i)) && (this.a = a[1],
            this.f = parseInt(a[2], 10))
        }
        function z(a) {
            return H(a) + " " + (a.f + "00 300px ") + A(a.c)
        }
        function A(a) {
            var b = [];
            a = a.split(/,\s*/);
            for (var c = 0; c < a.length; c++) {
                var d = a[c].replace(/['"]/g, "");
                -1 != d.indexOf(" ") || /^\d/.test(d) ? b.push("'" + d + "'") : b.push(d)
            }
            return b.join(",")
        }
        function B(a) {
            return a.a + a.f
        }
        function H(a) {
            var b = "normal";
            "o" === a.a ? b = "oblique" : "i" === a.a && (b = "italic");
            return b
        }
        function C(a) {
            var b = 4
              , c = "n"
              , d = null;
            a && ((d = a.match(/(normal|oblique|italic)/i)) && d[1] && (c = d[1].substr(0, 1).toLowerCase()),
            (d = a.match(/([1-9]00|normal|bold)/i)) && d[1] && (/bold/i.test(d[1]) ? b = 7 : /[1-9]00/.test(d[1]) && (b = parseInt(d[1].substr(0, 1), 10))));
            return c + b
        }
        function L(a, b) {
            this.c = a;
            this.f = a.m.document.documentElement;
            this.h = b;
            this.a = new x("-");
            this.j = !1 !== b.events;
            this.g = !1 !== b.classes
        }
        function G(a) {
            a.g && h(a.f, [a.a.c("wf", "loading")]);
            M(a, "loading")
        }
        function I(a) {
            if (a.g) {
                var b = l(a.f, a.a.c("wf", "active"))
                  , c = []
                  , d = [a.a.c("wf", "loading")];
                b || c.push(a.a.c("wf", "inactive"));
                h(a.f, c, d)
            }
            M(a, "inactive")
        }
        function M(a, b, c) {
            if (a.j && a.h[b])
                if (c)
                    a.h[b](c.c, B(c));
                else
                    a.h[b]()
        }
        function O() {
            this.c = {}
        }
        function K(a, b, c) {
            var d = [], e;
            for (e in b)
                if (b.hasOwnProperty(e)) {
                    var f = a.c[e];
                    f && d.push(f(b[e], c))
                }
            return d
        }
        function F(a, b) {
            this.c = a;
            this.f = b;
            this.a = e(this.c, "span", {
                "aria-hidden": "true"
            }, this.f)
        }
        function D(a) {
            f(a.c, "body", a.a)
        }
        function E(a) {
            return "display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:" + A(a.c) + ";font-style:" + (H(a) + ";font-weight:" + (a.f + "00;"))
        }
        function S(a, b, c, d, e, f) {
            this.g = a;
            this.j = b;
            this.a = d;
            this.c = c;
            this.f = e || 3E3;
            this.h = f || void 0
        }
        function Z(a, b, c, d, e, f, g) {
            this.v = a;
            this.B = b;
            this.c = c;
            this.a = d;
            this.s = g || "BESbswy";
            this.f = {};
            this.w = e || 3E3;
            this.u = f || null;
            this.o = this.j = this.h = this.g = null;
            this.g = new F(this.c,this.s);
            this.h = new F(this.c,this.s);
            this.j = new F(this.c,this.s);
            this.o = new F(this.c,this.s);
            a = new y(this.a.c + ",serif",B(this.a));
            a = E(a);
            this.g.a.style.cssText = a;
            a = new y(this.a.c + ",sans-serif",B(this.a));
            a = E(a);
            this.h.a.style.cssText = a;
            a = new y("serif",B(this.a));
            a = E(a);
            this.j.a.style.cssText = a;
            a = new y("sans-serif",B(this.a));
            a = E(a);
            this.o.a.style.cssText = a;
            D(this.g);
            D(this.h);
            D(this.j);
            D(this.o)
        }
        function R() {
            if (null === Bb) {
                var a = /AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);
                Bb = !!a && (536 > parseInt(a[1], 10) || 536 === parseInt(a[1], 10) && 11 >= parseInt(a[2], 10))
            }
            return Bb
        }
        function da(a, b, c) {
            for (var d in Ia)
                if (Ia.hasOwnProperty(d) && b === a.f[Ia[d]] && c === a.f[Ia[d]])
                    return !0;
            return !1
        }
        function ha(a) {
            var b = a.g.a.offsetWidth, c = a.h.a.offsetWidth, d;
            (d = b === a.f.serif && c === a.f["sans-serif"]) || (d = R() && da(a, b, c));
            d ? vb() - a.A >= a.w ? R() && da(a, b, c) && (null === a.u || a.u.hasOwnProperty(a.a.c)) ? Y(a, a.v) : Y(a, a.B) : ia(a) : Y(a, a.v)
        }
        function ia(a) {
            setTimeout(c(function() {
                ha(this)
            }, a), 50)
        }
        function Y(a, b) {
            setTimeout(c(function() {
                g(this.g.a);
                g(this.h.a);
                g(this.j.a);
                g(this.o.a);
                b(this.a)
            }, a), 0)
        }
        function N(a, b, c) {
            this.c = a;
            this.a = b;
            this.f = 0;
            this.o = this.j = !1;
            this.s = c
        }
        function U(a) {
            0 == --a.f && a.j && (a.o ? (a = a.a,
            a.g && h(a.f, [a.a.c("wf", "active")], [a.a.c("wf", "loading"), a.a.c("wf", "inactive")]),
            M(a, "active")) : I(a.a))
        }
        function ba(a) {
            this.j = a;
            this.a = new O;
            this.h = 0;
            this.f = this.g = !0
        }
        function W(a, b, d, e, f) {
            var g = 0 == --a.h;
            (a.f || a.g) && setTimeout(function() {
                var a = f || null
                  , l = e || {};
                if (0 === d.length && g)
                    I(b.a);
                else {
                    b.f += d.length;
                    g && (b.j = g);
                    var m, n = [];
                    for (m = 0; m < d.length; m++) {
                        var p = d[m]
                          , r = l[p.c]
                          , w = b.a
                          , q = p;
                        w.g && h(w.f, [w.a.c("wf", q.c, B(q).toString(), "loading")]);
                        M(w, "fontloading", q);
                        w = null;
                        null === Nb && (Nb = window.FontFace ? (q = /Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent)) ? 42 < parseInt(q[1], 10) : !0 : !1);
                        Nb ? w = new S(c(b.g, b),c(b.h, b),b.c,p,b.s,r) : w = new Z(c(b.g, b),c(b.h, b),b.c,p,b.s,a,r);
                        n.push(w)
                    }
                    for (m = 0; m < n.length; m++)
                        n[m].start()
                }
            }, 0)
        }
        function ka(a, b, c) {
            var d = []
              , e = c.timeout;
            G(b);
            d = K(a.a, c, a.c);
            var f = new N(a.c,b,e);
            a.h = d.length;
            b = 0;
            for (c = d.length; b < c; b++)
                d[b].load(function(b, c, d) {
                    W(a, f, b, c, d)
                })
        }
        function ca(a, b) {
            this.c = a;
            this.a = b
        }
        function la(a, b, c) {
            var d = m(a.c);
            a = (a.a.api || "fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/, "");
            return d + "//" + a + "/" + b + ".js" + (c ? "?v=" + c : "")
        }
        function ya(a, b) {
            this.c = a;
            this.a = b
        }
        function V(a, b, c) {
            a ? this.c = a : this.c = b + oa;
            this.a = [];
            this.f = [];
            this.g = c || ""
        }
        function Ga(a, b) {
            for (var c = b.length, d = 0; d < c; d++) {
                var e = b[d].split(":");
                3 == e.length && a.f.push(e.pop());
                var f = "";
                2 == e.length && "" != e[1] && (f = ":");
                a.a.push(e.join(f))
            }
        }
        function Ha(a) {
            if (0 == a.a.length)
                throw Error("No fonts to load!");
            if (-1 != a.c.indexOf("kit="))
                return a.c;
            for (var b = a.a.length, c = [], d = 0; d < b; d++)
                c.push(a.a[d].replace(/ /g, "+"));
            b = a.c + "?family=" + c.join("%7C");
            0 < a.f.length && (b += "&subset=" + a.f.join(","));
            0 < a.g.length && (b += "&text=" + encodeURIComponent(a.g));
            return b
        }
        function Qa(a) {
            this.f = a;
            this.a = [];
            this.c = {}
        }
        function bb(a) {
            for (var b = a.f.length, c = 0; c < b; c++) {
                var d = a.f[c].split(":")
                  , e = d[0].replace(/\+/g, " ")
                  , f = ["n4"];
                if (2 <= d.length) {
                    var g = d[1];
                    var h = [];
                    if (g) {
                        g = g.split(",");
                        for (var l = g.length, m = 0; m < l; m++) {
                            var n = g[m];
                            if (n.match(/^[\w-]+$/)) {
                                var p = pa.exec(n.toLowerCase());
                                if (null == p)
                                    n = "";
                                else {
                                    n = p[2];
                                    n = null == n || "" == n ? "n" : qa[n];
                                    p = p[1];
                                    if (null == p || "" == p)
                                        p = "4";
                                    else {
                                        var r = sa[p];
                                        p = r ? r : isNaN(p) ? "4" : p.substr(0, 1)
                                    }
                                    n = [n, p].join("")
                                }
                            } else
                                n = "";
                            n && h.push(n)
                        }
                    }
                    0 < h.length && (f = h);
                    3 == d.length && (d = d[2],
                    h = [],
                    d = d ? d.split(",") : h,
                    0 < d.length && (d = za[d[0]]) && (a.c[e] = d))
                }
                a.c[e] || (d = za[e]) && (a.c[e] = d);
                for (d = 0; d < f.length; d += 1)
                    a.a.push(new y(e,f[d]))
            }
        }
        function va(a, b) {
            this.c = a;
            this.a = b
        }
        function Db(a, b) {
            this.c = a;
            this.a = b
        }
        function Ta(a, b) {
            this.c = a;
            this.f = b;
            this.a = []
        }
        var vb = Date.now || function() {
            return +new Date
        }
          , ma = !!window.FontFace;
        x.prototype.c = function(a) {
            for (var b = [], c = 0; c < arguments.length; c++)
                b.push(arguments[c].replace(/[\W_]+/g, "").toLowerCase());
            return b.join(this.a)
        }
        ;
        S.prototype.start = function() {
            var a = this.c.m.document
              , b = this
              , c = vb()
              , d = new Promise(function(d, e) {
                function f() {
                    vb() - c >= b.f ? e() : a.fonts.load(z(b.a), b.h).then(function(a) {
                        1 <= a.length ? d() : setTimeout(f, 25)
                    }, function() {
                        e()
                    })
                }
                f()
            }
            )
              , e = new Promise(function(a, c) {
                setTimeout(c, b.f)
            }
            );
            Promise.race([e, d]).then(function() {
                b.g(b.a)
            }, function() {
                b.j(b.a)
            })
        }
        ;
        var Ia = {
            D: "serif",
            C: "sans-serif"
        }
          , Bb = null;
        Z.prototype.start = function() {
            this.f.serif = this.j.a.offsetWidth;
            this.f["sans-serif"] = this.o.a.offsetWidth;
            this.A = vb();
            ha(this)
        }
        ;
        var Nb = null;
        N.prototype.g = function(a) {
            var b = this.a;
            b.g && h(b.f, [b.a.c("wf", a.c, B(a).toString(), "active")], [b.a.c("wf", a.c, B(a).toString(), "loading"), b.a.c("wf", a.c, B(a).toString(), "inactive")]);
            M(b, "fontactive", a);
            this.o = !0;
            U(this)
        }
        ;
        N.prototype.h = function(a) {
            var b = this.a;
            if (b.g) {
                var c = l(b.f, b.a.c("wf", a.c, B(a).toString(), "active"))
                  , d = []
                  , e = [b.a.c("wf", a.c, B(a).toString(), "loading")];
                c || d.push(b.a.c("wf", a.c, B(a).toString(), "inactive"));
                h(b.f, d, e)
            }
            M(b, "fontinactive", a);
            U(this)
        }
        ;
        ba.prototype.load = function(a) {
            this.c = new d(this.j,a.context || this.j);
            this.g = !1 !== a.events;
            this.f = !1 !== a.classes;
            ka(this, new L(this.c,a), a)
        }
        ;
        ca.prototype.load = function(a) {
            function b() {
                if (f["__mti_fntLst" + d]) {
                    var c = f["__mti_fntLst" + d](), e = [], g;
                    if (c)
                        for (var h = 0; h < c.length; h++) {
                            var l = c[h].fontfamily;
                            void 0 != c[h].fontStyle && void 0 != c[h].fontWeight ? (g = c[h].fontStyle + c[h].fontWeight,
                            e.push(new y(l,g))) : e.push(new y(l))
                        }
                    a(e)
                } else
                    setTimeout(function() {
                        b()
                    }, 50)
            }
            var c = this
              , d = c.a.projectId
              , e = c.a.version;
            if (d) {
                var f = c.c.m;
                q(this.c, la(c, d, e), function(e) {
                    e ? a([]) : (f["__MonotypeConfiguration__" + d] = function() {
                        return c.a
                    }
                    ,
                    b())
                }).id = "__MonotypeAPIScript__" + d
            } else
                a([])
        }
        ;
        ya.prototype.load = function(a) {
            var b, c = this.a.urls || [], d = this.a.families || [], e = this.a.testStrings || {}, f = new r;
            var g = 0;
            for (b = c.length; g < b; g++)
                p(this.c, c[g], u(f));
            var h = [];
            g = 0;
            for (b = d.length; g < b; g++)
                if (c = d[g].split(":"),
                c[1])
                    for (var l = c[1].split(","), m = 0; m < l.length; m += 1)
                        h.push(new y(c[0],l[m]));
                else
                    h.push(new y(c[0]));
            v(f, function() {
                a(h, e)
            })
        }
        ;
        var oa = "//fonts.googleapis.com/css"
          , za = {
            latin: "BESbswy",
            "latin-ext": "\u00e7\u00f6\u00fc\u011f\u015f",
            cyrillic: "\u0439\u044f\u0416",
            greek: "\u03b1\u03b2\u03a3",
            khmer: "\u1780\u1781\u1782",
            Hanuman: "\u1780\u1781\u1782"
        }
          , sa = {
            thin: "1",
            extralight: "2",
            "extra-light": "2",
            ultralight: "2",
            "ultra-light": "2",
            light: "3",
            regular: "4",
            book: "4",
            medium: "5",
            "semi-bold": "6",
            semibold: "6",
            "demi-bold": "6",
            demibold: "6",
            bold: "7",
            "extra-bold": "8",
            extrabold: "8",
            "ultra-bold": "8",
            ultrabold: "8",
            black: "9",
            heavy: "9",
            l: "3",
            r: "4",
            b: "7"
        }
          , qa = {
            i: "i",
            italic: "i",
            n: "n",
            normal: "n"
        }
          , pa = /^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/
          , Da = {
            Arimo: !0,
            Cousine: !0,
            Tinos: !0
        };
        va.prototype.load = function(a) {
            var b = new r
              , c = this.c
              , d = new V(this.a.api,m(c),this.a.text)
              , e = this.a.families;
            Ga(d, e);
            var f = new Qa(e);
            bb(f);
            p(c, Ha(d), u(b));
            v(b, function() {
                a(f.a, f.c, Da)
            })
        }
        ;
        Db.prototype.load = function(a) {
            var b = this.a.id
              , c = this.c.m;
            b ? q(this.c, (this.a.api || "https://use.typekit.net") + "/" + b + ".js", function(b) {
                if (b)
                    a([]);
                else if (c.Typekit && c.Typekit.config && c.Typekit.config.fn) {
                    b = c.Typekit.config.fn;
                    for (var d = [], e = 0; e < b.length; e += 2)
                        for (var f = b[e], g = b[e + 1], h = 0; h < g.length; h++)
                            d.push(new y(f,g[h]));
                    try {
                        c.Typekit.load({
                            events: !1,
                            classes: !1,
                            async: !0
                        })
                    } catch (jb) {}
                    a(d)
                }
            }, 2E3) : a([])
        }
        ;
        Ta.prototype.load = function(a) {
            var b = this.f.id
              , c = this.c.m
              , d = this;
            b ? (c.__webfontfontdeckmodule__ || (c.__webfontfontdeckmodule__ = {}),
            c.__webfontfontdeckmodule__[b] = function(b, c) {
                b = 0;
                for (var e = c.fonts.length; b < e; ++b) {
                    var f = c.fonts[b];
                    d.a.push(new y(f.name,C("font-weight:" + f.weight + ";font-style:" + f.style)))
                }
                a(d.a)
            }
            ,
            q(this.c, m(this.c) + (this.f.api || "//f.fontdeck.com/s/css/js/") + n(this.c) + "/" + b + ".js", function(b) {
                b && a([])
            })) : a([])
        }
        ;
        var P = new ba(window);
        P.a.c.custom = function(a, b) {
            return new ya(b,a)
        }
        ;
        P.a.c.fontdeck = function(a, b) {
            return new Ta(b,a)
        }
        ;
        P.a.c.monotype = function(a, b) {
            return new ca(b,a)
        }
        ;
        P.a.c.typekit = function(a, b) {
            return new Db(b,a)
        }
        ;
        P.a.c.google = function(a, b) {
            return new va(b,a)
        }
        ;
        var fa = {
            load: c(P.load, P)
        };
        "function" === typeof define && define.amd ? define(function() {
            return fa
        }) : "undefined" !== typeof module && module.exports ? module.exports = fa : (window.WebFont = fa,
        window.WebFontConfig && P.load(window.WebFontConfig))
    }
    )();
    var t = {
        REVISION: "71"
    };
    "object" === typeof module && (module.exports = t);
    void 0 === Math.sign && (Math.sign = function(a) {
        return 0 > a ? -1 : 0 < a ? 1 : +a
    }
    );
    t.log = function() {
        console.log.apply(console, arguments)
    }
    ;
    t.warn = function() {
        console.warn.apply(console, arguments)
    }
    ;
    t.error = function() {
        console.error.apply(console, arguments)
    }
    ;
    t.MOUSE = {
        LEFT: 0,
        MIDDLE: 1,
        RIGHT: 2
    };
    t.CullFaceNone = 0;
    t.CullFaceBack = 1;
    t.CullFaceFront = 2;
    t.CullFaceFrontBack = 3;
    t.FrontFaceDirectionCW = 0;
    t.FrontFaceDirectionCCW = 1;
    t.BasicShadowMap = 0;
    t.PCFShadowMap = 1;
    t.PCFSoftShadowMap = 2;
    t.FrontSide = 0;
    t.BackSide = 1;
    t.DoubleSide = 2;
    t.NoShading = 0;
    t.FlatShading = 1;
    t.SmoothShading = 2;
    t.NoColors = 0;
    t.FaceColors = 1;
    t.VertexColors = 2;
    t.NoBlending = 0;
    t.NormalBlending = 1;
    t.AdditiveBlending = 2;
    t.SubtractiveBlending = 3;
    t.MultiplyBlending = 4;
    t.CustomBlending = 5;
    t.AddEquation = 100;
    t.SubtractEquation = 101;
    t.ReverseSubtractEquation = 102;
    t.MinEquation = 103;
    t.MaxEquation = 104;
    t.ZeroFactor = 200;
    t.OneFactor = 201;
    t.SrcColorFactor = 202;
    t.OneMinusSrcColorFactor = 203;
    t.SrcAlphaFactor = 204;
    t.OneMinusSrcAlphaFactor = 205;
    t.DstAlphaFactor = 206;
    t.OneMinusDstAlphaFactor = 207;
    t.DstColorFactor = 208;
    t.OneMinusDstColorFactor = 209;
    t.SrcAlphaSaturateFactor = 210;
    t.MultiplyOperation = 0;
    t.MixOperation = 1;
    t.AddOperation = 2;
    t.UVMapping = 300;
    t.CubeReflectionMapping = 301;
    t.CubeRefractionMapping = 302;
    t.EquirectangularReflectionMapping = 303;
    t.EquirectangularRefractionMapping = 304;
    t.SphericalReflectionMapping = 305;
    t.Color = function(a) {
        return 3 === arguments.length ? this.setRGB(arguments[0], arguments[1], arguments[2]) : this.set(a)
    }
    ;
    t.Color.prototype = {
        constructor: t.Color,
        r: 1,
        g: 1,
        b: 1,
        set: function(a) {
            a instanceof t.Color ? this.copy(a) : "number" === typeof a ? this.setHex(a) : "string" === typeof a && this.setStyle(a);
            return this
        },
        setHex: function(a) {
            a = Math.floor(a);
            this.r = (a >> 16 & 255) / 255;
            this.g = (a >> 8 & 255) / 255;
            this.b = (a & 255) / 255;
            return this
        },
        setRGB: function(a, b, c) {
            this.r = a;
            this.g = b;
            this.b = c;
            return this
        },
        setHSL: function(a, b, c) {
            if (0 === b)
                this.r = this.g = this.b = c;
            else {
                var d = function(a, b, c) {
                    0 > c && (c += 1);
                    1 < c && --c;
                    return c < 1 / 6 ? a + 6 * (b - a) * c : .5 > c ? b : c < 2 / 3 ? a + 6 * (b - a) * (2 / 3 - c) : a
                };
                b = .5 >= c ? c * (1 + b) : c + b - c * b;
                c = 2 * c - b;
                this.r = d(c, b, a + 1 / 3);
                this.g = d(c, b, a);
                this.b = d(c, b, a - 1 / 3)
            }
            return this
        },
        setStyle: function(a) {
            if (/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))
                return a = /^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),
                this.r = Math.min(255, parseInt(a[1], 10)) / 255,
                this.g = Math.min(255, parseInt(a[2], 10)) / 255,
                this.b = Math.min(255, parseInt(a[3], 10)) / 255,
                this;
            if (/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))
                return a = /^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),
                this.r = Math.min(100, parseInt(a[1], 10)) / 100,
                this.g = Math.min(100, parseInt(a[2], 10)) / 100,
                this.b = Math.min(100, parseInt(a[3], 10)) / 100,
                this;
            if (/^#([0-9a-f]{6})$/i.test(a))
                return a = /^#([0-9a-f]{6})$/i.exec(a),
                this.setHex(parseInt(a[1], 16)),
                this;
            if (/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))
                return a = /^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),
                this.setHex(parseInt(a[1] + a[1] + a[2] + a[2] + a[3] + a[3], 16)),
                this;
            if (/^(\w+)$/i.test(a))
                return this.setHex(t.ColorKeywords[a]),
                this
        },
        copy: function(a) {
            this.r = a.r;
            this.g = a.g;
            this.b = a.b;
            return this
        },
        copyGammaToLinear: function(a, b) {
            void 0 === b && (b = 2);
            this.r = Math.pow(a.r, b);
            this.g = Math.pow(a.g, b);
            this.b = Math.pow(a.b, b);
            return this
        },
        copyLinearToGamma: function(a, b) {
            void 0 === b && (b = 2);
            b = 0 < b ? 1 / b : 1;
            this.r = Math.pow(a.r, b);
            this.g = Math.pow(a.g, b);
            this.b = Math.pow(a.b, b);
            return this
        },
        convertGammaToLinear: function() {
            var a = this.r
              , b = this.g
              , c = this.b;
            this.r = a * a;
            this.g = b * b;
            this.b = c * c;
            return this
        },
        convertLinearToGamma: function() {
            this.r = Math.sqrt(this.r);
            this.g = Math.sqrt(this.g);
            this.b = Math.sqrt(this.b);
            return this
        },
        getHex: function() {
            return 255 * this.r << 16 ^ 255 * this.g << 8 ^ 255 * this.b << 0
        },
        getHexString: function() {
            return ("000000" + this.getHex().toString(16)).slice(-6)
        },
        getHSL: function(a) {
            a = a || {
                h: 0,
                s: 0,
                l: 0
            };
            var b = this.r, c = this.g, d = this.b, e = Math.max(b, c, d), f = Math.min(b, c, d), g, h = (f + e) / 2;
            if (f === e)
                f = g = 0;
            else {
                var l = e - f;
                f = .5 >= h ? l / (e + f) : l / (2 - e - f);
                switch (e) {
                case b:
                    g = (c - d) / l + (c < d ? 6 : 0);
                    break;
                case c:
                    g = (d - b) / l + 2;
                    break;
                case d:
                    g = (b - c) / l + 4
                }
                g /= 6
            }
            a.h = g;
            a.s = f;
            a.l = h;
            return a
        },
        getStyle: function() {
            return "rgb(" + (255 * this.r | 0) + "," + (255 * this.g | 0) + "," + (255 * this.b | 0) + ")"
        },
        offsetHSL: function(a, b, c) {
            var d = this.getHSL();
            d.h += a;
            d.s += b;
            d.l += c;
            this.setHSL(d.h, d.s, d.l);
            return this
        },
        add: function(a) {
            this.r += a.r;
            this.g += a.g;
            this.b += a.b;
            return this
        },
        addColors: function(a, b) {
            this.r = a.r + b.r;
            this.g = a.g + b.g;
            this.b = a.b + b.b;
            return this
        },
        addScalar: function(a) {
            this.r += a;
            this.g += a;
            this.b += a;
            return this
        },
        multiply: function(a) {
            this.r *= a.r;
            this.g *= a.g;
            this.b *= a.b;
            return this
        },
        multiplyScalar: function(a) {
            this.r *= a;
            this.g *= a;
            this.b *= a;
            return this
        },
        lerp: function(a, b) {
            this.r += (a.r - this.r) * b;
            this.g += (a.g - this.g) * b;
            this.b += (a.b - this.b) * b;
            return this
        },
        equals: function(a) {
            return a.r === this.r && a.g === this.g && a.b === this.b
        },
        fromArray: function(a) {
            this.r = a[0];
            this.g = a[1];
            this.b = a[2];
            return this
        },
        toArray: function(a, b) {
            void 0 === a && (a = []);
            void 0 === b && (b = 0);
            a[b] = this.r;
            a[b + 1] = this.g;
            a[b + 2] = this.b;
            return a
        },
        clone: function() {
            return (new t.Color).setRGB(this.r, this.g, this.b)
        }
    };
    t.ColorKeywords = {
        aliceblue: 15792383,
        antiquewhite: 16444375,
        aqua: 65535,
        aquamarine: 8388564,
        azure: 15794175,
        beige: 16119260,
        bisque: 16770244,
        black: 0,
        blanchedalmond: 16772045,
        blue: 255,
        blueviolet: 9055202,
        brown: 10824234,
        burlywood: 14596231,
        cadetblue: 6266528,
        chartreuse: 8388352,
        chocolate: 13789470,
        coral: 16744272,
        cornflowerblue: 6591981,
        cornsilk: 16775388,
        crimson: 14423100,
        cyan: 65535,
        darkblue: 139,
        darkcyan: 35723,
        darkgoldenrod: 12092939,
        darkgray: 11119017,
        darkgreen: 25600,
        darkgrey: 11119017,
        darkkhaki: 12433259,
        darkmagenta: 9109643,
        darkolivegreen: 5597999,
        darkorange: 16747520,
        darkorchid: 10040012,
        darkred: 9109504,
        darksalmon: 15308410,
        darkseagreen: 9419919,
        darkslateblue: 4734347,
        darkslategray: 3100495,
        darkslategrey: 3100495,
        darkturquoise: 52945,
        darkviolet: 9699539,
        deeppink: 16716947,
        deepskyblue: 49151,
        dimgray: 6908265,
        dimgrey: 6908265,
        dodgerblue: 2003199,
        firebrick: 11674146,
        floralwhite: 16775920,
        forestgreen: 2263842,
        fuchsia: 16711935,
        gainsboro: 14474460,
        ghostwhite: 16316671,
        gold: 16766720,
        goldenrod: 14329120,
        gray: 8421504,
        green: 32768,
        greenyellow: 11403055,
        grey: 8421504,
        honeydew: 15794160,
        hotpink: 16738740,
        indianred: 13458524,
        indigo: 4915330,
        ivory: 16777200,
        khaki: 15787660,
        lavender: 15132410,
        lavenderblush: 16773365,
        lawngreen: 8190976,
        lemonchiffon: 16775885,
        lightblue: 11393254,
        lightcoral: 15761536,
        lightcyan: 14745599,
        lightgoldenrodyellow: 16448210,
        lightgray: 13882323,
        lightgreen: 9498256,
        lightgrey: 13882323,
        lightpink: 16758465,
        lightsalmon: 16752762,
        lightseagreen: 2142890,
        lightskyblue: 8900346,
        lightslategray: 7833753,
        lightslategrey: 7833753,
        lightsteelblue: 11584734,
        lightyellow: 16777184,
        lime: 65280,
        limegreen: 3329330,
        linen: 16445670,
        magenta: 16711935,
        maroon: 8388608,
        mediumaquamarine: 6737322,
        mediumblue: 205,
        mediumorchid: 12211667,
        mediumpurple: 9662683,
        mediumseagreen: 3978097,
        mediumslateblue: 8087790,
        mediumspringgreen: 64154,
        mediumturquoise: 4772300,
        mediumvioletred: 13047173,
        midnightblue: 1644912,
        mintcream: 16121850,
        mistyrose: 16770273,
        moccasin: 16770229,
        navajowhite: 16768685,
        navy: 128,
        oldlace: 16643558,
        olive: 8421376,
        olivedrab: 7048739,
        orange: 16753920,
        orangered: 16729344,
        orchid: 14315734,
        palegoldenrod: 15657130,
        palegreen: 10025880,
        paleturquoise: 11529966,
        palevioletred: 14381203,
        papayawhip: 16773077,
        peachpuff: 16767673,
        peru: 13468991,
        pink: 16761035,
        plum: 14524637,
        powderblue: 11591910,
        purple: 8388736,
        red: 16711680,
        rosybrown: 12357519,
        royalblue: 4286945,
        saddlebrown: 9127187,
        salmon: 16416882,
        sandybrown: 16032864,
        seagreen: 3050327,
        seashell: 16774638,
        sienna: 10506797,
        silver: 12632256,
        skyblue: 8900331,
        slateblue: 6970061,
        slategray: 7372944,
        slategrey: 7372944,
        snow: 16775930,
        springgreen: 65407,
        steelblue: 4620980,
        tan: 13808780,
        teal: 32896,
        thistle: 14204888,
        tomato: 16737095,
        turquoise: 4251856,
        violet: 15631086,
        wheat: 16113331,
        white: 16777215,
        whitesmoke: 16119285,
        yellow: 16776960,
        yellowgreen: 10145074
    };
    t.Quaternion = function(a, b, c, d) {
        this._x = a || 0;
        this._y = b || 0;
        this._z = c || 0;
        this._w = void 0 !== d ? d : 1
    }
    ;
    t.Quaternion.prototype = {
        constructor: t.Quaternion,
        _x: 0,
        _y: 0,
        _z: 0,
        _w: 0,
        get x() {
            return this._x
        },
        set x(a) {
            this._x = a;
            this.onChangeCallback()
        },
        get y() {
            return this._y
        },
        set y(a) {
            this._y = a;
            this.onChangeCallback()
        },
        get z() {
            return this._z
        },
        set z(a) {
            this._z = a;
            this.onChangeCallback()
        },
        get w() {
            return this._w
        },
        set w(a) {
            this._w = a;
            this.onChangeCallback()
        },
        set: function(a, b, c, d) {
            this._x = a;
            this._y = b;
            this._z = c;
            this._w = d;
            this.onChangeCallback();
            return this
        },
        copy: function(a) {
            this._x = a.x;
            this._y = a.y;
            this._z = a.z;
            this._w = a.w;
            this.onChangeCallback();
            return this
        },
        setFromEuler: function(a, b) {
            if (!1 === a instanceof t.Euler)
                throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
            var c = Math.cos(a._x / 2)
              , d = Math.cos(a._y / 2)
              , e = Math.cos(a._z / 2)
              , f = Math.sin(a._x / 2)
              , g = Math.sin(a._y / 2)
              , h = Math.sin(a._z / 2);
            "XYZ" === a.order ? (this._x = f * d * e + c * g * h,
            this._y = c * g * e - f * d * h,
            this._z = c * d * h + f * g * e,
            this._w = c * d * e - f * g * h) : "YXZ" === a.order ? (this._x = f * d * e + c * g * h,
            this._y = c * g * e - f * d * h,
            this._z = c * d * h - f * g * e,
            this._w = c * d * e + f * g * h) : "ZXY" === a.order ? (this._x = f * d * e - c * g * h,
            this._y = c * g * e + f * d * h,
            this._z = c * d * h + f * g * e,
            this._w = c * d * e - f * g * h) : "ZYX" === a.order ? (this._x = f * d * e - c * g * h,
            this._y = c * g * e + f * d * h,
            this._z = c * d * h - f * g * e,
            this._w = c * d * e + f * g * h) : "YZX" === a.order ? (this._x = f * d * e + c * g * h,
            this._y = c * g * e + f * d * h,
            this._z = c * d * h - f * g * e,
            this._w = c * d * e - f * g * h) : "XZY" === a.order && (this._x = f * d * e - c * g * h,
            this._y = c * g * e - f * d * h,
            this._z = c * d * h + f * g * e,
            this._w = c * d * e + f * g * h);
            if (!1 !== b)
                this.onChangeCallback();
            return this
        },
        setFromAxisAngle: function(a, b) {
            b /= 2;
            var c = Math.sin(b);
            this._x = a.x * c;
            this._y = a.y * c;
            this._z = a.z * c;
            this._w = Math.cos(b);
            this.onChangeCallback();
            return this
        },
        setFromRotationMatrix: function(a) {
            var b = a.elements
              , c = b[0];
            a = b[4];
            var d = b[8]
              , e = b[1]
              , f = b[5]
              , g = b[9]
              , h = b[2]
              , l = b[6];
            b = b[10];
            var m = c + f + b;
            0 < m ? (c = .5 / Math.sqrt(m + 1),
            this._w = .25 / c,
            this._x = (l - g) * c,
            this._y = (d - h) * c,
            this._z = (e - a) * c) : c > f && c > b ? (c = 2 * Math.sqrt(1 + c - f - b),
            this._w = (l - g) / c,
            this._x = .25 * c,
            this._y = (a + e) / c,
            this._z = (d + h) / c) : f > b ? (c = 2 * Math.sqrt(1 + f - c - b),
            this._w = (d - h) / c,
            this._x = (a + e) / c,
            this._y = .25 * c,
            this._z = (g + l) / c) : (c = 2 * Math.sqrt(1 + b - c - f),
            this._w = (e - a) / c,
            this._x = (d + h) / c,
            this._y = (g + l) / c,
            this._z = .25 * c);
            this.onChangeCallback();
            return this
        },
        setFromUnitVectors: function() {
            var a, b;
            return function(c, d) {
                void 0 === a && (a = new t.Vector3);
                b = c.dot(d) + 1;
                1E-6 > b ? (b = 0,
                Math.abs(c.x) > Math.abs(c.z) ? a.set(-c.y, c.x, 0) : a.set(0, -c.z, c.y)) : a.crossVectors(c, d);
                this._x = a.x;
                this._y = a.y;
                this._z = a.z;
                this._w = b;
                this.normalize();
                return this
            }
        }(),
        inverse: function() {
            this.conjugate().normalize();
            return this
        },
        conjugate: function() {
            this._x *= -1;
            this._y *= -1;
            this._z *= -1;
            this.onChangeCallback();
            return this
        },
        dot: function(a) {
            return this._x * a._x + this._y * a._y + this._z * a._z + this._w * a._w
        },
        lengthSq: function() {
            return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w
        },
        length: function() {
            return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w)
        },
        normalize: function() {
            var a = this.length();
            0 === a ? (this._z = this._y = this._x = 0,
            this._w = 1) : (a = 1 / a,
            this._x *= a,
            this._y *= a,
            this._z *= a,
            this._w *= a);
            this.onChangeCallback();
            return this
        },
        multiply: function(a, b) {
            return void 0 !== b ? (t.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),
            this.multiplyQuaternions(a, b)) : this.multiplyQuaternions(this, a)
        },
        multiplyQuaternions: function(a, b) {
            var c = a._x
              , d = a._y
              , e = a._z;
            a = a._w;
            var f = b._x
              , g = b._y
              , h = b._z;
            b = b._w;
            this._x = c * b + a * f + d * h - e * g;
            this._y = d * b + a * g + e * f - c * h;
            this._z = e * b + a * h + c * g - d * f;
            this._w = a * b - c * f - d * g - e * h;
            this.onChangeCallback();
            return this
        },
        multiplyVector3: function(a) {
            t.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
            return a.applyQuaternion(this)
        },
        slerp: function(a, b) {
            if (0 === b)
                return this;
            if (1 === b)
                return this.copy(a);
            var c = this._x
              , d = this._y
              , e = this._z
              , f = this._w
              , g = f * a._w + c * a._x + d * a._y + e * a._z;
            0 > g ? (this._w = -a._w,
            this._x = -a._x,
            this._y = -a._y,
            this._z = -a._z,
            g = -g) : this.copy(a);
            if (1 <= g)
                return this._w = f,
                this._x = c,
                this._y = d,
                this._z = e,
                this;
            a = Math.acos(g);
            var h = Math.sqrt(1 - g * g);
            if (.001 > Math.abs(h))
                return this._w = .5 * (f + this._w),
                this._x = .5 * (c + this._x),
                this._y = .5 * (d + this._y),
                this._z = .5 * (e + this._z),
                this;
            g = Math.sin((1 - b) * a) / h;
            b = Math.sin(b * a) / h;
            this._w = f * g + this._w * b;
            this._x = c * g + this._x * b;
            this._y = d * g + this._y * b;
            this._z = e * g + this._z * b;
            this.onChangeCallback();
            return this
        },
        equals: function(a) {
            return a._x === this._x && a._y === this._y && a._z === this._z && a._w === this._w
        },
        fromArray: function(a, b) {
            void 0 === b && (b = 0);
            this._x = a[b];
            this._y = a[b + 1];
            this._z = a[b + 2];
            this._w = a[b + 3];
            this.onChangeCallback();
            return this
        },
        toArray: function(a, b) {
            void 0 === a && (a = []);
            void 0 === b && (b = 0);
            a[b] = this._x;
            a[b + 1] = this._y;
            a[b + 2] = this._z;
            a[b + 3] = this._w;
            return a
        },
        onChange: function(a) {
            this.onChangeCallback = a;
            return this
        },
        onChangeCallback: function() {},
        clone: function() {
            return new t.Quaternion(this._x,this._y,this._z,this._w)
        }
    };
    t.Quaternion.slerp = function(a, b, c, d) {
        return c.copy(a).slerp(b, d)
    }
    ;
    t.Vector2 = function(a, b) {
        this.x = a || 0;
        this.y = b || 0
    }
    ;
    t.Vector2.prototype = {
        constructor: t.Vector2,
        set: function(a, b) {
            this.x = a;
            this.y = b;
            return this
        },
        setX: function(a) {
            this.x = a;
            return this
        },
        setY: function(a) {
            this.y = a;
            return this
        },
        setComponent: function(a, b) {
            switch (a) {
            case 0:
                this.x = b;
                break;
            case 1:
                this.y = b;
                break;
            default:
                throw Error("index is out of range: " + a);
            }
        },
        getComponent: function(a) {
            switch (a) {
            case 0:
                return this.x;
            case 1:
                return this.y;
            default:
                throw Error("index is out of range: " + a);
            }
        },
        copy: function(a) {
            this.x = a.x;
            this.y = a.y;
            return this
        },
        add: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
                this.addVectors(a, b);
            this.x += a.x;
            this.y += a.y;
            return this
        },
        addScalar: function(a) {
            this.x += a;
            this.y += a;
            return this
        },
        addVectors: function(a, b) {
            this.x = a.x + b.x;
            this.y = a.y + b.y;
            return this
        },
        sub: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
                this.subVectors(a, b);
            this.x -= a.x;
            this.y -= a.y;
            return this
        },
        subScalar: function(a) {
            this.x -= a;
            this.y -= a;
            return this
        },
        subVectors: function(a, b) {
            this.x = a.x - b.x;
            this.y = a.y - b.y;
            return this
        },
        multiply: function(a) {
            this.x *= a.x;
            this.y *= a.y;
            return this
        },
        multiplyScalar: function(a) {
            this.x *= a;
            this.y *= a;
            return this
        },
        divide: function(a) {
            this.x /= a.x;
            this.y /= a.y;
            return this
        },
        divideScalar: function(a) {
            0 !== a ? (a = 1 / a,
            this.x *= a,
            this.y *= a) : this.y = this.x = 0;
            return this
        },
        min: function(a) {
            this.x > a.x && (this.x = a.x);
            this.y > a.y && (this.y = a.y);
            return this
        },
        max: function(a) {
            this.x < a.x && (this.x = a.x);
            this.y < a.y && (this.y = a.y);
            return this
        },
        clamp: function(a, b) {
            this.x < a.x ? this.x = a.x : this.x > b.x && (this.x = b.x);
            this.y < a.y ? this.y = a.y : this.y > b.y && (this.y = b.y);
            return this
        },
        clampScalar: function() {
            var a, b;
            return function(c, d) {
                void 0 === a && (a = new t.Vector2,
                b = new t.Vector2);
                a.set(c, c);
                b.set(d, d);
                return this.clamp(a, b)
            }
        }(),
        floor: function() {
            this.x = Math.floor(this.x);
            this.y = Math.floor(this.y);
            return this
        },
        ceil: function() {
            this.x = Math.ceil(this.x);
            this.y = Math.ceil(this.y);
            return this
        },
        round: function() {
            this.x = Math.round(this.x);
            this.y = Math.round(this.y);
            return this
        },
        roundToZero: function() {
            this.x = 0 > this.x ? Math.ceil(this.x) : Math.floor(this.x);
            this.y = 0 > this.y ? Math.ceil(this.y) : Math.floor(this.y);
            return this
        },
        negate: function() {
            this.x = -this.x;
            this.y = -this.y;
            return this
        },
        dot: function(a) {
            return this.x * a.x + this.y * a.y
        },
        lengthSq: function() {
            return this.x * this.x + this.y * this.y
        },
        length: function() {
            return Math.sqrt(this.x * this.x + this.y * this.y)
        },
        normalize: function() {
            return this.divideScalar(this.length())
        },
        distanceTo: function(a) {
            return Math.sqrt(this.distanceToSquared(a))
        },
        distanceToSquared: function(a) {
            var b = this.x - a.x;
            a = this.y - a.y;
            return b * b + a * a
        },
        setLength: function(a) {
            var b = this.length();
            0 !== b && a !== b && this.multiplyScalar(a / b);
            return this
        },
        lerp: function(a, b) {
            this.x += (a.x - this.x) * b;
            this.y += (a.y - this.y) * b;
            return this
        },
        lerpVectors: function(a, b, c) {
            this.subVectors(b, a).multiplyScalar(c).add(a);
            return this
        },
        equals: function(a) {
            return a.x === this.x && a.y === this.y
        },
        fromArray: function(a, b) {
            void 0 === b && (b = 0);
            this.x = a[b];
            this.y = a[b + 1];
            return this
        },
        toArray: function(a, b) {
            void 0 === a && (a = []);
            void 0 === b && (b = 0);
            a[b] = this.x;
            a[b + 1] = this.y;
            return a
        },
        fromAttribute: function(a, b, c) {
            void 0 === c && (c = 0);
            b = b * a.itemSize + c;
            this.x = a.array[b];
            this.y = a.array[b + 1];
            return this
        },
        clone: function() {
            return new t.Vector2(this.x,this.y)
        }
    };
    t.Vector3 = function(a, b, c) {
        this.x = a || 0;
        this.y = b || 0;
        this.z = c || 0
    }
    ;
    t.Vector3.prototype = {
        constructor: t.Vector3,
        set: function(a, b, c) {
            this.x = a;
            this.y = b;
            this.z = c;
            return this
        },
        setX: function(a) {
            this.x = a;
            return this
        },
        setY: function(a) {
            this.y = a;
            return this
        },
        setZ: function(a) {
            this.z = a;
            return this
        },
        setComponent: function(a, b) {
            switch (a) {
            case 0:
                this.x = b;
                break;
            case 1:
                this.y = b;
                break;
            case 2:
                this.z = b;
                break;
            default:
                throw Error("index is out of range: " + a);
            }
        },
        getComponent: function(a) {
            switch (a) {
            case 0:
                return this.x;
            case 1:
                return this.y;
            case 2:
                return this.z;
            default:
                throw Error("index is out of range: " + a);
            }
        },
        copy: function(a) {
            this.x = a.x;
            this.y = a.y;
            this.z = a.z;
            return this
        },
        add: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
                this.addVectors(a, b);
            this.x += a.x;
            this.y += a.y;
            this.z += a.z;
            return this
        },
        addScalar: function(a) {
            this.x += a;
            this.y += a;
            this.z += a;
            return this
        },
        addVectors: function(a, b) {
            this.x = a.x + b.x;
            this.y = a.y + b.y;
            this.z = a.z + b.z;
            return this
        },
        sub: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
                this.subVectors(a, b);
            this.x -= a.x;
            this.y -= a.y;
            this.z -= a.z;
            return this
        },
        subScalar: function(a) {
            this.x -= a;
            this.y -= a;
            this.z -= a;
            return this
        },
        subVectors: function(a, b) {
            this.x = a.x - b.x;
            this.y = a.y - b.y;
            this.z = a.z - b.z;
            return this
        },
        multiply: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),
                this.multiplyVectors(a, b);
            this.x *= a.x;
            this.y *= a.y;
            this.z *= a.z;
            return this
        },
        multiplyScalar: function(a) {
            this.x *= a;
            this.y *= a;
            this.z *= a;
            return this
        },
        multiplyVectors: function(a, b) {
            this.x = a.x * b.x;
            this.y = a.y * b.y;
            this.z = a.z * b.z;
            return this
        },
        applyEuler: function() {
            var a;
            return function(b) {
                !1 === b instanceof t.Euler && t.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");
                void 0 === a && (a = new t.Quaternion);
                this.applyQuaternion(a.setFromEuler(b));
                return this
            }
        }(),
        applyAxisAngle: function() {
            var a;
            return function(b, c) {
                void 0 === a && (a = new t.Quaternion);
                this.applyQuaternion(a.setFromAxisAngle(b, c));
                return this
            }
        }(),
        applyMatrix3: function(a) {
            var b = this.x
              , c = this.y
              , d = this.z;
            a = a.elements;
            this.x = a[0] * b + a[3] * c + a[6] * d;
            this.y = a[1] * b + a[4] * c + a[7] * d;
            this.z = a[2] * b + a[5] * c + a[8] * d;
            return this
        },
        applyMatrix4: function(a) {
            var b = this.x
              , c = this.y
              , d = this.z;
            a = a.elements;
            this.x = a[0] * b + a[4] * c + a[8] * d + a[12];
            this.y = a[1] * b + a[5] * c + a[9] * d + a[13];
            this.z = a[2] * b + a[6] * c + a[10] * d + a[14];
            return this
        },
        applyProjection: function(a) {
            var b = this.x
              , c = this.y
              , d = this.z;
            a = a.elements;
            var e = 1 / (a[3] * b + a[7] * c + a[11] * d + a[15]);
            this.x = (a[0] * b + a[4] * c + a[8] * d + a[12]) * e;
            this.y = (a[1] * b + a[5] * c + a[9] * d + a[13]) * e;
            this.z = (a[2] * b + a[6] * c + a[10] * d + a[14]) * e;
            return this
        },
        applyQuaternion: function(a) {
            var b = this.x
              , c = this.y
              , d = this.z
              , e = a.x
              , f = a.y
              , g = a.z;
            a = a.w;
            var h = a * b + f * d - g * c
              , l = a * c + g * b - e * d
              , m = a * d + e * c - f * b;
            b = -e * b - f * c - g * d;
            this.x = h * a + b * -e + l * -g - m * -f;
            this.y = l * a + b * -f + m * -e - h * -g;
            this.z = m * a + b * -g + h * -f - l * -e;
            return this
        },
        project: function() {
            var a;
            return function(b) {
                void 0 === a && (a = new t.Matrix4);
                a.multiplyMatrices(b.projectionMatrix, a.getInverse(b.matrixWorld));
                return this.applyProjection(a)
            }
        }(),
        unproject: function() {
            var a;
            return function(b) {
                void 0 === a && (a = new t.Matrix4);
                a.multiplyMatrices(b.matrixWorld, a.getInverse(b.projectionMatrix));
                return this.applyProjection(a)
            }
        }(),
        transformDirection: function(a) {
            var b = this.x
              , c = this.y
              , d = this.z;
            a = a.elements;
            this.x = a[0] * b + a[4] * c + a[8] * d;
            this.y = a[1] * b + a[5] * c + a[9] * d;
            this.z = a[2] * b + a[6] * c + a[10] * d;
            this.normalize();
            return this
        },
        divide: function(a) {
            this.x /= a.x;
            this.y /= a.y;
            this.z /= a.z;
            return this
        },
        divideScalar: function(a) {
            0 !== a ? (a = 1 / a,
            this.x *= a,
            this.y *= a,
            this.z *= a) : this.z = this.y = this.x = 0;
            return this
        },
        min: function(a) {
            this.x > a.x && (this.x = a.x);
            this.y > a.y && (this.y = a.y);
            this.z > a.z && (this.z = a.z);
            return this
        },
        max: function(a) {
            this.x < a.x && (this.x = a.x);
            this.y < a.y && (this.y = a.y);
            this.z < a.z && (this.z = a.z);
            return this
        },
        clamp: function(a, b) {
            this.x < a.x ? this.x = a.x : this.x > b.x && (this.x = b.x);
            this.y < a.y ? this.y = a.y : this.y > b.y && (this.y = b.y);
            this.z < a.z ? this.z = a.z : this.z > b.z && (this.z = b.z);
            return this
        },
        clampScalar: function() {
            var a, b;
            return function(c, d) {
                void 0 === a && (a = new t.Vector3,
                b = new t.Vector3);
                a.set(c, c, c);
                b.set(d, d, d);
                return this.clamp(a, b)
            }
        }(),
        floor: function() {
            this.x = Math.floor(this.x);
            this.y = Math.floor(this.y);
            this.z = Math.floor(this.z);
            return this
        },
        ceil: function() {
            this.x = Math.ceil(this.x);
            this.y = Math.ceil(this.y);
            this.z = Math.ceil(this.z);
            return this
        },
        round: function() {
            this.x = Math.round(this.x);
            this.y = Math.round(this.y);
            this.z = Math.round(this.z);
            return this
        },
        roundToZero: function() {
            this.x = 0 > this.x ? Math.ceil(this.x) : Math.floor(this.x);
            this.y = 0 > this.y ? Math.ceil(this.y) : Math.floor(this.y);
            this.z = 0 > this.z ? Math.ceil(this.z) : Math.floor(this.z);
            return this
        },
        negate: function() {
            this.x = -this.x;
            this.y = -this.y;
            this.z = -this.z;
            return this
        },
        dot: function(a) {
            return this.x * a.x + this.y * a.y + this.z * a.z
        },
        lengthSq: function() {
            return this.x * this.x + this.y * this.y + this.z * this.z
        },
        length: function() {
            return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
        },
        lengthManhattan: function() {
            return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z)
        },
        normalize: function() {
            return this.divideScalar(this.length())
        },
        setLength: function(a) {
            var b = this.length();
            0 !== b && a !== b && this.multiplyScalar(a / b);
            return this
        },
        lerp: function(a, b) {
            this.x += (a.x - this.x) * b;
            this.y += (a.y - this.y) * b;
            this.z += (a.z - this.z) * b;
            return this
        },
        lerpVectors: function(a, b, c) {
            this.subVectors(b, a).multiplyScalar(c).add(a);
            return this
        },
        cross: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),
                this.crossVectors(a, b);
            b = this.x;
            var c = this.y
              , d = this.z;
            this.x = c * a.z - d * a.y;
            this.y = d * a.x - b * a.z;
            this.z = b * a.y - c * a.x;
            return this
        },
        crossVectors: function(a, b) {
            var c = a.x
              , d = a.y;
            a = a.z;
            var e = b.x
              , f = b.y;
            b = b.z;
            this.x = d * b - a * f;
            this.y = a * e - c * b;
            this.z = c * f - d * e;
            return this
        },
        projectOnVector: function() {
            var a, b;
            return function(c) {
                void 0 === a && (a = new t.Vector3);
                a.copy(c).normalize();
                b = this.dot(a);
                return this.copy(a).multiplyScalar(b)
            }
        }(),
        projectOnPlane: function() {
            var a;
            return function(b) {
                void 0 === a && (a = new t.Vector3);
                a.copy(this).projectOnVector(b);
                return this.sub(a)
            }
        }(),
        reflect: function() {
            var a;
            return function(b) {
                void 0 === a && (a = new t.Vector3);
                return this.sub(a.copy(b).multiplyScalar(2 * this.dot(b)))
            }
        }(),
        angleTo: function(a) {
            a = this.dot(a) / (this.length() * a.length());
            return Math.acos(t.Math.clamp(a, -1, 1))
        },
        distanceTo: function(a) {
            return Math.sqrt(this.distanceToSquared(a))
        },
        distanceToSquared: function(a) {
            var b = this.x - a.x
              , c = this.y - a.y;
            a = this.z - a.z;
            return b * b + c * c + a * a
        },
        setEulerFromRotationMatrix: function() {
            t.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")
        },
        setEulerFromQuaternion: function() {
            t.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")
        },
        getPositionFromMatrix: function(a) {
            t.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");
            return this.setFromMatrixPosition(a)
        },
        getScaleFromMatrix: function(a) {
            t.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
            return this.setFromMatrixScale(a)
        },
        getColumnFromMatrix: function(a, b) {
            t.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");
            return this.setFromMatrixColumn(a, b)
        },
        setFromMatrixPosition: function(a) {
            this.x = a.elements[12];
            this.y = a.elements[13];
            this.z = a.elements[14];
            return this
        },
        setFromMatrixScale: function(a) {
            var b = this.set(a.elements[0], a.elements[1], a.elements[2]).length()
              , c = this.set(a.elements[4], a.elements[5], a.elements[6]).length();
            a = this.set(a.elements[8], a.elements[9], a.elements[10]).length();
            this.x = b;
            this.y = c;
            this.z = a;
            return this
        },
        setFromMatrixColumn: function(a, b) {
            a *= 4;
            b = b.elements;
            this.x = b[a];
            this.y = b[a + 1];
            this.z = b[a + 2];
            return this
        },
        equals: function(a) {
            return a.x === this.x && a.y === this.y && a.z === this.z
        },
        fromArray: function(a, b) {
            void 0 === b && (b = 0);
            this.x = a[b];
            this.y = a[b + 1];
            this.z = a[b + 2];
            return this
        },
        toArray: function(a, b) {
            void 0 === a && (a = []);
            void 0 === b && (b = 0);
            a[b] = this.x;
            a[b + 1] = this.y;
            a[b + 2] = this.z;
            return a
        },
        fromAttribute: function(a, b, c) {
            void 0 === c && (c = 0);
            b = b * a.itemSize + c;
            this.x = a.array[b];
            this.y = a.array[b + 1];
            this.z = a.array[b + 2];
            return this
        },
        clone: function() {
            return new t.Vector3(this.x,this.y,this.z)
        }
    };
    t.Vector4 = function(a, b, c, d) {
        this.x = a || 0;
        this.y = b || 0;
        this.z = c || 0;
        this.w = void 0 !== d ? d : 1
    }
    ;
    t.Vector4.prototype = {
        constructor: t.Vector4,
        set: function(a, b, c, d) {
            this.x = a;
            this.y = b;
            this.z = c;
            this.w = d;
            return this
        },
        setX: function(a) {
            this.x = a;
            return this
        },
        setY: function(a) {
            this.y = a;
            return this
        },
        setZ: function(a) {
            this.z = a;
            return this
        },
        setW: function(a) {
            this.w = a;
            return this
        },
        setComponent: function(a, b) {
            switch (a) {
            case 0:
                this.x = b;
                break;
            case 1:
                this.y = b;
                break;
            case 2:
                this.z = b;
                break;
            case 3:
                this.w = b;
                break;
            default:
                throw Error("index is out of range: " + a);
            }
        },
        getComponent: function(a) {
            switch (a) {
            case 0:
                return this.x;
            case 1:
                return this.y;
            case 2:
                return this.z;
            case 3:
                return this.w;
            default:
                throw Error("index is out of range: " + a);
            }
        },
        copy: function(a) {
            this.x = a.x;
            this.y = a.y;
            this.z = a.z;
            this.w = void 0 !== a.w ? a.w : 1;
            return this
        },
        add: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
                this.addVectors(a, b);
            this.x += a.x;
            this.y += a.y;
            this.z += a.z;
            this.w += a.w;
            return this
        },
        addScalar: function(a) {
            this.x += a;
            this.y += a;
            this.z += a;
            this.w += a;
            return this
        },
        addVectors: function(a, b) {
            this.x = a.x + b.x;
            this.y = a.y + b.y;
            this.z = a.z + b.z;
            this.w = a.w + b.w;
            return this
        },
        sub: function(a, b) {
            if (void 0 !== b)
                return t.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
                this.subVectors(a, b);
            this.x -= a.x;
            this.y -= a.y;
            this.z -= a.z;
            this.w -= a.w;
            return this
        },
        subScalar: function(a) {
            this.x -= a;
            this.y -= a;
            this.z -= a;
            this.w -= a;
            return this
        },
        subVectors: function(a, b) {
            this.x = a.x - b.x;
            this.y = a.y - b.y;
            this.z = a.z - b.z;
            this.w = a.w - b.w;
            return this
        },
        multiplyScalar: function(a) {
            this.x *= a;
            this.y *= a;
            this.z *= a;
            this.w *= a;
            return this
        },
        applyMatrix4: function(a) {
            var b = this.x
              , c = this.y
              , d = this.z
              , e = this.w;
            a = a.elements;
            this.x = a[0] * b + a[4] * c + a[8] * d + a[12] * e;
            this.y = a[1] * b + a[5] * c + a[9] * d + a[13] * e;
            this.z = a[2] * b + a[6] * c + a[10] * d + a[14] * e;
            this.w = a[3] * b + a[7] * c + a[11] * d + a[15] * e;
            return this
        },
        divideScalar: function(a) {
            0 !== a ? (a = 1 / a,
            this.x *= a,
            this.y *= a,
            this.z *= a,
            this.w *= a) : (this.z = this.y = this.x = 0,
            this.w = 1);
            return this
        },
        setAxisAngleFromQuaternion: function(a) {
            this.w = 2 * Math.acos(a.w);
            var b = Math.sqrt(1 - a.w * a.w);
            1E-4 > b ? (this.x = 1,
            this.z = this.y = 0) : (this.x = a.x / b,
            this.y = a.y / b,
            this.z = a.z / b);
            return this
        },
        setAxisAngleFromRotationMatrix: function(a) {
            a = a.elements;
            var b = a[0];
            var c = a[4];
            var d = a[8]
              , e = a[1]
              , f = a[5]
              , g = a[9];
            var h = a[2];
            var l = a[6];
            var m = a[10];
            if (.01 > Math.abs(c - e) && .01 > Math.abs(d - h) && .01 > Math.abs(g - l)) {
                if (.1 > Math.abs(c + e) && .1 > Math.abs(d + h) && .1 > Math.abs(g + l) && .1 > Math.abs(b + f + m - 3))
                    return this.set(1, 0, 0, 0),
                    this;
                a = Math.PI;
                b = (b + 1) / 2;
                f = (f + 1) / 2;
                m = (m + 1) / 2;
                c = (c + e) / 4;
                d = (d + h) / 4;
                g = (g + l) / 4;
                b > f && b > m ? .01 > b ? (l = 0,
                c = h = .707106781) : (l = Math.sqrt(b),
                h = c / l,
                c = d / l) : f > m ? .01 > f ? (l = .707106781,
                h = 0,
                c = .707106781) : (h = Math.sqrt(f),
                l = c / h,
                c = g / h) : .01 > m ? (h = l = .707106781,
                c = 0) : (c = Math.sqrt(m),
                l = d / c,
                h = g / c);
                this.set(l, h, c, a);
                return this
            }
            a = Math.sqrt((l - g) * (l - g) + (d - h) * (d - h) + (e - c) * (e - c));
            .001 > Math.abs(a) && (a = 1);
            this.x = (l - g) / a;
            this.y = (d - h) / a;
            this.z = (e - c) / a;
            this.w = Math.acos((b + f + m - 1) / 2);
            return this
        },
        min: function(a) {
            this.x > a.x && (this.x = a.x);
            this.y > a.y && (this.y = a.y);
            this.z > a.z && (this.z = a.z);
            this.w > a.w && (this.w = a.w);
            return this
        },
        max: function(a) {
            this.x < a.x && (this.x = a.x);
            this.y < a.y && (this.y = a.y);
            this.z < a.z && (this.z = a.z);
            this.w < a.w && (this.w = a.w);
            return this
        },
        clamp: function(a, b) {
            this.x < a.x ? this.x = a.x : this.x > b.x && (this.x = b.x);
            this.y < a.y ? this.y = a.y : this.y > b.y && (this.y = b.y);
            this.z < a.z ? this.z = a.z : this.z > b.z && (this.z = b.z);
            this.w < a.w ? this.w = a.w : this.w > b.w && (this.w = b.w);
            return this
        },
        clampScalar: function() {
            var a, b;
            return function(c, d) {
                void 0 === a && (a = new t.Vector4,
                b = new t.Vector4);
                a.set(c, c, c, c);
                b.set(d, d, d, d);
                return this.clamp(a, b)
            }
        }(),
        floor: function() {
            this.x = Math.floor(this.x);
            this.y = Math.floor(this.y);
            this.z = Math.floor(this.z);
            this.w = Math.floor(this.w);
            return this
        },
        ceil: function() {
            this.x = Math.ceil(this.x);
            this.y = Math.ceil(this.y);
            this.z = Math.ceil(this.z);
            this.w = Math.ceil(this.w);
            return this
        },
        round: function() {
            this.x = Math.round(this.x);
            this.y = Math.round(this.y);
            this.z = Math.round(this.z);
            this.w = Math.round(this.w);
            return this
        },
        roundToZero: function() {
            this.x = 0 > this.x ? Math.ceil(this.x) : Math.floor(this.x);
            this.y = 0 > this.y ? Math.ceil(this.y) : Math.floor(this.y);
            this.z = 0 > this.z ? Math.ceil(this.z) : Math.floor(this.z);
            this.w = 0 > this.w ? Math.ceil(this.w) : Math.floor(this.w);
            return this
        },
        negate: function() {
            this.x = -this.x;
            this.y = -this.y;
            this.z = -this.z;
            this.w = -this.w;
            return this
        },
        dot: function(a) {
            return this.x * a.x + this.y * a.y + this.z * a.z + this.w * a.w
        },
        lengthSq: function() {
            return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
        },
        length: function() {
            return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
        },
        lengthManhattan: function() {
            return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w)
        },
        normalize: function() {
            return this.divideScalar(this.length())
        },
        setLength: function(a) {
            var b = this.length();
            0 !== b && a !== b && this.multiplyScalar(a / b);
            return this
        },
        lerp: function(a, b) {
            this.x += (a.x - this.x) * b;
            this.y += (a.y - this.y) * b;
            this.z += (a.z - this.z) * b;
            this.w += (a.w - this.w) * b;
            return this
        },
        lerpVectors: function(a, b, c) {
            this.subVectors(b, a).multiplyScalar(c).add(a);
            return this
        },
        equals: function(a) {
            return a.x === this.x && a.y === this.y && a.z === this.z && a.w === this.w
        },
        fromArray: function(a, b) {
            void 0 === b && (b = 0);
            this.x = a[b];
            this.y = a[b + 1];
            this.z = a[b + 2];
            this.w = a[b + 3];
            return this
        },
        toArray: function(a, b) {
            void 0 === a && (a = []);
            void 0 === b && (b = 0);
            a[b] = this.x;
            a[b + 1] = this.y;
            a[b + 2] = this.z;
            a[b + 3] = this.w;
            return a
        },
        fromAttribute: function(a, b, c) {
            void 0 === c && (c = 0);
            b = b * a.itemSize + c;
            this.x = a.array[b];
            this.y = a.array[b + 1];
            this.z = a.array[b + 2];
            this.w = a.array[b + 3];
            return this
        },
        clone: function() {
            return new t.Vector4(this.x,this.y,this.z,this.w)
        }
    };
    t.Euler = function(a, b, c, d) {
        this._x = a || 0;
        this._y = b || 0;
        this._z = c || 0;
        this._order = d || t.Euler.DefaultOrder
    }
    ;
    t.Euler.RotationOrders = "XYZ YZX ZXY XZY YXZ ZYX".split(" ");
    t.Euler.DefaultOrder = "XYZ";
    t.Euler.prototype = {
        constructor: t.Euler,
        _x: 0,
        _y: 0,
        _z: 0,
        _order: t.Euler.DefaultOrder,
        get x() {
            return this._x
        },
        set x(a) {
            this._x = a;
            this.onChangeCallback()
        },
        get y() {
            return this._y
        },
        set y(a) {
            this._y = a;
            this.onChangeCallback()
        },
        get z() {
            return this._z
        },
        set z(a) {
            this._z = a;
            this.onChangeCallback()
        },
        get order() {
            return this._order
        },
        set order(a) {
            this._order = a;
            this.onChangeCallback()
        },
        set: function(a, b, c, d) {
            this._x = a;
            this._y = b;
            this._z = c;
            this._order = d || this._order;
            this.onChangeCallback();
            return this
        },
        copy: function(a) {
            this._x = a._x;
            this._y = a._y;
            this._z = a._z;
            this._order = a._order;
            this.onChangeCallback();
            return this
        },
        setFromRotationMatrix: function(a, b, c) {
            var d = t.Math.clamp
              , e = a.elements;
            a = e[0];
            var f = e[4]
              , g = e[8]
              , h = e[1]
              , l = e[5]
              , m = e[9]
              , n = e[2]
              , p = e[6];
            e = e[10];
            b = b || this._order;
            "XYZ" === b ? (this._y = Math.asin(d(g, -1, 1)),
            .99999 > Math.abs(g) ? (this._x = Math.atan2(-m, e),
            this._z = Math.atan2(-f, a)) : (this._x = Math.atan2(p, l),
            this._z = 0)) : "YXZ" === b ? (this._x = Math.asin(-d(m, -1, 1)),
            .99999 > Math.abs(m) ? (this._y = Math.atan2(g, e),
            this._z = Math.atan2(h, l)) : (this._y = Math.atan2(-n, a),
            this._z = 0)) : "ZXY" === b ? (this._x = Math.asin(d(p, -1, 1)),
            .99999 > Math.abs(p) ? (this._y = Math.atan2(-n, e),
            this._z = Math.atan2(-f, l)) : (this._y = 0,
            this._z = Math.atan2(h, a))) : "ZYX" === b ? (this._y = Math.asin(-d(n, -1, 1)),
            .99999 > Math.abs(n) ? (this._x = Math.atan2(p, e),
            this._z = Math.atan2(h, a)) : (this._x = 0,
            this._z = Math.atan2(-f, l))) : "YZX" === b ? (this._z = Math.asin(d(h, -1, 1)),
            .99999 > Math.abs(h) ? (this._x = Math.atan2(-m, l),
            this._y = Math.atan2(-n, a)) : (this._x = 0,
            this._y = Math.atan2(g, e))) : "XZY" === b ? (this._z = Math.asin(-d(f, -1, 1)),
            .99999 > Math.abs(f) ? (this._x = Math.atan2(p, l),
            this._y = Math.atan2(g, a)) : (this._x = Math.atan2(-m, e),
            this._y = 0)) : t.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: " + b);
            this._order = b;
            if (!1 !== c)
                this.onChangeCallback();
            return this
        },
        setFromQuaternion: function() {
            var a;
            return function(b, c, d) {
                void 0 === a && (a = new t.Matrix4);
                a.makeRotationFromQuaternion(b);
                this.setFromRotationMatrix(a, c, d);
                return this
            }
        }(),
        setFromVector3: function(a, b) {
            return this.set(a.x, a.y, a.z, b || this._order)
        },
        reorder: function() {
            var a = new t.Quaternion;
            return function(b) {
                a.setFromEuler(this);
                this.setFromQuaternion(a, b)
            }
        }(),
        equals: function(a) {
            return a._x === this._x && a._y === this._y && a._z === this._z && a._order === this._order
        },
        fromArray: function(a) {
            this._x = a[0];
            this._y = a[1];
            this._z = a[2];
            void 0 !== a[3] && (this._order = a[3]);
            this.onChangeCallback();
            return this
        },
        toArray: function(a, b) {
            void 0 === a && (a = []);
            void 0 === b && (b = 0);
            a[b] = this._x;
            a[b + 1] = this._y;
            a[b + 2] = this._z;
            a[b + 3] = this._order;
            return a
        },
        toVector3: function(a) {
            return a ? a.set(this._x, this._y, this._z) : new t.Vector3(this._x,this._y,this._z)
        },
        onChange: function(a) {
            this.onChangeCallback = a;
            return this
        },
        onChangeCallback: function() {},
        clone: function() {
            return new t.Euler(this._x,this._y,this._z,this._order)
        }
    };
    t.Line3 = function(a, b) {
        this.start = void 0 !== a ? a : new t.Vector3;
        this.end = void 0 !== b ? b : new t.Vector3
    }
    ;
    t.Line3.prototype = {
        constructor: t.Line3,
        set: function(a, b) {
            this.start.copy(a);
            this.end.copy(b);
            return this
        },
        copy: function(a) {
            this.start.copy(a.start);
            this.end.copy(a.end);
            return this
        },
        center: function(a) {
            return (a || new t.Vector3).addVectors(this.start, this.end).multiplyScalar(.5)
        },
        delta: function(a) {
            return (a || new t.Vector3).subVectors(this.end, this.start)
        },
        distanceSq: function() {
            return this.start.distanceToSquared(this.end)
        },
        distance: function() {
            return this.start.distanceTo(this.end)
        },
        at: function(a, b) {
            b = b || new t.Vector3;
            return this.delta(b).multiplyScalar(a).add(this.start)
        },
        closestPointToPointParameter: function() {
            var a = new t.Vector3
              , b = new t.Vector3;
            return function(c, d) {
                a.subVectors(c, this.start);
                b.subVectors(this.end, this.start);
                c = b.dot(b);
                c = b.dot(a) / c;
                d && (c = t.Math.clamp(c, 0, 1));
                return c
            }
        }(),
        closestPointToPoint: function(a, b, c) {
            a = this.closestPointToPointParameter(a, b);
            c = c || new t.Vector3;
            return this.delta(c).multiplyScalar(a).add(this.start)
        },
        applyMatrix4: function(a) {
            this.start.applyMatrix4(a);
            this.end.applyMatrix4(a);
            return this
        },
        equals: function(a) {
            return a.start.equals(this.start) && a.end.equals(this.end)
        },
        clone: function() {
            return (new t.Line3).copy(this)
        }
    };
    t.Box2 = function(a, b) {
        this.min = void 0 !== a ? a : new t.Vector2(Infinity,Infinity);
        this.max = void 0 !== b ? b : new t.Vector2(-Infinity,-Infinity)
    }
    ;
    t.Box2.prototype = {
        constructor: t.Box2,
        set: function(a, b) {
            this.min.copy(a);
            this.max.copy(b);
            return this
        },
        setFromPoints: function(a) {
            this.makeEmpty();
            for (var b = 0, c = a.length; b < c; b++)
                this.expandByPoint(a[b]);
            return this
        },
        copy: function(a) {
            this.min.copy(a.min);
            this.max.copy(a.max);
            return this
        },
        makeEmpty: function() {
            this.min.x = this.min.y = Infinity;
            this.max.x = this.max.y = -Infinity;
            return this
        },
        empty: function() {
            return this.max.x < this.min.x || this.max.y < this.min.y
        },
        center: function(a) {
            return (a || new t.Vector2).addVectors(this.min, this.max).multiplyScalar(.5)
        },
        size: function(a) {
            return (a || new t.Vector2).subVectors(this.max, this.min)
        },
        expandByPoint: function(a) {
            this.min.min(a);
            this.max.max(a);
            return this
        },
        expandByVector: function(a) {
            this.min.sub(a);
            this.max.add(a);
            return this
        },
        expandByScalar: function(a) {
            this.min.addScalar(-a);
            this.max.addScalar(a);
            return this
        },
        containsPoint: function(a) {
            return a.x < this.min.x || a.x > this.max.x || a.y < this.min.y || a.y > this.max.y ? !1 : !0
        },
        containsBox: function(a) {
            return this.min.x <= a.min.x && a.max.x <= this.max.x && this.min.y <= a.min.y && a.max.y <= this.max.y ? !0 : !1
        },
        getParameter: function(a, b) {
            return (b || new t.Vector2).set((a.x - this.min.x) / (this.max.x - this.min.x), (a.y - this.min.y) / (this.max.y - this.min.y))
        },
        isIntersectionBox: function(a) {
            return a.max.x < this.min.x || a.min.x > this.max.x || a.max.y < this.min.y || a.min.y > this.max.y ? !1 : !0
        },
        clampPoint: function(a, b) {
            return (b || new t.Vector2).copy(a).clamp(this.min, this.max)
        },
        distanceToPoint: function() {
            var a = new t.Vector2;
            return function(b) {
                return a.copy(b).clamp(this.min, this.max).sub(b).length()
            }
        }(),
        intersect: function(a) {
            this.min.max(a.min);
            this.max.min(a.max);
            return this
        },
        union: function(a) {
            this.min.min(a.min);
            this.max.max(a.max);
            return this
        },
        translate: function(a) {
            this.min.add(a);
            this.max.add(a);
            return this
        },
        equals: function(a) {
            return a.min.equals(this.min) && a.max.equals(this.max)
        },
        clone: function() {
            return (new t.Box2).copy(this)
        }
    };
    t.Box3 = function(a, b) {
        this.min = void 0 !== a ? a : new t.Vector3(Infinity,Infinity,Infinity);
        this.max = void 0 !== b ? b : new t.Vector3(-Infinity,-Infinity,-Infinity)
    }
    ;
    t.Box3.prototype = {
        constructor: t.Box3,
        set: function(a, b) {
            this.min.copy(a);
            this.max.copy(b);
            return this
        },
        setFromPoints: function(a) {
            this.makeEmpty();
            for (var b = 0, c = a.length; b < c; b++)
                this.expandByPoint(a[b]);
            return this
        },
        copy: function(a) {
            this.min.copy(a.min);
            this.max.copy(a.max);
            return this
        },
        makeEmpty: function() {
            this.min.x = this.min.y = this.min.z = Infinity;
            this.max.x = this.max.y = this.max.z = -Infinity;
            return this
        },
        empty: function() {
            return this.max.x < this.min.x || this.max.y < this.min.y || this.max.z < this.min.z
        },
        center: function(a) {
            return (a || new t.Vector3).addVectors(this.min, this.max).multiplyScalar(.5)
        },
        size: function(a) {
            return (a || new t.Vector3).subVectors(this.max, this.min)
        },
        expandByPoint: function(a) {
            this.min.min(a);
            this.max.max(a);
            return this
        },
        expandByVector: function(a) {
            this.min.sub(a);
            this.max.add(a);
            return this
        },
        expandByScalar: function(a) {
            this.min.addScalar(-a);
            this.max.addScalar(a);
            return this
        },
        containsPoint: function(a) {
            return a.x < this.min.x || a.x > this.max.x || a.y < this.min.y || a.y > this.max.y || a.z < this.min.z || a.z > this.max.z ? !1 : !0
        },
        containsBox: function(a) {
            return this.min.x <= a.min.x && a.max.x <= this.max.x && this.min.y <= a.min.y && a.max.y <= this.max.y && this.min.z <= a.min.z && a.max.z <= this.max.z ? !0 : !1
        },
        getParameter: function(a, b) {
            return (b || new t.Vector3).set((a.x - this.min.x) / (this.max.x - this.min.x), (a.y - this.min.y) / (this.max.y - this.min.y), (a.z - this.min.z) / (this.max.z - this.min.z))
        },
        isIntersectionBox: function(a) {
            return a.max.x < this.min.x || a.min.x > this.max.x || a.max.y < this.min.y || a.min.y > this.max.y || a.max.z < this.min.z || a.min.z > this.max.z ? !1 : !0
        },
        clampPoint: function(a, b) {
            return (b || new t.Vector3).copy(a).clamp(this.min, this.max)
        },
        distanceToPoint: function() {
            var a = new t.Vector3;
            return function(b) {
                return a.copy(b).clamp(this.min, this.max).sub(b).length()
            }
        }(),
        getBoundingSphere: function() {
            var a = new t.Vector3;
            return function(b) {
                b = b || new t.Sphere;
                b.center = this.center();
                b.radius = .5 * this.size(a).length();
                return b
            }
        }(),
        intersect: function(a) {
            this.min.max(a.min);
            this.max.min(a.max);
            return this
        },
        union: function(a) {
            this.min.min(a.min);
            this.max.max(a.max);
            return this
        },
        applyMatrix4: function() {
            var a = [new t.Vector3, new t.Vector3, new t.Vector3, new t.Vector3, new t.Vector3, new t.Vector3, new t.Vector3, new t.Vector3];
            return function(b) {
                a[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(b);
                a[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(b);
                a[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(b);
                a[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(b);
                a[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(b);
                a[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(b);
                a[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(b);
                a[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(b);
                this.makeEmpty();
                this.setFromPoints(a);
                return this
            }
        }(),
        translate: function(a) {
            this.min.add(a);
            this.max.add(a);
            return this
        },
        equals: function(a) {
            return a.min.equals(this.min) && a.max.equals(this.max)
        },
        clone: function() {
            return (new t.Box3).copy(this)
        }
    };
    t.Matrix3 = function() {
        this.elements = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);
        0 < arguments.length && t.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")
    }
    ;
    t.Matrix3.prototype = {
        constructor: t.Matrix3,
        set: function(a, b, c, d, e, f, g, h, l) {
            var m = this.elements;
            m[0] = a;
            m[3] = b;
            m[6] = c;
            m[1] = d;
            m[4] = e;
            m[7] = f;
            m[2] = g;
            m[5] = h;
            m[8] = l;
            return this
        },
        identity: function() {
            this.set(1, 0, 0, 0, 1, 0, 0, 0, 1);
            return this
        },
        copy: function(a) {
            a = a.elements;
            this.set(a[0], a[3], a[6], a[1], a[4], a[7], a[2], a[5], a[8]);
            return this
        },
        multiplyVector3: function(a) {
            t.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");
            return a.applyMatrix3(this)
        },
        multiplyVector3Array: function(a) {
            t.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
            return this.applyToVector3Array(a)
        },
        applyToVector3Array: function() {
            var a = new t.Vector3;
            return function(b, c, d) {
                void 0 === c && (c = 0);
                void 0 === d && (d = b.length);
                for (var e = 0; e < d; e += 3,
                c += 3)
                    a.x = b[c],
                    a.y = b[c + 1],
                    a.z = b[c + 2],
                    a.applyMatrix3(this),
                    b[c] = a.x,
                    b[c + 1] = a.y,
                    b[c + 2] = a.z;
                return b
            }
        }(),
        multiplyScalar: function(a) {
            var b = this.elements;
            b[0] *= a;
            b[3] *= a;
            b[6] *= a;
            b[1] *= a;
            b[4] *= a;
            b[7] *= a;
            b[2] *= a;
            b[5] *= a;
            b[8] *= a;
            return this
        },
        determinant: function() {
            var a = this.elements
              , b = a[0]
              , c = a[1]
              , d = a[2]
              , e = a[3]
              , f = a[4]
              , g = a[5]
              , h = a[6]
              , l = a[7];
            a = a[8];
            return b * f * a - b * g * l - c * e * a + c * g * h + d * e * l - d * f * h
        },
        getInverse: function(a, b) {
            a = a.elements;
            var c = this.elements;
            c[0] = a[10] * a[5] - a[6] * a[9];
            c[1] = -a[10] * a[1] + a[2] * a[9];
            c[2] = a[6] * a[1] - a[2] * a[5];
            c[3] = -a[10] * a[4] + a[6] * a[8];
            c[4] = a[10] * a[0] - a[2] * a[8];
            c[5] = -a[6] * a[0] + a[2] * a[4];
            c[6] = a[9] * a[4] - a[5] * a[8];
            c[7] = -a[9] * a[0] + a[1] * a[8];
            c[8] = a[5] * a[0] - a[1] * a[4];
            a = a[0] * c[0] + a[1] * c[3] + a[2] * c[6];
            if (0 === a) {
                if (b)
                    throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");
                t.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");
                this.identity();
                return this
            }
            this.multiplyScalar(1 / a);
            return this
        },
        transpose: function() {
            var a = this.elements;
            var b = a[1];
            a[1] = a[3];
            a[3] = b;
            b = a[2];
            a[2] = a[6];
            a[6] = b;
            b = a[5];
            a[5] = a[7];
            a[7] = b;
            return this
        },
        flattenToArrayOffset: function(a, b) {
            var c = this.elements;
            a[b] = c[0];
            a[b + 1] = c[1];
            a[b + 2] = c[2];
            a[b + 3] = c[3];
            a[b + 4] = c[4];
            a[b + 5] = c[5];
            a[b + 6] = c[6];
            a[b + 7] = c[7];
            a[b + 8] = c[8];
            return a
        },
        getNormalMatrix: function(a) {
            this.getInverse(a).transpose();
            return this
        },
        transposeIntoArray: function(a) {
            var b = this.elements;
            a[0] = b[0];
            a[1] = b[3];
            a[2] = b[6];
            a[3] = b[1];
            a[4] = b[4];
            a[5] = b[7];
            a[6] = b[2];
            a[7] = b[5];
            a[8] = b[8];
            return this
        },
        fromArray: function(a) {
            this.elements.set(a);
            return this
        },
        toArray: function() {
            var a = this.elements;
            return [a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8]]
        },
        clone: function() {
            return (new t.Matrix3).fromArray(this.elements)
        }
    };
    t.Matrix4 = function() {
        this.elements = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
        0 < arguments.length && t.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")
    }
    ;
    t.Matrix4.prototype = {
        constructor: t.Matrix4,
        set: function(a, b, c, d, e, f, g, h, l, m, n, p, q, r, u, v) {
            var w = this.elements;
            w[0] = a;
            w[4] = b;
            w[8] = c;
            w[12] = d;
            w[1] = e;
            w[5] = f;
            w[9] = g;
            w[13] = h;
            w[2] = l;
            w[6] = m;
            w[10] = n;
            w[14] = p;
            w[3] = q;
            w[7] = r;
            w[11] = u;
            w[15] = v;
            return this
        },
        identity: function() {
            this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
            return this
        },
        copy: function(a) {
            this.elements.set(a.elements);
            return this
        },
        extractPosition: function(a) {
            t.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");
            return this.copyPosition(a)
        },
        copyPosition: function(a) {
            var b = this.elements;
            a = a.elements;
            b[12] = a[12];
            b[13] = a[13];
            b[14] = a[14];
            return this
        },
        extractBasis: function(a, b, c) {
            var d = this.elements;
            a.set(d[0], d[1], d[2]);
            b.set(d[4], d[5], d[6]);
            c.set(d[8], d[9], d[10]);
            return this
        },
        makeBasis: function(a, b, c) {
            this.set(a.x, b.x, c.x, 0, a.y, b.y, c.y, 0, a.z, b.z, c.z, 0, 0, 0, 0, 1);
            return this
        },
        extractRotation: function() {
            var a = new t.Vector3;
            return function(b) {
                var c = this.elements;
                b = b.elements;
                var d = 1 / a.set(b[0], b[1], b[2]).length()
                  , e = 1 / a.set(b[4], b[5], b[6]).length()
                  , f = 1 / a.set(b[8], b[9], b[10]).length();
                c[0] = b[0] * d;
                c[1] = b[1] * d;
                c[2] = b[2] * d;
                c[4] = b[4] * e;
                c[5] = b[5] * e;
                c[6] = b[6] * e;
                c[8] = b[8] * f;
                c[9] = b[9] * f;
                c[10] = b[10] * f;
                return this
            }
        }(),
        makeRotationFromEuler: function(a) {
            !1 === a instanceof t.Euler && t.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
            var b = this.elements
              , c = a.x
              , d = a.y
              , e = a.z
              , f = Math.cos(c);
            c = Math.sin(c);
            var g = Math.cos(d);
            d = Math.sin(d);
            var h = Math.cos(e);
            e = Math.sin(e);
            if ("XYZ" === a.order) {
                a = f * h;
                var l = f * e
                  , m = c * h
                  , n = c * e;
                b[0] = g * h;
                b[4] = -g * e;
                b[8] = d;
                b[1] = l + m * d;
                b[5] = a - n * d;
                b[9] = -c * g;
                b[2] = n - a * d;
                b[6] = m + l * d;
                b[10] = f * g
            } else
                "YXZ" === a.order ? (a = g * h,
                l = g * e,
                m = d * h,
                n = d * e,
                b[0] = a + n * c,
                b[4] = m * c - l,
                b[8] = f * d,
                b[1] = f * e,
                b[5] = f * h,
                b[9] = -c,
                b[2] = l * c - m,
                b[6] = n + a * c,
                b[10] = f * g) : "ZXY" === a.order ? (a = g * h,
                l = g * e,
                m = d * h,
                n = d * e,
                b[0] = a - n * c,
                b[4] = -f * e,
                b[8] = m + l * c,
                b[1] = l + m * c,
                b[5] = f * h,
                b[9] = n - a * c,
                b[2] = -f * d,
                b[6] = c,
                b[10] = f * g) : "ZYX" === a.order ? (a = f * h,
                l = f * e,
                m = c * h,
                n = c * e,
                b[0] = g * h,
                b[4] = m * d - l,
                b[8] = a * d + n,
                b[1] = g * e,
                b[5] = n * d + a,
                b[9] = l * d - m,
                b[2] = -d,
                b[6] = c * g,
                b[10] = f * g) : "YZX" === a.order ? (a = f * g,
                l = f * d,
                m = c * g,
                n = c * d,
                b[0] = g * h,
                b[4] = n - a * e,
                b[8] = m * e + l,
                b[1] = e,
                b[5] = f * h,
                b[9] = -c * h,
                b[2] = -d * h,
                b[6] = l * e + m,
                b[10] = a - n * e) : "XZY" === a.order && (a = f * g,
                l = f * d,
                m = c * g,
                n = c * d,
                b[0] = g * h,
                b[4] = -e,
                b[8] = d * h,
                b[1] = a * e + n,
                b[5] = f * h,
                b[9] = l * e - m,
                b[2] = m * e - l,
                b[6] = c * h,
                b[10] = n * e + a);
            b[3] = 0;
            b[7] = 0;
            b[11] = 0;
            b[12] = 0;
            b[13] = 0;
            b[14] = 0;
            b[15] = 1;
            return this
        },
        setRotationFromQuaternion: function(a) {
            t.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");
            return this.makeRotationFromQuaternion(a)
        },
        makeRotationFromQuaternion: function(a) {
            var b = this.elements
              , c = a.x
              , d = a.y
              , e = a.z
              , f = a.w
              , g = c + c
              , h = d + d
              , l = e + e;
            a = c * g;
            var m = c * h;
            c *= l;
            var n = d * h;
            d *= l;
            e *= l;
            g *= f;
            h *= f;
            f *= l;
            b[0] = 1 - (n + e);
            b[4] = m - f;
            b[8] = c + h;
            b[1] = m + f;
            b[5] = 1 - (a + e);
            b[9] = d - g;
            b[2] = c - h;
            b[6] = d + g;
            b[10] = 1 - (a + n);
            b[3] = 0;
            b[7] = 0;
            b[11] = 0;
            b[12] = 0;
            b[13] = 0;
            b[14] = 0;
            b[15] = 1;
            return this
        },
        lookAt: function() {
            var a = new t.Vector3
              , b = new t.Vector3
              , c = new t.Vector3;
            return function(d, e, f) {
                var g = this.elements;
                c.subVectors(d, e).normalize();
                0 === c.length() && (c.z = 1);
                a.crossVectors(f, c).normalize();
                0 === a.length() && (c.x += 1E-4,
                a.crossVectors(f, c).normalize());
                b.crossVectors(c, a);
                g[0] = a.x;
                g[4] = b.x;
                g[8] = c.x;
                g[1] = a.y;
                g[5] = b.y;
                g[9] = c.y;
                g[2] = a.z;
                g[6] = b.z;
                g[10] = c.z;
                return this
            }
        }(),
        multiply: function(a, b) {
            return void 0 !== b ? (t.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),
            this.multiplyMatrices(a, b)) : this.multiplyMatrices(this, a)
        },
        multiplyMatrices: function(a, b) {
            var c = a.elements
              , d = b.elements;
            b = this.elements;
            a = c[0];
            var e = c[4]
              , f = c[8]
              , g = c[12]
              , h = c[1]
              , l = c[5]
              , m = c[9]
              , n = c[13]
              , p = c[2]
              , q = c[6]
              , r = c[10]
              , u = c[14]
              , v = c[3]
              , w = c[7]
              , x = c[11];
            c = c[15];
            var y = d[0]
              , z = d[4]
              , A = d[8]
              , B = d[12]
              , H = d[1]
              , C = d[5]
              , L = d[9]
              , G = d[13]
              , I = d[2]
              , M = d[6]
              , O = d[10]
              , K = d[14]
              , F = d[3]
              , D = d[7]
              , E = d[11];
            d = d[15];
            b[0] = a * y + e * H + f * I + g * F;
            b[4] = a * z + e * C + f * M + g * D;
            b[8] = a * A + e * L + f * O + g * E;
            b[12] = a * B + e * G + f * K + g * d;
            b[1] = h * y + l * H + m * I + n * F;
            b[5] = h * z + l * C + m * M + n * D;
            b[9] = h * A + l * L + m * O + n * E;
            b[13] = h * B + l * G + m * K + n * d;
            b[2] = p * y + q * H + r * I + u * F;
            b[6] = p * z + q * C + r * M + u * D;
            b[10] = p * A + q * L + r * O + u * E;
            b[14] = p * B + q * G + r * K + u * d;
            b[3] = v * y + w * H + x * I + c * F;
            b[7] = v * z + w * C + x * M + c * D;
            b[11] = v * A + w * L + x * O + c * E;
            b[15] = v * B + w * G + x * K + c * d;
            return this
        },
        multiplyToArray: function(a, b, c) {
            var d = this.elements;
            this.multiplyMatrices(a, b);
            c[0] = d[0];
            c[1] = d[1];
            c[2] = d[2];
            c[3] = d[3];
            c[4] = d[4];
            c[5] = d[5];
            c[6] = d[6];
            c[7] = d[7];
            c[8] = d[8];
            c[9] = d[9];
            c[10] = d[10];
            c[11] = d[11];
            c[12] = d[12];
            c[13] = d[13];
            c[14] = d[14];
            c[15] = d[15];
            return this
        },
        multiplyScalar: function(a) {
            var b = this.elements;
            b[0] *= a;
            b[4] *= a;
            b[8] *= a;
            b[12] *= a;
            b[1] *= a;
            b[5] *= a;
            b[9] *= a;
            b[13] *= a;
            b[2] *= a;
            b[6] *= a;
            b[10] *= a;
            b[14] *= a;
            b[3] *= a;
            b[7] *= a;
            b[11] *= a;
            b[15] *= a;
            return this
        },
        multiplyVector3: function(a) {
            t.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");
            return a.applyProjection(this)
        },
        multiplyVector4: function(a) {
            t.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");
            return a.applyMatrix4(this)
        },
        multiplyVector3Array: function(a) {
            t.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
            return this.applyToVector3Array(a)
        },
        applyToVector3Array: function() {
            var a = new t.Vector3;
            return function(b, c, d) {
                void 0 === c && (c = 0);
                void 0 === d && (d = b.length);
                for (var e = 0; e < d; e += 3,
                c += 3)
                    a.x = b[c],
                    a.y = b[c + 1],
                    a.z = b[c + 2],
                    a.applyMatrix4(this),
                    b[c] = a.x,
                    b[c + 1] = a.y,
                    b[c + 2] = a.z;
                return b
            }
        }(),
        rotateAxis: function(a) {
            t.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");
            a.transformDirection(this)
        },
        crossVector: function(a) {
            t.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
            return a.applyMatrix4(this)
        },
        determinant: function() {
            var a = this.elements
              , b = a[0]
              , c = a[4]
              , d = a[8]
              , e = a[12]
              , f = a[1]
              , g = a[5]
              , h = a[9]
              , l = a[13]
              , m = a[2]
              , n = a[6]
              , p = a[10]
              , q = a[14];
            return a[3] * (+e * h * n - d * l * n - e * g * p + c * l * p + d * g * q - c * h * q) + a[7] * (+b * h * q - b * l * p + e * f * p - d * f * q + d * l * m - e * h * m) + a[11] * (+b * l * n - b * g * q - e * f * n + c * f * q + e * g * m - c * l * m) + a[15] * (-d * g * m - b * h * n + b * g * p + d * f * n - c * f * p + c * h * m)
        },
        transpose: function() {
            var a = this.elements;
            var b = a[1];
            a[1] = a[4];
            a[4] = b;
            b = a[2];
            a[2] = a[8];
            a[8] = b;
            b = a[6];
            a[6] = a[9];
            a[9] = b;
            b = a[3];
            a[3] = a[12];
            a[12] = b;
            b = a[7];
            a[7] = a[13];
            a[13] = b;
            b = a[11];
            a[11] = a[14];
            a[14] = b;
            return this
        },
        flattenToArrayOffset: function(a, b) {
            var c = this.elements;
            a[b] = c[0];
            a[b + 1] = c[1];
            a[b + 2] = c[2];
            a[b + 3] = c[3];
            a[b + 4] = c[4];
            a[b + 5] = c[5];
            a[b + 6] = c[6];
            a[b + 7] = c[7];
            a[b + 8] = c[8];
            a[b + 9] = c[9];
            a[b + 10] = c[10];
            a[b + 11] = c[11];
            a[b + 12] = c[12];
            a[b + 13] = c[13];
            a[b + 14] = c[14];
            a[b + 15] = c[15];
            return a
        },
        getPosition: function() {
            var a = new t.Vector3;
            return function() {
                t.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
                var b = this.elements;
                return a.set(b[12], b[13], b[14])
            }
        }(),
        setPosition: function(a) {
            var b = this.elements;
            b[12] = a.x;
            b[13] = a.y;
            b[14] = a.z;
            return this
        },
        getInverse: function(a, b) {
            var c = this.elements
              , d = a.elements;
            a = d[0];
            var e = d[4]
              , f = d[8]
              , g = d[12]
              , h = d[1]
              , l = d[5]
              , m = d[9]
              , n = d[13]
              , p = d[2]
              , q = d[6]
              , r = d[10]
              , u = d[14]
              , v = d[3]
              , w = d[7]
              , x = d[11];
            d = d[15];
            c[0] = m * u * w - n * r * w + n * q * x - l * u * x - m * q * d + l * r * d;
            c[4] = g * r * w - f * u * w - g * q * x + e * u * x + f * q * d - e * r * d;
            c[8] = f * n * w - g * m * w + g * l * x - e * n * x - f * l * d + e * m * d;
            c[12] = g * m * q - f * n * q - g * l * r + e * n * r + f * l * u - e * m * u;
            c[1] = n * r * v - m * u * v - n * p * x + h * u * x + m * p * d - h * r * d;
            c[5] = f * u * v - g * r * v + g * p * x - a * u * x - f * p * d + a * r * d;
            c[9] = g * m * v - f * n * v - g * h * x + a * n * x + f * h * d - a * m * d;
            c[13] = f * n * p - g * m * p + g * h * r - a * n * r - f * h * u + a * m * u;
            c[2] = l * u * v - n * q * v + n * p * w - h * u * w - l * p * d + h * q * d;
            c[6] = g * q * v - e * u * v - g * p * w + a * u * w + e * p * d - a * q * d;
            c[10] = e * n * v - g * l * v + g * h * w - a * n * w - e * h * d + a * l * d;
            c[14] = g * l * p - e * n * p - g * h * q + a * n * q + e * h * u - a * l * u;
            c[3] = m * q * v - l * r * v - m * p * w + h * r * w + l * p * x - h * q * x;
            c[7] = e * r * v - f * q * v + f * p * w - a * r * w - e * p * x + a * q * x;
            c[11] = f * l * v - e * m * v - f * h * w + a * m * w + e * h * x - a * l * x;
            c[15] = e * m * p - f * l * p + f * h * q - a * m * q - e * h * r + a * l * r;
            c = a * c[0] + h * c[4] + p * c[8] + v * c[12];
            if (0 == c) {
                if (b)
                    throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
                t.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
                this.identity();
                return this
            }
            this.multiplyScalar(1 / c);
            return this
        },
        translate: function() {
            t.error("THREE.Matrix4: .translate() has been removed.")
        },
        rotateX: function() {
            t.error("THREE.Matrix4: .rotateX() has been removed.")
        },
        rotateY: function() {
            t.error("THREE.Matrix4: .rotateY() has been removed.")
        },
        rotateZ: function() {
            t.error("THREE.Matrix4: .rotateZ() has been removed.")
        },
        rotateByAxis: function() {
            t.error("THREE.Matrix4: .rotateByAxis() has been removed.")
        },
        scale: function(a) {
            var b = this.elements
              , c = a.x
              , d = a.y;
            a = a.z;
            b[0] *= c;
            b[4] *= d;
            b[8] *= a;
            b[1] *= c;
            b[5] *= d;
            b[9] *= a;
            b[2] *= c;
            b[6] *= d;
            b[10] *= a;
            b[3] *= c;
            b[7] *= d;
            b[11] *= a;
            return this
        },
        getMaxScaleOnAxis: function() {
            var a = this.elements;
            return Math.sqrt(Math.max(a[0] * a[0] + a[1] * a[1] + a[2] * a[2], Math.max(a[4] * a[4] + a[5] * a[5] + a[6] * a[6], a[8] * a[8] + a[9] * a[9] + a[10] * a[10])))
        },
        makeTranslation: function(a, b, c) {
            this.set(1, 0, 0, a, 0, 1, 0, b, 0, 0, 1, c, 0, 0, 0, 1);
            return this
        },
        makeRotationX: function(a) {
            var b = Math.cos(a);
            a = Math.sin(a);
            this.set(1, 0, 0, 0, 0, b, -a, 0, 0, a, b, 0, 0, 0, 0, 1);
            return this
        },
        makeRotationY: function(a) {
            var b = Math.cos(a);
            a = Math.sin(a);
            this.set(b, 0, a, 0, 0, 1, 0, 0, -a, 0, b, 0, 0, 0, 0, 1);
            return this
        },
        makeRotationZ: function(a) {
            var b = Math.cos(a);
            a = Math.sin(a);
            this.set(b, -a, 0, 0, a, b, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
            return this
        },
        makeRotationAxis: function(a, b) {
            var c = Math.cos(b);
            b = Math.sin(b);
            var d = 1 - c
              , e = a.x
              , f = a.y;
            a = a.z;
            var g = d * e
              , h = d * f;
            this.set(g * e + c, g * f - b * a, g * a + b * f, 0, g * f + b * a, h * f + c, h * a - b * e, 0, g * a - b * f, h * a + b * e, d * a * a + c, 0, 0, 0, 0, 1);
            return this
        },
        makeScale: function(a, b, c) {
            this.set(a, 0, 0, 0, 0, b, 0, 0, 0, 0, c, 0, 0, 0, 0, 1);
            return this
        },
        compose: function(a, b, c) {
            this.makeRotationFromQuaternion(b);
            this.scale(c);
            this.setPosition(a);
            return this
        },
        decompose: function() {
            var a = new t.Vector3
              , b = new t.Matrix4;
            return function(c, d, e) {
                var f = this.elements
                  , g = a.set(f[0], f[1], f[2]).length()
                  , h = a.set(f[4], f[5], f[6]).length()
                  , l = a.set(f[8], f[9], f[10]).length();
                0 > this.determinant() && (g = -g);
                c.x = f[12];
                c.y = f[13];
                c.z = f[14];
                b.elements.set(this.elements);
                c = 1 / g;
                f = 1 / h;
                var m = 1 / l;
                b.elements[0] *= c;
                b.elements[1] *= c;
                b.elements[2] *= c;
                b.elements[4] *= f;
                b.elements[5] *= f;
                b.elements[6] *= f;
                b.elements[8] *= m;
                b.elements[9] *= m;
                b.elements[10] *= m;
                d.setFromRotationMatrix(b);
                e.x = g;
                e.y = h;
                e.z = l;
                return this
            }
        }(),
        makeFrustum: function(a, b, c, d, e, f) {
            var g = this.elements;
            g[0] = 2 * e / (b - a);
            g[4] = 0;
            g[8] = (b + a) / (b - a);
            g[12] = 0;
            g[1] = 0;
            g[5] = 2 * e / (d - c);
            g[9] = (d + c) / (d - c);
            g[13] = 0;
            g[2] = 0;
            g[6] = 0;
            g[10] = -(f + e) / (f - e);
            g[14] = -2 * f * e / (f - e);
            g[3] = 0;
            g[7] = 0;
            g[11] = -1;
            g[15] = 0;
            return this
        },
        makePerspective: function(a, b, c, d) {
            a = c * Math.tan(t.Math.degToRad(.5 * a));
            var e = -a;
            return this.makeFrustum(e * b, a * b, e, a, c, d)
        },
        makeOrthographic: function(a, b, c, d, e, f) {
            var g = this.elements
              , h = b - a
              , l = c - d
              , m = f - e;
            g[0] = 2 / h;
            g[4] = 0;
            g[8] = 0;
            g[12] = -((b + a) / h);
            g[1] = 0;
            g[5] = 2 / l;
            g[9] = 0;
            g[13] = -((c + d) / l);
            g[2] = 0;
            g[6] = 0;
            g[10] = -2 / m;
            g[14] = -((f + e) / m);
            g[3] = 0;
            g[7] = 0;
            g[11] = 0;
            g[15] = 1;
            return this
        },
        fromArray: function(a) {
            this.elements.set(a);
            return this
        },
        toArray: function() {
            var a = this.elements;
            return [a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]]
        },
        clone: function() {
            return (new t.Matrix4).fromArray(this.elements)
        }
    };
    t.Triangle = function(a, b, c) {
        this.a = void 0 !== a ? a : new t.Vector3;
        this.b = void 0 !== b ? b : new t.Vector3;
        this.c = void 0 !== c ? c : new t.Vector3
    }
    ;
    t.Triangle.normal = function() {
        var a = new t.Vector3;
        return function(b, c, d, e) {
            e = e || new t.Vector3;
            e.subVectors(d, c);
            a.subVectors(b, c);
            e.cross(a);
            b = e.lengthSq();
            return 0 < b ? e.multiplyScalar(1 / Math.sqrt(b)) : e.set(0, 0, 0)
        }
    }();
    t.Triangle.barycoordFromPoint = function() {
        var a = new t.Vector3
          , b = new t.Vector3
          , c = new t.Vector3;
        return function(d, e, f, g, h) {
            a.subVectors(g, e);
            b.subVectors(f, e);
            c.subVectors(d, e);
            d = a.dot(a);
            e = a.dot(b);
            f = a.dot(c);
            var l = b.dot(b);
            g = b.dot(c);
            var m = d * l - e * e;
            h = h || new t.Vector3;
            if (0 == m)
                return h.set(-2, -1, -1);
            m = 1 / m;
            l = (l * f - e * g) * m;
            d = (d * g - e * f) * m;
            return h.set(1 - l - d, d, l)
        }
    }();
    t.Triangle.containsPoint = function() {
        var a = new t.Vector3;
        return function(b, c, d, e) {
            b = t.Triangle.barycoordFromPoint(b, c, d, e, a);
            return 0 <= b.x && 0 <= b.y && 1 >= b.x + b.y
        }
    }();
    t.Triangle.prototype = {
        constructor: t.Triangle,
        set: function(a, b, c) {
            this.a.copy(a);
            this.b.copy(b);
            this.c.copy(c);
            return this
        },
        setFromPointsAndIndices: function(a, b, c, d) {
            this.a.copy(a[b]);
            this.b.copy(a[c]);
            this.c.copy(a[d]);
            return this
        },
        copy: function(a) {
            this.a.copy(a.a);
            this.b.copy(a.b);
            this.c.copy(a.c);
            return this
        },
        area: function() {
            var a = new t.Vector3
              , b = new t.Vector3;
            return function() {
                a.subVectors(this.c, this.b);
                b.subVectors(this.a, this.b);
                return .5 * a.cross(b).length()
            }
        }(),
        midpoint: function(a) {
            return (a || new t.Vector3).addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3)
        },
        normal: function(a) {
            return t.Triangle.normal(this.a, this.b, this.c, a)
        },
        plane: function(a) {
            return (a || new t.Plane).setFromCoplanarPoints(this.a, this.b, this.c)
        },
        barycoordFromPoint: function(a, b) {
            return t.Triangle.barycoordFromPoint(a, this.a, this.b, this.c, b)
        },
        containsPoint: function(a) {
            return t.Triangle.containsPoint(a, this.a, this.b, this.c)
        },
        equals: function(a) {
            return a.a.equals(this.a) && a.b.equals(this.b) && a.c.equals(this.c)
        },
        clone: function() {
            return (new t.Triangle).copy(this)
        }
    };
    t.Ray = function(a, b) {
        this.origin = void 0 !== a ? a : new t.Vector3;
        this.direction = void 0 !== b ? b : new t.Vector3
    }
    ;
    t.Ray.prototype = {
        constructor: t.Ray,
        set: function(a, b) {
            this.origin.copy(a);
            this.direction.copy(b);
            return this
        },
        copy: function(a) {
            this.origin.copy(a.origin);
            this.direction.copy(a.direction);
            return this
        },
        at: function(a, b) {
            return (b || new t.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)
        },
        recast: function() {
            var a = new t.Vector3;
            return function(b) {
                this.origin.copy(this.at(b, a));
                return this
            }
        }(),
        closestPointToPoint: function(a, b) {
            b = b || new t.Vector3;
            b.subVectors(a, this.origin);
            a = b.dot(this.direction);
            return 0 > a ? b.copy(this.origin) : b.copy(this.direction).multiplyScalar(a).add(this.origin)
        },
        distanceToPoint: function() {
            var a = new t.Vector3;
            return function(b) {
                var c = a.subVectors(b, this.origin).dot(this.direction);
                if (0 > c)
                    return this.origin.distanceTo(b);
                a.copy(this.direction).multiplyScalar(c).add(this.origin);
                return a.distanceTo(b)
            }
        }(),
        distanceSqToSegment: function() {
            var a = new t.Vector3
              , b = new t.Vector3
              , c = new t.Vector3;
            return function(d, e, f, g) {
                a.copy(d).add(e).multiplyScalar(.5);
                b.copy(e).sub(d).normalize();
                c.copy(this.origin).sub(a);
                var h = .5 * d.distanceTo(e)
                  , l = -this.direction.dot(b)
                  , m = c.dot(this.direction)
                  , n = -c.dot(b)
                  , p = c.lengthSq()
                  , q = Math.abs(1 - l * l);
                if (0 < q) {
                    d = l * n - m;
                    e = l * m - n;
                    var r = h * q;
                    0 <= d ? e >= -r ? e <= r ? (h = 1 / q,
                    d *= h,
                    e *= h,
                    l = d * (d + l * e + 2 * m) + e * (l * d + e + 2 * n) + p) : (e = h,
                    d = Math.max(0, -(l * e + m)),
                    l = -d * d + e * (e + 2 * n) + p) : (e = -h,
                    d = Math.max(0, -(l * e + m)),
                    l = -d * d + e * (e + 2 * n) + p) : e <= -r ? (d = Math.max(0, -(-l * h + m)),
                    e = 0 < d ? -h : Math.min(Math.max(-h, -n), h),
                    l = -d * d + e * (e + 2 * n) + p) : e <= r ? (d = 0,
                    e = Math.min(Math.max(-h, -n), h),
                    l = e * (e + 2 * n) + p) : (d = Math.max(0, -(l * h + m)),
                    e = 0 < d ? h : Math.min(Math.max(-h, -n), h),
                    l = -d * d + e * (e + 2 * n) + p)
                } else
                    e = 0 < l ? -h : h,
                    d = Math.max(0, -(l * e + m)),
                    l = -d * d + e * (e + 2 * n) + p;
                f && f.copy(this.direction).multiplyScalar(d).add(this.origin);
                g && g.copy(b).multiplyScalar(e).add(a);
                return l
            }
        }(),
        isIntersectionSphere: function(a) {
            return this.distanceToPoint(a.center) <= a.radius
        },
        intersectSphere: function() {
            var a = new t.Vector3;
            return function(b, c) {
                a.subVectors(b.center, this.origin);
                var d = a.dot(this.direction)
                  , e = a.dot(a) - d * d;
                b = b.radius * b.radius;
                if (e > b)
                    return null;
                b = Math.sqrt(b - e);
                e = d - b;
                d += b;
                return 0 > e && 0 > d ? null : 0 > e ? this.at(d, c) : this.at(e, c)
            }
        }(),
        isIntersectionPlane: function(a) {
            var b = a.distanceToPoint(this.origin);
            return 0 === b || 0 > a.normal.dot(this.direction) * b ? !0 : !1
        },
        distanceToPlane: function(a) {
            var b = a.normal.dot(this.direction);
            if (0 == b)
                return 0 == a.distanceToPoint(this.origin) ? 0 : null;
            a = -(this.origin.dot(a.normal) + a.constant) / b;
            return 0 <= a ? a : null
        },
        intersectPlane: function(a, b) {
            a = this.distanceToPlane(a);
            return null === a ? null : this.at(a, b)
        },
        isIntersectionBox: function() {
            var a = new t.Vector3;
            return function(b) {
                return null !== this.intersectBox(b, a)
            }
        }(),
        intersectBox: function(a, b) {
            var c = 1 / this.direction.x;
            var d = 1 / this.direction.y;
            var e = 1 / this.direction.z
              , f = this.origin;
            if (0 <= c) {
                var g = (a.min.x - f.x) * c;
                c *= a.max.x - f.x
            } else
                g = (a.max.x - f.x) * c,
                c *= a.min.x - f.x;
            if (0 <= d) {
                var h = (a.min.y - f.y) * d;
                d *= a.max.y - f.y
            } else
                h = (a.max.y - f.y) * d,
                d *= a.min.y - f.y;
            if (g > d || h > c)
                return null;
            if (h > g || g !== g)
                g = h;
            if (d < c || c !== c)
                c = d;
            0 <= e ? (h = (a.min.z - f.z) * e,
            a = (a.max.z - f.z) * e) : (h = (a.max.z - f.z) * e,
            a = (a.min.z - f.z) * e);
            if (g > a || h > c)
                return null;
            if (h > g || g !== g)
                g = h;
            if (a < c || c !== c)
                c = a;
            return 0 > c ? null : this.at(0 <= g ? g : c, b)
        },
        intersectTriangle: function() {
            var a = new t.Vector3
              , b = new t.Vector3
              , c = new t.Vector3
              , d = new t.Vector3;
            return function(e, f, g, h, l) {
                b.subVectors(f, e);
                c.subVectors(g, e);
                d.crossVectors(b, c);
                f = this.direction.dot(d);
                if (0 < f) {
                    if (h)
                        return null;
                    h = 1
                } else if (0 > f)
                    h = -1,
                    f = -f;
                else
                    return null;
                a.subVectors(this.origin, e);
                e = h * this.direction.dot(c.crossVectors(a, c));
                if (0 > e)
                    return null;
                g = h * this.direction.dot(b.cross(a));
                if (0 > g || e + g > f)
                    return null;
                e = -h * a.dot(d);
                return 0 > e ? null : this.at(e / f, l)
            }
        }(),
        applyMatrix4: function(a) {
            this.direction.add(this.origin).applyMatrix4(a);
            this.origin.applyMatrix4(a);
            this.direction.sub(this.origin);
            this.direction.normalize();
            return this
        },
        equals: function(a) {
            return a.origin.equals(this.origin) && a.direction.equals(this.direction)
        },
        clone: function() {
            return (new t.Ray).copy(this)
        }
    };
    t.Sphere = function(a, b) {
        this.center = void 0 !== a ? a : new t.Vector3;
        this.radius = void 0 !== b ? b : 0
    }
    ;
    t.Sphere.prototype = {
        constructor: t.Sphere,
        set: function(a, b) {
            this.center.copy(a);
            this.radius = b;
            return this
        },
        setFromPoints: function() {
            var a = new t.Box3;
            return function(b, c) {
                var d = this.center;
                void 0 !== c ? d.copy(c) : a.setFromPoints(b).center(d);
                for (var e = c = 0, f = b.length; e < f; e++)
                    c = Math.max(c, d.distanceToSquared(b[e]));
                this.radius = Math.sqrt(c);
                return this
            }
        }(),
        copy: function(a) {
            this.center.copy(a.center);
            this.radius = a.radius;
            return this
        },
        empty: function() {
            return 0 >= this.radius
        },
        containsPoint: function(a) {
            return a.distanceToSquared(this.center) <= this.radius * this.radius
        },
        distanceToPoint: function(a) {
            return a.distanceTo(this.center) - this.radius
        },
        intersectsSphere: function(a) {
            var b = this.radius + a.radius;
            return a.center.distanceToSquared(this.center) <= b * b
        },
        clampPoint: function(a, b) {
            var c = this.center.distanceToSquared(a);
            b = b || new t.Vector3;
            b.copy(a);
            c > this.radius * this.radius && (b.sub(this.center).normalize(),
            b.multiplyScalar(this.radius).add(this.center));
            return b
        },
        getBoundingBox: function(a) {
            a = a || new t.Box3;
            a.set(this.center, this.center);
            a.expandByScalar(this.radius);
            return a
        },
        applyMatrix4: function(a) {
            this.center.applyMatrix4(a);
            this.radius *= a.getMaxScaleOnAxis();
            return this
        },
        translate: function(a) {
            this.center.add(a);
            return this
        },
        equals: function(a) {
            return a.center.equals(this.center) && a.radius === this.radius
        },
        clone: function() {
            return (new t.Sphere).copy(this)
        }
    };
    t.Plane = function(a, b) {
        this.normal = void 0 !== a ? a : new t.Vector3(1,0,0);
        this.constant = void 0 !== b ? b : 0
    }
    ;
    t.Plane.prototype = {
        constructor: t.Plane,
        set: function(a, b) {
            this.normal.copy(a);
            this.constant = b;
            return this
        },
        setComponents: function(a, b, c, d) {
            this.normal.set(a, b, c);
            this.constant = d;
            return this
        },
        setFromNormalAndCoplanarPoint: function(a, b) {
            this.normal.copy(a);
            this.constant = -b.dot(this.normal);
            return this
        },
        setFromCoplanarPoints: function() {
            var a = new t.Vector3
              , b = new t.Vector3;
            return function(c, d, e) {
                d = a.subVectors(e, d).cross(b.subVectors(c, d)).normalize();
                this.setFromNormalAndCoplanarPoint(d, c);
                return this
            }
        }(),
        copy: function(a) {
            this.normal.copy(a.normal);
            this.constant = a.constant;
            return this
        },
        normalize: function() {
            var a = 1 / this.normal.length();
            this.normal.multiplyScalar(a);
            this.constant *= a;
            return this
        },
        negate: function() {
            this.constant *= -1;
            this.normal.negate();
            return this
        },
        distanceToPoint: function(a) {
            return this.normal.dot(a) + this.constant
        },
        distanceToSphere: function(a) {
            return this.distanceToPoint(a.center) - a.radius
        },
        projectPoint: function(a, b) {
            return this.orthoPoint(a, b).sub(a).negate()
        },
        orthoPoint: function(a, b) {
            a = this.distanceToPoint(a);
            return (b || new t.Vector3).copy(this.normal).multiplyScalar(a)
        },
        isIntersectionLine: function(a) {
            var b = this.distanceToPoint(a.start);
            a = this.distanceToPoint(a.end);
            return 0 > b && 0 < a || 0 > a && 0 < b
        },
        intersectLine: function() {
            var a = new t.Vector3;
            return function(b, c) {
                c = c || new t.Vector3;
                var d = b.delta(a)
                  , e = this.normal.dot(d);
                if (0 == e) {
                    if (0 == this.distanceToPoint(b.start))
                        return c.copy(b.start)
                } else if (e = -(b.start.dot(this.normal) + this.constant) / e,
                !(0 > e || 1 < e))
                    return c.copy(d).multiplyScalar(e).add(b.start)
            }
        }(),
        coplanarPoint: function(a) {
            return (a || new t.Vector3).copy(this.normal).multiplyScalar(-this.constant)
        },
        applyMatrix4: function() {
            var a = new t.Vector3
              , b = new t.Vector3
              , c = new t.Matrix3;
            return function(d, e) {
                e = e || c.getNormalMatrix(d);
                e = a.copy(this.normal).applyMatrix3(e);
                var f = this.coplanarPoint(b);
                f.applyMatrix4(d);
                this.setFromNormalAndCoplanarPoint(e, f);
                return this
            }
        }(),
        translate: function(a) {
            this.constant -= a.dot(this.normal);
            return this
        },
        equals: function(a) {
            return a.normal.equals(this.normal) && a.constant == this.constant
        },
        clone: function() {
            return (new t.Plane).copy(this)
        }
    };
    t.Math = {
        generateUUID: function() {
            var a = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""), b = Array(36), c = 0, d;
            return function() {
                for (var e = 0; 36 > e; e++)
                    8 == e || 13 == e || 18 == e || 23 == e ? b[e] = "-" : 14 == e ? b[e] = "4" : (2 >= c && (c = 33554432 + 16777216 * Math.random() | 0),
                    d = c & 15,
                    c >>= 4,
                    b[e] = a[19 == e ? d & 3 | 8 : d]);
                return b.join("")
            }
        }(),
        clamp: function(a, b, c) {
            return a < b ? b : a > c ? c : a
        },
        clampBottom: function(a, b) {
            return a < b ? b : a
        },
        mapLinear: function(a, b, c, d, e) {
            return d + (a - b) * (e - d) / (c - b)
        },
        smoothstep: function(a, b, c) {
            if (a <= b)
                return 0;
            if (a >= c)
                return 1;
            a = (a - b) / (c - b);
            return a * a * (3 - 2 * a)
        },
        smootherstep: function(a, b, c) {
            if (a <= b)
                return 0;
            if (a >= c)
                return 1;
            a = (a - b) / (c - b);
            return a * a * a * (a * (6 * a - 15) + 10)
        },
        random16: function() {
            return (65280 * Math.random() + 255 * Math.random()) / 65535
        },
        randInt: function(a, b) {
            return Math.floor(this.randFloat(a, b))
        },
        randFloat: function(a, b) {
            return a + Math.random() * (b - a)
        },
        randFloatSpread: function(a) {
            return a * (.5 - Math.random())
        },
        degToRad: function() {
            var a = Math.PI / 180;
            return function(b) {
                return b * a
            }
        }(),
        radToDeg: function() {
            var a = 180 / Math.PI;
            return function(b) {
                return b * a
            }
        }(),
        isPowerOfTwo: function(a) {
            return 0 === (a & a - 1) && 0 !== a
        },
        nextPowerOfTwo: function(a) {
            a--;
            a |= a >> 1;
            a |= a >> 2;
            a |= a >> 4;
            a |= a >> 8;
            a |= a >> 16;
            a++;
            return a
        }
    };
    t.Clock = function(a) {
        this.autoStart = void 0 !== a ? a : !0;
        this.elapsedTime = this.oldTime = this.startTime = 0;
        this.running = !1
    }
    ;
    t.Clock.prototype = {
        constructor: t.Clock,
        start: function() {
            this.oldTime = this.startTime = void 0 !== self.performance && void 0 !== self.performance.now ? self.performance.now() : Date.now();
            this.running = !0
        },
        stop: function() {
            this.getElapsedTime();
            this.running = !1
        },
        getElapsedTime: function() {
            this.getDelta();
            return this.elapsedTime
        },
        getDelta: function() {
            var a = 0;
            this.autoStart && !this.running && this.start();
            if (this.running) {
                var b = void 0 !== self.performance && void 0 !== self.performance.now ? self.performance.now() : Date.now();
                a = .001 * (b - this.oldTime);
                this.oldTime = b;
                this.elapsedTime += a
            }
            return a
        }
    };
    t.EventDispatcher = function() {}
    ;
    t.EventDispatcher.prototype = {
        constructor: t.EventDispatcher,
        apply: function(a) {
            a.addEventListener = t.EventDispatcher.prototype.addEventListener;
            a.hasEventListener = t.EventDispatcher.prototype.hasEventListener;
            a.removeEventListener = t.EventDispatcher.prototype.removeEventListener;
            a.dispatchEvent = t.EventDispatcher.prototype.dispatchEvent
        },
        addEventListener: function(a, b) {
            void 0 === this._listeners && (this._listeners = {});
            var c = this._listeners;
            void 0 === c[a] && (c[a] = []);
            -1 === c[a].indexOf(b) && c[a].push(b)
        },
        hasEventListener: function(a, b) {
            if (void 0 === this._listeners)
                return !1;
            var c = this._listeners;
            return void 0 !== c[a] && -1 !== c[a].indexOf(b) ? !0 : !1
        },
        removeEventListener: function(a, b) {
            void 0 !== this._listeners && (a = this._listeners[a],
            void 0 !== a && (b = a.indexOf(b),
            -1 !== b && a.splice(b, 1)))
        },
        dispatchEvent: function(a) {
            if (void 0 !== this._listeners) {
                var b = this._listeners[a.type];
                if (void 0 !== b) {
                    a.target = this;
                    for (var c = [], d = b.length, e = 0; e < d; e++)
                        c[e] = b[e];
                    for (e = 0; e < d; e++)
                        c[e].call(this, a)
                }
            }
        }
    };
    t.Object3D = function() {
        Object.defineProperty(this, "id", {
            value: t.Object3DIdCount++
        });
        this.name = "";
        this.parent = void 0;
        this.children = [];
        this.up = t.Object3D.DefaultUp.clone();
        var a = new t.Vector3
          , b = new t.Euler
          , c = new t.Quaternion
          , d = new t.Vector3(1,1,1);
        b.onChange(function() {
            c.setFromEuler(b, !1)
        });
        c.onChange(function() {
            b.setFromQuaternion(c, void 0, !1)
        });
        Object.defineProperties(this, {
            position: {
                enumerable: !0,
                value: a
            },
            rotation: {
                enumerable: !0,
                value: b
            },
            quaternion: {
                enumerable: !0,
                value: c
            },
            scale: {
                enumerable: !0,
                value: d
            }
        });
        this.rotationAutoUpdate = !0;
        this.matrix = new t.Matrix4;
        this.matrixWorld = new t.Matrix4;
        this.matrixAutoUpdate = !0;
        this.matrixWorldNeedsUpdate = !1;
        this.visible = !0;
        this.receiveShadow = this.castShadow = !1;
        this.frustumCulled = !0;
        this.userData = {}
    }
    ;
    t.Object3D.DefaultUp = new t.Vector3(0,1,0);
    t.Object3D.prototype = {
        constructor: t.Object3D,
        applyMatrix: function(a) {
            this.matrix.multiplyMatrices(a, this.matrix);
            this.matrix.decompose(this.position, this.quaternion, this.scale)
        },
        setRotationFromAxisAngle: function(a, b) {
            this.quaternion.setFromAxisAngle(a, b)
        },
        setRotationFromEuler: function(a) {
            this.quaternion.setFromEuler(a, !0)
        },
        setRotationFromMatrix: function(a) {
            this.quaternion.setFromRotationMatrix(a)
        },
        setRotationFromQuaternion: function(a) {
            this.quaternion.copy(a)
        },
        rotateOnAxis: function() {
            var a = new t.Quaternion;
            return function(b, c) {
                a.setFromAxisAngle(b, c);
                this.quaternion.multiply(a);
                return this
            }
        }(),
        rotateX: function() {
            var a = new t.Vector3(1,0,0);
            return function(b) {
                return this.rotateOnAxis(a, b)
            }
        }(),
        rotateY: function() {
            var a = new t.Vector3(0,1,0);
            return function(b) {
                return this.rotateOnAxis(a, b)
            }
        }(),
        rotateZ: function() {
            var a = new t.Vector3(0,0,1);
            return function(b) {
                return this.rotateOnAxis(a, b)
            }
        }(),
        translateOnAxis: function() {
            var a = new t.Vector3;
            return function(b, c) {
                a.copy(b).applyQuaternion(this.quaternion);
                this.position.add(a.multiplyScalar(c));
                return this
            }
        }(),
        translate: function(a, b) {
            t.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");
            return this.translateOnAxis(b, a)
        },
        translateX: function() {
            var a = new t.Vector3(1,0,0);
            return function(b) {
                return this.translateOnAxis(a, b)
            }
        }(),
        translateY: function() {
            var a = new t.Vector3(0,1,0);
            return function(b) {
                return this.translateOnAxis(a, b)
            }
        }(),
        translateZ: function() {
            var a = new t.Vector3(0,0,1);
            return function(b) {
                return this.translateOnAxis(a, b)
            }
        }(),
        localToWorld: function(a) {
            return a.applyMatrix4(this.matrixWorld)
        },
        worldToLocal: function() {
            var a = new t.Matrix4;
            return function(b) {
                return b.applyMatrix4(a.getInverse(this.matrixWorld))
            }
        }(),
        lookAt: function() {
            var a = new t.Matrix4;
            return function(b) {
                a.lookAt(b, this.position, this.up);
                this.quaternion.setFromRotationMatrix(a)
            }
        }(),
        add: function(a) {
            if (1 < arguments.length) {
                for (var b = 0; b < arguments.length; b++)
                    this.add(arguments[b]);
                return this
            }
            if (a === this)
                return t.error("THREE.Object3D.add: object can't be added as a child of itself.", a),
                this;
            a instanceof t.Object3D ? (void 0 !== a.parent && a.parent.remove(a),
            a.parent = this,
            a.dispatchEvent({
                type: "added"
            }),
            this.children.push(a)) : t.error("THREE.Object3D.add: object not an instance of THREE.Object3D.", a);
            return this
        },
        remove: function(a) {
            if (1 < arguments.length)
                for (var b = 0; b < arguments.length; b++)
                    this.remove(arguments[b]);
            b = this.children.indexOf(a);
            -1 !== b && (a.parent = void 0,
            a.dispatchEvent({
                type: "removed"
            }),
            this.children.splice(b, 1))
        },
        getChildByName: function(a) {
            t.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
            return this.getObjectByName(a)
        },
        getObjectById: function(a) {
            return this.getObjectByProperty("id", a)
        },
        getObjectByName: function(a) {
            return this.getObjectByProperty("name", a)
        },
        getObjectByProperty: function(a, b) {
            if (this[a] === b)
                return this;
            for (var c = 0, d = this.children.length; c < d; c++) {
                var e = this.children[c].getObjectByProperty(a, b);
                if (void 0 !== e)
                    return e
            }
        },
        getWorldPosition: function(a) {
            a = a || new t.Vector3;
            this.updateMatrixWorld(!0);
            return a.setFromMatrixPosition(this.matrixWorld)
        },
        getWorldQuaternion: function() {
            var a = new t.Vector3
              , b = new t.Vector3;
            return function(c) {
                c = c || new t.Quaternion;
                this.updateMatrixWorld(!0);
                this.matrixWorld.decompose(a, c, b);
                return c
            }
        }(),
        getWorldRotation: function() {
            var a = new t.Quaternion;
            return function(b) {
                b = b || new t.Euler;
                this.getWorldQuaternion(a);
                return b.setFromQuaternion(a, this.rotation.order, !1)
            }
        }(),
        getWorldScale: function() {
            var a = new t.Vector3
              , b = new t.Quaternion;
            return function(c) {
                c = c || new t.Vector3;
                this.updateMatrixWorld(!0);
                this.matrixWorld.decompose(a, b, c);
                return c
            }
        }(),
        getWorldDirection: function() {
            var a = new t.Quaternion;
            return function(b) {
                b = b || new t.Vector3;
                this.getWorldQuaternion(a);
                return b.set(0, 0, 1).applyQuaternion(a)
            }
        }(),
        raycast: function() {},
        traverse: function(a) {
            a(this);
            for (var b = 0, c = this.children.length; b < c; b++)
                this.children[b].traverse(a)
        },
        traverseVisible: function(a) {
            if (!1 !== this.visible) {
                a(this);
                for (var b = 0, c = this.children.length; b < c; b++)
                    this.children[b].traverseVisible(a)
            }
        },
        traverseAncestors: function(a) {
            this.parent && (a(this.parent),
            this.parent.traverseAncestors(a))
        },
        updateMatrix: function() {
            this.matrix.compose(this.position, this.quaternion, this.scale);
            this.matrixWorldNeedsUpdate = !0
        },
        updateMatrixWorld: function(a) {
            !0 === this.matrixAutoUpdate && this.updateMatrix();
            if (!0 === this.matrixWorldNeedsUpdate || !0 === a)
                void 0 === this.parent ? this.matrixWorld.copy(this.matrix) : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix),
                this.matrixWorldNeedsUpdate = !1,
                a = !0;
            for (var b = 0, c = this.children.length; b < c; b++)
                this.children[b].updateMatrixWorld(a)
        },
        clone: function(a, b) {
            void 0 === a && (a = new t.Object3D);
            void 0 === b && (b = !0);
            a.name = this.name;
            a.up.copy(this.up);
            a.position.copy(this.position);
            a.quaternion.copy(this.quaternion);
            a.scale.copy(this.scale);
            a.rotationAutoUpdate = this.rotationAutoUpdate;
            a.matrix.copy(this.matrix);
            a.matrixWorld.copy(this.matrixWorld);
            a.matrixAutoUpdate = this.matrixAutoUpdate;
            a.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;
            a.visible = this.visible;
            a.castShadow = this.castShadow;
            a.receiveShadow = this.receiveShadow;
            a.frustumCulled = this.frustumCulled;
            a.userData = JSON.parse(JSON.stringify(this.userData));
            if (!0 === b)
                for (b = 0; b < this.children.length; b++)
                    a.add(this.children[b].clone());
            return a
        }
    };
    t.EventDispatcher.prototype.apply(t.Object3D.prototype);
    t.Object3DIdCount = 0;
    t.Face3 = function(a, b, c, d, e, f) {
        this.a = a;
        this.b = b;
        this.c = c;
        this.normal = d instanceof t.Vector3 ? d : new t.Vector3;
        this.vertexNormals = d instanceof Array ? d : [];
        this.color = e instanceof t.Color ? e : new t.Color;
        this.vertexColors = e instanceof Array ? e : [];
        this.vertexTangents = [];
        this.materialIndex = void 0 !== f ? f : 0
    }
    ;
    t.Face3.prototype = {
        constructor: t.Face3,
        clone: function() {
            var a = new t.Face3(this.a,this.b,this.c);
            a.normal.copy(this.normal);
            a.color.copy(this.color);
            a.materialIndex = this.materialIndex;
            for (var b = 0, c = this.vertexNormals.length; b < c; b++)
                a.vertexNormals[b] = this.vertexNormals[b].clone();
            b = 0;
            for (c = this.vertexColors.length; b < c; b++)
                a.vertexColors[b] = this.vertexColors[b].clone();
            b = 0;
            for (c = this.vertexTangents.length; b < c; b++)
                a.vertexTangents[b] = this.vertexTangents[b].clone();
            return a
        }
    };
    t.BufferAttribute = function(a, b) {
        this.array = a;
        this.itemSize = b;
        this.needsUpdate = !1
    }
    ;
    t.BufferAttribute.prototype = {
        constructor: t.BufferAttribute,
        get length() {
            return this.array.length
        },
        copyAt: function(a, b, c) {
            a *= this.itemSize;
            c *= b.itemSize;
            for (var d = 0, e = this.itemSize; d < e; d++)
                this.array[a + d] = b.array[c + d];
            return this
        },
        set: function(a, b) {
            void 0 === b && (b = 0);
            this.array.set(a, b);
            return this
        },
        setX: function(a, b) {
            this.array[a * this.itemSize] = b;
            return this
        },
        setY: function(a, b) {
            this.array[a * this.itemSize + 1] = b;
            return this
        },
        setZ: function(a, b) {
            this.array[a * this.itemSize + 2] = b;
            return this
        },
        setXY: function(a, b, c) {
            a *= this.itemSize;
            this.array[a] = b;
            this.array[a + 1] = c;
            return this
        },
        setXYZ: function(a, b, c, d) {
            a *= this.itemSize;
            this.array[a] = b;
            this.array[a + 1] = c;
            this.array[a + 2] = d;
            return this
        },
        setXYZW: function(a, b, c, d, e) {
            a *= this.itemSize;
            this.array[a] = b;
            this.array[a + 1] = c;
            this.array[a + 2] = d;
            this.array[a + 3] = e;
            return this
        },
        clone: function() {
            return new t.BufferAttribute(new this.array.constructor(this.array),this.itemSize)
        }
    };
    t.BufferGeometry = function() {
        Object.defineProperty(this, "id", {
            value: t.GeometryIdCount++
        });
        this.name = "";
        this.attributes = {};
        this.attributesKeys = [];
        this.offsets = this.drawcalls = [];
        this.boundingSphere = this.boundingBox = null
    }
    ;
    t.BufferGeometry.prototype = {
        constructor: t.BufferGeometry,
        addAttribute: function(a, b) {
            this.attributes[a] = b;
            this.attributesKeys = Object.keys(this.attributes)
        },
        getAttribute: function(a) {
            return this.attributes[a]
        },
        addDrawCall: function(a, b, c) {
            this.drawcalls.push({
                start: a,
                count: b,
                index: void 0 !== c ? c : 0
            })
        },
        applyMatrix: function(a) {
            var b = this.attributes.position;
            void 0 !== b && (a.applyToVector3Array(b.array),
            b.needsUpdate = !0);
            b = this.attributes.normal;
            void 0 !== b && ((new t.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
            b.needsUpdate = !0);
            null !== this.boundingBox && this.computeBoundingBox();
            null !== this.boundingSphere && this.computeBoundingSphere()
        },
        center: function() {
            this.computeBoundingBox();
            var a = this.boundingBox.center().negate();
            this.applyMatrix((new t.Matrix4).setPosition(a));
            return a
        },
        computeBoundingBox: function() {
            var a = new t.Vector3;
            return function() {
                null === this.boundingBox && (this.boundingBox = new t.Box3);
                var b = this.attributes.position.array;
                if (b) {
                    var c = this.boundingBox;
                    c.makeEmpty();
                    for (var d = 0, e = b.length; d < e; d += 3)
                        a.set(b[d], b[d + 1], b[d + 2]),
                        c.expandByPoint(a)
                }
                if (void 0 === b || 0 === b.length)
                    this.boundingBox.min.set(0, 0, 0),
                    this.boundingBox.max.set(0, 0, 0);
                (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) && t.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')
            }
        }(),
        computeBoundingSphere: function() {
            var a = new t.Box3
              , b = new t.Vector3;
            return function() {
                null === this.boundingSphere && (this.boundingSphere = new t.Sphere);
                var c = this.attributes.position.array;
                if (c) {
                    a.makeEmpty();
                    for (var d = this.boundingSphere.center, e = 0, f = c.length; e < f; e += 3)
                        b.set(c[e], c[e + 1], c[e + 2]),
                        a.expandByPoint(b);
                    a.center(d);
                    var g = 0;
                    e = 0;
                    for (f = c.length; e < f; e += 3)
                        b.set(c[e], c[e + 1], c[e + 2]),
                        g = Math.max(g, d.distanceToSquared(b));
                    this.boundingSphere.radius = Math.sqrt(g);
                    isNaN(this.boundingSphere.radius) && t.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')
                }
            }
        }(),
        computeVertexNormals: function() {
            var a = this.attributes;
            if (a.position) {
                var b = a.position.array;
                if (void 0 === a.normal)
                    this.addAttribute("normal", new t.BufferAttribute(new Float32Array(b.length),3));
                else
                    for (var c = a.normal.array, d = 0, e = c.length; d < e; d++)
                        c[d] = 0;
                c = a.normal.array;
                var f = new t.Vector3
                  , g = new t.Vector3
                  , h = new t.Vector3
                  , l = new t.Vector3
                  , m = new t.Vector3;
                if (a.index)
                    for (var n = a.index.array, p = 0 < this.offsets.length ? this.offsets : [{
                        start: 0,
                        count: n.length,
                        index: 0
                    }], q = 0, r = p.length; q < r; ++q) {
                        e = p[q].start;
                        var u = p[q].count;
                        var v = p[q].index;
                        d = e;
                        for (e += u; d < e; d += 3) {
                            u = 3 * (v + n[d]);
                            var w = 3 * (v + n[d + 1]);
                            var x = 3 * (v + n[d + 2]);
                            f.fromArray(b, u);
                            g.fromArray(b, w);
                            h.fromArray(b, x);
                            l.subVectors(h, g);
                            m.subVectors(f, g);
                            l.cross(m);
                            c[u] += l.x;
                            c[u + 1] += l.y;
                            c[u + 2] += l.z;
                            c[w] += l.x;
                            c[w + 1] += l.y;
                            c[w + 2] += l.z;
                            c[x] += l.x;
                            c[x + 1] += l.y;
                            c[x + 2] += l.z
                        }
                    }
                else
                    for (d = 0,
                    e = b.length; d < e; d += 9)
                        f.fromArray(b, d),
                        g.fromArray(b, d + 3),
                        h.fromArray(b, d + 6),
                        l.subVectors(h, g),
                        m.subVectors(f, g),
                        l.cross(m),
                        c[d] = l.x,
                        c[d + 1] = l.y,
                        c[d + 2] = l.z,
                        c[d + 3] = l.x,
                        c[d + 4] = l.y,
                        c[d + 5] = l.z,
                        c[d + 6] = l.x,
                        c[d + 7] = l.y,
                        c[d + 8] = l.z;
                this.normalizeNormals();
                a.normal.needsUpdate = !0
            }
        },
        computeTangents: function() {
            function a(a, b, c) {
                p.fromArray(d, 3 * a);
                q.fromArray(d, 3 * b);
                r.fromArray(d, 3 * c);
                u.fromArray(f, 2 * a);
                v.fromArray(f, 2 * b);
                w.fromArray(f, 2 * c);
                x = q.x - p.x;
                y = r.x - p.x;
                z = q.y - p.y;
                A = r.y - p.y;
                B = q.z - p.z;
                H = r.z - p.z;
                C = v.x - u.x;
                L = w.x - u.x;
                G = v.y - u.y;
                I = w.y - u.y;
                M = 1 / (C * I - L * G);
                O.set((I * x - G * y) * M, (I * z - G * A) * M, (I * B - G * H) * M);
                K.set((C * y - L * x) * M, (C * A - L * z) * M, (C * H - L * B) * M);
                l[a].add(O);
                l[b].add(O);
                l[c].add(O);
                m[a].add(K);
                m[b].add(K);
                m[c].add(K)
            }
            function b(a) {
                Y.fromArray(e, 3 * a);
                N.copy(Y);
                ba = l[a];
                ha.copy(ba);
                ha.sub(Y.multiplyScalar(Y.dot(ba))).normalize();
                ia.crossVectors(N, ba);
                W = ia.dot(m[a]);
                U = 0 > W ? -1 : 1;
                h[4 * a] = ha.x;
                h[4 * a + 1] = ha.y;
                h[4 * a + 2] = ha.z;
                h[4 * a + 3] = U
            }
            if (void 0 === this.attributes.index || void 0 === this.attributes.position || void 0 === this.attributes.normal || void 0 === this.attributes.uv)
                t.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
            else {
                var c = this.attributes.index.array
                  , d = this.attributes.position.array
                  , e = this.attributes.normal.array
                  , f = this.attributes.uv.array
                  , g = d.length / 3;
                void 0 === this.attributes.tangent && this.addAttribute("tangent", new t.BufferAttribute(new Float32Array(4 * g),4));
                for (var h = this.attributes.tangent.array, l = [], m = [], n = 0; n < g; n++)
                    l[n] = new t.Vector3,
                    m[n] = new t.Vector3;
                var p = new t.Vector3, q = new t.Vector3, r = new t.Vector3, u = new t.Vector2, v = new t.Vector2, w = new t.Vector2, x, y, z, A, B, H, C, L, G, I, M, O = new t.Vector3, K = new t.Vector3, F;
                0 === this.drawcalls.length && this.addDrawCall(0, c.length, 0);
                var D = this.drawcalls;
                n = 0;
                for (F = D.length; n < F; ++n) {
                    var E = D[n].start;
                    var S = D[n].count;
                    var Z = D[n].index;
                    g = E;
                    for (E += S; g < E; g += 3) {
                        S = Z + c[g];
                        var R = Z + c[g + 1];
                        var da = Z + c[g + 2];
                        a(S, R, da)
                    }
                }
                var ha = new t.Vector3, ia = new t.Vector3, Y = new t.Vector3, N = new t.Vector3, U, ba, W;
                n = 0;
                for (F = D.length; n < F; ++n)
                    for (E = D[n].start,
                    S = D[n].count,
                    Z = D[n].index,
                    g = E,
                    E += S; g < E; g += 3)
                        S = Z + c[g],
                        R = Z + c[g + 1],
                        da = Z + c[g + 2],
                        b(S),
                        b(R),
                        b(da)
            }
        },
        normalizeNormals: function() {
            for (var a = this.attributes.normal.array, b, c, d, e = 0, f = a.length; e < f; e += 3)
                b = a[e],
                c = a[e + 1],
                d = a[e + 2],
                b = 1 / Math.sqrt(b * b + c * c + d * d),
                a[e] *= b,
                a[e + 1] *= b,
                a[e + 2] *= b
        },
        clone: function() {
            var a = new t.BufferGeometry;
            for (b in this.attributes)
                a.addAttribute(b, this.attributes[b].clone());
            var b = 0;
            for (var c = this.offsets.length; b < c; b++) {
                var d = this.offsets[b];
                a.offsets.push({
                    start: d.start,
                    index: d.index,
                    count: d.count
                })
            }
            return a
        },
        dispose: function() {
            this.dispatchEvent({
                type: "dispose"
            })
        }
    };
    t.EventDispatcher.prototype.apply(t.BufferGeometry.prototype);
    t.Camera = function() {
        t.Object3D.call(this);
        this.matrixWorldInverse = new t.Matrix4;
        this.projectionMatrix = new t.Matrix4
    }
    ;
    t.Camera.prototype = Object.create(t.Object3D.prototype);
    t.Camera.prototype.constructor = t.Camera;
    t.Camera.prototype.getWorldDirection = function() {
        var a = new t.Quaternion;
        return function(b) {
            b = b || new t.Vector3;
            this.getWorldQuaternion(a);
            return b.set(0, 0, -1).applyQuaternion(a)
        }
    }();
    t.Camera.prototype.lookAt = function() {
        var a = new t.Matrix4;
        return function(b) {
            a.lookAt(this.position, b, this.up);
            this.quaternion.setFromRotationMatrix(a)
        }
    }();
    t.Camera.prototype.clone = function(a) {
        void 0 === a && (a = new t.Camera);
        t.Object3D.prototype.clone.call(this, a);
        a.matrixWorldInverse.copy(this.matrixWorldInverse);
        a.projectionMatrix.copy(this.projectionMatrix);
        return a
    }
    ;
    t.PerspectiveCamera = function(a, b, c, d) {
        t.Camera.call(this);
        this.zoom = 1;
        this.fov = void 0 !== a ? a : 50;
        this.aspect = void 0 !== b ? b : 1;
        this.near = void 0 !== c ? c : .1;
        this.far = void 0 !== d ? d : 2E3;
        this.updateProjectionMatrix()
    }
    ;
    t.PerspectiveCamera.prototype = Object.create(t.Camera.prototype);
    t.PerspectiveCamera.prototype.constructor = t.PerspectiveCamera;
    t.PerspectiveCamera.prototype.setLens = function(a, b) {
        void 0 === b && (b = 24);
        this.fov = 2 * t.Math.radToDeg(Math.atan(b / (2 * a)));
        this.updateProjectionMatrix()
    }
    ;
    t.PerspectiveCamera.prototype.setViewOffset = function(a, b, c, d, e, f) {
        this.fullWidth = a;
        this.fullHeight = b;
        this.x = c;
        this.y = d;
        this.width = e;
        this.height = f;
        this.updateProjectionMatrix()
    }
    ;
    t.PerspectiveCamera.prototype.updateProjectionMatrix = function() {
        var a = t.Math.radToDeg(2 * Math.atan(Math.tan(.5 * t.Math.degToRad(this.fov)) / this.zoom));
        if (this.fullWidth) {
            var b = this.fullWidth / this.fullHeight;
            a = Math.tan(t.Math.degToRad(.5 * a)) * this.near;
            var c = -a
              , d = b * c;
            b = Math.abs(b * a - d);
            c = Math.abs(a - c);
            this.projectionMatrix.makeFrustum(d + this.x * b / this.fullWidth, d + (this.x + this.width) * b / this.fullWidth, a - (this.y + this.height) * c / this.fullHeight, a - this.y * c / this.fullHeight, this.near, this.far)
        } else
            this.projectionMatrix.makePerspective(a, this.aspect, this.near, this.far)
    }
    ;
    t.PerspectiveCamera.prototype.clone = function() {
        var a = new t.PerspectiveCamera;
        t.Camera.prototype.clone.call(this, a);
        a.zoom = this.zoom;
        a.fov = this.fov;
        a.aspect = this.aspect;
        a.near = this.near;
        a.far = this.far;
        a.projectionMatrix.copy(this.projectionMatrix);
        return a
    }
    ;
    t.OrthographicCamera = function(a, b, c, d, e, f) {
        t.Camera.call(this);
        this.zoom = 1;
        this.left = a;
        this.right = b;
        this.top = c;
        this.bottom = d;
        this.near = void 0 !== e ? e : .1;
        this.far = void 0 !== f ? f : 2E3;
        this.updateProjectionMatrix()
    }
    ;
    t.OrthographicCamera.prototype = Object.create(t.Camera.prototype);
    t.OrthographicCamera.prototype.constructor = t.OrthographicCamera;
    t.OrthographicCamera.prototype.updateProjectionMatrix = function() {
        var a = (this.right - this.left) / (2 * this.zoom)
          , b = (this.top - this.bottom) / (2 * this.zoom)
          , c = (this.right + this.left) / 2
          , d = (this.top + this.bottom) / 2;
        this.projectionMatrix.makeOrthographic(c - a, c + a, d + b, d - b, this.near, this.far)
    }
    ;
    t.OrthographicCamera.prototype.clone = function() {
        var a = new t.OrthographicCamera;
        t.Camera.prototype.clone.call(this, a);
        a.zoom = this.zoom;
        a.left = this.left;
        a.right = this.right;
        a.top = this.top;
        a.bottom = this.bottom;
        a.near = this.near;
        a.far = this.far;
        a.projectionMatrix.copy(this.projectionMatrix);
        return a
    }
    ;
    t.Mesh = function(a, b) {
        t.Object3D.call(this);
        this.geometry = void 0 !== a ? a : new t.Geometry;
        this.material = void 0 !== b ? b : new t.MeshBasicMaterial({
            color: 16777215 * Math.random()
        });
        this.updateMorphTargets()
    }
    ;
    t.Mesh.prototype = Object.create(t.Object3D.prototype);
    t.Mesh.prototype.constructor = t.Mesh;
    t.Mesh.prototype.updateMorphTargets = function() {
        if (void 0 !== this.geometry.morphTargets && 0 < this.geometry.morphTargets.length) {
            this.morphTargetBase = -1;
            this.morphTargetForcedOrder = [];
            this.morphTargetInfluences = [];
            this.morphTargetDictionary = {};
            for (var a = 0, b = this.geometry.morphTargets.length; a < b; a++)
                this.morphTargetInfluences.push(0),
                this.morphTargetDictionary[this.geometry.morphTargets[a].name] = a
        }
    }
    ;
    t.Mesh.prototype.getMorphTargetIndexByName = function(a) {
        if (void 0 !== this.morphTargetDictionary[a])
            return this.morphTargetDictionary[a];
        t.warn("THREE.Mesh.getMorphTargetIndexByName: morph target " + a + " does not exist. Returning 0.");
        return 0
    }
    ;
    t.Mesh.prototype.clone = function(a, b) {
        void 0 === a && (a = new t.Mesh(this.geometry,this.material));
        t.Object3D.prototype.clone.call(this, a, b);
        return a
    }
    ;
    t.Scene = function() {
        t.Object3D.call(this);
        this.overrideMaterial = null;
        this.autoUpdate = !0
    }
    ;
    t.Scene.prototype = Object.create(t.Object3D.prototype);
    t.Scene.prototype.constructor = t.Scene;
    t.Scene.prototype.clone = function(a) {
        void 0 === a && (a = new t.Scene);
        t.Object3D.prototype.clone.call(this, a);
        null !== this.overrideMaterial && (a.overrideMaterial = this.overrideMaterial.clone());
        a.autoUpdate = this.autoUpdate;
        a.matrixAutoUpdate = this.matrixAutoUpdate;
        return a
    }
    ;
    t.UniformsUtils = {
        merge: function(a) {
            for (var b = {}, c = 0; c < a.length; c++) {
                var d = this.clone(a[c]), e;
                for (e in d)
                    b[e] = d[e]
            }
            return b
        },
        clone: function(a) {
            var b = {}, c;
            for (c in a) {
                b[c] = {};
                for (var d in a[c]) {
                    var e = a[c][d];
                    b[c][d] = e && void 0 !== e.clone ? e.clone() : e instanceof Array ? e.slice() : e
                }
            }
            return b
        }
    };
    t.BoxBufferGeometry = function(a, b, c, d, e, f) {
        function g(a, b, c, d, e, f, g, z, A, B) {
            var r = f / A
              , w = g / B
              , q = f / 2
              , u = g / 2
              , v = z / 2;
            g = A + 1;
            var x = B + 1;
            f = 0;
            var y, K, F = new t.Vector3;
            for (K = 0; K < x; K++) {
                var D = K * w - u;
                for (y = 0; y < g; y++)
                    F[a] = (y * r - q) * d,
                    F[b] = D * e,
                    F[c] = v,
                    l.push(F.x, F.y, F.z),
                    F[a] = 0,
                    F[b] = 0,
                    F[c] = 0 < z ? 1 : -1,
                    m.push(F.x, F.y, F.z),
                    n.push(y / A),
                    n.push(1 - K / B),
                    f += 1
            }
            for (K = 0; K < B; K++)
                for (y = 0; y < A; y++)
                    a = p + y + g * (K + 1),
                    b = p + (y + 1) + g * (K + 1),
                    c = p + (y + 1) + g * K,
                    h.push(p + y + g * K, a, c),
                    h.push(a, b, c);
            p += f
        }
        t.BufferGeometry.call(this);
        this.parameters = {
            width: a,
            height: b,
            depth: c,
            widthSegments: d,
            heightSegments: e,
            depthSegments: f
        };
        d = Math.floor(d) || 1;
        e = Math.floor(e) || 1;
        f = Math.floor(f) || 1;
        var h = []
          , l = []
          , m = []
          , n = []
          , p = 0;
        g("z", "y", "x", -1, -1, c, b, a, f, e);
        g("z", "y", "x", 1, -1, c, b, -a, f, e);
        g("x", "z", "y", 1, 1, a, c, b, d, f);
        g("x", "z", "y", 1, -1, a, c, -b, d, f);
        g("x", "y", "z", 1, -1, a, b, c, d, e);
        g("x", "y", "z", -1, -1, a, b, -c, d, e);
        console.assert(65536 >= l.length);
        this.addAttribute("index", new t.BufferAttribute(new Uint16Array(h),1));
        this.addAttribute("position", new t.BufferAttribute(new Float32Array(l),3));
        this.addAttribute("normal", new t.BufferAttribute(new Float32Array(m),3));
        this.addAttribute("uv", new t.BufferAttribute(new Float32Array(n),2))
    }
    ;
    t.BoxBufferGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    t.BoxBufferGeometry.prototype.constructor = t.BoxBufferGeometry;
    t.SphereBufferGeometry = function(a, b, c, d, e, f, g) {
        t.BufferGeometry.call(this);
        this.parameters = {
            radius: a,
            widthSegments: b,
            heightSegments: c,
            phiStart: d,
            phiLength: e,
            thetaStart: f,
            thetaLength: g
        };
        a = a || 50;
        b = Math.max(3, Math.floor(b) || 8);
        c = Math.max(2, Math.floor(c) || 6);
        d = void 0 !== d ? d : 0;
        e = void 0 !== e ? e : 2 * Math.PI;
        f = void 0 !== f ? f : 0;
        g = void 0 !== g ? g : Math.PI;
        var h = f + g, l, m, n = 0, p = [], q = new t.Vector3, r = new t.Vector3, u = [], v = [], w = [], x = [];
        for (m = 0; m <= c; m++) {
            var y = []
              , z = m / c;
            for (l = 0; l <= b; l++) {
                var A = l / b;
                q.x = -a * Math.cos(d + A * e) * Math.sin(f + z * g);
                q.y = a * Math.cos(f + z * g);
                q.z = a * Math.sin(d + A * e) * Math.sin(f + z * g);
                v.push(q.x, q.y, q.z);
                r.set(q.x, q.y, q.z).normalize();
                w.push(r.x, r.y, r.z);
                x.push(A, 1 - z);
                y.push(n++)
            }
            p.push(y)
        }
        for (m = 0; m < c; m++)
            for (l = 0; l < b; l++)
                a = p[m][l + 1],
                d = p[m][l],
                e = p[m + 1][l],
                g = p[m + 1][l + 1],
                (0 !== m || 0 < f) && u.push(a, d, g),
                (m !== c - 1 || h < Math.PI) && u.push(d, e, g);
        console.assert(65536 >= v.length);
        this.addAttribute("index", new t.BufferAttribute(new Uint16Array(u),1));
        this.addAttribute("position", new t.BufferAttribute(new Float32Array(v),3));
        this.addAttribute("normal", new t.BufferAttribute(new Float32Array(w),3));
        this.addAttribute("uv", new t.BufferAttribute(new Float32Array(x),2))
    }
    ;
    t.SphereBufferGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    t.SphereBufferGeometry.prototype.constructor = t.SphereBufferGeometry;
    t.PlaneBufferGeometry = function(a, b, c, d) {
        t.BufferGeometry.call(this);
        this.type = "PlaneBufferGeometry";
        this.parameters = {
            width: a,
            height: b,
            widthSegments: c,
            heightSegments: d
        };
        var e = a / 2
          , f = b / 2;
        c = c || 1;
        d = d || 1;
        var g = c + 1
          , h = d + 1
          , l = a / c
          , m = b / d;
        b = new Float32Array(g * h * 3);
        a = new Float32Array(g * h * 3);
        for (var n = new Float32Array(g * h * 2), p = 0, q = 0, r = 0; r < h; r++)
            for (var u = r * m - f, v = 0; v < g; v++)
                b[p] = v * l - e,
                b[p + 1] = -u,
                a[p + 2] = 1,
                n[q] = v / c,
                n[q + 1] = 1 - r / d,
                p += 3,
                q += 2;
        p = 0;
        e = new (65535 < b.length / 3 ? Uint32Array : Uint16Array)(c * d * 6);
        for (r = 0; r < d; r++)
            for (v = 0; v < c; v++)
                f = v + g * (r + 1),
                h = v + 1 + g * (r + 1),
                l = v + 1 + g * r,
                e[p] = v + g * r,
                e[p + 1] = f,
                e[p + 2] = l,
                e[p + 3] = f,
                e[p + 4] = h,
                e[p + 5] = l,
                p += 6;
        this.addAttribute("index", new t.BufferAttribute(e,1));
        this.addAttribute("position", new t.BufferAttribute(b,3));
        this.addAttribute("normal", new t.BufferAttribute(a,3));
        this.addAttribute("uv", new t.BufferAttribute(n,2))
    }
    ;
    t.PlaneBufferGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    t.PlaneBufferGeometry.prototype.constructor = t.PlaneBufferGeometry;
    t.CylinderBufferGeometry = function(a, b, c, d, e, f, g, h) {
        function l(c) {
            var e, f = new t.Vector2, l = new t.Vector3, w = !0 === c ? a : b, u = !0 === c ? 1 : -1;
            var H = r;
            for (e = 1; e <= d; e++)
                n.push(0, v * u, 0),
                p.push(0, u, 0),
                q.push(.5, .5),
                r++;
            var C = r;
            for (e = 0; e <= d; e++) {
                var L = e / d * h + g
                  , G = Math.cos(L);
                L = Math.sin(L);
                l.x = w * L;
                l.y = v * u;
                l.z = w * G;
                n.push(l.x, l.y, l.z);
                p.push(0, u, 0);
                f.x = .5 * G + .5;
                f.y = .5 * L * u + .5;
                q.push(f.x, f.y);
                r++
            }
            for (e = 0; e < d; e++)
                f = H + e,
                l = C + e,
                !0 === c ? m.push(l, l + 1, f) : m.push(l + 1, l, f)
        }
        t.BufferGeometry.call(this);
        this.parameters = {
            radiusTop: a,
            radiusBottom: b,
            height: c,
            radialSegments: d,
            heightSegments: e,
            openEnded: f,
            thetaStart: g,
            thetaLength: h
        };
        a = void 0 !== a ? a : 20;
        b = void 0 !== b ? b : 20;
        c = void 0 !== c ? c : 100;
        d = Math.floor(d) || 8;
        e = Math.floor(e) || 1;
        f = void 0 !== f ? f : !1;
        g = void 0 !== g ? g : 0;
        h = void 0 !== h ? h : 2 * Math.PI;
        var m = []
          , n = []
          , p = []
          , q = []
          , r = 0
          , u = []
          , v = c / 2;
        (function() {
            var f, l, y = new t.Vector3, z = new t.Vector3, A = (b - a) / c;
            for (l = 0; l <= e; l++) {
                var B = []
                  , H = l / e
                  , C = H * (b - a) + a;
                for (f = 0; f <= d; f++) {
                    var L = f / d
                      , G = L * h + g
                      , I = Math.sin(G);
                    G = Math.cos(G);
                    z.x = C * I;
                    z.y = -H * c + v;
                    z.z = C * G;
                    n.push(z.x, z.y, z.z);
                    y.set(I, A, G).normalize();
                    p.push(y.x, y.y, y.z);
                    q.push(L, 1 - H);
                    B.push(r++)
                }
                u.push(B)
            }
            for (f = 0; f < d; f++)
                for (l = 0; l < e; l++)
                    y = u[l + 1][f],
                    z = u[l + 1][f + 1],
                    A = u[l][f + 1],
                    m.push(u[l][f], y, A),
                    m.push(y, z, A)
        }
        )();
        !1 === f && (0 < a && l(!0),
        0 < b && l(!1));
        console.assert(65536 >= n.length);
        this.addAttribute("index", new t.BufferAttribute(new Uint16Array(m),1));
        this.addAttribute("position", new t.BufferAttribute(new Float32Array(n),3));
        this.addAttribute("normal", new t.BufferAttribute(new Float32Array(p),3));
        this.addAttribute("uv", new t.BufferAttribute(new Float32Array(q),2))
    }
    ;
    t.CylinderBufferGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    t.CylinderBufferGeometry.prototype.constructor = t.CylinderBufferGeometry;
    t.TorusBufferGeometry = function(a, b, c, d, e) {
        t.BufferGeometry.call(this);
        this.parameters = {
            radius: a,
            tube: b,
            radialSegments: c,
            tubularSegments: d,
            arc: e
        };
        a = a || 1;
        b = b || .4;
        c = Math.floor(c) || 8;
        d = Math.floor(d) || 6;
        e = e || 2 * Math.PI;
        var f = [], g = [], h = [], l = [], m = new t.Vector3, n = new t.Vector3, p = new t.Vector3, q, r;
        for (q = 0; q <= c; q++)
            for (r = 0; r <= d; r++) {
                var u = r / d * e
                  , v = q / c * Math.PI * 2;
                n.x = (a + b * Math.cos(v)) * Math.cos(u);
                n.y = (a + b * Math.cos(v)) * Math.sin(u);
                n.z = b * Math.sin(v);
                g.push(n.x, n.y, n.z);
                m.x = a * Math.cos(u);
                m.y = a * Math.sin(u);
                p.subVectors(n, m).normalize();
                h.push(p.x, p.y, p.z);
                l.push(r / d);
                l.push(q / c)
            }
        for (q = 1; q <= c; q++)
            for (r = 1; r <= d; r++)
                a = (d + 1) * (q - 1) + r - 1,
                b = (d + 1) * (q - 1) + r,
                e = (d + 1) * q + r,
                f.push((d + 1) * q + r - 1, a, e),
                f.push(a, b, e);
        console.assert(65536 >= g.length);
        this.addAttribute("index", new t.BufferAttribute(new Uint16Array(f),1));
        this.addAttribute("position", new t.BufferAttribute(new Float32Array(g),3));
        this.addAttribute("normal", new t.BufferAttribute(new Float32Array(h),3));
        this.addAttribute("uv", new t.BufferAttribute(new Float32Array(l),2))
    }
    ;
    t.TorusBufferGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    t.TorusBufferGeometry.prototype.constructor = t.TorusBufferGeometry;
    function aa(a) {
        var b = {};
        a && a.substring(1).split("&").forEach(function(a) {
            var c = a.indexOf("=");
            0 <= c ? b[a.substring(0, c)] = a.substring(c + 1) : b[a] = void 0
        });
        return b
    }
    function ea(a) {
        return a in aa(window.location.hash)
    }
    window.THREE = t;
    window.WALK = {
        EDIT_MODE: "editor"in aa(window.location.search),
        NO_SCREENSHOTS: ea("noscreenshots"),
        DEBUG: ea("debug"),
        DEBUG_SHARED_BUFFERS: ea("debugbuffers"),
        DEBUG_CAMERA_PATH: ea("debugcamerapath"),
        DEBUG_GEOMETRY_MERGING: ea("debugmerge"),
        ALWAYS_RENDER: ea("alwaysrender"),
        LOG_INFO: ea("log") || ea("savelog"),
        LOG_TO_SERVER: ea("savelog"),
        LOG_TIME: !1,
        PROGRESSIVE_LOADER_AFTER_SEC: 30,
        CONTEXT_LOST_RESTORE_LIMIT: 4,
        HEAD_LIGHT: !1,
        RETRIES_ON_LOAD_ERROR: 3,
        DEFAULT_ANISOTROPY: 4,
        NO_ANISOTROPY: 1,
        FORCE_FXAA: !1,
        FORCE_WEBGL1: ea("webgl1"),
        FONT_FAMILIES_TO_LOAD: [],
        MAX_TWO_POINTERS_IN_LINE_DIFF: 40,
        CAMERA_WALK_NEAR: .01,
        CAMERA_ORBIT_NEAR_FROM_1M: .01,
        CAMERA_MIN_FAR: 100,
        SKY_DISTANCE_TO_SCENE: 100,
        CAMERA_DEFAULT_FOV: 70,
        CAMERA_DEFAULT_MOVE_MAX_SPEED: 1.11,
        CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR: 2,
        CAMERA_LOOK_SPEED: Math.PI / 1500,
        CAMERA_LOOK_SMOOTHING: .1,
        CAMERA_ARROWS_TURN_SPEED: Math.PI / 2,
        CAMERA_SCROLL_SPEED: .5,
        CAMERA_FULL_ACCELERATION_TIME: .5,
        CAMERA_FULL_DECELERATION_TIME: .166,
        CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE: 1,
        CAMERA_FIXED_HEIGHT: null,
        MAX_GROUND_SEARCH_DEPTH: 5.5,
        MATERIAL_PICKER_BALL_MAX_SIZE: .1,
        COVER_JSON_URL: "./cover.json",
        AUTO_TOUR_IN_VIEW_STILL_TIME_MS: 3E3,
        CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE: .7,
        CLICK_MOVE_SHOW_TARGET_INDICATOR: !ea("nomovetarget"),
        KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE: .1,
        MIN_DISTANCE_TO_CEILING: .1,
        LIGHT_PROBE_MIRROR_SIZE: 512,
        LIGHT_PROBE_MAX_MIP_SIZE: 128,
        LIGHT_PROBE_MIN_MIP_SIZE: 4,
        LIGHT_PROBE_GLOSS_FOR_MIP: [.99, .9, .85, .7, .4, .25],
        DEBUG_LIGHT_PROBE_MIPS: !1,
        ENABLE_AUTO_EXPOSURE_CONTROLS: !1,
        EDITOR_COVER_WIDTH: 1920,
        EDITOR_COVER_HEIGHT: 1080,
        MAX_PANORAMA_SIZE: 8192,
        OBJECT_VISIBILITY_TARGET_SIZE: 128,
        DEFAULT_SKY_NAME: "default",
        EDITOR_CONTROLLED_SKY_NAME: "sky0",
        EDITOR_SELECTION_COLOR: (new t.Color(5021401)).convertGammaToLinear(),
        ALLOW_MOBILE_VR: !0,
        FALLBACK_CAMERA_HEIGHT: 1.6,
        LOAD_PRIORITY: {
            CORE_RESOURCE: 0,
            COLORMAP: 1,
            UV0: 1,
            DIFFUSE: 2,
            LIGHTMAP: 3,
            SKY: 4,
            SPECULARITY: 5,
            VIDEO: 6
        },
        MERGE_TRANSPARENT_DISABLED: ea("nomergetransparent"),
        urlHashContains: ea,
        urlHashGetArgument: function(a) {
            var b = aa(window.location.hash);
            return a in b && void 0 !== b[a] ? decodeURI(b[a]) : null
        },
        urlHashRemoveArgument: function(a) {
            var b = aa(window.location.hash);
            return Object.keys(b).filter(function(b) {
                return b !== a
            }).map(function(a) {
                var c = b[a];
                return a + (void 0 === c ? "" : "=" + c)
            }).join("&")
        },
        TELEPORT_TO_VIEW_MAX_TIME: 3,
        TELEPORT_TO_POINT_MAX_TIME: 4.5,
        TELEPORT_PATH_MAX_TIME: 6,
        TELEPORT_TO_VIEW_ACCELERATION: 4,
        TELEPORT_TO_POINT_ACCELERATION: 2,
        TELEPORT_PATH_ACCELERATION: 2,
        GAZE_POINTER_SHOW_LOADING_AFTER_S: 2.5,
        GAZE_POINTER_ACTIVATE_AFTER_S: 4.5,
        SPRITE_ANCHOR_FONT_SIZE: 128,
        POINTER_PRIORITY: {
            TRANSFORM_CONTROLS: 1,
            EDITOR_SELECTOR: 2,
            INTERACTION_DISPATCHER: 3
        },
        AVATAR_COLORS: "#f44336 #e81e63 #9c27b0 #673ab7 #3f51b5 #2196f3 #03a9f4 #00bcd4 #009688 #4caf50 #8bc34a #cddc39 #ffeb3b #ffc107 #ff9800 #ff5722 #795548 #9e9e9e #607d8b #ff5084".split(" "),
        STRINGS: {},
        DEFAULT_LANGUAGE: "English",
        ENABLE_MINIMAP: !0,
        FLIP_MOUSE: ea("flipmouse"),
        AUTO_PLAY: ea("autoplay"),
        HIDE_PLAY: ea("hideplay"),
        SHOW_HELP_ON_LOAD: ea("help"),
        GAZE_IN_POINTER_LOCK: ea("gazeinpointerlock"),
        NO_GAZE_TELEPORT: ea("nogazeteleport"),
        VR_LO: ea("vrlo"),
        VR_HI: ea("vrhi"),
        MOBILE_HI: ea("mobilehi"),
        NO_BASIS: ea("nobasis"),
        NO_WEBP: ea("nowebp")
    };
    window.WebXRConfig = {
        cardboardConfig: {
            ADDITIONAL_VIEWERS: [],
            DEFAULT_VIEWER: "",
            MOBILE_WAKE_LOCK: !0,
            DEBUG: !1,
            DPDB_URL: null,
            CARDBOARD_UI_DISABLED: !1,
            K_FILTER: .98,
            ROTATE_INSTRUCTIONS_DISABLED: !1,
            PREDICTION_TIME_S: .04,
            YAW_ONLY: !1,
            BUFFER_SCALE: 1,
            DIRTY_SUBMIT_FRAME_BINDINGS: !1
        }
    };
    window.GLC = {
        REPEAT: 10497,
        CLAMP_TO_EDGE: 33071,
        MIRRORED_REPEAT: 33648,
        NEAREST: 9728,
        LINEAR: 9729,
        NEAREST_MIPMAP_NEAREST: 9984,
        LINEAR_MIPMAP_NEAREST: 9985,
        NEAREST_MIPMAP_LINEAR: 9986,
        LINEAR_MIPMAP_LINEAR: 9987,
        BYTE: 5120,
        UNSIGNED_BYTE: 5121,
        SHORT: 5122,
        UNSIGNED_SHORT: 5123,
        INT: 5124,
        UNSIGNED_INT: 5125,
        FLOAT: 5126,
        UNSIGNED_SHORT_4_4_4_4: 32819,
        UNSIGNED_SHORT_5_5_5_1: 32820,
        UNSIGNED_SHORT_5_6_5: 33635,
        DEPTH_COMPONENT: 6402,
        ALPHA: 6406,
        RGB: 6407,
        RGBA: 6408,
        LUMINANCE: 6409,
        LUMINANCE_ALPHA: 6410,
        FUNC_ADD: 32774,
        FUNC_SUBTRACT: 32778,
        FUNC_REVERSE_SUBTRACT: 32779,
        ZERO: 0,
        ONE: 1,
        SRC_COLOR: 768,
        ONE_MINUS_SRC_COLOR: 769,
        SRC_ALPHA: 770,
        ONE_MINUS_SRC_ALPHA: 771,
        DST_ALPHA: 772,
        ONE_MINUS_DST_ALPHA: 773,
        DST_COLOR: 774,
        ONE_MINUS_DST_COLOR: 775,
        SRC_ALPHA_SATURATE: 776,
        CONSTANT_COLOR: 32769,
        ONE_MINUS_CONSTANT_COLOR: 32770,
        CONSTANT_ALPHA: 32771,
        ONE_MINUS_CONSTANT_ALPHA: 32772,
        HALF_FLOAT_OES: 36193,
        COMPRESSED_RGB_S3TC_DXT1_EXT: 33776,
        COMPRESSED_RGBA_S3TC_DXT1_EXT: 33777,
        COMPRESSED_RGBA_S3TC_DXT3_EXT: 33778,
        COMPRESSED_RGBA_S3TC_DXT5_EXT: 33779,
        COMPRESSED_RGB_PVRTC_4BPPV1_IMG: 35840,
        COMPRESSED_RGBA_PVRTC_4BPPV1_IMG: 35842,
        COMPRESSED_RGB_PVRTC_2BPPV1_IMG: 35841,
        COMPRESSED_RGBA_PVRTC_2BPPV1_IMG: 35843,
        COMPRESSED_RGB_ETC1_WEBGL: 36196,
        COMPRESSED_RGBA_ASTC_4x4_KHR: 37808
    };
    /*
 Copyright (C) 2014-present Shapespark
*/
    var ja = 2 * Math.PI;
    WALK.defer = function(a) {
        setTimeout(a, 0)
    }
    ;
    function na(a, b, c) {
        return function() {
            a !== b.length && (c(b[a]),
            WALK.defer(na(a + 1, b, c)))
        }
    }
    WALK.iterateAsync = function(a, b) {
        WALK.defer(na(0, a, b))
    }
    ;
    WALK.find = function(a, b) {
        for (var c = 0; c < a.length; c += 1) {
            var d = a[c];
            if (b(d))
                return d
        }
    }
    ;
    WALK.filter = function(a, b) {
        for (var c = a.length, d = [], e = 0; e < c; e += 1)
            b(a[e]) && d.push(a[e]);
        return d
    }
    ;
    WALK.indexOfMax = function(a, b) {
        if (0 === a.length)
            return null;
        for (var c = 0, d = b ? b(a[0]) : a[0], e = 1; e < a.length; e += 1) {
            var f = b ? b(a[e]) : a[e];
            f > d && (c = e,
            d = f)
        }
        return c
    }
    ;
    WALK.any = function(a, b) {
        for (var c = a.length, d = 0; d < c; d += 1)
            if (b(a[d]))
                return !0;
        return !1
    }
    ;
    WALK.removeFromArray = function(a, b) {
        a = b.indexOf(a);
        console.assert(-1 !== a);
        return b.splice(a, 1)
    }
    ;
    WALK.shiftItem = function(a, b, c) {
        var d = a.indexOf(b);
        b = a[d];
        for (var e = c > d ? 1 : -1; d !== c; d += e)
            a[d] = a[d + e];
        a[c] = b
    }
    ;
    WALK.copyProperties = function(a, b, c) {
        for (var d = 0; d < b.length; d += 1) {
            var e = b[d]
              , f = a[e];
            void 0 !== f && (c[e] = f)
        }
    }
    ;
    WALK.normalizeRotation = function(a) {
        a %= ja;
        return a > Math.PI ? -ja + a : a < -Math.PI ? ja + a : a
    }
    ;
    WALK.yawRotationToPoint = function(a, b) {
        return Math.atan2(-(b.x - a.x), b.y - a.y)
    }
    ;
    WALK.setTextContent = function(a, b) {
        void 0 !== a.textContent ? a.textContent = b : void 0 !== a.innerText ? a.innerText = b : console.warn("textContent and innerText properties are missing")
    }
    ;
    WALK.log2 = function(a) {
        return Math.log(a) / Math.log(2)
    }
    ;
    WALK.mipsCount = function(a, b) {
        return WALK.log2(b) - WALK.log2(a) + 1
    }
    ;
    WALK.LIGHT_PROBE_MIPS_COUNT = WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE, WALK.LIGHT_PROBE_MAX_MIP_SIZE);
    WALK.isModifierPressed = function(a) {
        return a.ctrlKey || a.altKey || a.metaKey
    }
    ;
    WALK.round = function(a, b) {
        void 0 === b && (b = 3);
        return +(Math.round(a + "e+" + b) + "e-" + b)
    }
    ;
    WALK.preloadImage = function(a) {
        var b = new Image;
        b.src = a;
        return b
    }
    ;
    WALK.onVideoDataReady = function(a, b) {
        function c() {
            a.readyState >= a.HAVE_CURRENT_DATA && (a.removeEventListener("playing", c),
            a.removeEventListener("timeupdate", c),
            b(a))
        }
        a.readyState >= a.HAVE_CURRENT_DATA ? b(a) : (a.addEventListener("playing", c),
        a.addEventListener("timeupdate", c))
    }
    ;
    WALK.cloneObject = function(a) {
        return JSON.parse(JSON.stringify(a))
    }
    ;
    WALK.readOnlyCopy = function(a) {
        return "object" === typeof a ? Object.freeze(WALK.cloneObject(a)) : a
    }
    ;
    WALK.deepEqual = function(a, b) {
        if (a === b)
            return !0;
        if ("object" !== typeof a || null === a || "object" !== typeof b || null === b || Object.keys(a).length !== Object.keys(b).length)
            return !1;
        for (var c = k.makeIterator(Object.keys(a)), d = c.next(); !d.done; d = c.next())
            if (d = d.value,
            !b.hasOwnProperty(d) || !WALK.deepEqual(a[d], b[d]))
                return !1;
        return !0
    }
    ;
    WALK.executableOnlyOnce = function(a) {
        var b = !1, c;
        return function() {
            if (b)
                return c;
            c = a();
            a = null;
            b = !0;
            return c
        }
    }
    ;
    WALK.preventClosureCompilerDeadCodeRemoval = function(a) {
        WALK.preventClosureCompilerDeadCodeRemoval[" "](a);
        return a
    }
    ;
    WALK.preventClosureCompilerDeadCodeRemoval[" "] = function() {
        return null
    }
    ;
    WALK.ICONS = {};
    function ra(a, b, c) {
        WALK.ICONS[a] = {
            name: a,
            value: b,
            fontFamily: c
        }
    }
    function ua(a, b) {
        ra(a, b, "FontAwesomeSolid")
    }
    function wa(a, b) {
        ra(a, b, "FontAwesomeRegular")
    }
    function xa(a, b) {
        ra(a, b, "FontAwesomeBrands")
    }
    ua("address-book", "\uf2b9");
    ua("address-card", "\uf2bb");
    ua("area-chart", "\uf1fe");
    ua("arrows", "\uf0b2");
    ua("arrow-up", "\uf062");
    ua("arrow-down", "\uf063");
    ua("assistive-listening-systems", "\uf2a2");
    ua("asterisk", "\uf069");
    ua("audio-description", "\uf29e");
    ua("at", "\uf1fa");
    ua("bars", "\uf0c9");
    ua("bell", "\uf0f3");
    ua("book", "\uf02d");
    ua("bookmark", "\uf02e");
    ua("bullhorn", "\uf0a1");
    ua("calculator", "\uf1ec");
    ua("camera", "\uf030");
    ua("chart-bar", "\uf080");
    ua("chart-pie", "\uf200");
    ua("chevron-up", "\uf077");
    ua("chevron-down", "\uf078");
    ua("cloud", "\uf0c2");
    ua("cog", "\uf013");
    ua("comment", "\uf075");
    wa("compass", "\uf14e");
    wa("credit-card", "\uf09d");
    ua("crosshairs", "\uf05b");
    ua("desktop", "\uf108");
    ua("download", "\uf019");
    ua("envelope", "\uf0e0");
    ua("expand", "\uf424");
    ua("external-link", "\uf35d");
    wa("eye", "\uf06e");
    ua("eye-dropper", "\uf1fb");
    ua("film", "\uf008");
    ua("flag", "\uf024");
    ua("folder", "\uf07b");
    ua("gift", "\uf06b");
    ua("headphones", "\uf025");
    ua("highlighter", "\uf591");
    ua("home", "\uf015");
    wa("image", "\uf03e");
    ua("sign-in", "\uf2f6");
    ua("info", "\uf129");
    wa("lightbulb", "\uf0eb");
    ua("magic", "\uf0d0");
    ua("magnet", "\uf076");
    ua("map-marker", "\uf3c5");
    ua("map-pin", "\uf276");
    ua("map-signs", "\uf277");
    ua("paint-brush", "\uf1fc");
    ua("pencil", "\uf303");
    ua("pen", "\uf304");
    ua("phone", "\uf095");
    ua("question", "\uf128");
    ua("search", "\uf002");
    ua("share", "\uf064");
    ua("share-alt", "\uf1e0");
    ua("shopping-cart", "\uf07a");
    ua("sliders", "\uf1de");
    ua("star", "\uf005");
    wa("sticky-note", "\uf249");
    ua("sync", "\uf2f1");
    wa("edit", "\uf044");
    ua("tachometer", "\uf3fd");
    ua("tag", "\uf02b");
    ua("video", "\uf03d");
    ua("wrench", "\uf0ad");
    ua("palette", "\uf53f");
    ua("paint-roller", "\uf5aa");
    ua("play", "\uf04b");
    ua("pause", "\uf04c");
    ua("plus", "\uf067");
    xa("youtube", "\uf167");
    xa("vimeo", "\uf40a");
    xa("facebook", "\uf09a");
    xa("twitter", "\uf099");
    xa("instagram", "\uf16d");
    xa("linkedin", "\uf08c");
    xa("skype", "\uf17e");
    xa("whatsapp", "\uf232");
    xa("facebook-messenger", "\uf39f");
    xa("telegram", "\uf2c6");
    xa("slack", "\uf198");
    var Ba = new function() {
        this.hideInfo = function() {
            document.getElementById("info-message").style.display = "none"
        }
        ;
        this.info = function(a, b) {
            var c = document.getElementById("info-message");
            c.innerHTML = a;
            c.style.display = "";
            setTimeout(this.hideInfo, b || 15E3);
            console.info(a)
        }
        ;
        this.error = function(a) {
            var b = document.getElementById("error-message");
            b.innerHTML = a;
            b.style.display = "";
            console.error(a)
        }
    }
    ;
    var Ca = !1
      , Ea = {
        NOT_NEEDED: 0,
        TEST_NEEDED: 1,
        NEEDED: 2
    }
      , Ja = new function() {
        function a() {
            for (d += 1; d < b.length; d += 1) {
                var a = b[d];
                if (0 < a.length) {
                    for (var f = 0; f < a.length; f += 1)
                        c[d] += 1,
                        WALK.defer(a[f]);
                    a.length = 0;
                    break
                }
            }
        }
        var b = []
          , c = []
          , d = Infinity;
        (function() {
            var a = 0, d;
            for (d in WALK.LOAD_PRIORITY)
                WALK.LOAD_PRIORITY.hasOwnProperty(d) && (a = Math.max(a, WALK.LOAD_PRIORITY[d]));
            for (d = 0; d <= a; d += 1)
                b[d] = [],
                c[d] = 0
        }
        )();
        this.add = function(e, f) {
            e <= d ? (c[e] += 1,
            d = e,
            WALK.defer(f)) : (b[e].push(f),
            0 === c[d] && a())
        }
        ;
        this.finished = function(b) {
            --c[b];
            var e = c[b];
            console.assert(0 <= e);
            b === d && 0 === e && a()
        }
    }
    ;
    function Ka(a) {
        for (var b = k.makeIterator(Object.entries({
            "https://cdn0.shapespark.com/": "https://cdn0-jsbr.shapespark.com/",
            "https://cdn0.dev.shapespark.com/": "https://cdn0-jsbr-dev.shapespark.com/",
            "https://cdn0-shapespark-cn-dev.oss-accelerate.aliyuncs.com/": "https://cdn0-jsbr-cn-dev.shapespark.com.cn/",
            "https://cdn0-shapespark-cn.oss-accelerate.aliyuncs.com/": "https://cdn0-jsbr.shapespark.com.cn/",
            "https://cdncn0-shapespark.oss-accelerate.aliyuncs.com/": "https://cdncn0-jsbr.shapespark.com.cn/"
        })), c = b.next(); !c.done; c = b.next()) {
            var d = k.makeIterator(c.value);
            c = d.next().value;
            d = d.next().value;
            if (a.startsWith(c))
                return a.replace(c, d)
        }
        return a
    }
    var La = new function() {
        function a(a) {
            a = new Int8Array(a);
            return (new BrotliDecode(a)).buffer
        }
        function b(a) {
            h = a;
            for (var b = 0; b < f.length; b += 1)
                f[b](a);
            f = null
        }
        function c(a) {
            l ? a() : (g.push(a),
            1 === g.length && WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/brotli.min.js"), function() {
                l = !0;
                for (var a = 0; a < g.length; a += 1)
                    g[a]();
                g = null
            }, function() {
                return Ba.error("Cannot load required library")
            }))
        }
        function d() {
            200 <= m.status && 300 > m.status || 0 === m.status ? b("SSSSSS" === m.responseText) : (console.error("br.buf response", m.status),
            b(!0))
        }
        function e(a) {
            void 0 !== h ? a(h) : (f.push(a),
            1 === f.length && (m.addEventListener("load", d, !1),
            m.open("GET", WALK.getViewerAssetUrl("3dassets/br.buf"), !0),
            m.send()))
        }
        var f = []
          , g = []
          , h = void 0
          , l = !1
          , m = new XMLHttpRequest;
        this.decode = function(b, d, f) {
            d ? c(function() {
                f(a(b))
            }) : e(function(d) {
                d ? f(b) : c(function() {
                    f(a(b))
                })
            })
        }
    }
    ;
    function Ma(a, b) {
        return function(c) {
            Ja.finished(a);
            b(c)
        }
    }
    function Na(a) {
        this.method = a;
        this.binaryResult = !1;
        this.dataContentType = this.data = null;
        "GET" === a ? (this.retriesLeft = WALK.RETRIES_ON_LOAD_ERROR,
        this.retryDelayMs = 1E3 + 1E3 * Math.random()) : this.retryDelayMs = this.retriesLeft = 0
    }
    Na.prototype = {
        constructor: Na,
        retryScheduled: function() {
            console.assert(0 < this.retriesLeft);
            --this.retriesLeft;
            this.retryDelayMs *= 2
        }
    };
    function Sa(a, b, c, d, e, f) {
        setTimeout(function() {
            Ua(a, b, c, d, e, f)
        }, b.retryDelayMs);
        b.retryScheduled()
    }
    function Ua(a, b, c, d, e, f) {
        function g(a, b) {
            var c = !0 !== WALK.DETECTOR.canForceBrotliBuffers ? Ea.NOT_NEEDED : 0 <= m.getAllResponseHeaders().toLowerCase().indexOf("js-content-encoding:") ? Ea.NEEDED : "br" === m.getResponseHeader("content-encoding") ? Ea.TEST_NEEDED : Ea.NOT_NEEDED;
            c === Ea.NOT_NEEDED ? b(a) : La.decode(a, c === Ea.NEEDED, b)
        }
        function h() {
            var g = m.status || 0;
            g = "GET" === b.method && (500 <= g || 0 === g) ? 0 !== b.retriesLeft : !1;
            console.warn("Failed to " + b.method + ": " + a + " (" + m.status + ")" + (g ? ", retrying in " + b.retryDelayMs / 1E3 + "s" : ""));
            if (g)
                f && !Ca && (console.warn("Switch to jsbr hosts."),
                Ca = !0),
                Sa(a, b, c, d, e, f);
            else if (void 0 !== d) {
                try {
                    var h = JSON.parse(m.responseText).message
                } catch (q) {
                    h = void 0
                }
                d(m.status, h)
            }
            b = m = null
        }
        function l() {
            if (void 0 !== c)
                if (b.binaryResult)
                    g(m.response, c);
                else {
                    var a = m.getResponseHeader("content-type")
                      , d = m.responseText;
                    d && -1 !== a.indexOf("text/plain") ? g(d, c) : d ? g(d, function(a) {
                        c(JSON.parse(a))
                    }) : c()
                }
            b = m = null
        }
        var m = new XMLHttpRequest;
        void 0 !== e && m.addEventListener("progress", e, !1);
        m.addEventListener("load", function() {
            200 <= m.status && 300 > m.status || 0 === m.status ? l() : h()
        }, !1);
        m.addEventListener("error", h, !1);
        m.addEventListener("abort", h, !1);
        f && Ca && (a = Ka(a));
        m.open(b.method, a, !0);
        b.binaryResult && (m.responseType = "arraybuffer");
        b.dataContentType && m.setRequestHeader("Content-Type", b.dataContentType);
        "POST" === b.method && m.setRequestHeader("X-Requested-By", "Shapespark");
        m.send(b.data)
    }
    WALK.ajaxGet = function(a, b, c, d, e, f) {
        var g = new Na("GET");
        g.binaryResult = b;
        Ua(a, g, c, d, e, f)
    }
    ;
    WALK.queueAjaxGet = function(a, b, c, d, e, f, g) {
        g = void 0 === g ? !1 : g;
        Ja.add(a, function() {
            WALK.ajaxGet(b, c, Ma(a, d), Ma(a, e), f, g)
        })
    }
    ;
    WALK.ajaxPost = function(a, b, c, d, e, f) {
        var g = new Na("POST");
        g.data = c;
        g.dataContentType = b;
        Ua(a, g, d, e, f)
    }
    ;
    function Va(a, b, c, d, e) {
        function f() {
            a(b, c, d, e)
        }
        return function() {
            console.warn("Failed to get: " + b + (f ? ", retrying in " + c.retryDelayMs / 1E3 + "s" : ""));
            0 < c.retriesLeft ? (setTimeout(f, c.retryDelayMs),
            c.retryScheduled()) : e()
        }
    }
    function Wa(a, b, c, d) {
        var e = new Image;
        e.onload = function() {
            c(e);
            e = null
        }
        ;
        e.onerror = Va(Wa, a, b, c, d);
        e.crossOrigin = "anonymous";
        e.src = a
    }
    WALK.queueImageGet = function(a, b, c, d) {
        Ja.add(a, function() {
            var e = new Na("GET");
            Wa(b, e, Ma(a, c), Ma(a, d))
        })
    }
    ;
    function Xa(a, b, c, d) {
        var e = document.createElement("video");
        e.autoplay = !0;
        e.muted = !0;
        e.loop = !0;
        e.setAttribute("playsinline", "");
        e.setAttribute("webkit-playsinline", "");
        e.crossOrigin = "anonymous";
        e.onerror = Va(Xa, a, b, c, d);
        WALK.onVideoDataReady(e, function() {
            e.onerror = void 0;
            c(e);
            e = null
        });
        e.src = a;
        e.play().catch(function() {})
    }
    WALK.queueVideoGet = function(a, b, c, d) {
        Ja.add(a, function() {
            var e = new Na("GET");
            Xa(b, e, Ma(a, c), Ma(a, d))
        })
    }
    ;
    WALK.loadScriptAndExecute = function() {
        function a(a) {
            c.add(a);
            var b = d.get(a);
            d.delete(a);
            b.forEach(function(a) {
                try {
                    (0,
                    a.onSuccess)()
                } catch (h) {
                    console.log(h)
                }
            })
        }
        function b(a) {
            var b = d.get(a);
            d.delete(a);
            console.error("Can't load script : " + a);
            b.forEach(function(b) {
                if (void 0 !== b.onError) {
                    b = b.onError.bind(null, a);
                    try {
                        b()
                    } catch (h) {
                        console.log(h)
                    }
                }
            })
        }
        var c = new Set
          , d = new Map;
        return function(e, f, g) {
            if (c.has(e))
                f();
            else if (d.has(e))
                d.get(e).push({
                    onSuccess: f,
                    onError: g
                });
            else {
                d.set(e, [{
                    onSuccess: f,
                    onError: g
                }]);
                f = a.bind(this, e);
                g = b.bind(this, e);
                var h = document.createElement("script");
                h.onload = f;
                h.onerror = g;
                h.src = e;
                h.type = "text/javascript";
                h.crossOrigin = "anonymous";
                document.body.appendChild(h)
            }
        }
    }();
    WALK.loadScriptsUrlAndExecute = function(a, b, c) {
        function d(a) {
            return new Promise(function(b, c) {
                WALK.loadScriptAndExecute(a, b, c)
            }
            )
        }
        a = a.map(function(a) {
            return d(a)
        });
        Promise.all(a).then(b).catch(function(a) {
            void 0 !== c && c(a)
        })
    }
    ;
    var Ya = []
      , ab = 0
      , cb = void 0
      , db = 0;
    function eb(a, b) {
        for (a = a.toString(); a.length < b; )
            a = "0" + a;
        return a
    }
    function fb() {
        0 !== db && (Ya[Ya.length - 1] += " [" + (db + 1).toString() + " copies]",
        db = 0)
    }
    function gb() {
        fb();
        0 < ab && Ya.push("[truncated, removed lines " + ab.toString() + "]");
        WALK.ajaxPost("./logs", "application/json", JSON.stringify({
            logs: Ya
        }));
        Ya.length = 0;
        cb = void 0;
        db = ab = 0
    }
    function hb(a) {
        var b = console[a].bind(console);
        console[a] = function() {
            for (var c = "", d = "", e = 0; e < arguments.length; ++e)
                d += (0 === e ? "" : " ") + arguments[e];
            WALK.LOG_TIME && (c = new Date,
            c = eb(c.getHours(), 2) + ":" + eb(c.getMinutes(), 2) + ":" + eb(c.getSeconds(), 2) + "," + eb(c.getMilliseconds(), 3) + " ");
            e = c;
            var f = d;
            cb === f ? db += 1 : 499 <= Ya.length ? ab += 1 : (fb(),
            cb = f,
            e = e + a.toUpperCase() + " " + f,
            Ya.push(e),
            1 == Ya.length && setTimeout(gb, 5E3));
            b(c + d)
        }
    }
    function ib() {
        window.onerror = function(a, b, c, d, e) {
            console.error("Error occured: " + a + " (" + b + "#" + c.toString() + ":" + d.toString() + "/" + e + ")");
            return !1
        }
    }
    WALK.log = function() {}
    ;
    WALK.logInfoMessages = function() {
        WALK.log = function(a) {
            for (var b = [], c = 0; c < arguments.length; ++c)
                b[c - 0] = arguments[c];
            console.log.apply(console, k.arrayFromIterable(b))
        }
    }
    ;
    WALK.initLoggingToServer = function(a) {
        a && (hb("log"),
        hb("info"));
        hb("warn");
        hb("error");
        ib()
    }
    ;
    WALK.LOG_INFO && WALK.logInfoMessages();
    WALK.LOG_TO_SERVER && WALK.initLoggingToServer(!0);
    /*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
    function kb() {
        function a(a) {
            a = void 0 === a ? {} : a;
            this.config = Object.freeze(Object.assign({}, Zg, a));
            this.global = this.config.global;
            this.nativeWebXR = "xr"in this.global.navigator;
            this.injected = !1;
            this.nativeWebXR ? this._injectCompatibilityShims(this.global) : this._injectPolyfill(this.global)
        }
        function b(a, b) {
            var e, g;
            return k.asyncExecutePromiseGeneratorProgram(function(h) {
                return 1 == h.nextAddress ? b.webvr ? h.yield(c(a), 3) : h.jumpTo(2) : 2 != h.nextAddress && (e = h.yieldResult) ? h.return(e) : (g = q(a)) && b.cardboard || !g && b.allowCardboardOnDesktop ? (a.VRFrameData || (a.VRFrameData = function() {
                    this.rightViewMatrix = new Float32Array(16);
                    this.leftViewMatrix = new Float32Array(16);
                    this.rightProjectionMatrix = new Float32Array(16);
                    this.leftProjectionMatrix = new Float32Array(16);
                    this.pose = null
                }
                ),
                h.return(new f(a,b.cardboardConfig))) : h.return(new d(a))
            })
        }
        function c(a) {
            var b, c;
            return k.asyncExecutePromiseGeneratorProgram(function(d) {
                switch (d.nextAddress) {
                case 1:
                    b = null;
                    if (!("getVRDisplays"in a.navigator)) {
                        d.jumpTo(2);
                        break
                    }
                    d.setCatchFinallyBlocks(3);
                    return d.yield(a.navigator.getVRDisplays(), 5);
                case 5:
                    (c = d.yieldResult) && c.length && (b = new g(a,c[0]));
                    d.leaveTryBlock(2);
                    break;
                case 3:
                    d.enterCatchBlock();
                case 2:
                    return d.return(b)
                }
            })
        }
        function d(a) {
            a = p.call(this, a) || this;
            a.sessions = new Map;
            a.projectionMatrix = S();
            a.identityMatrix = S();
            return a
        }
        function e(a, b) {
            this.mode = a;
            this.enabledFeatures = b;
            this.baseLayer = this.ended = null;
            this.id = ++$g
        }
        function f(a, b) {
            b = new ah(b || {});
            a = g.call(this, a, b) || this;
            a.display = b;
            a.frame = {
                rightViewMatrix: new Float32Array(16),
                leftViewMatrix: new Float32Array(16),
                rightProjectionMatrix: new Float32Array(16),
                leftProjectionMatrix: new Float32Array(16),
                pose: null,
                timestamp: null
            };
            return a
        }
        function g(a, b) {
            var c = b.capabilities.canPresent;
            var d = p.call(this, a) || this;
            d.display = b;
            d.frame = new a.VRFrameData;
            d.sessions = new Map;
            d.immersiveSession = null;
            d.canPresent = c;
            d.baseModelMatrix = S();
            d.gamepadInputSources = {};
            d.tempVec3 = new Float32Array(3);
            d.onVRDisplayPresentChange = d.onVRDisplayPresentChange.bind(d);
            a.window.addEventListener("vrdisplaypresentchange", d.onVRDisplayPresentChange);
            d.CAN_USE_GAMEPAD = a.navigator && "getGamepads"in a.navigator;
            d.HAS_BITMAP_SUPPORT = !(!a.ImageBitmapRenderingContext || !a.createImageBitmap);
            return d
        }
        function h(a, b, c) {
            c = void 0 === c ? {} : c;
            this.mode = a;
            this.enabledFeatures = b;
            this.outputContext = null;
            this.immersive = "immersive-vr" == a || "immersive-ar" == a;
            this.baseLayer = this.ended = null;
            this.id = ++bh;
            this.modifiedCanvasLayer = !1;
            this.outputContext && (this.renderContext = this.outputContext.canvas.getContext(c.renderContextType || "2d"))
        }
        function l(a, b, c, d) {
            c = void 0 === c ? 0 : c;
            d = void 0 === d ? -1 : d;
            this.polyfill = a;
            this.display = b;
            this.gamepad = this.nativeGamepad = null;
            this.inputSource = new v(this);
            this.lastPosition = U();
            this.emulatedPosition = !1;
            this.basePoseMatrix = S();
            this.outputMatrix = S();
            this.primaryButtonIndex = c;
            this.primaryActionPressed = !1;
            this.primarySqueezeButtonIndex = d;
            this.primarySqueezeActionPressed = !1;
            this.handedness = "";
            this.targetRayMode = "gaze";
            this.armModel = null
        }
        function m(a, b, c) {
            c || (c = {});
            if (c.userAgentOverrides)
                for (var d in c.userAgentOverrides)
                    if (navigator.userAgent.includes(d)) {
                        d = c.userAgentOverrides[d];
                        for (var e in d)
                            e in c ? Object.assign(c[e], d[e]) : c[e] = d[e];
                        break
                    }
            e = Array(c.axes && c.axes.length ? c.axes.length : a.axes.length);
            d = Array(c.buttons && c.buttons.length ? c.buttons.length : a.buttons.length);
            var f = null;
            if (c.gripTransform) {
                var g = c.gripTransform.orientation || [0, 0, 0, 1];
                f = S();
                ha(f, K(g, g), c.gripTransform.position || [0, 0, 0])
            }
            g = null;
            if (c.targetRayTransform) {
                var h = c.targetRayTransform.orientation || [0, 0, 0, 1];
                g = S();
                ha(g, K(h, h), c.targetRayTransform.position || [0, 0, 0])
            }
            h = c.profiles;
            c.displayProfiles && b.displayName in c.displayProfiles && (h = c.displayProfiles[b.displayName]);
            this[Ra] = {
                gamepad: a,
                map: c,
                profiles: h || [a.id],
                mapping: c.mapping || a.mapping,
                axes: e,
                buttons: d,
                gripTransform: f,
                targetRayTransform: g
            };
            this._update()
        }
        function n() {
            this.hand = "right";
            this.headElbowOffset = hf;
            this.controllerQ = va();
            this.lastControllerQ = va();
            this.headQ = va();
            this.headPos = U();
            this.elbowPos = U();
            this.wristPos = U();
            this.lastTime = this.time = null;
            this.rootQ = va();
            this.position = U()
        }
        function p(a) {
            var b = E.call(this) || this;
            b.global = a;
            b.onWindowResize = b.onWindowResize.bind(b);
            b.global.window.addEventListener("resize", b.onWindowResize);
            b.environmentBlendMode = "opaque";
            return b
        }
        function q(a) {
            var b = !1;
            a = a.navigator.userAgent || a.navigator.vendor || a.opera;
            if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4)))
                b = !0;
            return b
        }
        function r(a) {
            var b = a.prototype.getContext;
            a.prototype.getContext = function(a, c) {
                if (a = b.call(this, a, c))
                    a[jf] = !0,
                    c && "xrCompatible"in c && (a[ke] = c.xrCompatible);
                return a
            }
        }
        function u(a) {
            if ("function" === typeof a.prototype.makeXRCompatible)
                return !1;
            a.prototype.makeXRCompatible = function() {
                this[ke] = !0;
                return Promise.resolve()
            }
            ;
            return !0
        }
        function v(a) {
            this[Ob] = {
                impl: a,
                gripSpace: new M("grip",this),
                targetRaySpace: new M("target-ray",this)
            }
        }
        function w(a, b, c) {
            var d = E.call(this) || this;
            var e = "inline" != b
              , f = new z({
                inlineVerticalFieldOfView: e ? null : .5 * Math.PI
            });
            d[J] = {
                device: a,
                mode: b,
                immersive: e,
                ended: !1,
                suspended: !1,
                frameCallbacks: [],
                currentFrameCallbacks: null,
                frameHandle: 0,
                deviceFrameHandle: null,
                id: c,
                activeRenderState: f,
                pendingRenderState: null,
                viewerSpace: new I("viewer"),
                viewSpaces: [],
                currentInputSources: []
            };
            e ? d[J].viewSpaces.push(new x("left"), new x("right")) : d[J].viewSpaces.push(new x("none"));
            d[J].onDeviceFrame = function() {
                if (!d[J].ended && !d[J].suspended) {
                    d[J].deviceFrameHandle = null;
                    d[J].startDeviceFrameLoop();
                    if (null !== d[J].pendingRenderState && (d[J].activeRenderState = new z(d[J].pendingRenderState),
                    d[J].pendingRenderState = null,
                    d[J].activeRenderState.baseLayer))
                        d[J].device.onBaseLayerSet(d[J].id, d[J].activeRenderState.baseLayer);
                    if (null !== d[J].activeRenderState.baseLayer) {
                        var b = new A(a,d,d[J].id)
                          , c = d[J].currentFrameCallbacks = d[J].frameCallbacks;
                        d[J].frameCallbacks = [];
                        b[Fa].active = !0;
                        b[Fa].animationFrame = !0;
                        d[J].device.onFrameStart(d[J].id, d[J].activeRenderState);
                        d._checkInputSourcesChange();
                        for (var e = Hc(), f = 0; f < c.length; f++)
                            try {
                                c[f].cancelled || "function" !== typeof c[f].callback || c[f].callback(e, b)
                            } catch (ch) {
                                console.error(ch)
                            }
                        d[J].currentFrameCallbacks = null;
                        b[Fa].active = !1;
                        d[J].device.onFrameEnd(d[J].id)
                    }
                }
            }
            ;
            d[J].startDeviceFrameLoop = function() {
                null === d[J].deviceFrameHandle && (d[J].deviceFrameHandle = d[J].device.requestAnimationFrame(d[J].onDeviceFrame))
            }
            ;
            d[J].stopDeviceFrameLoop = function() {
                var a = d[J].deviceFrameHandle;
                null !== a && (d[J].device.cancelAnimationFrame(a),
                d[J].deviceFrameHandle = null)
            }
            ;
            d[J].onPresentationEnd = function(b) {
                b !== d[J].id ? (d[J].suspended = !1,
                d[J].startDeviceFrameLoop(),
                d.dispatchEvent("focus", {
                    session: d
                })) : (d[J].ended = !0,
                d[J].stopDeviceFrameLoop(),
                a.removeEventListener("@@webxr-polyfill/vr-present-end", d[J].onPresentationEnd),
                a.removeEventListener("@@webxr-polyfill/vr-present-start", d[J].onPresentationStart),
                a.removeEventListener("@@webxr-polyfill/input-select-start", d[J].onSelectStart),
                a.removeEventListener("@@webxr-polyfill/input-select-end", d[J].onSelectEnd),
                d.dispatchEvent("end", Ia("end", {
                    session: d
                })))
            }
            ;
            a.addEventListener("@@webxr-polyfill/vr-present-end", d[J].onPresentationEnd);
            d[J].onPresentationStart = function(a) {
                a !== d[J].id && (d[J].suspended = !0,
                d[J].stopDeviceFrameLoop(),
                d.dispatchEvent("blur", {
                    session: d
                }))
            }
            ;
            a.addEventListener("@@webxr-polyfill/vr-present-start", d[J].onPresentationStart);
            d[J].onSelectStart = function(a) {
                a.sessionId === d[J].id && d[J].dispatchInputSourceEvent("selectstart", a.inputSource)
            }
            ;
            a.addEventListener("@@webxr-polyfill/input-select-start", d[J].onSelectStart);
            d[J].onSelectEnd = function(a) {
                a.sessionId === d[J].id && (d[J].dispatchInputSourceEvent("selectend", a.inputSource),
                d[J].dispatchInputSourceEvent("select", a.inputSource))
            }
            ;
            a.addEventListener("@@webxr-polyfill/input-select-end", d[J].onSelectEnd);
            d[J].onSqueezeStart = function(a) {
                a.sessionId === d[J].id && d[J].dispatchInputSourceEvent("squeezestart", a.inputSource)
            }
            ;
            a.addEventListener("@@webxr-polyfill/input-squeeze-start", d[J].onSqueezeStart);
            d[J].onSqueezeEnd = function(a) {
                a.sessionId === d[J].id && (d[J].dispatchInputSourceEvent("squeezeend", a.inputSource),
                d[J].dispatchInputSourceEvent("squeeze", a.inputSource))
            }
            ;
            a.addEventListener("@@webxr-polyfill/input-squeeze-end", d[J].onSqueezeEnd);
            d[J].dispatchInputSourceEvent = function(b, c) {
                var e = new A(a,d,d[J].id);
                c = ma(b, {
                    frame: e,
                    inputSource: c
                });
                e[Fa].active = !0;
                d.dispatchEvent(b, c);
                e[Fa].active = !1
            }
            ;
            d[J].startDeviceFrameLoop();
            d.onblur = void 0;
            d.onfocus = void 0;
            d.onresetpose = void 0;
            d.onend = void 0;
            d.onselect = void 0;
            d.onselectstart = void 0;
            d.onselectend = void 0;
            return d
        }
        function x(a) {
            return M.call(this, a) || this
        }
        function y(a, b, c) {
            c = void 0 === c ? {} : c;
            c = Object.assign({}, dh, c);
            if (!(a instanceof w))
                throw Error("session must be a XRSession");
            if (a.ended)
                throw Error("InvalidStateError");
            if (b[jf] && !0 !== b[ke])
                throw Error("InvalidStateError");
            var d = b.getParameter(b.FRAMEBUFFER_BINDING);
            this[Wb] = {
                context: b,
                config: c,
                framebuffer: d,
                session: a
            }
        }
        function z(a) {
            a = void 0 === a ? {} : a;
            a = Object.assign({}, eh, a);
            this[Xb] = {
                config: a
            }
        }
        function A(a, b, c) {
            this[Fa] = {
                id: ++od,
                active: !1,
                animationFrame: !1,
                device: a,
                session: b,
                sessionId: c
            }
        }
        function B(a, b, c, d) {
            if (!Ub.includes(c))
                throw Error("XREye must be one of: " + Ub);
            var e = Object.create(null)
              , f = new H(e);
            this[$a] = {
                device: a,
                eye: c,
                viewport: f,
                temp: e,
                sessionId: d,
                transform: b
            }
        }
        function H(a) {
            this[Cb] = {
                target: a
            }
        }
        function C(a, b, c) {
            a = L.call(this, a, void 0 === c ? !1 : c) || this;
            a[jb] = {
                views: b
            };
            return a
        }
        function L(a, b) {
            this[Ic] = {
                transform: a,
                emulatedPosition: b
            }
        }
        function G(a) {
            var b = E.call(this) || this;
            b[Pa] = {
                device: null,
                devicePromise: a,
                immersiveSession: null,
                inlineSessions: new Set
            };
            a.then(function(a) {
                b[Pa].device = a
            });
            return b
        }
        function I(a, b) {
            b = void 0 === b ? null : b;
            if (!Za.includes(a))
                throw Error("XRReferenceSpaceType must be one of " + Za);
            var c = M.call(this, a) || this;
            if ("bounded-floor" === a && !b)
                throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");
            "bounded-floor" !== a && "local-floor" !== a || b || (b = Z(new Float32Array(16)),
            b[13] = 1.6);
            c._inverseBaseMatrix = b || Z(new Float32Array(16));
            c[Oa] = {
                type: a,
                transform: b,
                originOffset: Z(new Float32Array(16))
            };
            return c
        }
        function M(a, b) {
            this[fa] = {
                specialType: void 0 === a ? null : a,
                inputSource: void 0 === b ? null : b,
                baseMatrix: null,
                inverseBaseMatrix: null,
                lastFrameId: -1
            }
        }
        function O() {
            this[P] = {
                matrix: null,
                position: null,
                orientation: null,
                inverse: null
            };
            if (0 === arguments.length)
                this[P].matrix = Z(new Float32Array(16));
            else if (1 === arguments.length)
                arguments[0]instanceof Float32Array ? this[P].matrix = arguments[0] : (this[P].position = this._getPoint(arguments[0]),
                this[P].orientation = DOMPointReadOnly.fromPoint({
                    x: 0,
                    y: 0,
                    z: 0,
                    w: 1
                }));
            else if (2 === arguments.length)
                this[P].position = this._getPoint(arguments[0]),
                this[P].orientation = this._getPoint(arguments[1]);
            else
                throw Error("Too many arguments!");
            if (this[P].matrix) {
                var a = U();
                ia(a, this[P].matrix);
                this[P].position = DOMPointReadOnly.fromPoint({
                    x: a[0],
                    y: a[1],
                    z: a[2]
                });
                a = va();
                Y(a, this[P].matrix);
                this[P].orientation = DOMPointReadOnly.fromPoint({
                    x: a[0],
                    y: a[1],
                    z: a[2],
                    w: a[3]
                })
            } else {
                this[P].matrix = Z(new Float32Array(16));
                a = this[P].matrix;
                var b = this[P].orientation.x
                  , c = this[P].orientation.y
                  , d = this[P].orientation.z
                  , e = this[P].orientation.w
                  , f = new qa(4);
                f[0] = b;
                f[1] = c;
                f[2] = d;
                f[3] = e;
                ha(a, f, W(this[P].position.x, this[P].position.y, this[P].position.z))
            }
        }
        function K(a, b) {
            var c = b[0]
              , d = b[1]
              , e = b[2];
            b = b[3];
            var f = c * c + d * d + e * e + b * b;
            0 < f && (f = 1 / Math.sqrt(f),
            a[0] = c * f,
            a[1] = d * f,
            a[2] = e * f,
            a[3] = b * f);
            return a
        }
        function F(a, b) {
            a[0] = b[0];
            a[1] = b[1];
            a[2] = b[2];
            a[3] = b[3];
            return a
        }
        function D(a) {
            var b = new qa(4);
            b[0] = a[0];
            b[1] = a[1];
            b[2] = a[2];
            b[3] = a[3];
            return b
        }
        function E() {
            this[sa] = {
                listeners: new Map
            }
        }
        function S() {
            var a = new qa(16);
            qa != Float32Array && (a[1] = 0,
            a[2] = 0,
            a[3] = 0,
            a[4] = 0,
            a[6] = 0,
            a[7] = 0,
            a[8] = 0,
            a[9] = 0,
            a[11] = 0,
            a[12] = 0,
            a[13] = 0,
            a[14] = 0);
            a[0] = 1;
            a[5] = 1;
            a[10] = 1;
            a[15] = 1;
            return a
        }
        function Z(a) {
            a[0] = 1;
            a[1] = 0;
            a[2] = 0;
            a[3] = 0;
            a[4] = 0;
            a[5] = 1;
            a[6] = 0;
            a[7] = 0;
            a[8] = 0;
            a[9] = 0;
            a[10] = 1;
            a[11] = 0;
            a[12] = 0;
            a[13] = 0;
            a[14] = 0;
            a[15] = 1;
            return a
        }
        function R(a, b) {
            var c = b[0]
              , d = b[1]
              , e = b[2]
              , f = b[3]
              , g = b[4]
              , h = b[5]
              , l = b[6]
              , m = b[7]
              , n = b[8]
              , r = b[9]
              , p = b[10]
              , w = b[11]
              , q = b[12]
              , u = b[13]
              , ta = b[14];
            b = b[15];
            var v = c * h - d * g
              , Aa = c * l - e * g
              , x = c * m - f * g
              , D = d * l - e * h
              , y = d * m - f * h
              , A = e * m - f * l
              , z = n * u - r * q
              , B = n * ta - p * q
              , M = n * b - w * q
              , C = r * ta - p * u
              , F = r * b - w * u
              , Y = p * b - w * ta
              , ma = v * Y - Aa * F + x * C + D * M - y * B + A * z;
            if (!ma)
                return null;
            ma = 1 / ma;
            a[0] = (h * Y - l * F + m * C) * ma;
            a[1] = (e * F - d * Y - f * C) * ma;
            a[2] = (u * A - ta * y + b * D) * ma;
            a[3] = (p * y - r * A - w * D) * ma;
            a[4] = (l * M - g * Y - m * B) * ma;
            a[5] = (c * Y - e * M + f * B) * ma;
            a[6] = (ta * x - q * A - b * Aa) * ma;
            a[7] = (n * A - p * x + w * Aa) * ma;
            a[8] = (g * F - h * M + m * z) * ma;
            a[9] = (d * M - c * F - f * z) * ma;
            a[10] = (q * y - u * x + b * v) * ma;
            a[11] = (r * x - n * y - w * v) * ma;
            a[12] = (h * B - g * C - l * z) * ma;
            a[13] = (c * C - d * B + e * z) * ma;
            a[14] = (u * Aa - q * D - ta * v) * ma;
            a[15] = (n * D - r * Aa + p * v) * ma;
            return a
        }
        function da(a, b, c) {
            var d = b[0]
              , e = b[1]
              , f = b[2]
              , g = b[3]
              , h = b[4]
              , l = b[5]
              , m = b[6]
              , n = b[7]
              , r = b[8]
              , p = b[9]
              , w = b[10]
              , q = b[11]
              , u = b[12]
              , ta = b[13]
              , v = b[14];
            b = b[15];
            var x = c[0]
              , Aa = c[1]
              , D = c[2]
              , y = c[3];
            a[0] = x * d + Aa * h + D * r + y * u;
            a[1] = x * e + Aa * l + D * p + y * ta;
            a[2] = x * f + Aa * m + D * w + y * v;
            a[3] = x * g + Aa * n + D * q + y * b;
            x = c[4];
            Aa = c[5];
            D = c[6];
            y = c[7];
            a[4] = x * d + Aa * h + D * r + y * u;
            a[5] = x * e + Aa * l + D * p + y * ta;
            a[6] = x * f + Aa * m + D * w + y * v;
            a[7] = x * g + Aa * n + D * q + y * b;
            x = c[8];
            Aa = c[9];
            D = c[10];
            y = c[11];
            a[8] = x * d + Aa * h + D * r + y * u;
            a[9] = x * e + Aa * l + D * p + y * ta;
            a[10] = x * f + Aa * m + D * w + y * v;
            a[11] = x * g + Aa * n + D * q + y * b;
            x = c[12];
            Aa = c[13];
            D = c[14];
            y = c[15];
            a[12] = x * d + Aa * h + D * r + y * u;
            a[13] = x * e + Aa * l + D * p + y * ta;
            a[14] = x * f + Aa * m + D * w + y * v;
            a[15] = x * g + Aa * n + D * q + y * b;
            return a
        }
        function ha(a, b, c) {
            var d = b[0]
              , e = b[1]
              , f = b[2]
              , g = b[3]
              , h = d + d
              , l = e + e
              , m = f + f;
            b = d * h;
            var n = d * l;
            d *= m;
            var r = e * l;
            e *= m;
            f *= m;
            h *= g;
            l *= g;
            g *= m;
            a[0] = 1 - (r + f);
            a[1] = n + g;
            a[2] = d - l;
            a[3] = 0;
            a[4] = n - g;
            a[5] = 1 - (b + f);
            a[6] = e + h;
            a[7] = 0;
            a[8] = d + l;
            a[9] = e - h;
            a[10] = 1 - (b + r);
            a[11] = 0;
            a[12] = c[0];
            a[13] = c[1];
            a[14] = c[2];
            a[15] = 1;
            return a
        }
        function ia(a, b) {
            a[0] = b[12];
            a[1] = b[13];
            a[2] = b[14];
            return a
        }
        function Y(a, b) {
            var c = b[0] + b[5] + b[10];
            0 < c ? (c = 2 * Math.sqrt(c + 1),
            a[3] = .25 * c,
            a[0] = (b[6] - b[9]) / c,
            a[1] = (b[8] - b[2]) / c,
            a[2] = (b[1] - b[4]) / c) : b[0] > b[5] && b[0] > b[10] ? (c = 2 * Math.sqrt(1 + b[0] - b[5] - b[10]),
            a[3] = (b[6] - b[9]) / c,
            a[0] = .25 * c,
            a[1] = (b[1] + b[4]) / c,
            a[2] = (b[8] + b[2]) / c) : b[5] > b[10] ? (c = 2 * Math.sqrt(1 + b[5] - b[0] - b[10]),
            a[3] = (b[8] - b[2]) / c,
            a[0] = (b[1] + b[4]) / c,
            a[1] = .25 * c,
            a[2] = (b[6] + b[9]) / c) : (c = 2 * Math.sqrt(1 + b[10] - b[0] - b[5]),
            a[3] = (b[1] - b[4]) / c,
            a[0] = (b[8] + b[2]) / c,
            a[1] = (b[6] + b[9]) / c,
            a[2] = .25 * c);
            return a
        }
        function N(a, b, c, d, e) {
            b = 1 / Math.tan(b / 2);
            a[0] = b / c;
            a[1] = 0;
            a[2] = 0;
            a[3] = 0;
            a[4] = 0;
            a[5] = b;
            a[6] = 0;
            a[7] = 0;
            a[8] = 0;
            a[9] = 0;
            a[11] = -1;
            a[12] = 0;
            a[13] = 0;
            a[15] = 0;
            null != e && Infinity !== e ? (c = 1 / (d - e),
            a[10] = (e + d) * c,
            a[14] = 2 * e * d * c) : (a[10] = -1,
            a[14] = -2 * d);
            return a
        }
        function U() {
            var a = new qa(3);
            qa != Float32Array && (a[0] = 0,
            a[1] = 0,
            a[2] = 0);
            return a
        }
        function ba(a) {
            var b = new qa(3);
            b[0] = a[0];
            b[1] = a[1];
            b[2] = a[2];
            return b
        }
        function W(a, b, c) {
            var d = new qa(3);
            d[0] = a;
            d[1] = b;
            d[2] = c;
            return d
        }
        function ka(a, b) {
            a[0] = b[0];
            a[1] = b[1];
            a[2] = b[2];
            return a
        }
        function ca(a, b, c) {
            a[0] = b[0] + c[0];
            a[1] = b[1] + c[1];
            a[2] = b[2] + c[2];
            return a
        }
        function la(a, b, c) {
            a[0] = b[0] * c;
            a[1] = b[1] * c;
            a[2] = b[2] * c;
            return a
        }
        function ya(a, b) {
            var c = b[0]
              , d = b[1]
              , e = b[2];
            c = c * c + d * d + e * e;
            0 < c && (c = 1 / Math.sqrt(c),
            a[0] = b[0] * c,
            a[1] = b[1] * c,
            a[2] = b[2] * c);
            return a
        }
        function V(a, b) {
            return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]
        }
        function Ga(a, b, c) {
            var d = b[0]
              , e = b[1];
            b = b[2];
            var f = c[0]
              , g = c[1];
            c = c[2];
            a[0] = e * c - b * g;
            a[1] = b * f - d * c;
            a[2] = d * g - e * f;
            return a
        }
        function Ha(a, b, c) {
            var d = c[0]
              , e = c[1]
              , f = c[2]
              , g = b[0]
              , h = b[1];
            b = b[2];
            var l = e * b - f * h
              , m = f * g - d * b
              , n = d * h - e * g;
            c = 2 * c[3];
            a[0] = g + l * c + 2 * (e * n - f * m);
            a[1] = h + m * c + 2 * (f * l - d * n);
            a[2] = b + n * c + 2 * (d * m - e * l);
            return a
        }
        function Qa() {
            var a = new qa(9);
            qa != Float32Array && (a[1] = 0,
            a[2] = 0,
            a[3] = 0,
            a[5] = 0,
            a[6] = 0,
            a[7] = 0);
            a[0] = 1;
            a[4] = 1;
            a[8] = 1;
            return a
        }
        function bb() {
            var a = new qa(4);
            qa != Float32Array && (a[0] = 0,
            a[1] = 0,
            a[2] = 0,
            a[3] = 0);
            return a
        }
        function va() {
            var a = new qa(4);
            qa != Float32Array && (a[0] = 0,
            a[1] = 0,
            a[2] = 0);
            a[3] = 1;
            return a
        }
        function Db(a, b, c) {
            var d = b[0]
              , e = b[1]
              , f = b[2];
            b = b[3];
            var g = c[0]
              , h = c[1]
              , l = c[2];
            c = c[3];
            a[0] = d * c + b * g + e * l - f * h;
            a[1] = e * c + b * h + f * g - d * l;
            a[2] = f * c + b * l + d * h - e * g;
            a[3] = b * c - d * g - e * h - f * l;
            return a
        }
        function Ta(a, b, c, d) {
            var e = b[0]
              , f = b[1]
              , g = b[2];
            b = b[3];
            var h = c[0]
              , l = c[1]
              , m = c[2];
            c = c[3];
            var n = e * h + f * l + g * m + b * c;
            0 > n && (n = -n,
            h = -h,
            l = -l,
            m = -m,
            c = -c);
            if (1E-6 < 1 - n) {
                var r = Math.acos(n);
                var p = Math.sin(r);
                n = Math.sin((1 - d) * r) / p;
                d = Math.sin(d * r) / p
            } else
                n = 1 - d;
            a[0] = n * e + d * h;
            a[1] = n * f + d * l;
            a[2] = n * g + d * m;
            a[3] = n * b + d * c;
            return a
        }
        function vb(a, b) {
            var c = b[0]
              , d = b[1]
              , e = b[2];
            b = b[3];
            var f = c * c + d * d + e * e + b * b;
            f = f ? 1 / f : 0;
            a[0] = -c * f;
            a[1] = -d * f;
            a[2] = -e * f;
            a[3] = b * f;
            return a
        }
        function ma(a, b) {
            a = new Event(a,b);
            a[le] = {
                frame: b.frame,
                inputSource: b.inputSource
            };
            Object.setPrototypeOf(a, ma.prototype);
            Object.defineProperty(a, "frame", {
                get: function() {
                    return this[le].frame
                }
            });
            Object.defineProperty(a, "inputSource", {
                get: function() {
                    return this[le].inputSource
                }
            });
            return a
        }
        function Ia(a, b) {
            a = new Event(a,b);
            a[kf] = {
                session: b.session
            };
            Object.setPrototypeOf(a, Ia.prototype);
            Object.defineProperty(a, "session", {
                get: function() {
                    return this[kf].session
                }
            });
            return a
        }
        function Bb(a, b) {
            a = new Event(a,b);
            a[pd] = {
                session: b.session,
                added: b.added,
                removed: b.removed
            };
            Object.setPrototypeOf(a, Bb.prototype);
            Object.defineProperty(a, "session", {
                get: function() {
                    return this[pd].session
                }
            });
            Object.defineProperty(a, "added", {
                get: function() {
                    return this[pd].added
                }
            });
            Object.defineProperty(a, "removed", {
                get: function() {
                    return this[pd].removed
                }
            });
            return a
        }
        function Nb(a, b) {
            a = new Event(a,b);
            a[me] = {
                referenceSpace: b.referenceSpace,
                transform: b.transform || null
            };
            Object.setPrototypeOf(a, Nb.prototype);
            Object.defineProperty(a, "referenceSpace", {
                get: function() {
                    return this[me].referenceSpace
                }
            });
            Object.defineProperty(a, "transform", {
                get: function() {
                    return this[me].transform
                }
            });
            return a
        }
        function oa(a, b, c) {
            function d(a, b, c) {
                return a < b ? b : a > c ? c : a
            }
            var e = b[0] * b[0]
              , f = b[1] * b[1]
              , g = b[2] * b[2]
              , h = b[3] * b[3];
            "XYZ" === c ? (a[0] = Math.atan2(2 * (b[0] * b[3] - b[1] * b[2]), h - e - f + g),
            a[1] = Math.asin(d(2 * (b[0] * b[2] + b[1] * b[3]), -1, 1)),
            a[2] = Math.atan2(2 * (b[2] * b[3] - b[0] * b[1]), h + e - f - g)) : "YXZ" === c ? (a[0] = Math.asin(d(2 * (b[0] * b[3] - b[1] * b[2]), -1, 1)),
            a[1] = Math.atan2(2 * (b[0] * b[2] + b[1] * b[3]), h - e - f + g),
            a[2] = Math.atan2(2 * (b[0] * b[1] + b[2] * b[3]), h - e + f - g)) : "ZXY" === c ? (a[0] = Math.asin(d(2 * (b[0] * b[3] + b[1] * b[2]), -1, 1)),
            a[1] = Math.atan2(2 * (b[1] * b[3] - b[2] * b[0]), h - e - f + g),
            a[2] = Math.atan2(2 * (b[2] * b[3] - b[0] * b[1]), h - e + f - g)) : "ZYX" === c ? (a[0] = Math.atan2(2 * (b[0] * b[3] + b[2] * b[1]), h - e - f + g),
            a[1] = Math.asin(d(2 * (b[1] * b[3] - b[0] * b[2]), -1, 1)),
            a[2] = Math.atan2(2 * (b[0] * b[1] + b[2] * b[3]), h + e - f - g)) : "YZX" === c ? (a[0] = Math.atan2(2 * (b[0] * b[3] - b[2] * b[1]), h - e + f - g),
            a[1] = Math.atan2(2 * (b[1] * b[3] - b[0] * b[2]), h + e - f - g),
            a[2] = Math.asin(d(2 * (b[0] * b[1] + b[2] * b[3]), -1, 1))) : "XZY" === c ? (a[0] = Math.atan2(2 * (b[0] * b[3] + b[1] * b[2]), h - e + f - g),
            a[1] = Math.atan2(2 * (b[0] * b[2] + b[1] * b[3]), h + e - f - g),
            a[2] = Math.asin(d(2 * (b[2] * b[3] - b[0] * b[1]), -1, 1))) : console.log("No order given for quaternion to euler conversion.")
        }
        var za = "undefined" !== typeof global ? global : "undefined" !== typeof self ? self : "undefined" !== typeof window ? window : {};
        k.initSymbol();
        var sa = Symbol("@@webxr-polyfill/EventTarget");
        E.prototype.addEventListener = function(a, b) {
            if ("string" !== typeof a)
                throw Error("`type` must be a string");
            if ("function" !== typeof b)
                throw Error("`listener` must be a function");
            var c = this[sa].listeners.get(a) || [];
            c.push(b);
            this[sa].listeners.set(a, c)
        }
        ;
        E.prototype.removeEventListener = function(a, b) {
            if ("string" !== typeof a)
                throw Error("`type` must be a string");
            if ("function" !== typeof b)
                throw Error("`listener` must be a function");
            a = this[sa].listeners.get(a) || [];
            for (var c = a.length; 0 <= c; c--)
                a[c] === b && a.pop()
        }
        ;
        E.prototype.dispatchEvent = function(a, b) {
            for (var c = this[sa].listeners.get(a) || [], d = [], e = 0; e < c.length; e++)
                d[e] = c[e];
            c = k.makeIterator(d);
            for (d = c.next(); !d.done; d = c.next())
                d = d.value,
                d(b);
            if ("function" === typeof this["on" + a])
                this["on" + a](b)
        }
        ;
        var qa = "undefined" !== typeof Float32Array ? Float32Array : Array;
        (function() {
            var a = U();
            return function(b, c, d, e, f, g) {
                c || (c = 3);
                d || (d = 0);
                for (e = e ? Math.min(e * c + d, b.length) : b.length; d < e; d += c)
                    a[0] = b[d],
                    a[1] = b[d + 1],
                    a[2] = b[d + 2],
                    f(a, a, g),
                    b[d] = a[0],
                    b[d + 1] = a[1],
                    b[d + 2] = a[2];
                return b
            }
        }
        )();
        (function() {
            var a = bb();
            return function(b, c, d, e, f, g) {
                c || (c = 4);
                d || (d = 0);
                for (e = e ? Math.min(e * c + d, b.length) : b.length; d < e; d += c)
                    a[0] = b[d],
                    a[1] = b[d + 1],
                    a[2] = b[d + 2],
                    a[3] = b[d + 3],
                    f(a, a, g),
                    b[d] = a[0],
                    b[d + 1] = a[1],
                    b[d + 2] = a[2],
                    b[d + 3] = a[3];
                return b
            }
        }
        )();
        (function() {
            var a = U()
              , b = W(1, 0, 0)
              , c = W(0, 1, 0);
            return function(d, e, f) {
                var g = V(e, f);
                if (-.999999 > g) {
                    Ga(a, b, e);
                    f = a[0];
                    g = a[1];
                    var h = a[2];
                    1E-6 > Math.sqrt(f * f + g * g + h * h) && Ga(a, c, e);
                    ya(a, a);
                    e = Math.PI;
                    e *= .5;
                    f = Math.sin(e);
                    d[0] = f * a[0];
                    d[1] = f * a[1];
                    d[2] = f * a[2];
                    d[3] = Math.cos(e);
                    return d
                }
                if (.999999 < g)
                    return d[0] = 0,
                    d[1] = 0,
                    d[2] = 0,
                    d[3] = 1,
                    d;
                Ga(a, e, f);
                d[0] = a[0];
                d[1] = a[1];
                d[2] = a[2];
                d[3] = 1 + g;
                return K(d, d)
            }
        }
        )();
        (function() {
            var a = va()
              , b = va();
            return function(c, d, e, f, g, h) {
                Ta(a, d, g, h);
                Ta(b, e, f, h);
                Ta(c, a, b, 2 * h * (1 - h));
                return c
            }
        }
        )();
        (function() {
            var a = Qa();
            return function(b, c, d, e) {
                a[0] = d[0];
                a[3] = d[1];
                a[6] = d[2];
                a[1] = e[0];
                a[4] = e[1];
                a[7] = e[2];
                a[2] = -c[0];
                a[5] = -c[1];
                a[8] = -c[2];
                c = a[0] + a[4] + a[8];
                if (0 < c)
                    c = Math.sqrt(c + 1),
                    b[3] = .5 * c,
                    c = .5 / c,
                    b[0] = (a[5] - a[7]) * c,
                    b[1] = (a[6] - a[2]) * c,
                    b[2] = (a[1] - a[3]) * c;
                else {
                    d = 0;
                    a[4] > a[0] && (d = 1);
                    a[8] > a[3 * d + d] && (d = 2);
                    e = (d + 1) % 3;
                    var f = (d + 2) % 3;
                    c = Math.sqrt(a[3 * d + d] - a[3 * e + e] - a[3 * f + f] + 1);
                    b[d] = .5 * c;
                    c = .5 / c;
                    b[3] = (a[3 * e + f] - a[3 * f + e]) * c;
                    b[e] = (a[3 * e + d] + a[3 * d + e]) * c;
                    b[f] = (a[3 * f + d] + a[3 * d + f]) * c
                }
                return K(b, b)
            }
        }
        )();
        if (!("DOMPointReadOnly"in window)) {
            k.initSymbol();
            var pa = Symbol("@@webxr-polyfill/DOMPointReadOnly")
              , Da = function(a, b, c, d) {
                if (1 === arguments.length)
                    this[pa] = {
                        x: a.x,
                        y: a.y,
                        z: a.z,
                        w: a.w
                    };
                else if (4 === arguments.length)
                    this[pa] = {
                        x: a,
                        y: b,
                        z: c,
                        w: d
                    };
                else
                    throw new TypeError("Must supply either 1 or 4 arguments");
            };
            Da.fromPoint = function(a) {
                return new Da(a.x,a.y,a.z,a.w)
            }
            ;
            k.global.Object.defineProperties(Da.prototype, {
                x: {
                    configurable: !0,
                    enumerable: !0,
                    get: function() {
                        return this[pa].x
                    }
                },
                y: {
                    configurable: !0,
                    enumerable: !0,
                    get: function() {
                        return this[pa].y
                    }
                },
                z: {
                    configurable: !0,
                    enumerable: !0,
                    get: function() {
                        return this[pa].z
                    }
                },
                w: {
                    configurable: !0,
                    enumerable: !0,
                    get: function() {
                        return this[pa].w
                    }
                }
            });
            window.DOMPointReadOnly = Da
        }
        k.initSymbol();
        var P = Symbol("@@webxr-polyfill/XRRigidTransform");
        O.prototype._getPoint = function(a) {
            return a instanceof DOMPointReadOnly ? a : DOMPointReadOnly.fromPoint(a)
        }
        ;
        k.global.Object.defineProperties(O.prototype, {
            matrix: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[P].matrix
                }
            },
            position: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[P].position
                }
            },
            orientation: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[P].orientation
                }
            },
            inverse: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    if (null === this[P].inverse) {
                        var a = Z(new Float32Array(16));
                        R(a, this[P].matrix);
                        this[P].inverse = new O(a);
                        this[P].inverse[P].inverse = this
                    }
                    return this[P].inverse
                }
            }
        });
        k.initSymbol();
        var fa = Symbol("@@webxr-polyfill/XRSpace");
        M.prototype._ensurePoseUpdated = function(a, b) {
            b != this[fa].lastFrameId && (this[fa].lastFrameId = b,
            this._onPoseUpdate(a))
        }
        ;
        M.prototype._onPoseUpdate = function(a) {
            "viewer" == this[fa].specialType && (this._baseMatrix = a.getBasePoseMatrix())
        }
        ;
        M.prototype._getSpaceRelativeTransform = function(a) {
            if (!this._inverseBaseMatrix || !a._baseMatrix)
                return null;
            var b = new Float32Array(16);
            da(b, this._inverseBaseMatrix, a._baseMatrix);
            return new O(b)
        }
        ;
        k.global.Object.defineProperties(M.prototype, {
            _specialType: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[fa].specialType
                }
            },
            _inputSource: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[fa].inputSource
                }
            },
            _baseMatrix: {
                configurable: !0,
                enumerable: !0,
                set: function(a) {
                    this[fa].baseMatrix = a;
                    this[fa].inverseBaseMatrix = null
                },
                get: function() {
                    !this[fa].baseMatrix && this[fa].inverseBaseMatrix && (this[fa].baseMatrix = new Float32Array(16),
                    R(this[fa].baseMatrix, this[fa].inverseBaseMatrix));
                    return this[fa].baseMatrix
                }
            },
            _inverseBaseMatrix: {
                configurable: !0,
                enumerable: !0,
                set: function(a) {
                    this[fa].inverseBaseMatrix = a;
                    this[fa].baseMatrix = null
                },
                get: function() {
                    !this[fa].inverseBaseMatrix && this[fa].baseMatrix && (this[fa].inverseBaseMatrix = new Float32Array(16),
                    R(this[fa].inverseBaseMatrix, this[fa].baseMatrix));
                    return this[fa].inverseBaseMatrix
                }
            }
        });
        k.initSymbol();
        var Oa = Symbol("@@webxr-polyfill/XRReferenceSpace")
          , Za = ["viewer", "local", "local-floor", "bounded-floor", "unbounded"];
        k.inherits(I, M);
        I.prototype._transformBasePoseMatrix = function(a, b) {
            da(a, this._inverseBaseMatrix, b)
        }
        ;
        I.prototype._originOffsetMatrix = function() {
            return this[Oa].originOffset
        }
        ;
        I.prototype._adjustForOriginOffset = function(a) {
            var b = new Float32Array(16);
            R(b, this[Oa].originOffset);
            da(a, b, a)
        }
        ;
        I.prototype._getSpaceRelativeTransform = function(a) {
            a = M.prototype._getSpaceRelativeTransform.call(this, a);
            this._adjustForOriginOffset(a.matrix);
            return new XRRigidTransform(a.matrix)
        }
        ;
        I.prototype.getOffsetReferenceSpace = function(a) {
            var b = new I(this[Oa].type,this[Oa].transform,this[Oa].bounds);
            da(b[Oa].originOffset, this[Oa].originOffset, a.matrix);
            return b
        }
        ;
        k.initSymbol();
        var Pa = Symbol("@@webxr-polyfill/XR")
          , Ec = ["inline", "immersive-vr", "immersive-ar"]
          , Fc = {
            inline: {
                requiredFeatures: ["viewer"],
                optionalFeatures: []
            },
            "immersive-vr": {
                requiredFeatures: ["viewer", "local"],
                optionalFeatures: []
            },
            "immersive-ar": {
                requiredFeatures: ["viewer", "local"],
                optionalFeatures: []
            }
        };
        k.inherits(G, E);
        G.prototype.isSessionSupported = function(a) {
            var b = this;
            return k.asyncExecutePromiseGeneratorProgram(function(c) {
                return 1 == c.nextAddress ? b[Pa].device ? c.jumpTo(2) : c.yield(b[Pa].devicePromise, 2) : "inline" != a ? c.return(Promise.resolve(b[Pa].device.isSessionSupported(a))) : c.return(Promise.resolve(!0))
            })
        }
        ;
        G.prototype.requestSession = function(a, b) {
            var c = this, d, e, f, g, h, l, m, n, r, p, w, q, u;
            return k.asyncExecutePromiseGeneratorProgram(function(v) {
                if (1 == v.nextAddress) {
                    if (c[Pa].device)
                        return v.jumpTo(2);
                    if ("inline" != a)
                        throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");
                    return v.yield(c[Pa].devicePromise, 2)
                }
                if (5 != v.nextAddress) {
                    if (!Ec.includes(a))
                        throw new TypeError("The provided value '" + a + "' is not a valid enum value of type XRSessionMode");
                    d = Fc[a];
                    e = d.requiredFeatures.concat(b && b.requiredFeatures ? b.requiredFeatures : []);
                    f = d.optionalFeatures.concat(b && b.optionalFeatures ? b.optionalFeatures : []);
                    g = new Set;
                    h = !1;
                    l = k.makeIterator(e);
                    for (m = l.next(); !m.done; m = l.next())
                        n = m.value,
                        c[Pa].device.isFeatureSupported(n) ? g.add(n) : (console.error("The required feature '" + n + "' is not supported"),
                        h = !0);
                    if (h)
                        throw new DOMException("Session does not support some required features","NotSupportedError");
                    r = k.makeIterator(f);
                    for (m = r.next(); !m.done; m = r.next())
                        p = m.value,
                        c[Pa].device.isFeatureSupported(p) ? g.add(p) : console.log("The optional feature '" + p + "' is not supported");
                    return v.yield(c[Pa].device.requestSession(a, g), 5)
                }
                w = v.yieldResult;
                q = new XRSession(c[Pa].device,a,w);
                "inline" == a ? c[Pa].inlineSessions.add(q) : c[Pa].immersiveSession = q;
                u = function() {
                    "inline" == a ? c[Pa].inlineSessions.delete(q) : c[Pa].immersiveSession = null;
                    q.removeEventListener("end", u)
                }
                ;
                q.addEventListener("end", u);
                return v.return(q)
            })
        }
        ;
        if (!1 === "performance"in za) {
            var Gc = Date.now();
            var lc = function() {
                return Date.now() - Gc
            }
        } else
            lc = function() {
                return performance.now()
            }
            ;
        var Hc = lc;
        k.initSymbol();
        var Ic = Symbol("@@webxr-polyfill/XRPose");
        k.global.Object.defineProperties(L.prototype, {
            transform: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ic].transform
                }
            },
            emulatedPosition: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ic].emulatedPosition
                }
            }
        });
        k.initSymbol();
        var jb = Symbol("@@webxr-polyfill/XRViewerPose");
        k.inherits(C, L);
        k.global.Object.defineProperties(C.prototype, {
            views: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[jb].views
                }
            }
        });
        k.initSymbol();
        var Cb = Symbol("@@webxr-polyfill/XRViewport");
        k.global.Object.defineProperties(H.prototype, {
            x: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Cb].target.x
                }
            },
            y: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Cb].target.y
                }
            },
            width: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Cb].target.width
                }
            },
            height: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Cb].target.height
                }
            }
        });
        var Ub = ["left", "right", "none"];
        k.initSymbol();
        var $a = Symbol("@@webxr-polyfill/XRView");
        B.prototype._getViewport = function(a) {
            if (this[$a].device.getViewport(this[$a].sessionId, this.eye, a, this[$a].temp))
                return this[$a].viewport
        }
        ;
        k.global.Object.defineProperties(B.prototype, {
            eye: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[$a].eye
                }
            },
            projectionMatrix: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[$a].device.getProjectionMatrix(this.eye)
                }
            },
            transform: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[$a].transform
                }
            }
        });
        k.initSymbol();
        var Fa = Symbol("@@webxr-polyfill/XRFrame")
          , od = 0;
        A.prototype.getViewerPose = function(a) {
            if (!this[Fa].animationFrame)
                throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");
            if (!this[Fa].active)
                throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");
            var b = this[Fa].device
              , c = this[Fa].session;
            c[J].viewerSpace._ensurePoseUpdated(b, this[Fa].id);
            a._ensurePoseUpdated(b, this[Fa].id);
            var d = a._getSpaceRelativeTransform(c[J].viewerSpace)
              , e = [];
            c = k.makeIterator(c[J].viewSpaces);
            for (var f = c.next(); !f.done; f = c.next()) {
                f = f.value;
                f._ensurePoseUpdated(b, this[Fa].id);
                var g = a._getSpaceRelativeTransform(f);
                f = new B(b,g,f.eye,this[Fa].sessionId);
                e.push(f)
            }
            return new C(d,e,!1)
        }
        ;
        A.prototype.getPose = function(a, b) {
            if (!this[Fa].active)
                throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");
            var c = this[Fa].device;
            if ("target-ray" === a._specialType || "grip" === a._specialType)
                return c.getInputPose(a._inputSource, b, a._specialType);
            a._ensurePoseUpdated(c, this[Fa].id);
            b._ensurePoseUpdated(c, this[Fa].id);
            return (a = b._getSpaceRelativeTransform(a)) ? new XRPose(a,!1) : null
        }
        ;
        k.global.Object.defineProperties(A.prototype, {
            session: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Fa].session
                }
            }
        });
        k.initSymbol();
        var Xb = Symbol("@@webxr-polyfill/XRRenderState")
          , eh = Object.freeze({
            depthNear: .1,
            depthFar: 1E3,
            inlineVerticalFieldOfView: null,
            baseLayer: null
        });
        k.global.Object.defineProperties(z.prototype, {
            depthNear: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Xb].config.depthNear
                }
            },
            depthFar: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Xb].config.depthFar
                }
            },
            inlineVerticalFieldOfView: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Xb].config.inlineVerticalFieldOfView
                }
            },
            baseLayer: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Xb].config.baseLayer
                }
            }
        });
        k.initSymbol();
        var jf = Symbol("@@webxr-polyfill/polyfilled-xr-compatible");
        k.initSymbol();
        var ke = Symbol("@@webxr-polyfill/xr-compatible");
        k.initSymbol();
        var Wb = Symbol("@@webxr-polyfill/XRWebGLLayer")
          , dh = Object.freeze({
            antialias: !0,
            depth: !1,
            stencil: !1,
            alpha: !0,
            multiview: !1,
            ignoreDepthValues: !1,
            framebufferScaleFactor: 1
        });
        y.prototype.getViewport = function(a) {
            return a._getViewport(this)
        }
        ;
        y.getNativeFramebufferScaleFactor = function(a) {
            if (!a)
                throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");
            return a[J].ended ? 0 : 1
        }
        ;
        k.global.Object.defineProperties(y.prototype, {
            context: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Wb].context
                }
            },
            antialias: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Wb].config.antialias
                }
            },
            ignoreDepthValues: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return !0
                }
            },
            framebuffer: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Wb].framebuffer
                }
            },
            framebufferWidth: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Wb].context.drawingBufferWidth
                }
            },
            framebufferHeight: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Wb].context.drawingBufferHeight
                }
            },
            _session: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Wb].session
                }
            }
        });
        k.initSymbol();
        var le = Symbol("@@webxr-polyfill/XRInputSourceEvent");
        k.initSymbol();
        var kf = Symbol("@@webxr-polyfill/XRSessionEvent");
        k.initSymbol();
        var pd = Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent");
        k.initSymbol();
        var J = Symbol("@@webxr-polyfill/XRSession");
        k.inherits(x, M);
        x.prototype._onPoseUpdate = function(a) {
            this._inverseBaseMatrix = a.getBaseViewMatrix(this._specialType)
        }
        ;
        k.global.Object.defineProperties(x.prototype, {
            eye: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this._specialType
                }
            }
        });
        k.inherits(w, E);
        w.prototype.requestReferenceSpace = function(a) {
            var b = this, c, d;
            return k.asyncExecutePromiseGeneratorProgram(function(e) {
                if (1 == e.nextAddress) {
                    if (b[J].ended)
                        return e.return();
                    if (!Za.includes(a))
                        throw new TypeError("XRReferenceSpaceType must be one of " + Za);
                    if (!b[J].device.doesSessionSupportReferenceSpace(b[J].id, a))
                        throw new DOMException("The " + a + " reference space is not supported by this session.","NotSupportedError");
                    return "viewer" === a ? e.return(b[J].viewerSpace) : e.yield(b[J].device.requestFrameOfReferenceTransform(a), 2)
                }
                c = e.yieldResult;
                if ("bounded-floor" === a) {
                    if (!c)
                        throw new DOMException(a + " XRReferenceSpace not supported by this device.","NotSupportedError");
                    d = b[J].device.requestStageBounds();
                    if (!d)
                        throw new DOMException(a + " XRReferenceSpace not supported by this device.","NotSupportedError");
                    throw new DOMException("The WebXR polyfill does not support the " + a + " reference space yet.","NotSupportedError");
                }
                return e.return(new I(a,c))
            })
        }
        ;
        w.prototype.requestAnimationFrame = function(a) {
            if (!this[J].ended) {
                var b = ++this[J].frameHandle;
                this[J].frameCallbacks.push({
                    handle: b,
                    callback: a,
                    cancelled: !1
                });
                return b
            }
        }
        ;
        w.prototype.cancelAnimationFrame = function(a) {
            var b = this[J].frameCallbacks
              , c = b.findIndex(function(b) {
                return b && b.handle === a
            });
            -1 < c && (b[c].cancelled = !0,
            b.splice(c, 1));
            if (b = this[J].currentFrameCallbacks)
                c = b.findIndex(function(b) {
                    return b && b.handle === a
                }),
                -1 < c && (b[c].cancelled = !0)
        }
        ;
        w.prototype.end = function() {
            var a = this;
            return k.asyncExecutePromiseGeneratorProgram(function(b) {
                if (a[J].ended)
                    return b.return();
                a[J].immersive && (a[J].ended = !0,
                a[J].device.removeEventListener("@@webxr-polyfill/vr-present-start", a[J].onPresentationStart),
                a[J].device.removeEventListener("@@webxr-polyfill/vr-present-end", a[J].onPresentationEnd),
                a[J].device.removeEventListener("@@webxr-polyfill/input-select-start", a[J].onSelectStart),
                a[J].device.removeEventListener("@@webxr-polyfill/input-select-end", a[J].onSelectEnd),
                a.dispatchEvent("end", Ia("end", {
                    session: a
                })));
                a[J].stopDeviceFrameLoop();
                return b.return(a[J].device.endSession(a[J].id))
            })
        }
        ;
        w.prototype.updateRenderState = function(a) {
            if (this[J].ended)
                throw Error("Can't call updateRenderState on an XRSession that has already ended.");
            if (a.baseLayer && a.baseLayer._session !== this)
                throw Error("Called updateRenderState with a base layer that was created by a different session.");
            if (null !== a.inlineVerticalFieldOfView && void 0 !== a.inlineVerticalFieldOfView) {
                if (this[J].immersive)
                    throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
                a.inlineVerticalFieldOfView = Math.min(3.13, Math.max(.01, a.inlineVerticalFieldOfView))
            }
            if (null === this[J].pendingRenderState) {
                var b = this[J].activeRenderState;
                this[J].pendingRenderState = {
                    depthNear: b.depthNear,
                    depthFar: b.depthFar,
                    inlineVerticalFieldOfView: b.inlineVerticalFieldOfView,
                    baseLayer: b.baseLayer
                }
            }
            Object.assign(this[J].pendingRenderState, a)
        }
        ;
        w.prototype._checkInputSourcesChange = function() {
            for (var a = [], b = [], c = this.inputSources, d = this[J].currentInputSources, e = k.makeIterator(c), f = e.next(); !f.done; f = e.next())
                f = f.value,
                d.includes(f) || a.push(f);
            d = k.makeIterator(d);
            for (e = d.next(); !e.done; e = d.next())
                e = e.value,
                c.includes(e) || b.push(e);
            (0 < a.length || 0 < b.length) && this.dispatchEvent("inputsourceschange", Bb("inputsourceschange", {
                session: this,
                added: a,
                removed: b
            }));
            this[J].currentInputSources.length = 0;
            a = k.makeIterator(c);
            for (f = a.next(); !f.done; f = a.next())
                this[J].currentInputSources.push(f.value)
        }
        ;
        k.global.Object.defineProperties(w.prototype, {
            renderState: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[J].activeRenderState
                }
            },
            environmentBlendMode: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[J].device.environmentBlendMode || "opaque"
                }
            },
            inputSources: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[J].device.getInputSources()
                }
            }
        });
        k.initSymbol();
        var Ob = Symbol("@@webxr-polyfill/XRInputSource");
        k.global.Object.defineProperties(v.prototype, {
            handedness: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ob].impl.handedness
                }
            },
            targetRayMode: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ob].impl.targetRayMode
                }
            },
            gripSpace: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    var a = this[Ob].impl.targetRayMode;
                    return "gaze" === a || "screen" === a ? null : this[Ob].gripSpace
                }
            },
            targetRaySpace: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ob].targetRaySpace
                }
            },
            profiles: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ob].impl.profiles
                }
            },
            gamepad: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ob].impl.gamepad
                }
            }
        });
        k.initSymbol();
        var me = Symbol("@@webxr-polyfill/XRReferenceSpaceEvent")
          , ne = {
            XRSystem: G,
            XRSession: w,
            XRSessionEvent: Ia,
            XRFrame: A,
            XRView: B,
            XRViewport: H,
            XRViewerPose: C,
            XRWebGLLayer: y,
            XRSpace: M,
            XRReferenceSpace: I,
            XRReferenceSpaceEvent: Nb,
            XRInputSource: v,
            XRInputSourceEvent: ma,
            XRInputSourcesChangeEvent: Bb,
            XRRenderState: z,
            XRRigidTransform: O,
            XRPose: L
        }
          , oe = "undefined" !== typeof window ? window : "undefined" !== typeof global ? global : "undefined" !== typeof self ? self : {}
          , ah = function(a) {
            return a && a.__esModule && Object.prototype.hasOwnProperty.call(a, "default") ? a["default"] : a
        }(function(a, b) {
            return b = {
                exports: {}
            },
            a(b, b.exports),
            b.exports
        }(function(a) {
            (function(b, c) {
                a.exports = c()
            }
            )(oe, function() {
                function a(a, b, c, d) {
                    this.x = a || 0;
                    this.y = b || 0;
                    this.z = c || 0;
                    this.w = void 0 !== d ? d : 1
                }
                function b(a, b, c) {
                    this.x = a || 0;
                    this.y = b || 0;
                    this.z = c || 0
                }
                function c(a, b, c) {
                    if (b) {
                        for (var d = [], e = null, f = 0; f < b.length; ++f) {
                            var g = b[f];
                            switch (g) {
                            case a.TEXTURE_BINDING_2D:
                            case a.TEXTURE_BINDING_CUBE_MAP:
                                var h = b[++f];
                                if (h < a.TEXTURE0 || h > a.TEXTURE31) {
                                    console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");
                                    d.push(null, null);
                                    break
                                }
                                e || (e = a.getParameter(a.ACTIVE_TEXTURE));
                                a.activeTexture(h);
                                d.push(a.getParameter(g), null);
                                break;
                            case a.ACTIVE_TEXTURE:
                                e = a.getParameter(a.ACTIVE_TEXTURE);
                                d.push(null);
                                break;
                            default:
                                d.push(a.getParameter(g))
                            }
                        }
                        c(a);
                        for (f = 0; f < b.length; ++f) {
                            g = b[f];
                            c = d[f];
                            switch (g) {
                            case a.ACTIVE_TEXTURE:
                                break;
                            case a.ARRAY_BUFFER_BINDING:
                                a.bindBuffer(a.ARRAY_BUFFER, c);
                                break;
                            case a.COLOR_CLEAR_VALUE:
                                a.clearColor(c[0], c[1], c[2], c[3]);
                                break;
                            case a.COLOR_WRITEMASK:
                                a.colorMask(c[0], c[1], c[2], c[3]);
                                break;
                            case a.CURRENT_PROGRAM:
                                a.useProgram(c);
                                break;
                            case a.ELEMENT_ARRAY_BUFFER_BINDING:
                                a.bindBuffer(a.ELEMENT_ARRAY_BUFFER, c);
                                break;
                            case a.FRAMEBUFFER_BINDING:
                                a.bindFramebuffer(a.FRAMEBUFFER, c);
                                break;
                            case a.RENDERBUFFER_BINDING:
                                a.bindRenderbuffer(a.RENDERBUFFER, c);
                                break;
                            case a.TEXTURE_BINDING_2D:
                                h = b[++f];
                                if (h < a.TEXTURE0 || h > a.TEXTURE31)
                                    break;
                                a.activeTexture(h);
                                a.bindTexture(a.TEXTURE_2D, c);
                                break;
                            case a.TEXTURE_BINDING_CUBE_MAP:
                                h = b[++f];
                                if (h < a.TEXTURE0 || h > a.TEXTURE31)
                                    break;
                                a.activeTexture(h);
                                a.bindTexture(a.TEXTURE_CUBE_MAP, c);
                                break;
                            case a.VIEWPORT:
                                a.viewport(c[0], c[1], c[2], c[3]);
                                break;
                            case a.BLEND:
                            case a.CULL_FACE:
                            case a.DEPTH_TEST:
                            case a.SCISSOR_TEST:
                            case a.STENCIL_TEST:
                                c ? a.enable(g) : a.disable(g);
                                break;
                            default:
                                console.log("No GL restore behavior for 0x" + g.toString(16))
                            }
                            e && a.activeTexture(e)
                        }
                    } else
                        c(a)
                }
                function d(a, b) {
                    K(a, a + " has been deprecated. This may not work on native WebVR displays. " + (b ? "Please use " + b + " instead." : ""))
                }
                function e(a) {
                    return 1 < a.w ? (console.warn("getQuaternionAngle: w > 1"),
                    0) : 2 * Math.acos(a.w)
                }
                function f(a) {
                    var b = a.indexOf("://");
                    b = a.indexOf("/", -1 !== b ? b + 3 : 0);
                    -1 === b && (b = a.length);
                    return a.substring(0, b)
                }
                function g(a) {
                    if (ta()) {
                        var b = a.style.width
                          , c = a.style.height;
                        a.style.width = parseInt(b) + 1 + "px";
                        a.style.height = parseInt(c) + "px";
                        setTimeout(function() {
                            a.style.width = b;
                            a.style.height = c
                        }, 100)
                    }
                    window.canvas = a
                }
                function h(a, b) {
                    for (var c in b)
                        b.hasOwnProperty(c) && (a[c] = b[c]);
                    return a
                }
                function l() {
                    var a = !1
                      , b = navigator.userAgent || navigator.vendor || window.opera;
                    if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0, 4)))
                        a = !0;
                    return a
                }
                function m(a, b) {
                    for (var c = {}, d = a.getProgramParameter(b, a.ACTIVE_UNIFORMS), e, f = 0; f < d; f++)
                        e = a.getActiveUniform(b, f).name.replace("[0]", ""),
                        c[e] = a.getUniformLocation(b, e);
                    return c
                }
                function n(a, b, c, d) {
                    var e = a.createShader(a.VERTEX_SHADER);
                    a.shaderSource(e, b);
                    a.compileShader(e);
                    b = a.createShader(a.FRAGMENT_SHADER);
                    a.shaderSource(b, c);
                    a.compileShader(b);
                    c = a.createProgram();
                    a.attachShader(c, e);
                    a.attachShader(c, b);
                    for (var f in d)
                        a.bindAttribLocation(c, d[f], f);
                    a.linkProgram(c);
                    a.deleteShader(e);
                    a.deleteShader(b);
                    return c
                }
                function r() {
                    if (document.exitFullscreen)
                        document.exitFullscreen();
                    else if (document.webkitExitFullscreen)
                        document.webkitExitFullscreen();
                    else if (document.mozCancelFullScreen)
                        document.mozCancelFullScreen();
                    else if (document.msExitFullscreen)
                        document.msExitFullscreen();
                    else
                        return !1;
                    return !0
                }
                function p(a) {
                    if (O())
                        return !1;
                    if (a.requestFullscreen)
                        a.requestFullscreen();
                    else if (a.webkitRequestFullscreen)
                        a.webkitRequestFullscreen();
                    else if (a.mozRequestFullScreen)
                        a.mozRequestFullScreen();
                    else if (a.msRequestFullscreen)
                        a.msRequestFullscreen();
                    else
                        return !1;
                    return !0
                }
                function w() {
                    return Math.min(window.screen.width, window.screen.height) * window.devicePixelRatio
                }
                function q() {
                    return Math.max(window.screen.width, window.screen.height) * window.devicePixelRatio
                }
                function u() {
                    var a = 90 == window.orientation || -90 == window.orientation;
                    return Z() ? !a : a
                }
                function v(a, b, c, d) {
                    this.gl = a;
                    this.cardboardUI = b;
                    this.bufferScale = c;
                    this.dirtySubmitFrameBindings = d;
                    this.ctxAttribs = a.getContextAttributes();
                    this.instanceExt = a.getExtension("ANGLE_instanced_arrays");
                    this.meshHeight = this.meshWidth = 20;
                    this.bufferWidth = a.drawingBufferWidth;
                    this.bufferHeight = a.drawingBufferHeight;
                    this.realBindFramebuffer = a.bindFramebuffer;
                    this.realEnable = a.enable;
                    this.realDisable = a.disable;
                    this.realColorMask = a.colorMask;
                    this.realClearColor = a.clearColor;
                    this.realViewport = a.viewport;
                    ta() || (this.realCanvasWidth = Object.getOwnPropertyDescriptor(a.canvas.__proto__, "width"),
                    this.realCanvasHeight = Object.getOwnPropertyDescriptor(a.canvas.__proto__, "height"));
                    this.isPatched = !1;
                    this.lastBoundFramebuffer = null;
                    this.stencilTest = this.scissorTest = this.blend = this.depthTest = this.cullFace = !1;
                    this.viewport = [0, 0, 0, 0];
                    this.colorMask = [!0, !0, !0, !0];
                    this.clearColor = [0, 0, 0, 0];
                    this.attribs = {
                        position: 0,
                        texCoord: 1
                    };
                    this.program = n(a, "attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}", "precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}", this.attribs);
                    this.uniforms = m(a, this.program);
                    this.viewportOffsetScale = new Float32Array(8);
                    this.setTextureBounds();
                    this.vertexBuffer = a.createBuffer();
                    this.indexBuffer = a.createBuffer();
                    this.indexCount = 0;
                    this.renderTarget = a.createTexture();
                    this.framebuffer = a.createFramebuffer();
                    this.stencilBuffer = this.depthBuffer = this.depthStencilBuffer = null;
                    this.ctxAttribs.depth && this.ctxAttribs.stencil ? this.depthStencilBuffer = a.createRenderbuffer() : this.ctxAttribs.depth ? this.depthBuffer = a.createRenderbuffer() : this.ctxAttribs.stencil && (this.stencilBuffer = a.createRenderbuffer());
                    this.patch();
                    this.onResize()
                }
                function x(a) {
                    this.gl = a;
                    this.attribs = {
                        position: 0
                    };
                    this.program = n(a, "attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}", "precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}", this.attribs);
                    this.uniforms = m(a, this.program);
                    this.vertexBuffer = a.createBuffer();
                    this.arrowVertexCount = this.arrowOffset = this.gearVertexCount = this.gearOffset = 0;
                    this.projMat = new Float32Array(16);
                    this.listener = null;
                    this.onResize()
                }
                function D(a) {
                    this.coefficients = a
                }
                function y(a) {
                    this.width = a.width || q();
                    this.height = a.height || w();
                    this.widthMeters = a.widthMeters;
                    this.heightMeters = a.heightMeters;
                    this.bevelMeters = a.bevelMeters
                }
                function A(a, b) {
                    this.viewer = Ga.CardboardV2;
                    this.updateDeviceParams(a);
                    this.distortion = new D(this.viewer.distortionCoefficients);
                    for (a = 0; a < b.length; a++) {
                        var c = b[a];
                        Ga[c.id] = new z(c)
                    }
                }
                function z(a) {
                    this.id = a.id;
                    this.label = a.label;
                    this.fov = a.fov;
                    this.interLensDistance = a.interLensDistance;
                    this.baselineLensDistance = a.baselineLensDistance;
                    this.screenLensDistance = a.screenLensDistance;
                    this.distortionCoefficients = a.distortionCoefficients;
                    this.inverseCoefficients = a.inverseCoefficients
                }
                function B(a, b) {
                    this.dpdb = I;
                    this.recalculateDeviceParams_();
                    if (a) {
                        this.onDeviceParamsUpdated = b;
                        var c = new XMLHttpRequest
                          , d = this;
                        c.open("GET", a, !0);
                        c.addEventListener("load", function() {
                            d.loading = !1;
                            200 <= c.status && 299 >= c.status ? (d.dpdb = JSON.parse(c.response),
                            d.recalculateDeviceParams_()) : console.error("Error loading online DPDB!")
                        });
                        c.send()
                    }
                }
                function M(a) {
                    this.xdpi = a.xdpi;
                    this.ydpi = a.ydpi;
                    this.bevelMm = a.bevelMm
                }
                function C(a, b) {
                    this.set(a, b)
                }
                function ma(c, d) {
                    this.kFilter = c;
                    this.isDebug = d;
                    this.currentAccelMeasurement = new C;
                    this.currentGyroMeasurement = new C;
                    this.previousGyroMeasurement = new C;
                    ta() ? this.filterQ = new a(-1,0,0,1) : this.filterQ = new a(1,0,0,1);
                    this.previousFilterQ = new a;
                    this.previousFilterQ.copy(this.filterQ);
                    this.accelQ = new a;
                    this.isOrientationInitialized = !1;
                    this.estimatedGravity = new b;
                    this.measuredGravity = new b;
                    this.gyroIntegralQ = new a
                }
                function F(b, c) {
                    this.predictionTimeS = b;
                    this.isDebug = c;
                    this.previousQ = new a;
                    this.previousTimestampS = null;
                    this.deltaQ = new a;
                    this.outQ = new a
                }
                function Y(c, d, e, f) {
                    this.yawOnly = e;
                    this.accelerometer = new b;
                    this.gyroscope = new b;
                    this.filter = new ma(c,f);
                    this.posePredictor = new F(d,f);
                    this.isFirefoxAndroid = L();
                    this.isIOS = ta();
                    c = la();
                    this.isDeviceMotionInRadians = !this.isIOS && c && 66 > c;
                    this.isWithoutDeviceMotion = U() || V();
                    this.filterToWorldQ = new a;
                    ta() ? this.filterToWorldQ.setFromAxisAngle(new b(1,0,0), Math.PI / 2) : this.filterToWorldQ.setFromAxisAngle(new b(1,0,0), -Math.PI / 2);
                    this.inverseWorldToScreenQ = new a;
                    this.worldToScreenQ = new a;
                    this.originalPoseAdjustQ = new a;
                    this.originalPoseAdjustQ.setFromAxisAngle(new b(0,0,1), -window.orientation * Math.PI / 180);
                    this.setScreenTransform_();
                    u() && this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);
                    this.resetQ = new a;
                    this.orientationOut_ = new Float32Array(4);
                    this.start()
                }
                function N() {
                    this.loadIcon_();
                    var a = document.createElement("div")
                      , b = a.style;
                    b.position = "fixed";
                    b.top = 0;
                    b.right = 0;
                    b.bottom = 0;
                    b.left = 0;
                    b.backgroundColor = "gray";
                    b.fontFamily = "sans-serif";
                    b.zIndex = 1E6;
                    var c = document.createElement("img");
                    c.src = this.icon;
                    b = c.style;
                    b.marginLeft = "25%";
                    b.marginTop = "25%";
                    b.width = "50%";
                    a.appendChild(c);
                    c = document.createElement("div");
                    b = c.style;
                    b.textAlign = "center";
                    b.fontSize = "16px";
                    b.lineHeight = "24px";
                    b.margin = "24px 25%";
                    b.width = "50%";
                    c.innerHTML = "Place your phone into your Cardboard viewer.";
                    a.appendChild(c);
                    var d = document.createElement("div");
                    b = d.style;
                    b.backgroundColor = "#CFD8DC";
                    b.position = "fixed";
                    b.bottom = 0;
                    b.width = "100%";
                    b.height = "48px";
                    b.padding = "14px 24px";
                    b.boxSizing = "border-box";
                    b.color = "#656A6B";
                    a.appendChild(d);
                    var e = document.createElement("div");
                    e.style.float = "left";
                    e.innerHTML = "No Cardboard viewer?";
                    var f = document.createElement("a");
                    f.href = "https://www.google.com/get/cardboard/get-cardboard/";
                    f.innerHTML = "get one";
                    f.target = "_blank";
                    b = f.style;
                    b.float = "right";
                    b.fontWeight = 600;
                    b.textTransform = "uppercase";
                    b.borderLeft = "1px solid gray";
                    b.paddingLeft = "24px";
                    b.textDecoration = "none";
                    b.color = "#656A6B";
                    d.appendChild(e);
                    d.appendChild(f);
                    this.overlay = a;
                    this.text = c;
                    this.hide()
                }
                function W(a) {
                    try {
                        this.selectedKey = localStorage.getItem("WEBVR_CARDBOARD_VIEWER")
                    } catch (mb) {
                        console.error("Failed to load viewer profile: %s", mb)
                    }
                    this.selectedKey || (this.selectedKey = a || "CardboardV1");
                    this.dialog = this.createDialog_(A.Viewers);
                    this.root = null;
                    this.onChangeCallbacks_ = []
                }
                function S(a) {
                    Object.defineProperties(this, {
                        hasPosition: {
                            writable: !1,
                            enumerable: !0,
                            value: a.hasPosition
                        },
                        hasExternalDisplay: {
                            writable: !1,
                            enumerable: !0,
                            value: a.hasExternalDisplay
                        },
                        canPresent: {
                            writable: !1,
                            enumerable: !0,
                            value: a.canPresent
                        },
                        maxLayers: {
                            writable: !1,
                            enumerable: !0,
                            value: a.maxLayers
                        },
                        hasOrientation: {
                            enumerable: !0,
                            get: function() {
                                d("VRDisplayCapabilities.prototype.hasOrientation", "VRDisplay.prototype.getFrameData");
                                return a.hasOrientation
                            }
                        }
                    })
                }
                function E(a) {
                    a = a || {};
                    a = "wakelock"in a ? a.wakelock : !0;
                    this.isPolyfilled = !0;
                    this.displayId = Ta++;
                    this.displayName = "";
                    this.depthNear = .01;
                    this.depthFar = 1E4;
                    this.isPresenting = !1;
                    Object.defineProperty(this, "isConnected", {
                        get: function() {
                            d("VRDisplay.prototype.isConnected", "VRDisplayCapabilities.prototype.hasExternalDisplay");
                            return !1
                        }
                    });
                    this.capabilities = new S({
                        hasPosition: !1,
                        hasOrientation: !1,
                        hasExternalDisplay: !1,
                        canPresent: !1,
                        maxLayers: 1
                    });
                    this.stageParameters = null;
                    this.waitingForPresent_ = !1;
                    this.fullscreenErrorHandler_ = this.fullscreenChangeHandler_ = this.fullscreenEventTarget_ = this.fullscreenElementCachedStyle_ = this.fullscreenWrapper_ = this.fullscreenElement_ = this.originalParent_ = this.layer_ = null;
                    a && l() && (this.wakelock_ = new bb)
                }
                function ca(a) {
                    var b = h({}, Qa);
                    a = h(b, a || {});
                    E.call(this, {
                        wakelock: a.MOBILE_WAKE_LOCK
                    });
                    this.config = a;
                    this.displayName = "Cardboard VRDisplay";
                    this.capabilities = new S({
                        hasPosition: !1,
                        hasOrientation: !0,
                        hasExternalDisplay: !1,
                        canPresent: !0,
                        maxLayers: 1
                    });
                    this.stageParameters = null;
                    this.bufferScale_ = this.config.BUFFER_SCALE;
                    this.poseSensor_ = new ia(this.config);
                    this.cardboardUI_ = this.distorter_ = null;
                    this.dpdb_ = new B(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));
                    this.deviceInfo_ = new A(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS);
                    this.viewerSelector_ = new W(a.DEFAULT_VIEWER);
                    this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));
                    this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
                    this.config.ROTATE_INSTRUCTIONS_DISABLED || (this.rotateInstructions_ = new N);
                    ta() && window.addEventListener("resize", this.onResize_.bind(this))
                }
                var ya = function() {
                    function a(a, b) {
                        for (var c = 0; c < b.length; c++) {
                            var d = b[c];
                            d.enumerable = d.enumerable || !1;
                            d.configurable = !0;
                            "value"in d && (d.writable = !0);
                            Object.defineProperty(a, d.key, d)
                        }
                    }
                    return function(b, c, d) {
                        c && a(b.prototype, c);
                        d && a(b, d);
                        return b
                    }
                }()
                  , H = function() {
                    return function(a, b) {
                        if (Array.isArray(a))
                            return a;
                        k.initSymbol();
                        k.initSymbolIterator();
                        if (Symbol.iterator in Object(a)) {
                            var c = []
                              , d = !0
                              , e = !1
                              , f = void 0;
                            try {
                                k.initSymbol();
                                k.initSymbolIterator();
                                for (var g = a[Symbol.iterator](), h; !(d = (h = g.next()).done) && (c.push(h.value),
                                !b || c.length !== b); d = !0)
                                    ;
                            } catch (fh) {
                                e = !0,
                                f = fh
                            } finally {
                                try {
                                    if (!d && g["return"])
                                        g["return"]()
                                } finally {
                                    if (e)
                                        throw f;
                                }
                            }
                            return c
                        }
                        throw new TypeError("Invalid attempt to destructure non-iterable instance");
                    }
                }()
                  , ta = function() {
                    var a = /iPad|iPhone|iPod/.test(navigator.platform);
                    return function() {
                        return a
                    }
                }()
                  , O = function() {
                    var a = -1 !== navigator.userAgent.indexOf("Version") && -1 !== navigator.userAgent.indexOf("Android") && -1 !== navigator.userAgent.indexOf("Chrome");
                    return function() {
                        return a
                    }
                }()
                  , ba = function() {
                    var a = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
                    return function() {
                        return a
                    }
                }()
                  , L = function() {
                    var a = -1 !== navigator.userAgent.indexOf("Firefox") && -1 !== navigator.userAgent.indexOf("Android");
                    return function() {
                        return a
                    }
                }()
                  , la = function() {
                    var a = navigator.userAgent.match(/.*Chrome\/([0-9]+)/)
                      , b = a ? parseInt(a[1], 10) : null;
                    return function() {
                        return b
                    }
                }()
                  , V = function() {
                    var a = !1;
                    a = ta() && ba() && -1 !== navigator.userAgent.indexOf("13_4");
                    return function() {
                        return a
                    }
                }()
                  , U = function() {
                    var a = !1;
                    if (65 === la()) {
                        var b = navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);
                        if (b) {
                            b = b[1].split(".");
                            b = H(b, 4);
                            var c = b[3];
                            a = 3325 === parseInt(b[2], 10) && 148 > parseInt(c, 10)
                        }
                    }
                    return function() {
                        return a
                    }
                }()
                  , Z = function() {
                    var a = -1 !== navigator.userAgent.indexOf("R7 Build");
                    return function() {
                        return a
                    }
                }()
                  , G = function() {
                    function a(a, f, g, h, l, m) {
                        var n = h || null;
                        h = m.depthNear;
                        m = m.depthFar;
                        var r = Math.tan(n ? n.upDegrees * b : c)
                          , p = Math.tan(n ? n.downDegrees * b : c)
                          , w = Math.tan(n ? n.leftDegrees * b : c);
                        n = Math.tan(n ? n.rightDegrees * b : c);
                        var q = 2 / (w + n)
                          , u = 2 / (r + p);
                        a[0] = q;
                        a[1] = 0;
                        a[2] = 0;
                        a[3] = 0;
                        a[4] = 0;
                        a[5] = u;
                        a[6] = 0;
                        a[7] = 0;
                        a[8] = -((w - n) * q * .5);
                        a[9] = (r - p) * u * .5;
                        a[10] = m / (h - m);
                        a[11] = -1;
                        a[12] = 0;
                        a[13] = 0;
                        a[14] = m * h / (h - m);
                        a[15] = 0;
                        a = g.orientation || d;
                        g = g.position || e;
                        p = a[0];
                        q = a[1];
                        u = a[2];
                        m = a[3];
                        var v = p + p;
                        n = q + q;
                        r = u + u;
                        a = p * v;
                        h = p * n;
                        p *= r;
                        w = q * n;
                        q *= r;
                        u *= r;
                        v *= m;
                        n *= m;
                        m *= r;
                        f[0] = 1 - (w + u);
                        f[1] = h + m;
                        f[2] = p - n;
                        f[3] = 0;
                        f[4] = h - m;
                        f[5] = 1 - (a + u);
                        f[6] = q + v;
                        f[7] = 0;
                        f[8] = p + n;
                        f[9] = q - v;
                        f[10] = 1 - (a + w);
                        f[11] = 0;
                        f[12] = g[0];
                        f[13] = g[1];
                        f[14] = g[2];
                        f[15] = 1;
                        if (l)
                            if (g = l[0],
                            a = l[1],
                            l = l[2],
                            f === f)
                                f[12] = f[0] * g + f[4] * a + f[8] * l + f[12],
                                f[13] = f[1] * g + f[5] * a + f[9] * l + f[13],
                                f[14] = f[2] * g + f[6] * a + f[10] * l + f[14],
                                f[15] = f[3] * g + f[7] * a + f[11] * l + f[15];
                            else {
                                h = f[0];
                                m = f[1];
                                r = f[2];
                                p = f[3];
                                w = f[4];
                                n = f[5];
                                q = f[6];
                                u = f[7];
                                v = f[8];
                                var lb = f[9];
                                var x = f[10];
                                var mb = f[11];
                                f[0] = h;
                                f[1] = m;
                                f[2] = r;
                                f[3] = p;
                                f[4] = w;
                                f[5] = n;
                                f[6] = q;
                                f[7] = u;
                                f[8] = v;
                                f[9] = lb;
                                f[10] = x;
                                f[11] = mb;
                                f[12] = h * g + w * a + v * l + f[12];
                                f[13] = m * g + n * a + lb * l + f[13];
                                f[14] = r * g + q * a + x * l + f[14];
                                f[15] = p * g + u * a + mb * l + f[15]
                            }
                        l = f[0];
                        g = f[1];
                        a = f[2];
                        h = f[3];
                        m = f[4];
                        r = f[5];
                        p = f[6];
                        w = f[7];
                        n = f[8];
                        q = f[9];
                        u = f[10];
                        v = f[11];
                        lb = f[12];
                        x = f[13];
                        mb = f[14];
                        var D = f[15]
                          , y = l * r - g * m
                          , xb = l * p - a * m
                          , A = l * w - h * m
                          , z = g * p - a * r
                          , B = g * w - h * r
                          , M = a * w - h * p
                          , C = n * x - q * lb
                          , ma = n * mb - u * lb
                          , Y = n * D - v * lb
                          , F = q * mb - u * x
                          , E = q * D - v * x
                          , N = u * D - v * mb
                          , W = y * N - xb * E + A * F + z * Y - B * ma + M * C;
                        W && (W = 1 / W,
                        f[0] = (r * N - p * E + w * F) * W,
                        f[1] = (a * E - g * N - h * F) * W,
                        f[2] = (x * M - mb * B + D * z) * W,
                        f[3] = (u * B - q * M - v * z) * W,
                        f[4] = (p * Y - m * N - w * ma) * W,
                        f[5] = (l * N - a * Y + h * ma) * W,
                        f[6] = (mb * A - lb * M - D * xb) * W,
                        f[7] = (n * M - u * A + v * xb) * W,
                        f[8] = (m * E - r * Y + w * C) * W,
                        f[9] = (g * Y - l * E - h * C) * W,
                        f[10] = (lb * B - x * A + D * y) * W,
                        f[11] = (q * A - n * B - v * y) * W,
                        f[12] = (r * ma - m * F - p * C) * W,
                        f[13] = (l * F - g * ma + a * C) * W,
                        f[14] = (x * xb - lb * z - mb * y) * W,
                        f[15] = (n * z - q * xb + u * y) * W)
                    }
                    var b = Math.PI / 180
                      , c = .25 * Math.PI
                      , d = new Float32Array([0, 0, 0, 1])
                      , e = new Float32Array([0, 0, 0]);
                    return function(b, c, d) {
                        if (!b || !c)
                            return !1;
                        b.pose = c;
                        b.timestamp = c.timestamp;
                        a(b.leftProjectionMatrix, b.leftViewMatrix, c, d._getFieldOfView("left"), d._getEyeOffset("left"), d);
                        a(b.rightProjectionMatrix, b.rightViewMatrix, c, d._getFieldOfView("right"), d._getEyeOffset("right"), d);
                        return !0
                    }
                }()
                  , K = function() {
                    var a = {};
                    return function(b, c) {
                        void 0 === a[b] && (console.warn("webvr-polyfill: " + c),
                        a[b] = !0)
                    }
                }();
                v.prototype.destroy = function() {
                    var a = this.gl;
                    this.unpatch();
                    a.deleteProgram(this.program);
                    a.deleteBuffer(this.vertexBuffer);
                    a.deleteBuffer(this.indexBuffer);
                    a.deleteTexture(this.renderTarget);
                    a.deleteFramebuffer(this.framebuffer);
                    this.depthStencilBuffer && a.deleteRenderbuffer(this.depthStencilBuffer);
                    this.depthBuffer && a.deleteRenderbuffer(this.depthBuffer);
                    this.stencilBuffer && a.deleteRenderbuffer(this.stencilBuffer);
                    this.cardboardUI && this.cardboardUI.destroy()
                }
                ;
                v.prototype.onResize = function() {
                    var a = this.gl
                      , b = this;
                    c(a, [a.RENDERBUFFER_BINDING, a.TEXTURE_BINDING_2D, a.TEXTURE0], function(a) {
                        b.realBindFramebuffer.call(a, a.FRAMEBUFFER, null);
                        b.scissorTest && b.realDisable.call(a, a.SCISSOR_TEST);
                        b.realColorMask.call(a, !0, !0, !0, !0);
                        b.realViewport.call(a, 0, 0, a.drawingBufferWidth, a.drawingBufferHeight);
                        b.realClearColor.call(a, 0, 0, 0, 1);
                        a.clear(a.COLOR_BUFFER_BIT);
                        b.realBindFramebuffer.call(a, a.FRAMEBUFFER, b.framebuffer);
                        a.bindTexture(a.TEXTURE_2D, b.renderTarget);
                        a.texImage2D(a.TEXTURE_2D, 0, b.ctxAttribs.alpha ? a.RGBA : a.RGB, b.bufferWidth, b.bufferHeight, 0, b.ctxAttribs.alpha ? a.RGBA : a.RGB, a.UNSIGNED_BYTE, null);
                        a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MAG_FILTER, a.LINEAR);
                        a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MIN_FILTER, a.LINEAR);
                        a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_S, a.CLAMP_TO_EDGE);
                        a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_T, a.CLAMP_TO_EDGE);
                        a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_2D, b.renderTarget, 0);
                        b.ctxAttribs.depth && b.ctxAttribs.stencil ? (a.bindRenderbuffer(a.RENDERBUFFER, b.depthStencilBuffer),
                        a.renderbufferStorage(a.RENDERBUFFER, a.DEPTH_STENCIL, b.bufferWidth, b.bufferHeight),
                        a.framebufferRenderbuffer(a.FRAMEBUFFER, a.DEPTH_STENCIL_ATTACHMENT, a.RENDERBUFFER, b.depthStencilBuffer)) : b.ctxAttribs.depth ? (a.bindRenderbuffer(a.RENDERBUFFER, b.depthBuffer),
                        a.renderbufferStorage(a.RENDERBUFFER, a.DEPTH_COMPONENT16, b.bufferWidth, b.bufferHeight),
                        a.framebufferRenderbuffer(a.FRAMEBUFFER, a.DEPTH_ATTACHMENT, a.RENDERBUFFER, b.depthBuffer)) : b.ctxAttribs.stencil && (a.bindRenderbuffer(a.RENDERBUFFER, b.stencilBuffer),
                        a.renderbufferStorage(a.RENDERBUFFER, a.STENCIL_INDEX8, b.bufferWidth, b.bufferHeight),
                        a.framebufferRenderbuffer(a.FRAMEBUFFER, a.STENCIL_ATTACHMENT, a.RENDERBUFFER, b.stencilBuffer));
                        !a.checkFramebufferStatus(a.FRAMEBUFFER) === a.FRAMEBUFFER_COMPLETE && console.error("Framebuffer incomplete!");
                        b.realBindFramebuffer.call(a, a.FRAMEBUFFER, b.lastBoundFramebuffer);
                        b.scissorTest && b.realEnable.call(a, a.SCISSOR_TEST);
                        b.realColorMask.apply(a, b.colorMask);
                        b.realViewport.apply(a, b.viewport);
                        b.realClearColor.apply(a, b.clearColor)
                    });
                    if (this.cardboardUI)
                        this.cardboardUI.onResize()
                }
                ;
                v.prototype.patch = function() {
                    if (!this.isPatched) {
                        var a = this
                          , b = this.gl.canvas
                          , c = this.gl;
                        ta() || (b.width = q() * this.bufferScale,
                        b.height = w() * this.bufferScale,
                        Object.defineProperty(b, "width", {
                            configurable: !0,
                            enumerable: !0,
                            get: function() {
                                return a.bufferWidth
                            },
                            set: function(c) {
                                a.bufferWidth = c;
                                a.realCanvasWidth.set.call(b, c);
                                a.onResize()
                            }
                        }),
                        Object.defineProperty(b, "height", {
                            configurable: !0,
                            enumerable: !0,
                            get: function() {
                                return a.bufferHeight
                            },
                            set: function(c) {
                                a.bufferHeight = c;
                                a.realCanvasHeight.set.call(b, c);
                                a.onResize()
                            }
                        }));
                        this.lastBoundFramebuffer = c.getParameter(c.FRAMEBUFFER_BINDING);
                        null == this.lastBoundFramebuffer && (this.lastBoundFramebuffer = this.framebuffer,
                        this.gl.bindFramebuffer(c.FRAMEBUFFER, this.framebuffer));
                        this.gl.bindFramebuffer = function(b, d) {
                            a.lastBoundFramebuffer = d ? d : a.framebuffer;
                            a.realBindFramebuffer.call(c, b, a.lastBoundFramebuffer)
                        }
                        ;
                        this.cullFace = c.getParameter(c.CULL_FACE);
                        this.depthTest = c.getParameter(c.DEPTH_TEST);
                        this.blend = c.getParameter(c.BLEND);
                        this.scissorTest = c.getParameter(c.SCISSOR_TEST);
                        this.stencilTest = c.getParameter(c.STENCIL_TEST);
                        c.enable = function(b) {
                            switch (b) {
                            case c.CULL_FACE:
                                a.cullFace = !0;
                                break;
                            case c.DEPTH_TEST:
                                a.depthTest = !0;
                                break;
                            case c.BLEND:
                                a.blend = !0;
                                break;
                            case c.SCISSOR_TEST:
                                a.scissorTest = !0;
                                break;
                            case c.STENCIL_TEST:
                                a.stencilTest = !0
                            }
                            a.realEnable.call(c, b)
                        }
                        ;
                        c.disable = function(b) {
                            switch (b) {
                            case c.CULL_FACE:
                                a.cullFace = !1;
                                break;
                            case c.DEPTH_TEST:
                                a.depthTest = !1;
                                break;
                            case c.BLEND:
                                a.blend = !1;
                                break;
                            case c.SCISSOR_TEST:
                                a.scissorTest = !1;
                                break;
                            case c.STENCIL_TEST:
                                a.stencilTest = !1
                            }
                            a.realDisable.call(c, b)
                        }
                        ;
                        this.colorMask = c.getParameter(c.COLOR_WRITEMASK);
                        c.colorMask = function(b, d, e, f) {
                            a.colorMask[0] = b;
                            a.colorMask[1] = d;
                            a.colorMask[2] = e;
                            a.colorMask[3] = f;
                            a.realColorMask.call(c, b, d, e, f)
                        }
                        ;
                        this.clearColor = c.getParameter(c.COLOR_CLEAR_VALUE);
                        c.clearColor = function(b, d, e, f) {
                            a.clearColor[0] = b;
                            a.clearColor[1] = d;
                            a.clearColor[2] = e;
                            a.clearColor[3] = f;
                            a.realClearColor.call(c, b, d, e, f)
                        }
                        ;
                        this.viewport = c.getParameter(c.VIEWPORT);
                        c.viewport = function(b, d, e, f) {
                            a.viewport[0] = b;
                            a.viewport[1] = d;
                            a.viewport[2] = e;
                            a.viewport[3] = f;
                            a.realViewport.call(c, b, d, e, f)
                        }
                        ;
                        this.isPatched = !0;
                        g(b)
                    }
                }
                ;
                v.prototype.unpatch = function() {
                    if (this.isPatched) {
                        var a = this.gl
                          , b = this.gl.canvas;
                        ta() || (Object.defineProperty(b, "width", this.realCanvasWidth),
                        Object.defineProperty(b, "height", this.realCanvasHeight));
                        b.width = this.bufferWidth;
                        b.height = this.bufferHeight;
                        a.bindFramebuffer = this.realBindFramebuffer;
                        a.enable = this.realEnable;
                        a.disable = this.realDisable;
                        a.colorMask = this.realColorMask;
                        a.clearColor = this.realClearColor;
                        a.viewport = this.realViewport;
                        this.lastBoundFramebuffer == this.framebuffer && a.bindFramebuffer(a.FRAMEBUFFER, null);
                        this.isPatched = !1;
                        setTimeout(function() {
                            g(b)
                        }, 1)
                    }
                }
                ;
                v.prototype.setTextureBounds = function(a, b) {
                    a || (a = [0, 0, .5, 1]);
                    b || (b = [.5, 0, .5, 1]);
                    this.viewportOffsetScale[0] = a[0];
                    this.viewportOffsetScale[1] = a[1];
                    this.viewportOffsetScale[2] = a[2];
                    this.viewportOffsetScale[3] = a[3];
                    this.viewportOffsetScale[4] = b[0];
                    this.viewportOffsetScale[5] = b[1];
                    this.viewportOffsetScale[6] = b[2];
                    this.viewportOffsetScale[7] = b[3]
                }
                ;
                v.prototype.submitFrame = function() {
                    var a = this.gl
                      , b = this
                      , d = [];
                    this.dirtySubmitFrameBindings || d.push(a.CURRENT_PROGRAM, a.ARRAY_BUFFER_BINDING, a.ELEMENT_ARRAY_BUFFER_BINDING, a.TEXTURE_BINDING_2D, a.TEXTURE0);
                    c(a, d, function(a) {
                        b.realBindFramebuffer.call(a, a.FRAMEBUFFER, null);
                        var c = 0
                          , d = 0;
                        b.instanceExt && (c = a.getVertexAttrib(b.attribs.position, b.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),
                        d = a.getVertexAttrib(b.attribs.texCoord, b.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));
                        b.cullFace && b.realDisable.call(a, a.CULL_FACE);
                        b.depthTest && b.realDisable.call(a, a.DEPTH_TEST);
                        b.blend && b.realDisable.call(a, a.BLEND);
                        b.scissorTest && b.realDisable.call(a, a.SCISSOR_TEST);
                        b.stencilTest && b.realDisable.call(a, a.STENCIL_TEST);
                        b.realColorMask.call(a, !0, !0, !0, !0);
                        b.realViewport.call(a, 0, 0, a.drawingBufferWidth, a.drawingBufferHeight);
                        if (b.ctxAttribs.alpha || ta())
                            b.realClearColor.call(a, 0, 0, 0, 1),
                            a.clear(a.COLOR_BUFFER_BIT);
                        a.useProgram(b.program);
                        a.bindBuffer(a.ELEMENT_ARRAY_BUFFER, b.indexBuffer);
                        a.bindBuffer(a.ARRAY_BUFFER, b.vertexBuffer);
                        a.enableVertexAttribArray(b.attribs.position);
                        a.enableVertexAttribArray(b.attribs.texCoord);
                        a.vertexAttribPointer(b.attribs.position, 2, a.FLOAT, !1, 20, 0);
                        a.vertexAttribPointer(b.attribs.texCoord, 3, a.FLOAT, !1, 20, 8);
                        b.instanceExt && (0 != c && b.instanceExt.vertexAttribDivisorANGLE(b.attribs.position, 0),
                        0 != d && b.instanceExt.vertexAttribDivisorANGLE(b.attribs.texCoord, 0));
                        a.activeTexture(a.TEXTURE0);
                        a.uniform1i(b.uniforms.diffuse, 0);
                        a.bindTexture(a.TEXTURE_2D, b.renderTarget);
                        a.uniform4fv(b.uniforms.viewportOffsetScale, b.viewportOffsetScale);
                        a.drawElements(a.TRIANGLES, b.indexCount, a.UNSIGNED_SHORT, 0);
                        b.cardboardUI && b.cardboardUI.renderNoState();
                        b.realBindFramebuffer.call(b.gl, a.FRAMEBUFFER, b.framebuffer);
                        b.ctxAttribs.preserveDrawingBuffer || (b.realClearColor.call(a, 0, 0, 0, 0),
                        a.clear(a.COLOR_BUFFER_BIT));
                        b.dirtySubmitFrameBindings || b.realBindFramebuffer.call(a, a.FRAMEBUFFER, b.lastBoundFramebuffer);
                        b.cullFace && b.realEnable.call(a, a.CULL_FACE);
                        b.depthTest && b.realEnable.call(a, a.DEPTH_TEST);
                        b.blend && b.realEnable.call(a, a.BLEND);
                        b.scissorTest && b.realEnable.call(a, a.SCISSOR_TEST);
                        b.stencilTest && b.realEnable.call(a, a.STENCIL_TEST);
                        b.realColorMask.apply(a, b.colorMask);
                        b.realViewport.apply(a, b.viewport);
                        !b.ctxAttribs.alpha && b.ctxAttribs.preserveDrawingBuffer || b.realClearColor.apply(a, b.clearColor);
                        b.instanceExt && (0 != c && b.instanceExt.vertexAttribDivisorANGLE(b.attribs.position, c),
                        0 != d && b.instanceExt.vertexAttribDivisorANGLE(b.attribs.texCoord, d))
                    });
                    ta() && (a = a.canvas,
                    a.width != b.bufferWidth || a.height != b.bufferHeight) && (b.bufferWidth = a.width,
                    b.bufferHeight = a.height,
                    b.onResize())
                }
                ;
                v.prototype.updateDeviceInfo = function(a) {
                    var b = this.gl
                      , d = this;
                    c(b, [b.ARRAY_BUFFER_BINDING, b.ELEMENT_ARRAY_BUFFER_BINDING], function(b) {
                        var c = d.computeMeshVertices_(d.meshWidth, d.meshHeight, a);
                        b.bindBuffer(b.ARRAY_BUFFER, d.vertexBuffer);
                        b.bufferData(b.ARRAY_BUFFER, c, b.STATIC_DRAW);
                        d.indexCount || (c = d.computeMeshIndices_(d.meshWidth, d.meshHeight),
                        b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, d.indexBuffer),
                        b.bufferData(b.ELEMENT_ARRAY_BUFFER, c, b.STATIC_DRAW),
                        d.indexCount = c.length)
                    })
                }
                ;
                v.prototype.computeMeshVertices_ = function(a, b, c) {
                    for (var d = new Float32Array(2 * a * b * 5), e = c.getLeftEyeVisibleTanAngles(), f = c.getLeftEyeNoLensTanAngles(), g = c.getLeftEyeVisibleScreenRect(f), h = 0, l = 0; 2 > l; l++) {
                        for (var m = 0; m < b; m++)
                            for (var n = 0; n < a; n++,
                            h++) {
                                var r = n / (a - 1)
                                  , p = m / (b - 1)
                                  , w = r
                                  , q = p
                                  , u = e[0];
                                r = u + (e[2] - u) * r;
                                u = e[3];
                                var v = u + (e[1] - u) * p;
                                p = Math.sqrt(r * r + v * v);
                                u = c.distortion.distortInverse(p);
                                v = v * u / p;
                                r = (r * u / p - f[0]) / (f[2] - f[0]);
                                p = (v - f[3]) / (f[1] - f[3]);
                                r = 2 * (g.x + r * g.width - .5);
                                p = 2 * (g.y + p * g.height - .5);
                                d[5 * h] = r;
                                d[5 * h + 1] = p;
                                d[5 * h + 2] = w;
                                d[5 * h + 3] = q;
                                d[5 * h + 4] = l
                            }
                        m = e[2] - e[0];
                        e[0] = -(m + e[0]);
                        e[2] = m - e[2];
                        m = f[2] - f[0];
                        f[0] = -(m + f[0]);
                        f[2] = m - f[2];
                        g.x = 1 - (g.x + g.width)
                    }
                    return d
                }
                ;
                v.prototype.computeMeshIndices_ = function(a, b) {
                    for (var c = new Uint16Array(2 * (a - 1) * (b - 1) * 6), d = a / 2, e = b / 2, f = 0, g = 0, h = 0; 2 > h; h++)
                        for (var l = 0; l < b; l++)
                            for (var m = 0; m < a; m++,
                            f++)
                                0 != m && 0 != l && (m <= d == l <= e ? (c[g++] = f,
                                c[g++] = f - a - 1,
                                c[g++] = f - a,
                                c[g++] = f - a - 1,
                                c[g++] = f,
                                c[g++] = f - 1) : (c[g++] = f - 1,
                                c[g++] = f - a,
                                c[g++] = f,
                                c[g++] = f - a,
                                c[g++] = f - 1,
                                c[g++] = f - a - 1));
                    return c
                }
                ;
                v.prototype.getOwnPropertyDescriptor_ = function(a, b) {
                    a = Object.getOwnPropertyDescriptor(a, b);
                    if (void 0 === a.get || void 0 === a.set)
                        a.configurable = !0,
                        a.enumerable = !0,
                        a.get = function() {
                            return this.getAttribute(b)
                        }
                        ,
                        a.set = function(a) {
                            this.setAttribute(b, a)
                        }
                        ;
                    return a
                }
                ;
                var R = Math.PI / 180;
                x.prototype.destroy = function() {
                    var a = this.gl;
                    this.listener && a.canvas.removeEventListener("click", this.listener, !1);
                    a.deleteProgram(this.program);
                    a.deleteBuffer(this.vertexBuffer)
                }
                ;
                x.prototype.listen = function(a, b) {
                    var c = this.gl.canvas;
                    this.listener = function(d) {
                        var e = c.clientWidth / 2
                          , f = d.touches ? d.touches[0].clientX : d.clientX
                          , g = d.touches ? d.touches[0].clientY : d.clientY;
                        f > e - 42 && f < e + 42 && g > c.clientHeight - 42 ? a(d) : 42 > f && 42 > g && b(d)
                    }
                    ;
                    c.addEventListener("click", this.listener, !1);
                    c.addEventListener("touchstart", this.listener, !1)
                }
                ;
                x.prototype.onResize = function() {
                    var a = this.gl
                      , b = this;
                    c(a, [a.ARRAY_BUFFER_BINDING], function(a) {
                        function c(a, b) {
                            var c = (90 - a) * R;
                            a = Math.cos(c);
                            c = Math.sin(c);
                            e.push(.3125 * a * m + f, .3125 * c * m + m);
                            e.push(b * a * m + f, b * c * m + m)
                        }
                        function d(b, c) {
                            e.push(n + b, a.drawingBufferHeight - n - c)
                        }
                        var e = []
                          , f = a.drawingBufferWidth / 2
                          , g = a.drawingBufferWidth / (Math.max(screen.width, screen.height) * window.devicePixelRatio) * window.devicePixelRatio
                          , h = 4 * g / 2
                          , l = 42 * g
                          , m = 28 * g / 2
                          , n = 14 * g;
                        e.push(f - h, l);
                        e.push(f - h, a.drawingBufferHeight);
                        e.push(f + h, l);
                        e.push(f + h, a.drawingBufferHeight);
                        b.gearOffset = e.length / 2;
                        for (l = 0; 6 >= l; l++) {
                            var r = 60 * l;
                            c(r, 1);
                            c(r + 12, 1);
                            c(r + 20, .75);
                            c(r + 40, .75);
                            c(r + 48, 1)
                        }
                        b.gearVertexCount = e.length / 2 - b.gearOffset;
                        b.arrowOffset = e.length / 2;
                        l = h / Math.sin(45 * R);
                        d(0, m);
                        d(m, 0);
                        d(m + l, l);
                        d(l, m + l);
                        d(l, m - l);
                        d(0, m);
                        d(m, 2 * m);
                        d(m + l, 2 * m - l);
                        d(l, m - l);
                        d(0, m);
                        d(l, m - h);
                        d(28 * g, m - h);
                        d(l, m + h);
                        d(28 * g, m + h);
                        b.arrowVertexCount = e.length / 2 - b.arrowOffset;
                        a.bindBuffer(a.ARRAY_BUFFER, b.vertexBuffer);
                        a.bufferData(a.ARRAY_BUFFER, new Float32Array(e), a.STATIC_DRAW)
                    })
                }
                ;
                x.prototype.render = function() {
                    var a = this.gl
                      , b = this;
                    c(a, [a.CULL_FACE, a.DEPTH_TEST, a.BLEND, a.SCISSOR_TEST, a.STENCIL_TEST, a.COLOR_WRITEMASK, a.VIEWPORT, a.CURRENT_PROGRAM, a.ARRAY_BUFFER_BINDING], function(a) {
                        a.disable(a.CULL_FACE);
                        a.disable(a.DEPTH_TEST);
                        a.disable(a.BLEND);
                        a.disable(a.SCISSOR_TEST);
                        a.disable(a.STENCIL_TEST);
                        a.colorMask(!0, !0, !0, !0);
                        a.viewport(0, 0, a.drawingBufferWidth, a.drawingBufferHeight);
                        b.renderNoState()
                    })
                }
                ;
                x.prototype.renderNoState = function() {
                    var a = this.gl;
                    a.useProgram(this.program);
                    a.bindBuffer(a.ARRAY_BUFFER, this.vertexBuffer);
                    a.enableVertexAttribArray(this.attribs.position);
                    a.vertexAttribPointer(this.attribs.position, 2, a.FLOAT, !1, 8, 0);
                    a.uniform4f(this.uniforms.color, 1, 1, 1, 1);
                    var b = this.projMat
                      , c = a.drawingBufferWidth
                      , d = a.drawingBufferHeight
                      , e = 1 / (0 - c)
                      , f = 1 / (0 - d)
                      , g = 1 / -1023.9;
                    b[0] = -2 * e;
                    b[1] = 0;
                    b[2] = 0;
                    b[3] = 0;
                    b[4] = 0;
                    b[5] = -2 * f;
                    b[6] = 0;
                    b[7] = 0;
                    b[8] = 0;
                    b[9] = 0;
                    b[10] = 2 * g;
                    b[11] = 0;
                    b[12] = (0 + c) * e;
                    b[13] = (d + 0) * f;
                    b[14] = 1024.1 * g;
                    b[15] = 1;
                    a.uniformMatrix4fv(this.uniforms.projectionMat, !1, this.projMat);
                    a.drawArrays(a.TRIANGLE_STRIP, 0, 4);
                    a.drawArrays(a.TRIANGLE_STRIP, this.gearOffset, this.gearVertexCount);
                    a.drawArrays(a.TRIANGLE_STRIP, this.arrowOffset, this.arrowVertexCount)
                }
                ;
                D.prototype.distortInverse = function(a) {
                    for (var b = 0, c = 1, d = a - this.distort(b); 1E-4 < Math.abs(c - b); ) {
                        var e = a - this.distort(c);
                        d = c - (c - b) / (e - d) * e;
                        b = c;
                        c = d;
                        d = e
                    }
                    return c
                }
                ;
                D.prototype.distort = function(a) {
                    for (var b = a * a, c = 0, d = 0; d < this.coefficients.length; d++)
                        c = b * (c + this.coefficients[d]);
                    return (c + 1) * a
                }
                ;
                var ka = Math.PI / 180
                  , Ia = 180 / Math.PI;
                b.prototype = {
                    constructor: b,
                    set: function(a, b, c) {
                        this.x = a;
                        this.y = b;
                        this.z = c;
                        return this
                    },
                    copy: function(a) {
                        this.x = a.x;
                        this.y = a.y;
                        this.z = a.z;
                        return this
                    },
                    length: function() {
                        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
                    },
                    normalize: function() {
                        var a = this.length();
                        0 !== a ? this.multiplyScalar(1 / a) : this.z = this.y = this.x = 0;
                        return this
                    },
                    multiplyScalar: function(a) {
                        this.x *= a;
                        this.y *= a;
                        this.z *= a
                    },
                    applyQuaternion: function(a) {
                        var b = this.x
                          , c = this.y
                          , d = this.z
                          , e = a.x
                          , f = a.y
                          , g = a.z;
                        a = a.w;
                        var h = a * b + f * d - g * c
                          , l = a * c + g * b - e * d
                          , m = a * d + e * c - f * b;
                        b = -e * b - f * c - g * d;
                        this.x = h * a + b * -e + l * -g - m * -f;
                        this.y = l * a + b * -f + m * -e - h * -g;
                        this.z = m * a + b * -g + h * -f - l * -e;
                        return this
                    },
                    dot: function(a) {
                        return this.x * a.x + this.y * a.y + this.z * a.z
                    },
                    crossVectors: function(a, b) {
                        var c = a.x
                          , d = a.y;
                        a = a.z;
                        var e = b.x
                          , f = b.y;
                        b = b.z;
                        this.x = d * b - a * f;
                        this.y = a * e - c * b;
                        this.z = c * f - d * e;
                        return this
                    }
                };
                a.prototype = {
                    constructor: a,
                    set: function(a, b, c, d) {
                        this.x = a;
                        this.y = b;
                        this.z = c;
                        this.w = d;
                        return this
                    },
                    copy: function(a) {
                        this.x = a.x;
                        this.y = a.y;
                        this.z = a.z;
                        this.w = a.w;
                        return this
                    },
                    setFromEulerXYZ: function(a, b, c) {
                        var d = Math.cos(a / 2)
                          , e = Math.cos(b / 2)
                          , f = Math.cos(c / 2);
                        a = Math.sin(a / 2);
                        b = Math.sin(b / 2);
                        c = Math.sin(c / 2);
                        this.x = a * e * f + d * b * c;
                        this.y = d * b * f - a * e * c;
                        this.z = d * e * c + a * b * f;
                        this.w = d * e * f - a * b * c;
                        return this
                    },
                    setFromEulerYXZ: function(a, b, c) {
                        var d = Math.cos(a / 2)
                          , e = Math.cos(b / 2)
                          , f = Math.cos(c / 2);
                        a = Math.sin(a / 2);
                        b = Math.sin(b / 2);
                        c = Math.sin(c / 2);
                        this.x = a * e * f + d * b * c;
                        this.y = d * b * f - a * e * c;
                        this.z = d * e * c - a * b * f;
                        this.w = d * e * f + a * b * c;
                        return this
                    },
                    setFromAxisAngle: function(a, b) {
                        b /= 2;
                        var c = Math.sin(b);
                        this.x = a.x * c;
                        this.y = a.y * c;
                        this.z = a.z * c;
                        this.w = Math.cos(b);
                        return this
                    },
                    multiply: function(a) {
                        return this.multiplyQuaternions(this, a)
                    },
                    multiplyQuaternions: function(a, b) {
                        var c = a.x
                          , d = a.y
                          , e = a.z;
                        a = a.w;
                        var f = b.x
                          , g = b.y
                          , h = b.z;
                        b = b.w;
                        this.x = c * b + a * f + d * h - e * g;
                        this.y = d * b + a * g + e * f - c * h;
                        this.z = e * b + a * h + c * g - d * f;
                        this.w = a * b - c * f - d * g - e * h;
                        return this
                    },
                    inverse: function() {
                        this.x *= -1;
                        this.y *= -1;
                        this.z *= -1;
                        this.normalize();
                        return this
                    },
                    normalize: function() {
                        var a = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
                        0 === a ? (this.z = this.y = this.x = 0,
                        this.w = 1) : (a = 1 / a,
                        this.x *= a,
                        this.y *= a,
                        this.z *= a,
                        this.w *= a);
                        return this
                    },
                    slerp: function(a, b) {
                        if (0 === b)
                            return this;
                        if (1 === b)
                            return this.copy(a);
                        var c = this.x
                          , d = this.y
                          , e = this.z
                          , f = this.w
                          , g = f * a.w + c * a.x + d * a.y + e * a.z;
                        0 > g ? (this.w = -a.w,
                        this.x = -a.x,
                        this.y = -a.y,
                        this.z = -a.z,
                        g = -g) : this.copy(a);
                        if (1 <= g)
                            return this.w = f,
                            this.x = c,
                            this.y = d,
                            this.z = e,
                            this;
                        a = Math.acos(g);
                        var h = Math.sqrt(1 - g * g);
                        if (.001 > Math.abs(h))
                            return this.w = .5 * (f + this.w),
                            this.x = .5 * (c + this.x),
                            this.y = .5 * (d + this.y),
                            this.z = .5 * (e + this.z),
                            this;
                        g = Math.sin((1 - b) * a) / h;
                        b = Math.sin(b * a) / h;
                        this.w = f * g + this.w * b;
                        this.x = c * g + this.x * b;
                        this.y = d * g + this.y * b;
                        this.z = e * g + this.z * b;
                        return this
                    },
                    setFromUnitVectors: function() {
                        var a, c;
                        return function(d, e) {
                            void 0 === a && (a = new b);
                            c = d.dot(e) + 1;
                            1E-6 > c ? (c = 0,
                            Math.abs(d.x) > Math.abs(d.z) ? a.set(-d.y, d.x, 0) : a.set(0, -d.z, d.y)) : a.crossVectors(d, e);
                            this.x = a.x;
                            this.y = a.y;
                            this.z = a.z;
                            this.w = c;
                            this.normalize();
                            return this
                        }
                    }()
                };
                var da = new y({
                    widthMeters: .11,
                    heightMeters: .062,
                    bevelMeters: .004
                })
                  , va = new y({
                    widthMeters: .1038,
                    heightMeters: .0584,
                    bevelMeters: .004
                })
                  , Ga = {
                    CardboardV1: new z({
                        id: "CardboardV1",
                        label: "Cardboard I/O 2014",
                        fov: 40,
                        interLensDistance: .06,
                        baselineLensDistance: .035,
                        screenLensDistance: .042,
                        distortionCoefficients: [.441, .156],
                        inverseCoefficients: [-.4410035, .42756155, -.4804439, .5460139, -.58821183, .5733938, -.48303202, .33299083, -.17573841, .0651772, -.01488963, .001559834]
                    }),
                    CardboardV2: new z({
                        id: "CardboardV2",
                        label: "Cardboard I/O 2015",
                        fov: 60,
                        interLensDistance: .064,
                        baselineLensDistance: .035,
                        screenLensDistance: .039,
                        distortionCoefficients: [.34, .55],
                        inverseCoefficients: [-.33836704, -.18162185, .862655, -1.2462051, 1.0560602, -.58208317, .21609078, -.05444823, .009177956, -9.904169E-4, 6.183535E-5, -1.6981803E-6]
                    })
                };
                A.prototype.updateDeviceParams = function(a) {
                    this.device = this.determineDevice_(a) || this.device
                }
                ;
                A.prototype.getDevice = function() {
                    return this.device
                }
                ;
                A.prototype.setViewer = function(a) {
                    this.viewer = a;
                    this.distortion = new D(this.viewer.distortionCoefficients)
                }
                ;
                A.prototype.determineDevice_ = function(a) {
                    if (!a) {
                        if (ta())
                            return console.warn("Using fallback iOS device measurements."),
                            va;
                        console.warn("Using fallback Android device measurements.");
                        return da
                    }
                    var b = .0254 / a.xdpi
                      , c = .0254 / a.ydpi
                      , d = q()
                      , e = w();
                    return new y({
                        widthMeters: b * d,
                        heightMeters: c * e,
                        bevelMeters: .001 * a.bevelMm
                    })
                }
                ;
                A.prototype.getDistortedFieldOfViewLeftEye = function() {
                    var a = this.viewer
                      , b = this.device
                      , c = this.distortion
                      , d = a.screenLensDistance
                      , e = a.interLensDistance / 2
                      , f = a.baselineLensDistance - b.bevelMeters
                      , g = b.heightMeters - f;
                    b = Ia * Math.atan(c.distort((b.widthMeters - a.interLensDistance) / 2 / d));
                    e = Ia * Math.atan(c.distort(e / d));
                    f = Ia * Math.atan(c.distort(f / d));
                    c = Ia * Math.atan(c.distort(g / d));
                    return {
                        leftDegrees: Math.min(b, a.fov),
                        rightDegrees: Math.min(e, a.fov),
                        downDegrees: Math.min(f, a.fov),
                        upDegrees: Math.min(c, a.fov)
                    }
                }
                ;
                A.prototype.getLeftEyeVisibleTanAngles = function() {
                    var a = this.viewer
                      , b = this.device
                      , c = this.distortion
                      , d = Math.tan(-ka * a.fov)
                      , e = Math.tan(ka * a.fov)
                      , f = Math.tan(ka * a.fov)
                      , g = Math.tan(-ka * a.fov)
                      , h = b.widthMeters / 4
                      , l = b.heightMeters / 2
                      , m = a.interLensDistance / 2 - h
                      , n = -(a.baselineLensDistance - b.bevelMeters - l)
                      , r = a.screenLensDistance;
                    a = c.distort((m - h) / r);
                    b = c.distort((n + l) / r);
                    h = c.distort((m + h) / r);
                    c = c.distort((n - l) / r);
                    l = new Float32Array(4);
                    l[0] = Math.max(d, a);
                    l[1] = Math.min(e, b);
                    l[2] = Math.min(f, h);
                    l[3] = Math.max(g, c);
                    return l
                }
                ;
                A.prototype.getLeftEyeNoLensTanAngles = function() {
                    var a = this.viewer
                      , b = this.device
                      , c = this.distortion
                      , d = new Float32Array(4)
                      , e = c.distortInverse(Math.tan(-ka * a.fov))
                      , f = c.distortInverse(Math.tan(ka * a.fov))
                      , g = c.distortInverse(Math.tan(ka * a.fov));
                    c = c.distortInverse(Math.tan(-ka * a.fov));
                    var h = b.widthMeters / 4
                      , l = b.heightMeters / 2
                      , m = a.interLensDistance / 2 - h;
                    b = -(a.baselineLensDistance - b.bevelMeters - l);
                    a = a.screenLensDistance;
                    d[0] = Math.max(e, (m - h) / a);
                    d[1] = Math.min(f, (b + l) / a);
                    d[2] = Math.min(g, (m + h) / a);
                    d[3] = Math.max(c, (b - l) / a);
                    return d
                }
                ;
                A.prototype.getLeftEyeVisibleScreenRect = function(a) {
                    var b = this.viewer
                      , c = this.device
                      , d = b.screenLensDistance
                      , e = (c.widthMeters - b.interLensDistance) / 2;
                    b = b.baselineLensDistance - c.bevelMeters;
                    var f = (a[0] * d + e) / c.widthMeters
                      , g = (a[3] * d + b) / c.heightMeters;
                    return {
                        x: f,
                        y: g,
                        width: (a[2] * d + e) / c.widthMeters - f,
                        height: (a[1] * d + b) / c.heightMeters - g
                    }
                }
                ;
                A.prototype.getFieldOfViewLeftEye = function(a) {
                    return a ? this.getUndistortedFieldOfViewLeftEye() : this.getDistortedFieldOfViewLeftEye()
                }
                ;
                A.prototype.getFieldOfViewRightEye = function(a) {
                    a = this.getFieldOfViewLeftEye(a);
                    return {
                        leftDegrees: a.rightDegrees,
                        rightDegrees: a.leftDegrees,
                        upDegrees: a.upDegrees,
                        downDegrees: a.downDegrees
                    }
                }
                ;
                A.prototype.getUndistortedFieldOfViewLeftEye = function() {
                    var a = this.getUndistortedParams_();
                    return {
                        leftDegrees: Ia * Math.atan(a.outerDist),
                        rightDegrees: Ia * Math.atan(a.innerDist),
                        downDegrees: Ia * Math.atan(a.bottomDist),
                        upDegrees: Ia * Math.atan(a.topDist)
                    }
                }
                ;
                A.prototype.getUndistortedViewportLeftEye = function() {
                    var a = this.getUndistortedParams_()
                      , b = this.device
                      , c = this.viewer.screenLensDistance
                      , d = b.width / (b.widthMeters / c);
                    b = b.height / (b.heightMeters / c);
                    c = Math.round((a.eyePosX - a.outerDist) * d);
                    var e = Math.round((a.eyePosY - a.bottomDist) * b);
                    return {
                        x: c,
                        y: e,
                        width: Math.round((a.eyePosX + a.innerDist) * d) - c,
                        height: Math.round((a.eyePosY + a.topDist) * b) - e
                    }
                }
                ;
                A.prototype.getUndistortedParams_ = function() {
                    var a = this.viewer
                      , b = this.device
                      , c = a.screenLensDistance
                      , d = a.interLensDistance / 2 / c
                      , e = b.heightMeters / c
                      , f = b.widthMeters / c / 2 - d;
                    b = (a.baselineLensDistance - b.bevelMeters) / c;
                    a = this.distortion.distortInverse(Math.tan(ka * a.fov));
                    return {
                        outerDist: Math.min(f, a),
                        innerDist: Math.min(d, a),
                        topDist: Math.min(e - b, a),
                        bottomDist: Math.min(b, a),
                        eyePosX: f,
                        eyePosY: b
                    }
                }
                ;
                A.Viewers = Ga;
                var I = {
                    format: 1,
                    last_updated: "2019-11-09T17:36:14Z",
                    devices: [{
                        type: "android",
                        rules: [{
                            mdmh: "asus/*/Nexus 7/*"
                        }, {
                            ua: "Nexus 7"
                        }],
                        dpi: [320.8, 323],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "asus/*/ASUS_X00PD/*"
                        }, {
                            ua: "ASUS_X00PD"
                        }],
                        dpi: 245,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "asus/*/ASUS_X008D/*"
                        }, {
                            ua: "ASUS_X008D"
                        }],
                        dpi: 282,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "asus/*/ASUS_Z00AD/*"
                        }, {
                            ua: "ASUS_Z00AD"
                        }],
                        dpi: [403, 404.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Google/*/Pixel 2 XL/*"
                        }, {
                            ua: "Pixel 2 XL"
                        }],
                        dpi: 537.9,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Google/*/Pixel 3 XL/*"
                        }, {
                            ua: "Pixel 3 XL"
                        }],
                        dpi: [558.5, 553.8],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Google/*/Pixel XL/*"
                        }, {
                            ua: "Pixel XL"
                        }],
                        dpi: [537.9, 533],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Google/*/Pixel 3/*"
                        }, {
                            ua: "Pixel 3"
                        }],
                        dpi: 442.4,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Google/*/Pixel 2/*"
                        }, {
                            ua: "Pixel 2"
                        }],
                        dpi: 441,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Google/*/Pixel/*"
                        }, {
                            ua: "Pixel"
                        }],
                        dpi: [432.6, 436.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "HTC/*/HTC6435LVW/*"
                        }, {
                            ua: "HTC6435LVW"
                        }],
                        dpi: [449.7, 443.3],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "HTC/*/HTC One XL/*"
                        }, {
                            ua: "HTC One XL"
                        }],
                        dpi: [315.3, 314.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "htc/*/Nexus 9/*"
                        }, {
                            ua: "Nexus 9"
                        }],
                        dpi: 289,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "HTC/*/HTC One M9/*"
                        }, {
                            ua: "HTC One M9"
                        }],
                        dpi: [442.5, 443.3],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "HTC/*/HTC One_M8/*"
                        }, {
                            ua: "HTC One_M8"
                        }],
                        dpi: [449.7, 447.4],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "HTC/*/HTC One/*"
                        }, {
                            ua: "HTC One"
                        }],
                        dpi: 472.8,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Huawei/*/Nexus 6P/*"
                        }, {
                            ua: "Nexus 6P"
                        }],
                        dpi: [515.1, 518],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Huawei/*/BLN-L24/*"
                        }, {
                            ua: "HONORBLN-L24"
                        }],
                        dpi: 480,
                        bw: 4,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Huawei/*/BKL-L09/*"
                        }, {
                            ua: "BKL-L09"
                        }],
                        dpi: 403,
                        bw: 3.47,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LENOVO/*/Lenovo PB2-690Y/*"
                        }, {
                            ua: "Lenovo PB2-690Y"
                        }],
                        dpi: [457.2, 454.713],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/Nexus 5X/*"
                        }, {
                            ua: "Nexus 5X"
                        }],
                        dpi: [422, 419.9],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/LGMS345/*"
                        }, {
                            ua: "LGMS345"
                        }],
                        dpi: [221.7, 219.1],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/LG-D800/*"
                        }, {
                            ua: "LG-D800"
                        }],
                        dpi: [422, 424.1],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/LG-D850/*"
                        }, {
                            ua: "LG-D850"
                        }],
                        dpi: [537.9, 541.9],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/VS985 4G/*"
                        }, {
                            ua: "VS985 4G"
                        }],
                        dpi: [537.9, 535.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/Nexus 5/*"
                        }, {
                            ua: "Nexus 5 B"
                        }],
                        dpi: [442.4, 444.8],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/Nexus 4/*"
                        }, {
                            ua: "Nexus 4"
                        }],
                        dpi: [319.8, 318.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/LG-P769/*"
                        }, {
                            ua: "LG-P769"
                        }],
                        dpi: [240.6, 247.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/LGMS323/*"
                        }, {
                            ua: "LGMS323"
                        }],
                        dpi: [206.6, 204.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "LGE/*/LGLS996/*"
                        }, {
                            ua: "LGLS996"
                        }],
                        dpi: [403.4, 401.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Micromax/*/4560MMX/*"
                        }, {
                            ua: "4560MMX"
                        }],
                        dpi: [240, 219.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Micromax/*/A250/*"
                        }, {
                            ua: "Micromax A250"
                        }],
                        dpi: [480, 446.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Micromax/*/Micromax AQ4501/*"
                        }, {
                            ua: "Micromax AQ4501"
                        }],
                        dpi: 240,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/G5/*"
                        }, {
                            ua: "Moto G (5) Plus"
                        }],
                        dpi: [403.4, 403],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/DROID RAZR/*"
                        }, {
                            ua: "DROID RAZR"
                        }],
                        dpi: [368.1, 256.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT830C/*"
                        }, {
                            ua: "XT830C"
                        }],
                        dpi: [254, 255.9],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1021/*"
                        }, {
                            ua: "XT1021"
                        }],
                        dpi: [254, 256.7],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1023/*"
                        }, {
                            ua: "XT1023"
                        }],
                        dpi: [254, 256.7],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1028/*"
                        }, {
                            ua: "XT1028"
                        }],
                        dpi: [326.6, 327.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1034/*"
                        }, {
                            ua: "XT1034"
                        }],
                        dpi: [326.6, 328.4],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1053/*"
                        }, {
                            ua: "XT1053"
                        }],
                        dpi: [315.3, 316.1],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1562/*"
                        }, {
                            ua: "XT1562"
                        }],
                        dpi: [403.4, 402.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/Nexus 6/*"
                        }, {
                            ua: "Nexus 6 B"
                        }],
                        dpi: [494.3, 489.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1063/*"
                        }, {
                            ua: "XT1063"
                        }],
                        dpi: [295, 296.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1064/*"
                        }, {
                            ua: "XT1064"
                        }],
                        dpi: [295, 295.6],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1092/*"
                        }, {
                            ua: "XT1092"
                        }],
                        dpi: [422, 424.1],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/XT1095/*"
                        }, {
                            ua: "XT1095"
                        }],
                        dpi: [422, 423.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "motorola/*/G4/*"
                        }, {
                            ua: "Moto G (4)"
                        }],
                        dpi: 401,
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/A0001/*"
                        }, {
                            ua: "A0001"
                        }],
                        dpi: [403.4, 401],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE E1001/*"
                        }, {
                            ua: "ONE E1001"
                        }],
                        dpi: [442.4, 441.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE E1003/*"
                        }, {
                            ua: "ONE E1003"
                        }],
                        dpi: [442.4, 441.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE E1005/*"
                        }, {
                            ua: "ONE E1005"
                        }],
                        dpi: [442.4, 441.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE A2001/*"
                        }, {
                            ua: "ONE A2001"
                        }],
                        dpi: [391.9, 405.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE A2003/*"
                        }, {
                            ua: "ONE A2003"
                        }],
                        dpi: [391.9, 405.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE A2005/*"
                        }, {
                            ua: "ONE A2005"
                        }],
                        dpi: [391.9, 405.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A3000/*"
                        }, {
                            ua: "ONEPLUS A3000"
                        }],
                        dpi: 401,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A3003/*"
                        }, {
                            ua: "ONEPLUS A3003"
                        }],
                        dpi: 401,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A3010/*"
                        }, {
                            ua: "ONEPLUS A3010"
                        }],
                        dpi: 401,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A5000/*"
                        }, {
                            ua: "ONEPLUS A5000 "
                        }],
                        dpi: [403.411, 399.737],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONE A5010/*"
                        }, {
                            ua: "ONEPLUS A5010"
                        }],
                        dpi: [403, 400],
                        bw: 2,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A6000/*"
                        }, {
                            ua: "ONEPLUS A6000"
                        }],
                        dpi: 401,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A6003/*"
                        }, {
                            ua: "ONEPLUS A6003"
                        }],
                        dpi: 401,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A6010/*"
                        }, {
                            ua: "ONEPLUS A6010"
                        }],
                        dpi: 401,
                        bw: 2,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OnePlus/*/ONEPLUS A6013/*"
                        }, {
                            ua: "ONEPLUS A6013"
                        }],
                        dpi: 401,
                        bw: 2,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "OPPO/*/X909/*"
                        }, {
                            ua: "X909"
                        }],
                        dpi: [442.4, 444.1],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9082/*"
                        }, {
                            ua: "GT-I9082"
                        }],
                        dpi: [184.7, 185.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G360P/*"
                        }, {
                            ua: "SM-G360P"
                        }],
                        dpi: [196.7, 205.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/Nexus S/*"
                        }, {
                            ua: "Nexus S"
                        }],
                        dpi: [234.5, 229.8],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9300/*"
                        }, {
                            ua: "GT-I9300"
                        }],
                        dpi: [304.8, 303.9],
                        bw: 5,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-T230NU/*"
                        }, {
                            ua: "SM-T230NU"
                        }],
                        dpi: 216,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SGH-T399/*"
                        }, {
                            ua: "SGH-T399"
                        }],
                        dpi: [217.7, 231.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SGH-M919/*"
                        }, {
                            ua: "SGH-M919"
                        }],
                        dpi: [440.8, 437.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-N9005/*"
                        }, {
                            ua: "SM-N9005"
                        }],
                        dpi: [386.4, 387],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SAMSUNG-SM-N900A/*"
                        }, {
                            ua: "SAMSUNG-SM-N900A"
                        }],
                        dpi: [386.4, 387.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9500/*"
                        }, {
                            ua: "GT-I9500"
                        }],
                        dpi: [442.5, 443.3],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9505/*"
                        }, {
                            ua: "GT-I9505"
                        }],
                        dpi: 439.4,
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G900F/*"
                        }, {
                            ua: "SM-G900F"
                        }],
                        dpi: [415.6, 431.6],
                        bw: 5,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G900M/*"
                        }, {
                            ua: "SM-G900M"
                        }],
                        dpi: [415.6, 431.6],
                        bw: 5,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G800F/*"
                        }, {
                            ua: "SM-G800F"
                        }],
                        dpi: 326.8,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G906S/*"
                        }, {
                            ua: "SM-G906S"
                        }],
                        dpi: [562.7, 572.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9300/*"
                        }, {
                            ua: "GT-I9300"
                        }],
                        dpi: [306.7, 304.8],
                        bw: 5,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-T535/*"
                        }, {
                            ua: "SM-T535"
                        }],
                        dpi: [142.6, 136.4],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-N920C/*"
                        }, {
                            ua: "SM-N920C"
                        }],
                        dpi: [515.1, 518.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-N920P/*"
                        }, {
                            ua: "SM-N920P"
                        }],
                        dpi: [386.3655, 390.144],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-N920W8/*"
                        }, {
                            ua: "SM-N920W8"
                        }],
                        dpi: [515.1, 518.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9300I/*"
                        }, {
                            ua: "GT-I9300I"
                        }],
                        dpi: [304.8, 305.8],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-I9195/*"
                        }, {
                            ua: "GT-I9195"
                        }],
                        dpi: [249.4, 256.7],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SPH-L520/*"
                        }, {
                            ua: "SPH-L520"
                        }],
                        dpi: [249.4, 255.9],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SAMSUNG-SGH-I717/*"
                        }, {
                            ua: "SAMSUNG-SGH-I717"
                        }],
                        dpi: 285.8,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SPH-D710/*"
                        }, {
                            ua: "SPH-D710"
                        }],
                        dpi: [217.7, 204.2],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/GT-N7100/*"
                        }, {
                            ua: "GT-N7100"
                        }],
                        dpi: 265.1,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SCH-I605/*"
                        }, {
                            ua: "SCH-I605"
                        }],
                        dpi: 265.1,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/Galaxy Nexus/*"
                        }, {
                            ua: "Galaxy Nexus"
                        }],
                        dpi: [315.3, 314.2],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-N910H/*"
                        }, {
                            ua: "SM-N910H"
                        }],
                        dpi: [515.1, 518],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-N910C/*"
                        }, {
                            ua: "SM-N910C"
                        }],
                        dpi: [515.2, 520.2],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G130M/*"
                        }, {
                            ua: "SM-G130M"
                        }],
                        dpi: [165.9, 164.8],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G928I/*"
                        }, {
                            ua: "SM-G928I"
                        }],
                        dpi: [515.1, 518.4],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G920F/*"
                        }, {
                            ua: "SM-G920F"
                        }],
                        dpi: 580.6,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G920P/*"
                        }, {
                            ua: "SM-G920P"
                        }],
                        dpi: [522.5, 577],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G925F/*"
                        }, {
                            ua: "SM-G925F"
                        }],
                        dpi: 580.6,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G925V/*"
                        }, {
                            ua: "SM-G925V"
                        }],
                        dpi: [522.5, 576.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G930F/*"
                        }, {
                            ua: "SM-G930F"
                        }],
                        dpi: 576.6,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G935F/*"
                        }, {
                            ua: "SM-G935F"
                        }],
                        dpi: 533,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G950F/*"
                        }, {
                            ua: "SM-G950F"
                        }],
                        dpi: [562.707, 565.293],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G955U/*"
                        }, {
                            ua: "SM-G955U"
                        }],
                        dpi: [522.514, 525.762],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G955F/*"
                        }, {
                            ua: "SM-G955F"
                        }],
                        dpi: [522.514, 525.762],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G960F/*"
                        }, {
                            ua: "SM-G960F"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G9600/*"
                        }, {
                            ua: "SM-G9600"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G960T/*"
                        }, {
                            ua: "SM-G960T"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G960N/*"
                        }, {
                            ua: "SM-G960N"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G960U/*"
                        }, {
                            ua: "SM-G960U"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G9608/*"
                        }, {
                            ua: "SM-G9608"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G960FD/*"
                        }, {
                            ua: "SM-G960FD"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G960W/*"
                        }, {
                            ua: "SM-G960W"
                        }],
                        dpi: [569.575, 571.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G965F/*"
                        }, {
                            ua: "SM-G965F"
                        }],
                        dpi: 529,
                        bw: 2,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Sony/*/C6903/*"
                        }, {
                            ua: "C6903"
                        }],
                        dpi: [442.5, 443.3],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Sony/*/D6653/*"
                        }, {
                            ua: "D6653"
                        }],
                        dpi: [428.6, 427.6],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Sony/*/E6653/*"
                        }, {
                            ua: "E6653"
                        }],
                        dpi: [428.6, 425.7],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Sony/*/E6853/*"
                        }, {
                            ua: "E6853"
                        }],
                        dpi: [403.4, 401.9],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Sony/*/SGP321/*"
                        }, {
                            ua: "SGP321"
                        }],
                        dpi: [224.7, 224.1],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "TCT/*/ALCATEL ONE TOUCH Fierce/*"
                        }, {
                            ua: "ALCATEL ONE TOUCH Fierce"
                        }],
                        dpi: [240, 247.5],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "THL/*/thl 5000/*"
                        }, {
                            ua: "thl 5000"
                        }],
                        dpi: [480, 443.3],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Fly/*/IQ4412/*"
                        }, {
                            ua: "IQ4412"
                        }],
                        dpi: 307.9,
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "ZTE/*/ZTE Blade L2/*"
                        }, {
                            ua: "ZTE Blade L2"
                        }],
                        dpi: 240,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "BENEVE/*/VR518/*"
                        }, {
                            ua: "VR518"
                        }],
                        dpi: 480,
                        bw: 3,
                        ac: 500
                    }, {
                        type: "ios",
                        rules: [{
                            res: [640, 960]
                        }],
                        dpi: [325.1, 328.4],
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "ios",
                        rules: [{
                            res: [640, 1136]
                        }],
                        dpi: [317.1, 320.2],
                        bw: 3,
                        ac: 1E3
                    }, {
                        type: "ios",
                        rules: [{
                            res: [750, 1334]
                        }],
                        dpi: 326.4,
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "ios",
                        rules: [{
                            res: [1242, 2208]
                        }],
                        dpi: [453.6, 458.4],
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "ios",
                        rules: [{
                            res: [1125, 2001]
                        }],
                        dpi: [410.9, 415.4],
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "ios",
                        rules: [{
                            res: [1125, 2436]
                        }],
                        dpi: 458,
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Huawei/*/EML-L29/*"
                        }, {
                            ua: "EML-L29"
                        }],
                        dpi: 428,
                        bw: 3.45,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "Nokia/*/Nokia 7.1/*"
                        }, {
                            ua: "Nokia 7.1"
                        }],
                        dpi: [432, 431.9],
                        bw: 3,
                        ac: 500
                    }, {
                        type: "ios",
                        rules: [{
                            res: [1242, 2688]
                        }],
                        dpi: 458,
                        bw: 4,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G570M/*"
                        }, {
                            ua: "SM-G570M"
                        }],
                        dpi: 320,
                        bw: 3.684,
                        ac: 1E3
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G970F/*"
                        }, {
                            ua: "SM-G970F"
                        }],
                        dpi: 438,
                        bw: 2.281,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G973F/*"
                        }, {
                            ua: "SM-G973F"
                        }],
                        dpi: 550,
                        bw: 2.002,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G975F/*"
                        }, {
                            ua: "SM-G975F"
                        }],
                        dpi: 522,
                        bw: 2.054,
                        ac: 500
                    }, {
                        type: "android",
                        rules: [{
                            mdmh: "samsung/*/SM-G977F/*"
                        }, {
                            ua: "SM-G977F"
                        }],
                        dpi: 505,
                        bw: 2.334,
                        ac: 500
                    }, {
                        type: "ios",
                        rules: [{
                            res: [828, 1792]
                        }],
                        dpi: 326,
                        bw: 5,
                        ac: 500
                    }]
                };
                B.prototype.getDeviceParams = function() {
                    return this.deviceParams
                }
                ;
                B.prototype.recalculateDeviceParams_ = function() {
                    var a = this.calcDeviceParams_();
                    if (a) {
                        if (this.deviceParams = a,
                        this.onDeviceParamsUpdated)
                            this.onDeviceParamsUpdated(this.deviceParams)
                    } else
                        console.error("Failed to recalculate device parameters.")
                }
                ;
                B.prototype.calcDeviceParams_ = function() {
                    var a = this.dpdb;
                    if (!a)
                        return console.error("DPDB not available."),
                        null;
                    if (1 != a.format)
                        return console.error("DPDB has unexpected format version."),
                        null;
                    if (!a.devices || !a.devices.length)
                        return console.error("DPDB does not have a devices section."),
                        null;
                    var b = navigator.userAgent || navigator.vendor || window.opera
                      , c = q()
                      , d = w();
                    if (!a.devices)
                        return console.error("DPDB has no devices section."),
                        null;
                    for (var e = 0; e < a.devices.length; e++) {
                        var f = a.devices[e];
                        if (!f.rules)
                            console.warn("Device[" + e + "] has no rules section.");
                        else if ("ios" != f.type && "android" != f.type)
                            console.warn("Device[" + e + "] has invalid type.");
                        else if (ta() == ("ios" == f.type)) {
                            for (var g = !1, h = 0; h < f.rules.length; h++)
                                if (this.ruleMatches_(f.rules[h], b, c, d)) {
                                    g = !0;
                                    break
                                }
                            if (g)
                                return new M({
                                    xdpi: f.dpi[0] || f.dpi,
                                    ydpi: f.dpi[1] || f.dpi,
                                    bevelMm: f.bw
                                })
                        }
                    }
                    console.warn("No DPDB device match.");
                    return null
                }
                ;
                B.prototype.ruleMatches_ = function(a, b, c, d) {
                    if (!a.ua && !a.res)
                        return !1;
                    a.ua && "SM" === a.ua.substring(0, 2) && (a.ua = a.ua.substring(0, 7));
                    if (a.ua && 0 > b.indexOf(a.ua))
                        return !1;
                    if (a.res) {
                        if (!a.res[0] || !a.res[1])
                            return !1;
                        b = a.res[0];
                        a = a.res[1];
                        if (Math.min(c, d) != Math.min(b, a) || Math.max(c, d) != Math.max(b, a))
                            return !1
                    }
                    return !0
                }
                ;
                C.prototype.set = function(a, b) {
                    this.sample = a;
                    this.timestampS = b
                }
                ;
                C.prototype.copy = function(a) {
                    this.set(a.sample, a.timestampS)
                }
                ;
                ma.prototype.addAccelMeasurement = function(a, b) {
                    this.currentAccelMeasurement.set(a, b)
                }
                ;
                ma.prototype.addGyroMeasurement = function(a, b) {
                    this.currentGyroMeasurement.set(a, b);
                    a = b - this.previousGyroMeasurement.timestampS;
                    isNaN(a) || .001 >= a || 1 < a || this.run_();
                    this.previousGyroMeasurement.copy(this.currentGyroMeasurement)
                }
                ;
                ma.prototype.run_ = function() {
                    if (this.isOrientationInitialized) {
                        var b = this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample, this.currentGyroMeasurement.timestampS - this.previousGyroMeasurement.timestampS);
                        this.gyroIntegralQ.multiply(b);
                        this.filterQ.copy(this.previousFilterQ);
                        this.filterQ.multiply(b);
                        b = new a;
                        b.copy(this.filterQ);
                        b.inverse();
                        this.estimatedGravity.set(0, 0, -1);
                        this.estimatedGravity.applyQuaternion(b);
                        this.estimatedGravity.normalize();
                        this.measuredGravity.copy(this.currentAccelMeasurement.sample);
                        this.measuredGravity.normalize();
                        b = new a;
                        b.setFromUnitVectors(this.estimatedGravity, this.measuredGravity);
                        b.inverse();
                        this.isDebug && console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)", Ia * e(b), this.estimatedGravity.x.toFixed(1), this.estimatedGravity.y.toFixed(1), this.estimatedGravity.z.toFixed(1), this.measuredGravity.x.toFixed(1), this.measuredGravity.y.toFixed(1), this.measuredGravity.z.toFixed(1));
                        var c = new a;
                        c.copy(this.filterQ);
                        c.multiply(b);
                        this.filterQ.slerp(c, 1 - this.kFilter);
                        this.previousFilterQ.copy(this.filterQ)
                    } else
                        this.accelQ = this.accelToQuaternion_(this.currentAccelMeasurement.sample),
                        this.previousFilterQ.copy(this.accelQ),
                        this.isOrientationInitialized = !0
                }
                ;
                ma.prototype.getOrientation = function() {
                    return this.filterQ
                }
                ;
                ma.prototype.accelToQuaternion_ = function(c) {
                    var d = new b;
                    d.copy(c);
                    d.normalize();
                    c = new a;
                    c.setFromUnitVectors(new b(0,0,-1), d);
                    c.inverse();
                    return c
                }
                ;
                ma.prototype.gyroToQuaternionDelta_ = function(c, d) {
                    var e = new a
                      , f = new b;
                    f.copy(c);
                    f.normalize();
                    e.setFromAxisAngle(f, c.length() * d);
                    return e
                }
                ;
                F.prototype.getPrediction = function(a, c, d) {
                    if (!this.previousTimestampS)
                        return this.previousQ.copy(a),
                        this.previousTimestampS = d,
                        a;
                    var e = new b;
                    e.copy(c);
                    e.normalize();
                    c = c.length();
                    if (c < 20 * ka)
                        return this.isDebug && console.log("Moving slowly, at %s deg/s: no prediction", (Ia * c).toFixed(1)),
                        this.outQ.copy(a),
                        this.previousQ.copy(a),
                        this.outQ;
                    this.deltaQ.setFromAxisAngle(e, c * this.predictionTimeS);
                    this.outQ.copy(this.previousQ);
                    this.outQ.multiply(this.deltaQ);
                    this.previousQ.copy(a);
                    this.previousTimestampS = d;
                    return this.outQ
                }
                ;
                Y.prototype.getPosition = function() {
                    return null
                }
                ;
                Y.prototype.getOrientation = function() {
                    var c = void 0;
                    if (this.isWithoutDeviceMotion && this._deviceOrientationQ) {
                        this.deviceOrientationFixQ = this.deviceOrientationFixQ || function() {
                            var c = (new a).setFromAxisAngle(new b(0,0,-1), 0)
                              , d = new a;
                            -90 === window.orientation ? d.setFromAxisAngle(new b(0,1,0), Math.PI / -2) : d.setFromAxisAngle(new b(0,1,0), Math.PI / 2);
                            return c.multiply(d)
                        }();
                        this.deviceOrientationFilterToWorldQ = this.deviceOrientationFilterToWorldQ || function() {
                            var c = new a;
                            c.setFromAxisAngle(new b(1,0,0), -Math.PI / 2);
                            return c
                        }();
                        c = this._deviceOrientationQ;
                        var d = new a;
                        d.copy(c);
                        d.multiply(this.deviceOrientationFilterToWorldQ);
                        d.multiply(this.resetQ);
                        d.multiply(this.worldToScreenQ);
                        d.multiplyQuaternions(this.deviceOrientationFixQ, d);
                        this.yawOnly && (d.x = 0,
                        d.z = 0,
                        d.normalize());
                        this.orientationOut_[0] = d.x;
                        this.orientationOut_[1] = d.y;
                        this.orientationOut_[2] = d.z;
                        this.orientationOut_[3] = d.w;
                        return this.orientationOut_
                    }
                    c = this.filter.getOrientation();
                    c = this.posePredictor.getPrediction(c, this.gyroscope, this.previousTimestampS);
                    d = new a;
                    d.copy(this.filterToWorldQ);
                    d.multiply(this.resetQ);
                    d.multiply(c);
                    d.multiply(this.worldToScreenQ);
                    this.yawOnly && (d.x = 0,
                    d.z = 0,
                    d.normalize());
                    this.orientationOut_[0] = d.x;
                    this.orientationOut_[1] = d.y;
                    this.orientationOut_[2] = d.z;
                    this.orientationOut_[3] = d.w;
                    return this.orientationOut_
                }
                ;
                Y.prototype.resetPose = function() {
                    this.resetQ.copy(this.filter.getOrientation());
                    this.resetQ.x = 0;
                    this.resetQ.y = 0;
                    this.resetQ.z *= -1;
                    this.resetQ.normalize();
                    u() && this.resetQ.multiply(this.inverseWorldToScreenQ);
                    this.resetQ.multiply(this.originalPoseAdjustQ)
                }
                ;
                Y.prototype.onDeviceOrientation_ = function(b) {
                    this._deviceOrientationQ = this._deviceOrientationQ || new a;
                    var c = b.alpha
                      , d = b.beta;
                    b = b.gamma;
                    c = (c || 0) * Math.PI / 180;
                    d = (d || 0) * Math.PI / 180;
                    b = (b || 0) * Math.PI / 180;
                    this._deviceOrientationQ.setFromEulerYXZ(d, c, -b)
                }
                ;
                Y.prototype.onDeviceMotion_ = function(a) {
                    this.updateDeviceMotion_(a)
                }
                ;
                Y.prototype.updateDeviceMotion_ = function(a) {
                    var b = a.accelerationIncludingGravity
                      , c = a.rotationRate;
                    a = a.timeStamp / 1E3;
                    var d = a - this.previousTimestampS;
                    0 > d ? K("fusion-pose-sensor:invalid:non-monotonic", "Invalid timestamps detected: non-monotonic timestamp from devicemotion") : .001 >= d || 1 < d ? K("fusion-pose-sensor:invalid:outside-threshold", "Invalid timestamps detected: Timestamp from devicemotion outside expected range.") : (this.accelerometer.set(-b.x, -b.y, -b.z),
                    c && (Z() ? this.gyroscope.set(-c.beta, c.alpha, c.gamma) : this.gyroscope.set(c.alpha, c.beta, c.gamma),
                    this.isDeviceMotionInRadians || this.gyroscope.multiplyScalar(Math.PI / 180),
                    this.filter.addGyroMeasurement(this.gyroscope, a)),
                    this.filter.addAccelMeasurement(this.accelerometer, a));
                    this.previousTimestampS = a
                }
                ;
                Y.prototype.onOrientationChange_ = function() {
                    this.setScreenTransform_()
                }
                ;
                Y.prototype.onMessage_ = function(a) {
                    (a = a.data) && a.type && "devicemotion" === a.type.toLowerCase() && this.updateDeviceMotion_(a.deviceMotionEvent)
                }
                ;
                Y.prototype.setScreenTransform_ = function() {
                    this.worldToScreenQ.set(0, 0, 0, 1);
                    switch (window.orientation) {
                    case 90:
                        this.worldToScreenQ.setFromAxisAngle(new b(0,0,1), -Math.PI / 2);
                        break;
                    case -90:
                        this.worldToScreenQ.setFromAxisAngle(new b(0,0,1), Math.PI / 2)
                    }
                    this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
                    this.inverseWorldToScreenQ.inverse()
                }
                ;
                Y.prototype.start = function() {
                    this.onDeviceMotionCallback_ = this.onDeviceMotion_.bind(this);
                    this.onOrientationChangeCallback_ = this.onOrientationChange_.bind(this);
                    this.onMessageCallback_ = this.onMessage_.bind(this);
                    this.onDeviceOrientationCallback_ = this.onDeviceOrientation_.bind(this);
                    var a;
                    if (a = ta()) {
                        a = window.self !== window.top;
                        var b = f(document.referrer)
                          , c = f(window.location.href);
                        a = a && b !== c
                    }
                    a && window.addEventListener("message", this.onMessageCallback_);
                    window.addEventListener("orientationchange", this.onOrientationChangeCallback_);
                    this.isWithoutDeviceMotion ? window.addEventListener("deviceorientation", this.onDeviceOrientationCallback_) : window.addEventListener("devicemotion", this.onDeviceMotionCallback_)
                }
                ;
                Y.prototype.stop = function() {
                    window.removeEventListener("devicemotion", this.onDeviceMotionCallback_);
                    window.removeEventListener("deviceorientation", this.onDeviceOrientationCallback_);
                    window.removeEventListener("orientationchange", this.onOrientationChangeCallback_);
                    window.removeEventListener("message", this.onMessageCallback_)
                }
                ;
                var Db = new b(1,0,0)
                  , J = new b(0,0,1)
                  , ha = new a;
                ha.setFromAxisAngle(Db, -Math.PI / 2);
                ha.multiply((new a).setFromAxisAngle(J, Math.PI / 2));
                var ia = function() {
                    function b(c) {
                        if (!(this instanceof b))
                            throw new TypeError("Cannot call a class as a function");
                        this.config = c;
                        this.fusionSensor = this.sensor = null;
                        this._out = new Float32Array(4);
                        this.api = null;
                        this.errors = [];
                        this._sensorQ = new a;
                        this._outQ = new a;
                        this._onSensorRead = this._onSensorRead.bind(this);
                        this._onSensorError = this._onSensorError.bind(this);
                        this.init()
                    }
                    ya(b, [{
                        key: "init",
                        value: function() {
                            var a = null;
                            try {
                                a = new RelativeOrientationSensor({
                                    frequency: 60,
                                    referenceFrame: "screen"
                                }),
                                a.addEventListener("error", this._onSensorError)
                            } catch (xb) {
                                this.errors.push(xb),
                                "SecurityError" === xb.name ? (console.error("Cannot construct sensors due to the Feature Policy"),
                                console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),
                                this.useDeviceMotion()) : "ReferenceError" === xb.name ? this.useDeviceMotion() : console.error(xb)
                            }
                            a && (this.api = "sensor",
                            this.sensor = a,
                            this.sensor.addEventListener("reading", this._onSensorRead),
                            this.sensor.start())
                        }
                    }, {
                        key: "useDeviceMotion",
                        value: function() {
                            this.api = "devicemotion";
                            this.fusionSensor = new Y(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);
                            this.sensor && (this.sensor.removeEventListener("reading", this._onSensorRead),
                            this.sensor.removeEventListener("error", this._onSensorError),
                            this.sensor = null)
                        }
                    }, {
                        key: "getOrientation",
                        value: function() {
                            if (this.fusionSensor)
                                return this.fusionSensor.getOrientation();
                            if (!this.sensor || !this.sensor.quaternion)
                                return this._out[0] = this._out[1] = this._out[2] = 0,
                                this._out[3] = 1,
                                this._out;
                            var a = this.sensor.quaternion;
                            this._sensorQ.set(a[0], a[1], a[2], a[3]);
                            a = this._outQ;
                            a.copy(ha);
                            a.multiply(this._sensorQ);
                            this.config.YAW_ONLY && (a.x = a.z = 0,
                            a.normalize());
                            this._out[0] = a.x;
                            this._out[1] = a.y;
                            this._out[2] = a.z;
                            this._out[3] = a.w;
                            return this._out
                        }
                    }, {
                        key: "_onSensorError",
                        value: function(a) {
                            this.errors.push(a.error);
                            "NotAllowedError" === a.error.name ? console.error("Permission to access sensor was denied") : "NotReadableError" === a.error.name ? console.error("Sensor could not be read") : console.error(a.error);
                            this.useDeviceMotion()
                        }
                    }, {
                        key: "_onSensorRead",
                        value: function() {}
                    }]);
                    return b
                }();
                N.prototype.show = function(a) {
                    a || this.overlay.parentElement ? a && (this.overlay.parentElement && this.overlay.parentElement != a && this.overlay.parentElement.removeChild(this.overlay),
                    a.appendChild(this.overlay)) : document.body.appendChild(this.overlay);
                    this.overlay.style.display = "block";
                    a = this.overlay.querySelector("img").style;
                    u() ? (a.width = "20%",
                    a.marginLeft = "40%",
                    a.marginTop = "3%") : (a.width = "50%",
                    a.marginLeft = "25%",
                    a.marginTop = "25%")
                }
                ;
                N.prototype.hide = function() {
                    this.overlay.style.display = "none"
                }
                ;
                N.prototype.showTemporarily = function(a, b) {
                    this.show(b);
                    this.timer = setTimeout(this.hide.bind(this), a)
                }
                ;
                N.prototype.disableShowTemporarily = function() {
                    clearTimeout(this.timer)
                }
                ;
                N.prototype.update = function() {
                    this.disableShowTemporarily();
                    !u() && l() ? this.show() : this.hide()
                }
                ;
                N.prototype.loadIcon_ = function() {
                    this.icon = "data:image/svg+xml," + encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")
                }
                ;
                W.prototype.show = function(a) {
                    this.root = a;
                    a.appendChild(this.dialog);
                    this.dialog.querySelector("#" + this.selectedKey).checked = !0;
                    this.dialog.style.display = "block"
                }
                ;
                W.prototype.hide = function() {
                    this.root && this.root.contains(this.dialog) && this.root.removeChild(this.dialog);
                    this.dialog.style.display = "none"
                }
                ;
                W.prototype.getCurrentViewer = function() {
                    return A.Viewers[this.selectedKey]
                }
                ;
                W.prototype.getSelectedKey_ = function() {
                    var a = this.dialog.querySelector("input[name=field]:checked");
                    return a ? a.id : null
                }
                ;
                W.prototype.onChange = function(a) {
                    this.onChangeCallbacks_.push(a)
                }
                ;
                W.prototype.fireOnChange_ = function(a) {
                    for (var b = 0; b < this.onChangeCallbacks_.length; b++)
                        this.onChangeCallbacks_[b](a)
                }
                ;
                W.prototype.onSave_ = function() {
                    if ((this.selectedKey = this.getSelectedKey_()) && A.Viewers[this.selectedKey]) {
                        this.fireOnChange_(A.Viewers[this.selectedKey]);
                        try {
                            localStorage.setItem("WEBVR_CARDBOARD_VIEWER", this.selectedKey)
                        } catch (lb) {
                            console.error("Failed to save viewer profile: %s", lb)
                        }
                        this.hide()
                    } else
                        console.error("ViewerSelector.onSave_: this should never happen!")
                }
                ;
                W.prototype.createDialog_ = function(a) {
                    var b = document.createElement("div");
                    b.classList.add("webvr-polyfill-viewer-selector");
                    b.style.display = "none";
                    var c = document.createElement("div")
                      , d = c.style;
                    d.position = "fixed";
                    d.left = 0;
                    d.top = 0;
                    d.width = "100%";
                    d.height = "100%";
                    d.background = "rgba(0, 0, 0, 0.3)";
                    c.addEventListener("click", this.hide.bind(this));
                    var e = document.createElement("div");
                    d = e.style;
                    d.boxSizing = "border-box";
                    d.position = "fixed";
                    d.top = "24px";
                    d.left = "50%";
                    d.marginLeft = "-140px";
                    d.width = "280px";
                    d.padding = "24px";
                    d.overflow = "hidden";
                    d.background = "#fafafa";
                    d.fontFamily = "'Roboto', sans-serif";
                    d.boxShadow = "0px 5px 20px #666";
                    e.appendChild(this.createH1_("Select your viewer"));
                    for (var f in a)
                        e.appendChild(this.createChoice_(f, a[f].label));
                    e.appendChild(this.createButton_("Save", this.onSave_.bind(this)));
                    b.appendChild(c);
                    b.appendChild(e);
                    return b
                }
                ;
                W.prototype.createH1_ = function(a) {
                    var b = document.createElement("h1")
                      , c = b.style;
                    c.color = "black";
                    c.fontSize = "20px";
                    c.fontWeight = "bold";
                    c.marginTop = 0;
                    c.marginBottom = "24px";
                    b.innerHTML = a;
                    return b
                }
                ;
                W.prototype.createChoice_ = function(a, b) {
                    var c = document.createElement("div");
                    c.style.marginTop = "8px";
                    c.style.color = "black";
                    var d = document.createElement("input");
                    d.style.fontSize = "30px";
                    d.setAttribute("id", a);
                    d.setAttribute("type", "radio");
                    d.setAttribute("value", a);
                    d.setAttribute("name", "field");
                    var e = document.createElement("label");
                    e.style.marginLeft = "4px";
                    e.setAttribute("for", a);
                    e.innerHTML = b;
                    c.appendChild(d);
                    c.appendChild(e);
                    return c
                }
                ;
                W.prototype.createButton_ = function(a, b) {
                    var c = document.createElement("button");
                    c.innerHTML = a;
                    a = c.style;
                    a.float = "right";
                    a.textTransform = "uppercase";
                    a.color = "#1094f7";
                    a.fontSize = "14px";
                    a.letterSpacing = 0;
                    a.border = 0;
                    a.background = "none";
                    a.marginTop = "16px";
                    c.addEventListener("click", b);
                    return c
                }
                ;
                var P = "undefined" !== typeof window ? window : "undefined" !== typeof oe ? oe : "undefined" !== typeof self ? self : {}
                  , bb = function(a) {
                    return a && a.__esModule && Object.prototype.hasOwnProperty.call(a, "default") ? a["default"] : a
                }(function(a, b) {
                    return b = {
                        exports: {}
                    },
                    a(b, b.exports),
                    b.exports
                }(function(a) {
                    (function(b, c) {
                        a.exports = c()
                    }
                    )(P, function() {
                        return function(a) {
                            function b(d) {
                                if (c[d])
                                    return c[d].exports;
                                var e = c[d] = {
                                    i: d,
                                    l: !1,
                                    exports: {}
                                };
                                a[d].call(e.exports, e, e.exports, b);
                                e.l = !0;
                                return e.exports
                            }
                            var c = {};
                            b.m = a;
                            b.c = c;
                            b.d = function(a, c, d) {
                                b.o(a, c) || Object.defineProperty(a, c, {
                                    configurable: !1,
                                    enumerable: !0,
                                    get: d
                                })
                            }
                            ;
                            b.n = function(a) {
                                var c = a && a.__esModule ? function() {
                                    return a["default"]
                                }
                                : function() {
                                    return a
                                }
                                ;
                                b.d(c, "a", c);
                                return c
                            }
                            ;
                            b.o = function(a, b) {
                                return Object.prototype.hasOwnProperty.call(a, b)
                            }
                            ;
                            b.p = "";
                            return b(b.s = 0)
                        }([function(a, b, c) {
                            var d = function() {
                                function a(a, b) {
                                    for (var c = 0; c < b.length; c++) {
                                        var d = b[c];
                                        d.enumerable = d.enumerable || !1;
                                        d.configurable = !0;
                                        "value"in d && (d.writable = !0);
                                        Object.defineProperty(a, d.key, d)
                                    }
                                }
                                return function(b, c, d) {
                                    c && a(b.prototype, c);
                                    d && a(b, d);
                                    return b
                                }
                            }()
                              , e = c(1)
                              , f = "undefined" !== typeof navigator && 10 > parseFloat(("" + (/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0, ""])[1]).replace("undefined", "3_2").replace("_", ".").replace("_", "")) && !window.MSStream;
                            b = function() {
                                function a() {
                                    if (!(this instanceof a))
                                        throw new TypeError("Cannot call a class as a function");
                                    f ? this.noSleepTimer = null : (this.noSleepVideo = document.createElement("video"),
                                    this.noSleepVideo.setAttribute("playsinline", ""),
                                    this.noSleepVideo.setAttribute("src", e),
                                    this.noSleepVideo.addEventListener("timeupdate", function() {
                                        .5 < this.noSleepVideo.currentTime && (this.noSleepVideo.currentTime = Math.random())
                                    }
                                    .bind(this)))
                                }
                                d(a, [{
                                    key: "enable",
                                    value: function() {
                                        f ? (this.disable(),
                                        this.noSleepTimer = window.setInterval(function() {
                                            window.location.href = "/";
                                            window.setTimeout(window.stop, 0)
                                        }, 15E3)) : this.noSleepVideo.play()
                                    }
                                }, {
                                    key: "disable",
                                    value: function() {
                                        f ? this.noSleepTimer && (window.clearInterval(this.noSleepTimer),
                                        this.noSleepTimer = null) : this.noSleepVideo.pause()
                                    }
                                }]);
                                return a
                            }();
                            a.exports = b
                        }
                        , function(a) {
                            a.exports = "data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="
                        }
                        ])
                    })
                }))
                  , Ta = 1E3
                  , Bb = [0, 0, .5, 1]
                  , oa = [.5, 0, .5, 1]
                  , Ha = window.requestAnimationFrame
                  , Nb = window.cancelAnimationFrame;
                E.prototype.getFrameData = function(a) {
                    return G(a, this._getPose(), this)
                }
                ;
                E.prototype.getPose = function() {
                    d("VRDisplay.prototype.getPose", "VRDisplay.prototype.getFrameData");
                    return this._getPose()
                }
                ;
                E.prototype.resetPose = function() {
                    d("VRDisplay.prototype.resetPose");
                    return this._resetPose()
                }
                ;
                E.prototype.getImmediatePose = function() {
                    d("VRDisplay.prototype.getImmediatePose", "VRDisplay.prototype.getFrameData");
                    return this._getPose()
                }
                ;
                E.prototype.requestAnimationFrame = function(a) {
                    return Ha(a)
                }
                ;
                E.prototype.cancelAnimationFrame = function(a) {
                    return Nb(a)
                }
                ;
                E.prototype.wrapForFullscreen = function(a) {
                    if (ta())
                        return a;
                    this.fullscreenWrapper_ || (this.fullscreenWrapper_ = document.createElement("div"),
                    this.fullscreenWrapper_.setAttribute("style", ["height: " + Math.min(screen.height, screen.width) + "px !important", "top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ") + ";"),
                    this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));
                    if (this.fullscreenElement_ == a)
                        return this.fullscreenWrapper_;
                    this.fullscreenElement_ && (this.originalParent_ ? this.originalParent_.appendChild(this.fullscreenElement_) : this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));
                    this.fullscreenElement_ = a;
                    (this.originalParent_ = a.parentElement) || document.body.appendChild(a);
                    this.fullscreenWrapper_.parentElement || (a = this.fullscreenElement_.parentElement,
                    a.insertBefore(this.fullscreenWrapper_, this.fullscreenElement_),
                    a.removeChild(this.fullscreenElement_));
                    this.fullscreenWrapper_.insertBefore(this.fullscreenElement_, this.fullscreenWrapper_.firstChild);
                    this.fullscreenElementCachedStyle_ = this.fullscreenElement_.getAttribute("style");
                    this.fullscreenElement_ && this.fullscreenElement_.setAttribute("style", ["position: absolute; top: 0; left: 0", "width: " + Math.max(screen.width, screen.height) + "px", "height: " + Math.min(screen.height, screen.width) + "px", "border: 0; margin: 0; padding: 0"].join("; ") + ";");
                    return this.fullscreenWrapper_
                }
                ;
                E.prototype.removeFullscreenWrapper = function() {
                    if (this.fullscreenElement_) {
                        var a = this.fullscreenElement_;
                        this.fullscreenElementCachedStyle_ ? a.setAttribute("style", this.fullscreenElementCachedStyle_) : a.removeAttribute("style");
                        this.fullscreenElementCachedStyle_ = this.fullscreenElement_ = null;
                        var b = this.fullscreenWrapper_.parentElement;
                        this.fullscreenWrapper_.removeChild(a);
                        this.originalParent_ === b ? b.insertBefore(a, this.fullscreenWrapper_) : this.originalParent_ && this.originalParent_.appendChild(a);
                        b.removeChild(this.fullscreenWrapper_);
                        return a
                    }
                }
                ;
                E.prototype.requestPresent = function(a) {
                    var b = this.isPresenting
                      , c = this;
                    a instanceof Array || (d("VRDisplay.prototype.requestPresent with non-array argument", "an array of VRLayers as the first argument"),
                    a = [a]);
                    return new Promise(function(d, e) {
                        if (c.capabilities.canPresent)
                            if (0 == a.length || a.length > c.capabilities.maxLayers)
                                e(Error("Invalid number of layers."));
                            else {
                                var f = a[0];
                                if (f.source) {
                                    var g = f.leftBounds || Bb
                                      , h = f.rightBounds || oa;
                                    if (b) {
                                        var l = c.layer_;
                                        l.source !== f.source && (l.source = f.source);
                                        for (f = 0; 4 > f; f++)
                                            l.leftBounds[f] = g[f],
                                            l.rightBounds[f] = h[f];
                                        c.wrapForFullscreen(c.layer_.source);
                                        c.updatePresent_();
                                        d()
                                    } else {
                                        c.layer_ = {
                                            predistorted: f.predistorted,
                                            source: f.source,
                                            leftBounds: g.slice(0),
                                            rightBounds: h.slice(0)
                                        };
                                        c.waitingForPresent_ = !1;
                                        if (c.layer_ && c.layer_.source) {
                                            var m = c.wrapForFullscreen(c.layer_.source);
                                            c.addFullscreenListeners_(m, function() {
                                                c.isPresenting = m === (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
                                                c.isPresenting ? (screen.orientation && screen.orientation.lock && screen.orientation.lock("landscape-primary").catch(function(a) {
                                                    console.error("screen.orientation.lock() failed due to", a.message)
                                                }),
                                                c.waitingForPresent_ = !1,
                                                c.beginPresent_(),
                                                d()) : (screen.orientation && screen.orientation.unlock && screen.orientation.unlock(),
                                                c.removeFullscreenWrapper(),
                                                c.disableWakeLock(),
                                                c.endPresent_(),
                                                c.removeFullscreenListeners_());
                                                c.fireVRDisplayPresentChange_()
                                            }, function() {
                                                c.waitingForPresent_ && (c.removeFullscreenWrapper(),
                                                c.removeFullscreenListeners_(),
                                                c.disableWakeLock(),
                                                c.waitingForPresent_ = !1,
                                                c.isPresenting = !1,
                                                e(Error("Unable to present.")))
                                            });
                                            if (p(m))
                                                c.enableWakeLock(),
                                                c.waitingForPresent_ = !0;
                                            else if (ta() || O())
                                                c.enableWakeLock(),
                                                c.isPresenting = !0,
                                                c.beginPresent_(),
                                                c.fireVRDisplayPresentChange_(),
                                                d()
                                        }
                                        c.waitingForPresent_ || ta() || (r(),
                                        e(Error("Unable to present.")))
                                    }
                                } else
                                    d()
                            }
                        else
                            e(Error("VRDisplay is not capable of presenting."))
                    }
                    )
                }
                ;
                E.prototype.exitPresent = function() {
                    var a = this.isPresenting
                      , b = this;
                    this.isPresenting = !1;
                    this.layer_ = null;
                    this.disableWakeLock();
                    return new Promise(function(c, d) {
                        a ? (!r() && ta() && (b.endPresent_(),
                        b.fireVRDisplayPresentChange_()),
                        O() && (b.removeFullscreenWrapper(),
                        b.removeFullscreenListeners_(),
                        b.endPresent_(),
                        b.fireVRDisplayPresentChange_()),
                        c()) : d(Error("Was not presenting to VRDisplay."))
                    }
                    )
                }
                ;
                E.prototype.getLayers = function() {
                    return this.layer_ ? [this.layer_] : []
                }
                ;
                E.prototype.fireVRDisplayPresentChange_ = function() {
                    var a = new CustomEvent("vrdisplaypresentchange",{
                        detail: {
                            display: this
                        }
                    });
                    window.dispatchEvent(a)
                }
                ;
                E.prototype.fireVRDisplayConnect_ = function() {
                    var a = new CustomEvent("vrdisplayconnect",{
                        detail: {
                            display: this
                        }
                    });
                    window.dispatchEvent(a)
                }
                ;
                E.prototype.addFullscreenListeners_ = function(a, b, c) {
                    this.removeFullscreenListeners_();
                    this.fullscreenEventTarget_ = a;
                    this.fullscreenChangeHandler_ = b;
                    this.fullscreenErrorHandler_ = c;
                    b && (document.fullscreenEnabled ? a.addEventListener("fullscreenchange", b, !1) : document.webkitFullscreenEnabled ? a.addEventListener("webkitfullscreenchange", b, !1) : document.mozFullScreenEnabled ? document.addEventListener("mozfullscreenchange", b, !1) : document.msFullscreenEnabled && a.addEventListener("msfullscreenchange", b, !1));
                    c && (document.fullscreenEnabled ? a.addEventListener("fullscreenerror", c, !1) : document.webkitFullscreenEnabled ? a.addEventListener("webkitfullscreenerror", c, !1) : document.mozFullScreenEnabled ? document.addEventListener("mozfullscreenerror", c, !1) : document.msFullscreenEnabled && a.addEventListener("msfullscreenerror", c, !1))
                }
                ;
                E.prototype.removeFullscreenListeners_ = function() {
                    if (this.fullscreenEventTarget_) {
                        var a = this.fullscreenEventTarget_;
                        if (this.fullscreenChangeHandler_) {
                            var b = this.fullscreenChangeHandler_;
                            a.removeEventListener("fullscreenchange", b, !1);
                            a.removeEventListener("webkitfullscreenchange", b, !1);
                            document.removeEventListener("mozfullscreenchange", b, !1);
                            a.removeEventListener("msfullscreenchange", b, !1)
                        }
                        this.fullscreenErrorHandler_ && (b = this.fullscreenErrorHandler_,
                        a.removeEventListener("fullscreenerror", b, !1),
                        a.removeEventListener("webkitfullscreenerror", b, !1),
                        document.removeEventListener("mozfullscreenerror", b, !1),
                        a.removeEventListener("msfullscreenerror", b, !1));
                        this.fullscreenErrorHandler_ = this.fullscreenChangeHandler_ = this.fullscreenEventTarget_ = null
                    }
                }
                ;
                E.prototype.enableWakeLock = function() {
                    this.wakelock_ && this.wakelock_.enable()
                }
                ;
                E.prototype.disableWakeLock = function() {
                    this.wakelock_ && this.wakelock_.disable()
                }
                ;
                E.prototype.beginPresent_ = function() {}
                ;
                E.prototype.endPresent_ = function() {}
                ;
                E.prototype.submitFrame = function() {}
                ;
                E.prototype.getEyeParameters = function() {
                    return null
                }
                ;
                var Qa = {
                    ADDITIONAL_VIEWERS: [],
                    DEFAULT_VIEWER: "",
                    MOBILE_WAKE_LOCK: !0,
                    DEBUG: !1,
                    DPDB_URL: "https://dpdb.webvr.rocks/dpdb.json",
                    K_FILTER: .98,
                    PREDICTION_TIME_S: .04,
                    CARDBOARD_UI_DISABLED: !1,
                    ROTATE_INSTRUCTIONS_DISABLED: !1,
                    YAW_ONLY: !1,
                    BUFFER_SCALE: .5,
                    DIRTY_SUBMIT_FRAME_BINDINGS: !1
                };
                ca.prototype = Object.create(E.prototype);
                ca.prototype._getPose = function() {
                    return {
                        position: null,
                        orientation: this.poseSensor_.getOrientation(),
                        linearVelocity: null,
                        linearAcceleration: null,
                        angularVelocity: null,
                        angularAcceleration: null
                    }
                }
                ;
                ca.prototype._resetPose = function() {
                    this.poseSensor_.resetPose && this.poseSensor_.resetPose()
                }
                ;
                ca.prototype._getFieldOfView = function(a) {
                    if ("left" == a)
                        a = this.deviceInfo_.getFieldOfViewLeftEye();
                    else if ("right" == a)
                        a = this.deviceInfo_.getFieldOfViewRightEye();
                    else
                        return console.error("Invalid eye provided: %s", a),
                        null;
                    return a
                }
                ;
                ca.prototype._getEyeOffset = function(a) {
                    if ("left" == a)
                        a = [.5 * -this.deviceInfo_.viewer.interLensDistance, 0, 0];
                    else if ("right" == a)
                        a = [.5 * this.deviceInfo_.viewer.interLensDistance, 0, 0];
                    else
                        return console.error("Invalid eye provided: %s", a),
                        null;
                    return a
                }
                ;
                ca.prototype.getEyeParameters = function(a) {
                    var b = this._getEyeOffset(a)
                      , c = this._getFieldOfView(a);
                    a = {
                        offset: b,
                        renderWidth: .5 * this.deviceInfo_.device.width * this.bufferScale_,
                        renderHeight: this.deviceInfo_.device.height * this.bufferScale_
                    };
                    Object.defineProperty(a, "fieldOfView", {
                        enumerable: !0,
                        get: function() {
                            d("VRFieldOfView", "VRFrameData's projection matrices");
                            return c
                        }
                    });
                    return a
                }
                ;
                ca.prototype.onDeviceParamsUpdated_ = function(a) {
                    this.config.DEBUG && console.log("DPDB reported that device params were updated.");
                    this.deviceInfo_.updateDeviceParams(a);
                    this.distorter_ && this.distorter_.updateDeviceInfo(this.deviceInfo_)
                }
                ;
                ca.prototype.updateBounds_ = function() {
                    this.layer_ && this.distorter_ && (this.layer_.leftBounds || this.layer_.rightBounds) && this.distorter_.setTextureBounds(this.layer_.leftBounds, this.layer_.rightBounds)
                }
                ;
                ca.prototype.beginPresent_ = function() {
                    var a = this.layer_.source.getContext("webgl");
                    a || (a = this.layer_.source.getContext("experimental-webgl"));
                    a || (a = this.layer_.source.getContext("webgl2"));
                    a && (this.layer_.predistorted ? this.config.CARDBOARD_UI_DISABLED || (a.canvas.width = q() * this.bufferScale_,
                    a.canvas.height = w() * this.bufferScale_,
                    this.cardboardUI_ = new x(a)) : (this.config.CARDBOARD_UI_DISABLED || (this.cardboardUI_ = new x(a)),
                    this.distorter_ = new v(a,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),
                    this.distorter_.updateDeviceInfo(this.deviceInfo_)),
                    this.cardboardUI_ && this.cardboardUI_.listen(function(a) {
                        this.viewerSelector_.show(this.layer_.source.parentElement);
                        a.stopPropagation();
                        a.preventDefault()
                    }
                    .bind(this), function(a) {
                        this.exitPresent();
                        a.stopPropagation();
                        a.preventDefault()
                    }
                    .bind(this)),
                    this.rotateInstructions_ && (u() && l() ? this.rotateInstructions_.showTemporarily(3E3, this.layer_.source.parentElement) : this.rotateInstructions_.update()),
                    this.orientationHandler = this.onOrientationChange_.bind(this),
                    window.addEventListener("orientationchange", this.orientationHandler),
                    this.vrdisplaypresentchangeHandler = this.updateBounds_.bind(this),
                    window.addEventListener("vrdisplaypresentchange", this.vrdisplaypresentchangeHandler),
                    this.fireVRDisplayDeviceParamsChange_())
                }
                ;
                ca.prototype.endPresent_ = function() {
                    this.distorter_ && (this.distorter_.destroy(),
                    this.distorter_ = null);
                    this.cardboardUI_ && (this.cardboardUI_.destroy(),
                    this.cardboardUI_ = null);
                    this.rotateInstructions_ && this.rotateInstructions_.hide();
                    this.viewerSelector_.hide();
                    window.removeEventListener("orientationchange", this.orientationHandler);
                    window.removeEventListener("vrdisplaypresentchange", this.vrdisplaypresentchangeHandler)
                }
                ;
                ca.prototype.updatePresent_ = function() {
                    this.endPresent_();
                    this.beginPresent_()
                }
                ;
                ca.prototype.submitFrame = function() {
                    if (this.distorter_)
                        this.updateBounds_(),
                        this.distorter_.submitFrame();
                    else if (this.cardboardUI_ && this.layer_) {
                        var a = this.layer_.source.getContext("webgl");
                        a || (a = this.layer_.source.getContext("experimental-webgl"));
                        a || (a = this.layer_.source.getContext("webgl2"));
                        a = a.canvas;
                        if (a.width != this.lastWidth || a.height != this.lastHeight)
                            this.cardboardUI_.onResize();
                        this.lastWidth = a.width;
                        this.lastHeight = a.height;
                        this.cardboardUI_.render()
                    }
                }
                ;
                ca.prototype.onOrientationChange_ = function() {
                    this.viewerSelector_.hide();
                    this.rotateInstructions_ && this.rotateInstructions_.update();
                    this.onResize_()
                }
                ;
                ca.prototype.onResize_ = function() {
                    if (this.layer_) {
                        var a = this.layer_.source.getContext("webgl");
                        a || (a = this.layer_.source.getContext("experimental-webgl"));
                        a || (a = this.layer_.source.getContext("webgl2"));
                        a.canvas.setAttribute("style", "position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;");
                        g(a.canvas)
                    }
                }
                ;
                ca.prototype.onViewerChanged_ = function(a) {
                    this.deviceInfo_.setViewer(a);
                    this.distorter_ && this.distorter_.updateDeviceInfo(this.deviceInfo_);
                    this.fireVRDisplayDeviceParamsChange_()
                }
                ;
                ca.prototype.fireVRDisplayDeviceParamsChange_ = function() {
                    var a = new CustomEvent("vrdisplaydeviceparamschange",{
                        detail: {
                            vrdisplay: this,
                            deviceInfo: this.deviceInfo_
                        }
                    });
                    window.dispatchEvent(a)
                }
                ;
                ca.VRFrameData = function() {
                    this.leftProjectionMatrix = new Float32Array(16);
                    this.leftViewMatrix = new Float32Array(16);
                    this.rightProjectionMatrix = new Float32Array(16);
                    this.rightViewMatrix = new Float32Array(16);
                    this.pose = null
                }
                ;
                ca.VRDisplay = E;
                return ca
            })
        }));
        k.inherits(p, E);
        p.prototype.onBaseLayerSet = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.isSessionSupported = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.isFeatureSupported = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.requestSession = function() {
            return k.asyncExecutePromiseGeneratorProgram(function() {
                throw Error("Not implemented");
            })
        }
        ;
        p.prototype.requestAnimationFrame = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.onFrameStart = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.onFrameEnd = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.doesSessionSupportReferenceSpace = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.requestStageBounds = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.requestFrameOfReferenceTransform = function() {
            return k.asyncExecutePromiseGeneratorProgram(function(a) {
                return a.return(void 0)
            })
        }
        ;
        p.prototype.cancelAnimationFrame = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.endSession = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.getViewport = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.getProjectionMatrix = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.getBasePoseMatrix = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.getBaseViewMatrix = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.getInputSources = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.getInputPose = function() {
            throw Error("Not implemented");
        }
        ;
        p.prototype.onWindowResize = function() {
            this.onWindowResize()
        }
        ;
        var lf = {
            mapping: "xr-standard",
            displayProfiles: {
                "Oculus Quest": ["oculus-touch-v2", "oculus-touch", "generic-trigger-squeeze-thumbstick"]
            },
            profiles: ["oculus-touch", "generic-trigger-squeeze-thumbstick"],
            axes: {
                length: 4,
                0: null,
                1: null,
                2: 0,
                3: 1
            },
            buttons: {
                length: 7,
                0: 1,
                1: 2,
                2: null,
                3: 0,
                4: 3,
                5: 4,
                6: null
            },
            gripTransform: {
                position: [0, -.02, .04, 1],
                orientation: [.11 * Math.PI, 0, 0, 1]
            }
        }
          , pe = {
            mapping: "xr-standard",
            profiles: ["microsoft-mixed-reality", "generic-trigger-squeeze-touchpad-thumbstick"],
            buttons: {
                length: 4,
                0: 1,
                1: 0,
                2: 2,
                3: 4
            },
            gripTransform: {
                position: [0, -.02, .04, 1],
                orientation: [.11 * Math.PI, 0, 0, 1]
            }
        }
          , gh = {
            "Daydream Controller": {
                mapping: "",
                profiles: ["google-daydream", "generic-trigger-touchpad"],
                buttons: {
                    length: 3,
                    0: null,
                    1: null,
                    2: 0
                }
            },
            "Gear VR Controller": {
                mapping: "xr-standard",
                profiles: ["samsung-gearvr", "generic-trigger-touchpad"],
                buttons: {
                    length: 3,
                    0: 1,
                    1: null,
                    2: 0
                },
                gripTransform: {
                    orientation: [.11 * Math.PI, 0, 0, 1]
                }
            },
            "HTC Vive Focus Controller": {
                mapping: "xr-standard",
                profiles: ["htc-vive-focus", "generic-trigger-touchpad"],
                buttons: {
                    length: 3,
                    0: 1,
                    1: null,
                    2: 0
                }
            },
            "Oculus Go Controller": {
                mapping: "xr-standard",
                profiles: ["oculus-go", "generic-trigger-touchpad"],
                buttons: {
                    length: 3,
                    0: 1,
                    1: null,
                    2: 0
                },
                gripTransform: {
                    orientation: [.11 * Math.PI, 0, 0, 1]
                }
            },
            "Oculus Touch (Right)": lf,
            "Oculus Touch (Left)": lf,
            "OpenVR Gamepad": {
                mapping: "xr-standard",
                profiles: ["htc-vive", "generic-trigger-squeeze-touchpad"],
                displayProfiles: {
                    "HTC Vive": ["htc-vive", "generic-trigger-squeeze-touchpad"],
                    "HTC Vive DVT": ["htc-vive", "generic-trigger-squeeze-touchpad"],
                    "Valve Index": ["valve-index", "generic-trigger-squeeze-touchpad-thumbstick"]
                },
                buttons: {
                    length: 3,
                    0: 1,
                    1: 2,
                    2: 0
                },
                gripTransform: {
                    position: [0, 0, .05, 1]
                },
                targetRayTransform: {
                    orientation: [-.08 * Math.PI, 0, 0, 1]
                },
                userAgentOverrides: {
                    Firefox: {
                        axes: {
                            invert: [1, 3]
                        }
                    }
                }
            },
            "Spatial Controller (Spatial Interaction Source) 045E-065A": pe,
            "Spatial Controller (Spatial Interaction Source) 045E-065D": {
                mapping: "xr-standard",
                profiles: ["samsung-odyssey", "microsoft-mixed-reality", "generic-trigger-squeeze-touchpad-thumbstick"],
                buttons: {
                    length: 4,
                    0: 1,
                    1: 0,
                    2: 2,
                    3: 4
                },
                gripTransform: {
                    position: [0, -.02, .04, 1],
                    orientation: [.11 * Math.PI, 0, 0, 1]
                }
            },
            "Windows Mixed Reality (Right)": pe,
            "Windows Mixed Reality (Left)": pe
        }
          , hf = W(.155, -.465, -.15)
          , hh = W(-.155, -.465, -.15)
          , ih = W(0, 0, -.25)
          , jh = W(0, 0, .05)
          , mf = W(-.08, .14, .08)
          , nf = 180 / Math.PI;
        n.prototype.setHandedness = function(a) {
            this.hand != a && (this.hand = a,
            this.headElbowOffset = "left" == this.hand ? hh : hf)
        }
        ;
        n.prototype.update = function(a, b) {
            this.time = Hc();
            a && (F(this.lastControllerQ, this.controllerQ),
            F(this.controllerQ, a));
            b && (ia(this.headPos, b),
            Y(this.headQ, b));
            a = this.getHeadYawOrientation_();
            b = this.quatAngle_(this.lastControllerQ, this.controllerQ);
            .61 < b / ((this.time - this.lastTime) / 1E3) ? Ta(this.rootQ, this.rootQ, a, Math.min(b / .175, 1)) : F(this.rootQ, a);
            a = W(0, 0, -1);
            Ha(a, a, this.controllerQ);
            a = V(a, [0, 1, 0]);
            a = this.clamp_((a - .12) / .87, 0, 1);
            var c = D(this.rootQ);
            vb(c, c);
            Db(c, c, this.controllerQ);
            b = this.elbowPos;
            ka(b, this.headPos);
            ca(b, b, this.headElbowOffset);
            var d = ba(mf);
            la(d, d, a);
            ca(b, b, d);
            d = this.quatAngle_(c, va()) * nf;
            var e = (1 - Math.pow(d / 180, 4)) * (.4 + .24 * a);
            d = va();
            Ta(d, d, c, e);
            e = vb(va(), d);
            c = D(c);
            Db(c, c, e);
            e = this.wristPos;
            ka(e, jh);
            Ha(e, e, d);
            ca(e, e, ih);
            Ha(e, e, c);
            ca(e, e, b);
            b = ba(mf);
            la(b, b, a);
            ca(this.position, this.wristPos, b);
            Ha(this.position, this.position, this.rootQ);
            this.lastTime = this.time
        }
        ;
        n.prototype.getPosition = function() {
            return this.position
        }
        ;
        n.prototype.getHeadYawOrientation_ = function() {
            var a = U();
            oa(a, this.headQ, "YXZ");
            var b = va()
              , c = a[1] * nf;
            a = .5 * Math.PI / 180;
            var d = 0 * a;
            c *= a;
            var e = 0 * a;
            a = Math.sin(d);
            d = Math.cos(d);
            var f = Math.sin(c);
            c = Math.cos(c);
            var g = Math.sin(e);
            e = Math.cos(e);
            b[0] = a * c * e - d * f * g;
            b[1] = d * f * e + a * c * g;
            b[2] = d * c * g - a * f * e;
            b[3] = d * c * e + a * f * g;
            return b
        }
        ;
        n.prototype.clamp_ = function(a, b, c) {
            return Math.min(Math.max(a, b), c)
        }
        ;
        n.prototype.quatAngle_ = function(a, b) {
            var c = [0, 0, -1]
              , d = [0, 0, -1];
            Ha(c, c, a);
            Ha(d, d, b);
            a = W(c[0], c[1], c[2]);
            d = W(d[0], d[1], d[2]);
            ya(a, a);
            ya(d, d);
            d = V(a, d);
            d = 1 < d ? 0 : -1 > d ? Math.PI : Math.acos(d);
            return d
        }
        ;
        k.initSymbol();
        var Ra = Symbol("@@webxr-polyfill/XRRemappedGamepad")
          , of = {
            pressed: !1,
            touched: !1,
            value: 0
        };
        Object.freeze(of);
        m.prototype._update = function() {
            for (var a = this[Ra].gamepad, b = this[Ra].map, c = this[Ra].axes, d = 0; d < c.length; ++d)
                c[d] = b.axes && d in b.axes ? null === b.axes[d] ? 0 : a.axes[b.axes[d]] : a.axes[d];
            if (b.axes && b.axes.invert) {
                d = k.makeIterator(b.axes.invert);
                for (var e = d.next(); !e.done; e = d.next())
                    e = e.value,
                    e < c.length && (c[e] *= -1)
            }
            c = this[Ra].buttons;
            for (d = 0; d < c.length; ++d)
                c[d] = b.buttons && d in b.buttons ? null === b.buttons[d] ? of : a.buttons[b.buttons[d]] : a.buttons[d]
        }
        ;
        k.global.Object.defineProperties(m.prototype, {
            id: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return ""
                }
            },
            _profiles: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].profiles
                }
            },
            index: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return -1
                }
            },
            connected: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].gamepad.connected
                }
            },
            timestamp: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].gamepad.timestamp
                }
            },
            mapping: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].mapping
                }
            },
            axes: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].axes
                }
            },
            buttons: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].buttons
                }
            },
            hapticActuators: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this[Ra].gamepad.hapticActuators
                }
            }
        });
        l.prototype.updateFromGamepad = function(a) {
            this.nativeGamepad !== a && (this.gamepad = (this.nativeGamepad = a) ? new m(a,this.display,gh[a.id]) : null);
            this.handedness = "" === a.hand ? "none" : a.hand;
            this.gamepad && this.gamepad._update();
            a.pose ? (this.targetRayMode = "tracked-pointer",
            this.emulatedPosition = !a.pose.hasPosition) : "" === a.hand && (this.targetRayMode = "gaze",
            this.emulatedPosition = !1)
        }
        ;
        l.prototype.updateBasePoseMatrix = function() {
            if (this.nativeGamepad && this.nativeGamepad.pose) {
                var a = this.nativeGamepad.pose
                  , b = a.position
                  , c = a.orientation;
                if (!b && !c)
                    return;
                b ? (this.lastPosition[0] = b[0],
                this.lastPosition[1] = b[1],
                this.lastPosition[2] = b[2]) : a.hasPosition ? b = this.lastPosition : (this.armModel || (this.armModel = new n),
                this.armModel.setHandedness(this.nativeGamepad.hand),
                this.armModel.update(c, this.polyfill.getBasePoseMatrix()),
                b = this.armModel.getPosition());
                ha(this.basePoseMatrix, c, b)
            } else
                a = this.basePoseMatrix,
                b = this.polyfill.getBasePoseMatrix(),
                a[0] = b[0],
                a[1] = b[1],
                a[2] = b[2],
                a[3] = b[3],
                a[4] = b[4],
                a[5] = b[5],
                a[6] = b[6],
                a[7] = b[7],
                a[8] = b[8],
                a[9] = b[9],
                a[10] = b[10],
                a[11] = b[11],
                a[12] = b[12],
                a[13] = b[13],
                a[14] = b[14],
                a[15] = b[15];
            return this.basePoseMatrix
        }
        ;
        l.prototype.getXRPose = function(a, b) {
            this.updateBasePoseMatrix();
            switch (b) {
            case "target-ray":
                a._transformBasePoseMatrix(this.outputMatrix, this.basePoseMatrix);
                this.gamepad && this.gamepad[Ra].targetRayTransform && da(this.outputMatrix, this.outputMatrix, this.gamepad[Ra].targetRayTransform);
                break;
            case "grip":
                if (!this.nativeGamepad || !this.nativeGamepad.pose)
                    return null;
                a._transformBasePoseMatrix(this.outputMatrix, this.basePoseMatrix);
                this.gamepad && this.gamepad[Ra].gripTransform && da(this.outputMatrix, this.outputMatrix, this.gamepad[Ra].gripTransform);
                break;
            default:
                return null
            }
            a._adjustForOriginOffset(this.outputMatrix);
            return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)
        }
        ;
        k.global.Object.defineProperties(l.prototype, {
            profiles: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this.gamepad ? this.gamepad._profiles : []
                }
            }
        });
        var pf = {
            highRefreshRate: !0
        }
          , qf = {
            oculus: 1,
            openvr: 1,
            "spatial controller (spatial interaction source)": 1
        }
          , bh = 0;
        k.inherits(g, p);
        g.prototype.onBaseLayerSet = function(a, b) {
            var c = this
              , d = this.sessions.get(a)
              , e = b.context.canvas;
            if (d.immersive) {
                a = this.display.getEyeParameters("left");
                var f = this.display.getEyeParameters("right");
                e.width = 2 * Math.max(a.renderWidth, f.renderWidth);
                e.height = Math.max(a.renderHeight, f.renderHeight);
                this.display.requestPresent([{
                    source: e,
                    attributes: pf
                }]).then(function() {
                    c.global.document.body.contains(e) || (d.modifiedCanvasLayer = !0,
                    c.global.document.body.appendChild(e),
                    e.style.display = "block",
                    e.style.position = "absolute",
                    e.style.width = e.style.height = "1px",
                    e.style.top = e.style.left = "0px");
                    d.baseLayer = b
                })
            } else
                d.baseLayer = b
        }
        ;
        g.prototype.isSessionSupported = function(a) {
            return "immersive-ar" == a || "immersive-vr" == a && !1 === this.canPresent ? !1 : !0
        }
        ;
        g.prototype.isFeatureSupported = function(a) {
            switch (a) {
            case "viewer":
                return !0;
            case "local":
                return !0;
            case "local-floor":
                return !0;
            case "bounded":
                return !1;
            case "unbounded":
                return !1;
            default:
                return !1
            }
        }
        ;
        g.prototype.requestSession = function(a, b) {
            var c = this, d, e, f;
            return k.asyncExecutePromiseGeneratorProgram(function(g) {
                if (1 == g.nextAddress) {
                    if (!c.isSessionSupported(a))
                        return g.return(Promise.reject());
                    d = "immersive-vr" == a;
                    if (!d)
                        return g.jumpTo(2);
                    e = c.global.document.createElement("canvas");
                    e.getContext("webgl");
                    return g.yield(c.display.requestPresent([{
                        source: e,
                        attributes: pf
                    }]), 2)
                }
                f = new h(a,b,{
                    renderContextType: c.HAS_BITMAP_SUPPORT ? "bitmaprenderer" : "2d"
                });
                c.sessions.set(f.id, f);
                d && (c.immersiveSession = f,
                c.dispatchEvent("@@webxr-polyfill/vr-present-start", f.id));
                return g.return(Promise.resolve(f.id))
            })
        }
        ;
        g.prototype.requestAnimationFrame = function(a) {
            return this.display.requestAnimationFrame(a)
        }
        ;
        g.prototype.getPrimaryButtonIndex = function(a) {
            var b = 0, c = a.id.toLowerCase(), d;
            for (d in qf)
                if (c.includes(d)) {
                    b = qf[d];
                    break
                }
            return Math.min(b, a.buttons.length - 1)
        }
        ;
        g.prototype.onFrameStart = function(a, b) {
            this.display.depthNear = b.depthNear;
            this.display.depthFar = b.depthFar;
            this.display.getFrameData(this.frame);
            a = this.sessions.get(a);
            if (a.immersive && this.CAN_USE_GAMEPAD) {
                var c = this.gamepadInputSources;
                this.gamepadInputSources = {};
                for (var d = this.global.navigator.getGamepads(), e = 0; e < d.length; ++e) {
                    var f = d[e];
                    if (f && 0 < f.displayId) {
                        var g = c[e];
                        g || (g = new l(this,this.display,this.getPrimaryButtonIndex(f)));
                        g.updateFromGamepad(f);
                        this.gamepadInputSources[e] = g;
                        if (-1 != g.primaryButtonIndex) {
                            var h = f.buttons[g.primaryButtonIndex].pressed;
                            h && !g.primaryActionPressed ? this.dispatchEvent("@@webxr-polyfill/input-select-start", {
                                sessionId: a.id,
                                inputSource: g.inputSource
                            }) : !h && g.primaryActionPressed && this.dispatchEvent("@@webxr-polyfill/input-select-end", {
                                sessionId: a.id,
                                inputSource: g.inputSource
                            });
                            g.primaryActionPressed = h
                        }
                        -1 != g.primarySqueezeButtonIndex && ((f = f.buttons[g.primarySqueezeButtonIndex].pressed) && !g.primarySqueezeActionPressed ? this.dispatchEvent("@@webxr-polyfill/input-squeeze-start", {
                            sessionId: a.id,
                            inputSource: g.inputSource
                        }) : !f && g.primarySqueezeActionPressed && this.dispatchEvent("@@webxr-polyfill/input-squeeze-end", {
                            sessionId: a.id,
                            inputSource: g.inputSource
                        }),
                        g.primarySqueezeActionPressed = f)
                    }
                }
            }
            !a.immersive && a.baseLayer && (a = a.baseLayer.context.canvas,
            N(this.frame.leftProjectionMatrix, b.inlineVerticalFieldOfView, a.width / a.height, b.depthNear, b.depthFar))
        }
        ;
        g.prototype.onFrameEnd = function(a) {
            a = this.sessions.get(a);
            if (!a.ended && a.baseLayer) {
                if (a.outputContext && (!a.immersive || this.display.capabilities.hasExternalDisplay)) {
                    var b = a.baseLayer.context.canvas
                      , c = a.immersive && this.display.capabilities.hasExternalDisplay ? b.width / 2 : b.width
                      , d = b.height
                      , e = a.outputContext.canvas
                      , f = e.width;
                    e = e.height;
                    var g = a.renderContext;
                    this.HAS_BITMAP_SUPPORT ? b.transferToImageBitmap ? g.transferFromImageBitmap(b.transferToImageBitmap()) : this.global.createImageBitmap(b, 0, 0, c, d, {
                        resizeWidth: f,
                        resizeHeight: e
                    }).then(function(a) {
                        return g.transferFromImageBitmap(a)
                    }) : g.drawImage(b, 0, 0, c, d, 0, 0, f, e)
                }
                a.immersive && a.baseLayer && this.display.submitFrame()
            }
        }
        ;
        g.prototype.cancelAnimationFrame = function(a) {
            this.display.cancelAnimationFrame(a)
        }
        ;
        g.prototype.endSession = function(a) {
            var b = this, c;
            return k.asyncExecutePromiseGeneratorProgram(function(d) {
                c = b.sessions.get(a);
                if (c.ended)
                    return d.return();
                if (c.immersive)
                    return d.return(b.display.exitPresent());
                c.ended = !0;
                d.jumpToEnd()
            })
        }
        ;
        g.prototype.doesSessionSupportReferenceSpace = function(a, b) {
            a = this.sessions.get(a);
            return a.ended ? !1 : a.enabledFeatures.has(b)
        }
        ;
        g.prototype.requestStageBounds = function() {
            if (this.display.stageParameters) {
                var a = this.display.stageParameters.sizeX
                  , b = this.display.stageParameters.sizeZ
                  , c = [];
                c.push(-a / 2);
                c.push(-b / 2);
                c.push(a / 2);
                c.push(-b / 2);
                c.push(a / 2);
                c.push(b / 2);
                c.push(-a / 2);
                c.push(b / 2);
                return c
            }
            return null
        }
        ;
        g.prototype.requestFrameOfReferenceTransform = function(a) {
            var b = this;
            return k.asyncExecutePromiseGeneratorProgram(function(c) {
                return ("local-floor" === a || "bounded-floor" === a) && b.display.stageParameters && b.display.stageParameters.sittingToStandingTransform ? c.return(b.display.stageParameters.sittingToStandingTransform) : c.return(null)
            })
        }
        ;
        g.prototype.getProjectionMatrix = function(a) {
            if ("left" === a)
                return this.frame.leftProjectionMatrix;
            if ("right" === a)
                return this.frame.rightProjectionMatrix;
            if ("none" === a)
                return this.frame.leftProjectionMatrix;
            throw Error("eye must be of type 'left' or 'right'");
        }
        ;
        g.prototype.getViewport = function(a, b, c, d) {
            a = this.sessions.get(a);
            var e = c.context.canvas;
            c = e.width;
            e = e.height;
            if (!a.immersive)
                return d.x = d.y = 0,
                d.width = c,
                d.height = e,
                !0;
            if ("left" === b || "none" === b)
                d.x = 0;
            else if ("right" === b)
                d.x = c / 2;
            else
                return !1;
            d.y = 0;
            d.width = c / 2;
            d.height = e;
            return !0
        }
        ;
        g.prototype.getBasePoseMatrix = function() {
            var a = this.frame.pose
              , b = a.position;
            a = a.orientation;
            if (!b && !a)
                return this.baseModelMatrix;
            b || (b = this.tempVec3,
            b[0] = b[1] = b[2] = 0);
            ha(this.baseModelMatrix, a, b);
            return this.baseModelMatrix
        }
        ;
        g.prototype.getBaseViewMatrix = function(a) {
            if ("left" === a || "none" === a)
                return this.frame.leftViewMatrix;
            if ("right" === a)
                return this.frame.rightViewMatrix;
            throw Error("eye must be of type 'left' or 'right'");
        }
        ;
        g.prototype.getInputSources = function() {
            var a = [], b;
            for (b in this.gamepadInputSources)
                a.push(this.gamepadInputSources[b].inputSource);
            return a
        }
        ;
        g.prototype.getInputPose = function(a, b, c) {
            if (!b)
                return null;
            for (var d in this.gamepadInputSources) {
                var e = this.gamepadInputSources[d];
                if (e.inputSource === a)
                    return e.getXRPose(b, c)
            }
            return null
        }
        ;
        g.prototype.onWindowResize = function() {}
        ;
        g.prototype.onVRDisplayPresentChange = function() {
            var a = this;
            this.display.isPresenting || this.sessions.forEach(function(b) {
                if (b.immersive && !b.ended) {
                    if (b.modifiedCanvasLayer) {
                        var c = b.baseLayer.context.canvas;
                        document.body.removeChild(c);
                        c.setAttribute("style", "")
                    }
                    a.immersiveSession === b && (a.immersiveSession = null);
                    a.dispatchEvent("@@webxr-polyfill/vr-present-end", b.id)
                }
            })
        }
        ;
        k.global.Object.defineProperties(g.prototype, {
            depthNear: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this.display.depthNear
                },
                set: function(a) {
                    this.display.depthNear = a
                }
            },
            depthFar: {
                configurable: !0,
                enumerable: !0,
                get: function() {
                    return this.display.depthFar
                },
                set: function(a) {
                    this.display.depthFar = a
                }
            }
        });
        k.inherits(f, g);
        var $g = 0;
        k.inherits(d, p);
        d.prototype.onBaseLayerSet = function(a, b) {
            this.sessions.get(a).baseLayer = b
        }
        ;
        d.prototype.isSessionSupported = function(a) {
            return "inline" == a
        }
        ;
        d.prototype.isFeatureSupported = function(a) {
            switch (a) {
            case "viewer":
                return !0;
            default:
                return !1
            }
        }
        ;
        d.prototype.requestSession = function(a, b) {
            var c = this, d;
            return k.asyncExecutePromiseGeneratorProgram(function(f) {
                if (!c.isSessionSupported(a))
                    return f.return(Promise.reject());
                d = new e(a,b);
                c.sessions.set(d.id, d);
                return f.return(Promise.resolve(d.id))
            })
        }
        ;
        d.prototype.requestAnimationFrame = function(a) {
            return window.requestAnimationFrame(a)
        }
        ;
        d.prototype.cancelAnimationFrame = function(a) {
            window.cancelAnimationFrame(a)
        }
        ;
        d.prototype.onFrameStart = function(a, b) {
            a = this.sessions.get(a);
            a.baseLayer && (a = a.baseLayer.context.canvas,
            N(this.projectionMatrix, b.inlineVerticalFieldOfView, a.width / a.height, b.depthNear, b.depthFar))
        }
        ;
        d.prototype.onFrameEnd = function() {}
        ;
        d.prototype.endSession = function(a) {
            var b = this, c;
            return k.asyncExecutePromiseGeneratorProgram(function(d) {
                c = b.sessions.get(a);
                c.ended = !0;
                d.jumpToEnd()
            })
        }
        ;
        d.prototype.doesSessionSupportReferenceSpace = function(a, b) {
            a = this.sessions.get(a);
            return a.ended ? !1 : a.enabledFeatures.has(b)
        }
        ;
        d.prototype.requestStageBounds = function() {
            return null
        }
        ;
        d.prototype.requestFrameOfReferenceTransform = function() {
            return k.asyncExecutePromiseGeneratorProgram(function(a) {
                return a.return(null)
            })
        }
        ;
        d.prototype.getProjectionMatrix = function() {
            return this.projectionMatrix
        }
        ;
        d.prototype.getViewport = function(a, b, c, d) {
            this.sessions.get(a);
            b = c.context.canvas;
            a = b.width;
            b = b.height;
            d.x = d.y = 0;
            d.width = a;
            d.height = b;
            return !0
        }
        ;
        d.prototype.getBasePoseMatrix = function() {
            return this.identityMatrix
        }
        ;
        d.prototype.getBaseViewMatrix = function() {
            return this.identityMatrix
        }
        ;
        d.prototype.getInputSources = function() {
            return []
        }
        ;
        d.prototype.getInputPose = function() {
            return null
        }
        ;
        d.prototype.onWindowResize = function() {}
        ;
        var Zg = {
            global: za,
            webvr: !0,
            cardboard: !0,
            cardboardConfig: null,
            allowCardboardOnDesktop: !1
        }
          , qd = ["navigator", "HTMLCanvasElement", "WebGLRenderingContext"];
        a.prototype._injectPolyfill = function(a) {
            if (!qd.every(function(b) {
                return !!a[b]
            }))
                throw Error("Global must have the following attributes : " + qd);
            for (var b = k.makeIterator(Object.keys(ne)), c = b.next(); !c.done; c = b.next())
                c = c.value,
                void 0 !== a[c] ? console.warn(c + " already defined on global.") : a[c] = ne[c];
            u(a.WebGLRenderingContext) && (r(a.HTMLCanvasElement),
            a.OffscreenCanvas && r(a.OffscreenCanvas),
            a.WebGL2RenderingContext && u(a.WebGL2RenderingContext),
            window.isSecureContext || console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
            this.injected = !0;
            this._patchNavigatorXR()
        }
        ;
        a.prototype._patchNavigatorXR = function() {
            var a = b(this.global, this.config);
            this.xr = new ne.XRSystem(a);
            Object.defineProperty(this.global.navigator, "xr", {
                value: this.xr,
                configurable: !0
            })
        }
        ;
        a.prototype._injectCompatibilityShims = function(a) {
            if (!qd.every(function(b) {
                return !!a[b]
            }))
                throw Error("Global must have the following attributes : " + qd);
            if (a.navigator.xr && "supportsSession"in a.navigator.xr && !("isSessionSupported"in a.navigator.xr)) {
                var b = a.navigator.xr.supportsSession;
                a.navigator.xr.isSessionSupported = function(a) {
                    return b.call(this, a).then(function() {
                        return !0
                    }).catch(function() {
                        return !1
                    })
                }
                ;
                a.navigator.xr.supportsSession = function(a) {
                    console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");
                    return b.call(this, a)
                }
            }
        }
        ;
        return a
    }
    "object" === typeof exports && "undefined" !== typeof module ? module.exports = kb() : "function" === typeof define && define.amd ? define(kb) : this.WebXRPolyfill = kb();
    function nb(a, b, c, d, e, f, g, h) {
        this.id = a;
        this.name = b;
        this.parentTexture = c;
        this.textureCropper = d;
        this.extractedTexture = this.stdExt = this.rawExt = null;
        this.uvOffsetScale = new t.Vector4(e,f,g,h);
        this.isCutout = !1;
        this.importAutoScale = this.importGpuCompress = !0
    }
    nb.prototype = {
        addLoadedListener: function(a) {
            this.parentTexture.addLoadedListener(a)
        },
        extractTexture: function() {
            console.assert(null !== this.textureCropper);
            console.assert(null === this.extractedTexture);
            this.extractedTexture = this.textureCropper.cropTextureToPoTTarget(this.parentTexture, this.uvOffsetScale)
        },
        get hasAlpha() {
            return this.parentTexture.hasAlpha
        },
        serialize: function() {
            return {
                id: this.id,
                name: this.name,
                atlasId: this.parentTexture.id,
                atlasOffset: [this.uvOffsetScale.x, this.uvOffsetScale.y],
                atlasScale: [this.uvOffsetScale.z, this.uvOffsetScale.w],
                rawExt: this.rawExt,
                stdExt: this.stdExt,
                webFormats: [],
                alpha: this.hasAlpha,
                importGpuCompress: this.importGpuCompress,
                importAutoScale: this.importAutoScale
            }
        }
    };
    function ob(a, b, c, d, e, f, g, h) {
        this.webFormats = this.stdExt = this.rawExt = this.name = this.id = null;
        this.isCube = !1;
        this.image = a;
        this.height = this.width = null;
        this.mipmaps = [];
        this.wrapS = void 0 !== b ? b : GLC.CLAMP_TO_EDGE;
        this.wrapT = void 0 !== c ? c : GLC.CLAMP_TO_EDGE;
        this.magFilter = void 0 !== d ? d : GLC.LINEAR;
        this.minFilter = void 0 !== e ? e : GLC.LINEAR_MIPMAP_LINEAR;
        this.anisotropy = void 0 !== h ? h : 1;
        this.isRgbm = this.isCutout = this.hasAlpha = this.isAnimated = !1;
        this.format = void 0 !== f ? f : GLC.RGBA;
        this.type = void 0 !== g ? g : GLC.UNSIGNED_BYTE;
        this.generateMipmaps = !0;
        this.premultiplyAlpha = !1;
        this.flipY = !0;
        this.unpackAlignment = 4;
        this._textureCropper = this._atlasEntries = null;
        this._needsUpdate = !1;
        this.releaseOnLoadedToGpu = !0;
        this.loaded = !1;
        this._loadedListeners = [];
        this.__webglSlot = this.__webglTexture = null;
        this.importAutoScale = this.importGpuCompress = !0;
        this.passphrase = null
    }
    ob.prototype = {
        constructor: ob,
        sleepAnimation: function() {
            console.assert(!1)
        },
        wakeAnimation: function() {
            console.assert(!1)
        },
        get needsUpdate() {
            return this._needsUpdate
        },
        set needsUpdate(a) {
            this._needsUpdate = a
        },
        isAtlas: function() {
            return null !== this._atlasEntries
        },
        enableAtlas: function(a) {
            console.assert(!this.isAtlas());
            this._atlasEntries = {};
            this._textureCropper = a
        },
        getAtlasEntry: function(a, b, c, d, e, f) {
            var g = this._atlasEntries[b];
            if (g)
                return g;
            console.assert(!this.loaded);
            g = new nb(a,b,this,this._textureCropper,c,d,e,f);
            return this._atlasEntries[b] = g
        },
        forEachAtlasEntry: function(a) {
            for (var b in this._atlasEntries)
                this._atlasEntries.hasOwnProperty(b) && a(this._atlasEntries[b])
        },
        clone: function(a) {
            void 0 === a && (a = new ob);
            a.isCube = a.isCube;
            a.image = this.image;
            a.mipmaps = this.mipmaps.slice(0);
            a.wrapS = this.wrapS;
            a.wrapT = this.wrapT;
            a.magFilter = this.magFilter;
            a.minFilter = this.minFilter;
            a.anisotropy = this.anisotropy;
            a.isCutout = this.isCutout;
            a.isAnimated = this.isAnimated;
            a.hasAlpha = this.hasAlpha;
            a.format = this.format;
            a.type = this.type;
            a.generateMipmaps = this.generateMipmaps;
            a.premultiplyAlpha = this.premultiplyAlpha;
            a.flipY = this.flipY;
            a.unpackAlignment = this.unpackAlignment;
            a.passphrase = this.passphrase;
            return a
        },
        serialize: function() {
            var a = {
                id: this.id,
                name: this.name,
                stdExt: this.stdExt,
                webFormats: this.webFormats,
                alpha: this.hasAlpha,
                importGpuCompress: this.importGpuCompress,
                importAutoScale: this.importAutoScale
            };
            this.passphrase && (a.passphrase = this.passphrase);
            this.rawExt && (a.rawExt = this.rawExt);
            this.isRgbm && (a.rgbm = !0);
            return a
        },
        dispose: function() {
            this._loadedListeners = [];
            this.dispatchEvent({
                type: "dispose"
            })
        },
        addLoadedListener: function(a) {
            this.loaded ? a() : this._loadedListeners.push(a)
        },
        notifyLoaded: function() {
            this.loaded = !0;
            for (var a = this._loadedListeners, b = 0; b < a.length; b += 1)
                a[b]();
            a.length = 0
        }
    };
    t.EventDispatcher.prototype.apply(ob.prototype);
    function pb(a, b, c, d, e, f, g, h, l, m) {
        ob.call(this, null, f, g, h, l, d, e, m);
        this.image = {
            width: b,
            height: c
        };
        this.mipmaps = a;
        this.generateMipmaps = this.flipY = !1
    }
    pb.prototype = Object.create(ob.prototype);
    pb.prototype.constructor = pb;
    pb.prototype.clone = function() {
        var a = new pb;
        ob.prototype.clone.call(this, a);
        return a
    }
    ;
    function qb(a, b, c, d, e, f, g, h, l, m) {
        ob.call(this, null, f, g, h, l, d, e, m);
        this.image = {
            data: a,
            width: b,
            height: c
        }
    }
    qb.prototype = Object.create(ob.prototype);
    qb.prototype.constructor = qb;
    qb.prototype.clone = function() {
        var a = new qb;
        ob.prototype.clone.call(this, a);
        return a
    }
    ;
    function rb(a, b, c, d, e, f, g, h, l) {
        var m = this;
        ob.call(this, a, b, c, d, e, f, g, h, l);
        this.generateMipmaps = !1;
        this.isAnimated = !0;
        this.releaseOnLoadedToGpu = !1;
        this._isPlaying = !0;
        this._pauseRequested = this._isSleeping = !1;
        this._videoSrc = null;
        this._pausedTime = 0;
        this._interruptible = !0;
        this._resizedListeners = [];
        this._handlePaused = function() {
            m._pauseRequested ? m._pauseRequested = !1 : m._isSleeping = !0;
            !m._isPlaying && m._interruptible && (m.video.src = "")
        }
        ;
        this._handleEnded = function() {
            m._isPlaying = !1;
            m._isSleeping = !1
        }
        ;
        this._notifyResized = function() {
            m.width = m.video.videoWidth;
            m.height = m.video.videoHeight;
            for (var a = 0; a < m._resizedListeners.length; a += 1)
                m._resizedListeners[a]()
        }
    }
    rb.prototype = Object.create(ob.prototype);
    rb.prototype.constructor = rb;
    rb.prototype._srcAtPausedPosition = function() {
        return this._videoSrc + "#t=" + this._pausedTime
    }
    ;
    rb.prototype._pauseVideo = function() {
        this._pausedTime = this.video.currentTime;
        this.video.pause()
    }
    ;
    rb.prototype.rewind = function() {
        this._pausedTime = 0;
        this.video.currentTime = 0
    }
    ;
    Object.defineProperty(rb.prototype, "video", {
        get: function() {
            return this.image
        },
        set: function(a) {
            console.assert(void 0 === this.image, "Video already attached to texture.");
            this.image = a;
            this._videoSrc = a.src;
            this._isPlaying = !a.paused && !a.ended;
            a.addEventListener("pause", this._handlePaused);
            a.addEventListener("ended", this._handleEnded);
            a.addEventListener("resize", this._notifyResized);
            this._isSleeping && this._isPlaying && this._pauseVideo()
        }
    });
    Object.defineProperty(rb.prototype, "muted", {
        get: function() {
            return this.video.muted
        },
        set: function(a) {
            this.video.muted = a
        }
    });
    Object.defineProperty(rb.prototype, "loop", {
        get: function() {
            return this.video.loop
        },
        set: function(a) {
            this.video.loop = a
        }
    });
    Object.defineProperty(rb.prototype, "isPlaying", {
        get: function() {
            return !this._isSleeping && this._isPlaying
        }
    });
    rb.prototype.play = function() {
        var a = this;
        if (!this._isPlaying)
            if (this._isSleeping)
                this._isPlaying = !0;
            else {
                var b = this.video;
                this._interruptible && (b.src = this._srcAtPausedPosition());
                var c = b.play();
                c ? (this._isPlaying = !0,
                c.catch(function(b) {
                    console.log("Can't play video texture: " + b);
                    a._isPlaying = !1
                })) : this._isPlaying = !b.paused && !b.ended
            }
    }
    ;
    rb.prototype.pause = function() {
        this._isPlaying && this.video && (this._isPlaying = !1,
        this._isSleeping || (this._pauseRequested = !0,
        this._pauseVideo()))
    }
    ;
    rb.prototype.sleepAnimation = function() {
        this._isSleeping || (this._isPlaying && this.video && this._pauseVideo(),
        this._isSleeping = !0)
    }
    ;
    rb.prototype.wakeAnimation = function() {
        this._isSleeping && (this._isPlaying && this.video && (this._interruptible && (this.video.src = this._srcAtPausedPosition()),
        this.video.play()),
        this._isSleeping = !1)
    }
    ;
    rb.prototype.dispose = function() {
        ob.prototype.dispose.call(this);
        this._isPlaying && this.pause();
        var a = this.video;
        this.image = null;
        this._videoSrc = "";
        this._isPlaying = !1;
        a.src = "";
        a.removeEventListener("pause", this._handlePaused);
        a.removeEventListener("ended", this._handleEnded);
        a.removeEventListener("resize", this._notifyResized);
        this._resizedListeners.length = 0
    }
    ;
    rb.prototype.addResizedListener = function(a) {
        this._resizedListeners.push(a)
    }
    ;
    rb.prototype.serialize = function() {
        var a = ob.prototype.serialize.call(this);
        a.video = !0;
        return a
    }
    ;
    Object.defineProperty(rb.prototype, "needsUpdate", {
        get: function() {
            return this._needsUpdate || this.isPlaying && this.video && !0 !== this.video.seeking && this.video.readyState >= this.video.HAVE_CURRENT_DATA
        },
        set: function(a) {
            this._needsUpdate = a
        }
    });
    function sb(a, b, c) {
        this.y = this.x = 0;
        this.width = a;
        this.height = b;
        c = c || {};
        this.wrapS = void 0 !== c.wrapS ? c.wrapS : GLC.CLAMP_TO_EDGE;
        this.wrapT = void 0 !== c.wrapT ? c.wrapT : GLC.CLAMP_TO_EDGE;
        this.magFilter = void 0 !== c.magFilter ? c.magFilter : GLC.LINEAR;
        this.minFilter = void 0 !== c.minFilter ? c.minFilter : GLC.LINEAR_MIPMAP_LINEAR;
        this.anisotropy = void 0 !== c.anisotropy ? c.anisotropy : 1;
        this.offset = new t.Vector2(0,0);
        this.repeat = new t.Vector2(1,1);
        this.format = void 0 !== c.format ? c.format : GLC.RGBA;
        this.type = void 0 !== c.type ? c.type : GLC.UNSIGNED_BYTE;
        this.depthBuffer = void 0 !== c.depthBuffer ? c.depthBuffer : !0;
        this.stencilBuffer = void 0 !== c.stencilBuffer ? c.stencilBuffer : !0;
        this.generateMipmaps = c.generateMipmaps || !1;
        this.shareDepthFrom = void 0 !== c.shareDepthFrom ? c.shareDepthFrom : null;
        this.isCube = !1;
        this.loaded = !0;
        this.__webglSlot = this.__webglTexture = this.__webglRenderbuffer = this.__webglFramebuffer = null
    }
    sb.prototype = {
        constructor: sb,
        dispose: function() {
            this.dispatchEvent({
                type: "dispose"
            })
        }
    };
    t.EventDispatcher.prototype.apply(sb.prototype);
    function tb(a) {
        this.__webglFramebuffer = a;
        this.height = this.width = this.y = this.x = null;
        this.isCube = !1
    }
    tb.prototype = {
        constructor: tb,
        dispose: function() {
            this.__webglFramebuffer = null;
            this.dispatchEvent({
                type: "dispose"
            })
        }
    };
    t.EventDispatcher.prototype.apply(tb.prototype);
    function ub(a, b, c) {
        sb.call(this, a, b, c);
        this.activeCubeFace = 0;
        this.isCube = !0;
        this.__webglFramebuffer = [];
        this.__webglRenderbuffer = []
    }
    ub.prototype = Object.create(sb.prototype);
    ub.prototype.constructor = ub;
    var wb = WALK.DEBUG;
    function yb(a) {
        var b = {
            format: GLC.RGBA,
            magFilter: GLC.NEAREST,
            minFilter: GLC.NEAREST,
            stencilBuffer: !1,
            depthBuffer: !1,
            generateMipmaps: !1
        }
          , c = [a.createRenderTarget(1024, 1024, b), a.createRenderTarget(512, 512, b)];
        b = {
            uniforms: {
                map: {
                    type: "t",
                    value: null
                },
                mapUvStep: {
                    type: "v2",
                    value: null
                },
                mapUvOffsetScale: {
                    type: "v4",
                    value: null
                }
            },
            vertexShader: WALK.getShader("alpha_stats_vertex.glsl"),
            fragmentShader: WALK.getShader("alpha_stats_fragment.glsl")
        };
        var d = new t.ShaderPass(b,"map");
        d.material.depthTest = !1;
        d.material.depthWrite = !1;
        var e = new t.Vector2
          , f = new t.Vector4;
        d.uniforms.mapUvStep.value = e;
        d.uniforms.mapUvOffsetScale.value = f;
        b = {
            uniforms: {
                map: {
                    type: "t",
                    value: null
                },
                mapUvStep: {
                    type: "v2",
                    value: null
                },
                mapUvScale: {
                    type: "v2",
                    value: null
                }
            },
            vertexShader: WALK.getShader("alpha_stats_vertex.glsl"),
            fragmentShader: WALK.getShader("alpha_stats_combine_fragment.glsl")
        };
        var g = new t.ShaderPass(b,"map");
        g.material.depthTest = !1;
        g.material.depthWrite = !1;
        var h = new t.Vector2;
        g.uniforms.mapUvScale.value = h;
        g.uniforms.mapUvStep.value = e;
        var l = new Uint8Array(4096)
          , m = null;
        wb && (m = new WALK.Timer);
        this.isCutoutTexture = function(b) {
            var n = void 0 !== b.parentTexture;
            if (n) {
                var q = b.parentTexture;
                var r = b.uvOffsetScale.x;
                var u = b.uvOffsetScale.y;
                var v = b.uvOffsetScale.z;
                var w = b.uvOffsetScale.w
            } else
                q = b,
                r = u = 0,
                v = w = 1;
            if (!q.hasAlpha || q.video)
                b.isCutout = !1;
            else {
                wb && m.reset();
                a.enableScissorTest(!0);
                var x = q.width * v
                  , y = q.height * w;
                e.set(1 / x, 1 / y);
                f.set(r, u, v, w);
                x = Math.max(Math.floor(x / 2), 1);
                y = Math.max(Math.floor(y / 2), 1);
                a.setRenderTarget(c[0]);
                a.setViewport(0, 0, x, y);
                a.setScissor(0, 0, x, y);
                d.render(a, c[0], q);
                for (var z = 1, A = c[0]; 1 !== x && 1 !== y; ) {
                    e.set(1 / A.width, 1 / A.height);
                    h.set(x / A.width, y / A.height);
                    x = Math.floor(x / 2);
                    y = Math.floor(y / 2);
                    var B = c[z];
                    a.setRenderTarget(B);
                    a.setViewport(0, 0, x, y);
                    a.setScissor(0, 0, x, y);
                    g.render(a, B, A);
                    A = B;
                    z = (z + 1) % 2
                }
                a.readPixels(x, y, l);
                A = z = 0;
                x = Math.max(x, y);
                for (y = 0; y < x; ++y)
                    z += l[4 * y],
                    A += l[4 * y + 1];
                z = 100 * z / (255 * x);
                A = 100 * A / (255 * x);
                b.isCutout = 20 > z || 50 < A;
                wb && (x = "",
                n && (x += "From atlas: " + q.name + " [" + r + ", " + u + ", " + v + ", " + w + "]\n"),
                console.log(b.name + " " + q.width + "x" + q.height + "\n " + x + "Is cutout: " + b.isCutout + "\n Partialy transparent regions: " + z + "%\n Fully transparent pixels: " + A + "%\n Time: " + m.elapsedSec()));
                a.enableScissorTest(!1)
            }
        }
        ;
        this.dispose = function() {
            c[0].dispose();
            c[1].dispose();
            d.dispose();
            g.dispose()
        }
    }
    ;function zb(a) {
        var b = new t.ShaderPass({
            uniforms: {
                srcTexture: {
                    type: "t",
                    value: null
                },
                uvOffsetScale: {
                    type: "v4",
                    value: null
                }
            },
            vertexShader: WALK.getShader("crop_texture_vertex.glsl"),
            fragmentShader: WALK.getShader("crop_texture_fragment.glsl")
        },"srcTexture");
        b.material.depthTest = !1;
        b.material.depthWrite = !1;
        this.cropTextureToPoTTarget = function(c, d) {
            var e = t.Math.nextPowerOfTwo(d.z * c.width)
              , f = t.Math.nextPowerOfTwo(d.w * c.height);
            e = a.createRenderTarget(e, f, {
                wrapS: GLC.REPEAT,
                wrapT: GLC.REPEAT,
                magFilter: GLC.LINEAR,
                minFilter: GLC.LINEAR_MIPMAP_LINEAR,
                format: GLC.RGBA,
                type: GLC.UNSIGNED_BYTE,
                depthBuffer: !1,
                stencilBuffer: !1,
                generateMipmaps: !0
            });
            b.uniforms.uvOffsetScale.value = d;
            b.render(a, e, c);
            a.deallocateRenderTargetRenderingBuffers(e);
            return e
        }
    }
    ;WALK.SHADERS = {};
    WALK.SHADERS["static_render_fragment.glsl"] = "//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) -\nE / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l,\nin float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\nfragColor = vec4(linearToGammaToneMapped(colorLinear), 1.0);\n}\n";
    WALK.SHADERS["editor_light_fragment.glsl"] = "//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) -\nE / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l,\nin float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vNormal;\nvarIn vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\nfragColor = vec4(min(linearToGamma(lightColor), 1.0), 1.0);\n}\n";
    WALK.SHADERS["static_render_vertex.glsl"] = "//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["copy_opaque_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["crop_texture_fragment.glsl"] = "//AUTO GENERATED\nuniform sampler2D srcTexture;\nuniform vec4 uvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = texture2D(srcTexture, uvOffsetScale.xy + vUv * uvOffsetScale.zw);\n}\n";
    WALK.SHADERS["equirect_sky_fragment.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) -\nE / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l,\nin float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 cubic(in float v){\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeBicubic(in sampler2D sampler, in vec2 texSize, in vec2 texCoords){\nvec2 invTexSize = 1.0 / texSize;\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x);\nvec4 ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = c + vec4 (xcubic.yw, ycubic.yw) / s;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecode(texture2D(sampler, offset.xz));\nvec3 sample1 = hdrDecode(texture2D(sampler, offset.yz));\nvec3 sample2 = hdrDecode(texture2D(sampler, offset.xw));\nvec3 sample3 = hdrDecode(texture2D(sampler, offset.yw));\nfloat sx = s.x / (s.x + s.y);\nfloat sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#ifdef USE_FOG\nuniform float distanceDensity;\nuniform float distanceStart;\nuniform float heightDensity;\nuniform float heightStart;\nuniform vec3 color;\nconst float LOG2 = 1.442695;\nvec3 addFog(in vec3 colorIn, in float distance, in vec3 positionW) {\nfloat distanceValue = max(0.0, distance - distanceStart);\nfloat distanceFogExp = 1.0 - exp2(-distanceDensity * distanceDensity *\ndistanceValue * distanceValue * LOG2);\nfloat heightValue = max(0.0, -positionW.z + heightStart);\nfloat heightFogExp = 1.0 - exp2(-heightDensity * heightDensity * heightValue *\nheightValue * LOG2);\nfloat fogAmount = min(1.0, distanceFogExp + heightFogExp);\nreturn mix(colorIn, color, fogAmount);\n}\n#endif\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec2 vUv;\n#ifdef USE_FOG\nvarIn vec3 vPositionW;\nvarIn vec3 vPositionV;\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color, in float intensity) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color, mix(color0, color1, bOffset), intensity);\n}\nuniform sampler2D colorMap;\nuniform float colorMapIntensity;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef USE_FOG\nfloat distance = length(vPositionV);\ncolorLinear = addFog(colorLinear, distance, vPositionW);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\nfragColor = colorRgbm;\n#else\nfragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaToneMapped(colorExposed);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma, colorMapIntensity), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
    WALK.SHADERS["accumulate_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["equirect_sky_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\n#ifdef USE_FOG\nvarOut vec3 vPositionW;\nvarOut vec3 vPositionV;\n#endif\nvoid main() {\nvUv = uv;\n#ifdef USE_FOG\nvPositionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvPositionV = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n#endif\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["cap_vertex.glsl"] = "//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvoid main() {\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
    WALK.SHADERS["alpha_stats_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["minimap_add_alpha_fragment.glsl"] = "//AUTO GENERATED\nuniform sampler2D tColor;\n#ifdef USE_ALPHA_FROM_COLOR\nuniform vec3 colorFill;\n#else\nuniform sampler2D tAlpha;\n#endif\nvarIn vec2 vUv;\nvoid main() {\nvec4 color = texture2D(tColor, vUv);\n#ifdef USE_ALPHA_FROM_COLOR\nfloat alphaFromColor = (color.r + color.g + color.b) / 3.0;\nfragColor = vec4(colorFill, alphaFromColor);\n#else\nfloat alpha = vec4(texture2D(tAlpha, vUv)).a;\nfragColor = vec4(color.rgb, alpha);\n#endif\n}\n";
    WALK.SHADERS["rotate_gizmo_material_fragment.glsl"] = "//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarIn vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\nfragColor = outColor;\n}\n";
    WALK.SHADERS["aabb_query_fragment.glsl"] = "//AUTO GENERATED\nvarIn vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\nfragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\nfragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\nfragColor = encodeFloat(viewW.z);\n}\n}\n";
    WALK.SHADERS["editor_light_vertex.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarOut vec3 vNormal;\nvarOut vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
    WALK.SHADERS["alpha_stats_fragment.glsl"] = "//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\nfragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
    WALK.SHADERS["procedural_sky_vertex.glsl"] = "//AUTO GENERATED\n#ifdef USE_FOG\nvarOut vec3 vPositionW;\nvarOut vec3 vPositionV;\n#endif\nvarOut vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\n#ifdef USE_FOG\nvPositionW = positionW;\nvPositionV = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n#endif\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["mirror_vertex.glsl"] = "//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarOut vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
    WALK.SHADERS["wireframe_fragment.glsl"] = "//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\nfragColor = vec4(lineColor, (1.0 - edge) * lineMaxAlpha);\n} else {\nfragColor = vec4(highlight, highlightMix);\n}\n}\n";
    WALK.SHADERS["procedural_sky_fragment.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) -\nE / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l,\nin float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\n#ifdef USE_FOG\nuniform float distanceDensity;\nuniform float distanceStart;\nuniform float heightDensity;\nuniform float heightStart;\nuniform vec3 color;\nconst float LOG2 = 1.442695;\nvec3 addFog(in vec3 colorIn, in float distance, in vec3 positionW) {\nfloat distanceValue = max(0.0, distance - distanceStart);\nfloat distanceFogExp = 1.0 - exp2(-distanceDensity * distanceDensity *\ndistanceValue * distanceValue * LOG2);\nfloat heightValue = max(0.0, -positionW.z + heightStart);\nfloat heightFogExp = 1.0 - exp2(-heightDensity * heightDensity * heightValue *\nheightValue * LOG2);\nfloat fogAmount = min(1.0, distanceFogExp + heightFogExp);\nreturn mix(colorIn, color, fogAmount);\n}\n#endif\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec3 vWorldDirection;\n#ifdef USE_FOG\nvarIn vec3 vPositionW;\nvarIn vec3 vPositionV;\n#endif\n#ifdef HDR_OUTPUT\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color, in float intensity) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color, mix(color0, color1, bOffset), intensity);\n}\nuniform sampler2D colorMap;\nuniform float colorMapIntensity;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\nvec3 colorLinear = gammaToLinear(colorGamma);\n#ifdef USE_FOG\nfloat distance = length(vPositionV);\ncolorLinear = addFog(colorLinear, distance, vPositionW);\n#endif\n#ifdef HDR_OUTPUT\nfragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_FOG\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\ncolorGamma =  linearToGammaToneMapped(colorExposed);\n#endif\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma, colorMapIntensity), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
    WALK.SHADERS["copy_opaque_fragment.glsl"] = "//AUTO GENERATED\nuniform sampler2D tDiffuse;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = vec4(texture2D(tDiffuse, vUv).rgb, 1.0);\n}\n";
    WALK.SHADERS["outline_fragment.glsl"] = "//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";
    WALK.SHADERS["standard_material_vertex.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nwebgl2centroid varOut vec2 vUv2;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvarOut vec3 vPositionV;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvarOut vec3 vPositionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvPositionV = -mvPosition.xyz;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
    WALK.SHADERS["luma_fragment.glsl"] = "//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 cubic(in float v){\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeBicubic(in sampler2D sampler, in vec2 texSize, in vec2 texCoords){\nvec2 invTexSize = 1.0 / texSize;\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x);\nvec4 ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = c + vec4 (xcubic.yw, ycubic.yw) / s;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecode(texture2D(sampler, offset.xz));\nvec3 sample1 = hdrDecode(texture2D(sampler, offset.yz));\nvec3 sample2 = hdrDecode(texture2D(sampler, offset.xw));\nvec3 sample3 = hdrDecode(texture2D(sampler, offset.yw));\nfloat sx = s.x / (s.x + s.y);\nfloat sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nuniform vec2 lightMapSize;\nvec3 getLightIntensity() {\nreturn hdrDecodeBicubic(lightMap, lightMapSize, vUv2);\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\nfragColor.r = fract(luma);\nfragColor.g = floor(luma) / 255.0;\n}\n";
    WALK.SHADERS["cube_to_equirect_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["minimap_add_alpha_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["water.glsl"] = "//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
    WALK.SHADERS["rotate_gizmo_material_vertex.glsl"] = "//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
    WALK.SHADERS["sprite_vertex.glsl"] = "//AUTO GENERATED\nuniform vec3 offset;\n#ifdef USE_FOG\nvarOut vec3 vPositionW;\nvarOut vec3 vPositionV;\n#endif\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(offset, 1.0);\nvec2 scale;\n#ifdef USE_FOG\nvPositionW = (modelMatrix * vec4(offset, 1.0)).xyz;\nvPositionV = -mvPosition.xyz;\n#endif\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
    WALK.SHADERS["object_distance_vertex.glsl"] = "//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
    WALK.SHADERS["gaze_pointer_fragment.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarIn vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\nfragColor = vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\nfragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
    WALK.SHADERS["standard_material_fragment.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) -\nE / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l,\nin float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 cubic(in float v){\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeBicubic(in sampler2D sampler, in vec2 texSize, in vec2 texCoords){\nvec2 invTexSize = 1.0 / texSize;\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x);\nvec4 ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = c + vec4 (xcubic.yw, ycubic.yw) / s;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecode(texture2D(sampler, offset.xz));\nvec3 sample1 = hdrDecode(texture2D(sampler, offset.yz));\nvec3 sample2 = hdrDecode(texture2D(sampler, offset.xw));\nvec3 sample3 = hdrDecode(texture2D(sampler, offset.yw));\nfloat sx = s.x / (s.x + s.y);\nfloat sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n#ifdef USE_FOG\nuniform float distanceDensity;\nuniform float distanceStart;\nuniform float heightDensity;\nuniform float heightStart;\nuniform vec3 color;\nconst float LOG2 = 1.442695;\nvec3 addFog(in vec3 colorIn, in float distance, in vec3 positionW) {\nfloat distanceValue = max(0.0, distance - distanceStart);\nfloat distanceFogExp = 1.0 - exp2(-distanceDensity * distanceDensity *\ndistanceValue * distanceValue * LOG2);\nfloat heightValue = max(0.0, -positionW.z + heightStart);\nfloat heightFogExp = 1.0 - exp2(-heightDensity * heightDensity * heightValue *\nheightValue * LOG2);\nfloat fogAmount = min(1.0, distanceFogExp + heightFogExp);\nreturn mix(colorIn, color, fogAmount);\n}\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvarIn vec3 vPositionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarIn vec3 vNormalW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarIn vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvarIn vec3 vPositionV;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarIn vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 uv = vUv;\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT\nvec2 uvScaled = uv * baseColorAtlasUvMod.zw;\nvec2 dfdx = dFdx(uvScaled);\nvec2 dfdy = dFdy(uvScaled);\nuv = fract(uv) * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\nvec4 baseColorGamma = texture2DGradEXT(baseColorTexture, uv, dfdx, dfdy);\nfloat textureAlpha = baseColorGamma.a;\n#else\nuv = uv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture,\nvec2(uv.x, .5 + .5 * uv.y));\nfloat textureAlpha = texture2D(baseColorTexture,\nvec2(uv.x, .5 * uv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, uv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nuniform vec2 lightMapSize;\nvec3 getLightIntensity() {\nreturn hdrDecodeBicubic(lightMap, lightMapSize, vUv2);\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_ENVMAP)\nconst float DLT = 0.001;\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\nstruct Roughness {\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\nreturn r;\n}\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT USE_ENVMAP\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color, in float intensity) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color, mix(color0, color1, bOffset), intensity);\n}\nuniform sampler2D colorMap;\nuniform float colorMapIntensity;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\n#ifdef USE_EXPOSURE_AND_GAMMA\nuniform float exposure;\nuniform float cameraGamma;\n#else\nconst float exposure = 1.0f;\nconst float cameraGamma = 1.0f;\n#endif\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef USE_FOG\nfloat distance = length(vPositionV);\ndiffuseSpecularEmissive = addFog(diffuseSpecularEmissive, distance, vPositionW);\n#endif\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\nfragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaToneMapped(exposedColor);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, min(gammaColor, 1.0), colorMapIntensity), alpha);\n#else\nfragColor = vec4(gammaColor, alpha);\n#endif\n#endif // no HDR_OUTPUT\n}\n";
    WALK.SHADERS["crop_texture_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["cap_fragment.glsl"] = "//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";
    WALK.SHADERS["gaze_pointer_vertex.glsl"] = "//AUTO GENERATED\nvarOut vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";
    WALK.SHADERS["cubemap_filter_fragment.glsl"] = "//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 cubic(in float v){\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeBicubic(in sampler2D sampler, in vec2 texSize, in vec2 texCoords){\nvec2 invTexSize = 1.0 / texSize;\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x);\nvec4 ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = c + vec4 (xcubic.yw, ycubic.yw) / s;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecode(texture2D(sampler, offset.xz));\nvec3 sample1 = hdrDecode(texture2D(sampler, offset.yz));\nvec3 sample2 = hdrDecode(texture2D(sampler, offset.xw));\nvec3 sample3 = hdrDecode(texture2D(sampler, offset.yw));\nfloat sx = s.x / (s.x + s.y);\nfloat sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\nfragColor = hdrEncode(color);\n}\n";
    WALK.SHADERS["alpha_stats_combine_fragment.glsl"] = "//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\nfragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
    WALK.SHADERS["mirror_fragment.glsl"] = "//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarIn vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\nfragColor = color;\n}\n";
    WALK.SHADERS["anchor_vertex.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvarOut vec3 vPositionV;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvarOut vec3 vPositionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvPositionV = -mvPosition.xyz;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvPositionW = positionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
    WALK.SHADERS["outline_vertex.glsl"] = "//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nuniform float thickness;\nvoid main() {\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\nvec4 transformedPosition = transformPosition();\nfloat distToCamera = cameraPosition.z - transformedPosition.z;\nvec4 movedPosition = vec4(\ntransformedPosition.x - distToCamera * thickness * normal.x,\ntransformedPosition.y - distToCamera * thickness * normal.y,\ntransformedPosition.z, transformedPosition.w);\ngl_Position = projectionMatrix * modelViewMatrix * movedPosition;\n}\n";
    WALK.SHADERS["object_id_distance_fragment.glsl"] = "//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";
    WALK.SHADERS["accumulate_fragment.glsl"] = "//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarIn vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\nfragColor = vec4(inputColor, weight);\n}\n";
    WALK.SHADERS["aabb_query_vertex.glsl"] = "//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
    WALK.SHADERS["cube_to_equirect_fragment.glsl"] = "//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarIn vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\nfragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
    WALK.SHADERS["cubemap_filter_vertex.glsl"] = "//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";
    WALK.SHADERS["object_id_fragment.glsl"] = "//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 0);\n}\n";
    WALK.SHADERS["wireframe_vertex.glsl"] = "//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattr float order;\nvarOut vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
    WALK.Shader = function(a, b) {
        this.id = a;
        this.code = b
    }
    ;
    var Ab = 0;
    WALK.InlineShader = function(a) {
        WALK.Shader.call(this, "inline:" + Ab, a);
        Ab += 1
    }
    ;
    WALK.getShader = function(a) {
        return new WALK.Shader(a,WALK.SHADERS[a])
    }
    ;
    var Eb = {
        HABLE: 1,
        UNREAL: 2,
        UCHIMURA: 3
    };
    WALK.Camera = function() {
        var a = this;
        t.PerspectiveCamera.call(this, WALK.CAMERA_DEFAULT_FOV, 1, WALK.CAMERA_WALK_NEAR, WALK.CAMERA_MIN_FAR);
        this._defaultFov = this.fov;
        this._exposure = this._defaultExposure = 0;
        this._gamma = this._defaultGamma = 1;
        this._autoExposure = !1;
        this._autoExposureDarkness = .3;
        this._moveMaxSpeed = WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;
        this._autoClimb = this._autoPath = !1;
        this._toneMapping = this._colorMap = this._fixedHeight = null;
        this._colorMapIntensity = 1;
        this._exposureUpdatedEvent = {
            type: "exposureUpdated",
            target: null
        };
        this._gammaUpdatedEvent = {
            type: "gammaUpdated",
            target: null
        };
        this._colorMapUpdated = {
            type: "colorMapUpdated",
            target: null
        };
        this._toneMappingUpdated = {
            type: "toneMappingUpdated",
            target: null
        };
        var b = {
            type: "updated",
            target: this
        };
        this._updated = function() {
            return a.dispatchEvent(b)
        }
    }
    ;
    WALK.Camera.prototype = Object.create(t.PerspectiveCamera.prototype);
    WALK.Camera.prototype.constructor = WALK.Camera;
    Object.defineProperty(WALK.Camera.prototype, "defaultFov", {
        get: function() {
            return this._defaultFov
        },
        set: function(a) {
            this.fov = this._defaultFov = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "colorMap", {
        get: function() {
            return this._colorMap
        },
        set: function(a) {
            var b = this;
            this._colorMap && this._colorMap.dispose();
            (this._colorMap = a) && !a.loaded && a.addLoadedListener(function() {
                return b.dispatchEvent(b._colorMapUpdated)
            });
            this.dispatchEvent(this._colorMapUpdated)
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "colorMapIntensity", {
        get: function() {
            return this._colorMapIntensity
        },
        set: function(a) {
            this._colorMapIntensity = a;
            this.dispatchEvent(this._colorMapUpdated)
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "toneMapping", {
        get: function() {
            return this._toneMapping
        },
        set: function(a) {
            a !== this._toneMapping && (this._toneMapping = a,
            this.dispatchEvent(this._toneMappingUpdated))
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "toneMappingModes", {
        get: function() {
            return Eb
        }
    });
    WALK.Camera.prototype.colorMapReady = function() {
        return this._colorMap && this._colorMap.loaded
    }
    ;
    Object.defineProperty(WALK.Camera.prototype, "defaultExposure", {
        get: function() {
            return this._defaultExposure
        },
        set: function(a) {
            this._defaultExposure = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "exposure", {
        get: function() {
            return this._exposure
        },
        set: function(a) {
            a !== this._exposure && (this._exposure = a,
            this.dispatchEvent(this._exposureUpdatedEvent))
        }
    });
    WALK.Camera.prototype.setExposureController = function(a) {
        this.exposureController = a
    }
    ;
    WALK.Camera.prototype.setExposure = function(a) {
        this.exposureController ? this.exposureController.setTargetExposure(a) : this.exposure = a
    }
    ;
    Object.defineProperty(WALK.Camera.prototype, "defaultGamma", {
        get: function() {
            return this._defaultGamma
        },
        set: function(a) {
            this._defaultGamma = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "gamma", {
        get: function() {
            return this._gamma
        },
        set: function(a) {
            a !== this._gamma && (this._gamma = a,
            this.dispatchEvent(this._gammaUpdatedEvent))
        }
    });
    WALK.Camera.prototype.setGamma = function(a) {
        this.gamma = a
    }
    ;
    Object.defineProperty(WALK.Camera.prototype, "autoExposure", {
        get: function() {
            return this._autoExposure
        },
        set: function(a) {
            a !== this._autoExposure && (this._autoExposure = a,
            this._exposure = this._defaultExposure,
            this._updated())
        }
    });
    WALK.Camera.prototype.setFar = function(a) {
        this.far = a;
        this.updateProjectionMatrix();
        this._updated()
    }
    ;
    Object.defineProperty(WALK.Camera.prototype, "moveMaxSpeed", {
        get: function() {
            return this._moveMaxSpeed
        },
        set: function(a) {
            this._moveMaxSpeed = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "autoPath", {
        get: function() {
            return this._autoPath
        },
        set: function(a) {
            this._autoPath = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "autoClimb", {
        get: function() {
            return this._autoClimb
        },
        set: function(a) {
            this._autoClimb = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "autoExposureDarkness", {
        get: function() {
            return this._autoExposureDarkness
        },
        set: function(a) {
            this._autoExposureDarkness = a;
            this._updated()
        }
    });
    Object.defineProperty(WALK.Camera.prototype, "fixedHeight", {
        get: function() {
            return this._fixedHeight || WALK.CAMERA_FIXED_HEIGHT
        },
        set: function(a) {
            this._fixedHeight = a;
            this._updated()
        }
    });
    WALK.Camera.prototype.serialize = function() {
        return {
            fov: this.defaultFov,
            exposure: this.defaultExposure,
            gamma: this.defaultGamma,
            lutTexture: this.colorMap ? this.colorMap.serialize() : null,
            lutIntensity: this.colorMapIntensity,
            toneMapping: this.toneMapping,
            autoPath: this.autoPath,
            autoClimb: this.autoClimb,
            moveMaxSpeed: this.moveMaxSpeed,
            fixedHeight: this._fixedHeight
        }
    }
    ;
    t.EventDispatcher.prototype.apply(WALK.Camera.prototype);
    var Fb = 0
      , Gb = [0, 0]
      , Hb = Object.freeze({
        uv: Gb,
        uv2: Gb,
        uv2Mod: [0, 0, 1 / 65535, 1 / 65535],
        t0: [1, 0, 0, 0],
        t1: [0, 1, 0, 0],
        t2: [0, 0, 1, 0]
    })
      , Ib = Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" "))
      , Jb = new WALK.InlineShader("")
      , Kb = Object.keys(Eb).map(function(a) {
        return "TONE_MAPPING_" + a
    });
    function Lb(a) {
        return "TONE_MAPPING_" + Object.keys(Eb).find(function(b) {
            return Eb[b] === a
        })
    }
    WALK.BaseMaterial = function(a, b, c) {
        var d = this;
        c = void 0 === c ? Jb : c;
        Fb += 1;
        Object.defineProperty(this, "id", {
            value: Fb
        });
        this.name = "";
        this.side = t.FrontSide;
        this.doNotOverrideSide = !1;
        this.opacity = 1;
        this.transparent = !1;
        this.transparentRenderOrder = 0;
        this.blending = t.NoBlending;
        this.blendSrc = GLC.SRC_ALPHA;
        this.blendDst = GLC.ONE_MINUS_SRC_ALPHA;
        this.blendEquation = GLC.FUNC_ADD;
        this.blendEquationAlpha = this.blendDstAlpha = this.blendSrcAlpha = null;
        this.colorWrite = this.depthWrite = this.depthTest = !0;
        this._hideFromLightProbes = !1;
        this._defines = new Set;
        this._definesString = null;
        this._textureLodExtension = this._standardDerivativesExtension = !1;
        this.uniforms = {};
        this.attributes = Ib;
        this._vertexShaderBody = a;
        this._fragmentShaderBody = b;
        this._fragmentShaderHooks = c;
        this.defaultAttributeValues = Hb;
        this.index0AttributeName = void 0;
        this._programNeedsUpdate = this.visible = !0;
        this._sharedMaterialState = this.program = null;
        this.toneMappingSupported = this.exposureAndGammaSupported = this.colorMapSupported = this.hdrOutputSupported = this.fogSupported = !1;
        var e = {
            type: "updated",
            target: this
        };
        this._updated = function() {
            return d.dispatchEvent(e)
        }
    }
    ;
    WALK.BaseMaterial.prototype = {
        constructor: WALK.BaseMaterial,
        get isAnimated() {
            return !1
        },
        get isPlaying() {
            return !1
        },
        update: function() {},
        rewind: function() {
            console.assert(!1)
        },
        play: function() {
            console.assert(!1)
        },
        pause: function() {
            console.assert(!1)
        },
        get hideFromLightProbes() {
            return this._hideFromLightProbes
        },
        set hideFromLightProbes(a) {
            this._hideFromLightProbes = a
        },
        get programNeedsUpdate() {
            return this._programNeedsUpdate
        },
        set programNeedsUpdate(a) {
            this._definesString = null;
            this._programNeedsUpdate = a
        },
        get sharedMaterialState() {
            return this._sharedMaterialState
        },
        set sharedMaterialState(a) {
            this._sharedMaterialState = a;
            this._setSharedStateUpdate();
            this._applySharedState()
        },
        hasDefine: function(a) {
            return this._defines.has(a)
        },
        addDefine: function(a) {
            this.hasDefine(a) || (this._defines.add(a),
            this.programNeedsUpdate = !0)
        },
        removeDefine: function(a) {
            this.hasDefine(a) && (this._defines.delete(a),
            this.programNeedsUpdate = !0)
        },
        condDefine: function(a, b) {
            a ? this.addDefine(b) : this.removeDefine(b);
            return a
        },
        _getDefinesString: function() {
            if (null === this._definesString) {
                for (var a = [], b = k.makeIterator(this._defines), c = b.next(); !c.done; c = b.next())
                    a.push("#define " + c.value);
                a.sort();
                this._definesString = a.join("\n")
            }
            return this._definesString
        },
        generateProgramId: function() {
            return [this._fragmentShaderBody.id, this._fragmentShaderHooks.id, this._getDefinesString(), this._vertexShaderBody.id, this._standardDerivativesExtension ? "+" : "", this._textureLodExtension ? "+" : ""].join("$")
        },
        enableStandardDerivativesExtension: function() {
            WALK.DETECTOR.gl.webgl2 || this._standardDerivativesExtension || (this.programNeedsUpdate = this._standardDerivativesExtension = !0)
        },
        enableTextureLodExtension: function() {
            WALK.DETECTOR.gl.webgl2 || this._textureLodExtension || (this.programNeedsUpdate = this._textureLodExtension = !0)
        },
        _getShaderHeader: function() {
            return WALK.DETECTOR.gl.webgl2 ? "#version 300 es\n#define texture2D texture\n#define textureCube texture\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define attr in\n#define varOut out\n#define varIn in\n#define webgl2centroid centroid\n" : "\n#define attr attribute\n#define varOut varying\n#define varIn varying\n#define webgl2centroid\n"
        },
        generateVertexShader: function() {
            return [this._getShaderHeader(), "precision highp float;\nprecision highp int;", this._getDefinesString(), "uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattr vec3 position;\nattr vec2 sphericalNormal;\nattr vec2 uv;\nattr vec2 uv2;\nattr vec4 uv2Mod;\nattr vec4 t0;\nattr vec4 t1;\nattr vec4 t2;", this._vertexShaderBody.code].join("\n")
        },
        generateFragmentShader: function() {
            return [this._getShaderHeader(), this._standardDerivativesExtension ? "#extension GL_OES_standard_derivatives : enable" : "", this._textureLodExtension ? "#extension GL_EXT_shader_texture_lod : require" : "", "precision " + WALK.DETECTOR.gl.fragmentPrecision + " float;", "precision " + WALK.DETECTOR.gl.fragmentPrecision + " int;", this._getDefinesString(), "uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;", WALK.DETECTOR.gl.webgl2 ? "out vec4 fragColor;" : "#define fragColor gl_FragColor", this._fragmentShaderBody.code, this._fragmentShaderHooks.code].join("\n")
        },
        dispose: function() {
            this.dispatchEvent({
                type: "dispose"
            })
        },
        setUniform: function(a, b, c) {
            this.uniforms[a] = {
                type: b,
                value: c
            }
        },
        propertyFromUniform: function(a) {
            Object.defineProperty(this, a, {
                get: function() {
                    return this.uniforms[a].value
                },
                set: function(b) {
                    this.uniforms[a].value = b
                }
            })
        },
        hash: function() {
            console.assert(!1, "hash not implemented")
        },
        canMerge: function() {
            console.assert(!1, "canMerge not implemented")
        },
        _setSharedStateUpdate: function() {
            var a = this;
            this._sharedMaterialState.addEventListener("updated", function() {
                a._applySharedState() && a._updated()
            })
        },
        _applySharedState: function() {
            var a = this
              , b = !1;
            if (this.fogSupported) {
                b = this.sharedMaterialState.fog;
                if (this.condDefine(null !== b && b.enabled(), "USE_FOG")) {
                    var c = b.heightEnabled ? b.heightDensity : 0;
                    this.setUniform("distanceDensity", "f", b.distanceEnabled ? b.distanceDensity : 0);
                    this.setUniform("distanceStart", "f", b.distanceStart);
                    this.setUniform("heightDensity", "f", c);
                    this.setUniform("heightStart", "f", b.heightStart);
                    this.setUniform("color", "c", b.color)
                }
                b = !0
            }
            this.hdrOutputSupported && (this.condDefine(this.sharedMaterialState.hdrOutput, "HDR_OUTPUT"),
            b = !0);
            this.colorMapSupported && (b = this.sharedMaterialState.colorMap,
            c = this.sharedMaterialState.colorMapIntensity,
            this.condDefine(null !== b && 0 < c, "USE_COLORMAP") && (this.setUniform("colorMap", "t", b),
            this.setUniform("colorMapIntensity", "f", c)),
            b = !0);
            this.exposureAndGammaSupported && (this.addDefine("USE_EXPOSURE_AND_GAMMA"),
            this.setUniform("exposure", "f", Math.pow(2, this.sharedMaterialState.cameraExposure)),
            this.setUniform("cameraGamma", "f", this.sharedMaterialState.cameraGamma),
            b = !0);
            this.toneMappingSupported && (Kb.forEach(function(b) {
                a.removeDefine(b)
            }),
            this.addDefine(Lb(this.sharedMaterialState.toneMapping)),
            b = !0);
            return b
        }
    };
    t.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype);
    t.FXAAShader = {
        uniforms: {
            tDiffuse: {
                type: "t",
                value: null
            },
            resolution: {
                type: "v2",
                value: new t.Vector2(1 / 1024,1 / 512)
            }
        },
        vertexShader: new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),
        fragmentShader: new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\nfragColor = rgbA;\n} else {\nfragColor = rgbB;\n}\n}")
    };
    t.EffectComposer = function(a) {
        this.renderer = a;
        this.renderTarget2 = this.renderTarget1 = null;
        this.passes = []
    }
    ;
    t.EffectComposer.prototype = {
        addPass: function(a) {
            this.passes.push(a)
        },
        disposeTarget: function() {
            this.renderTarget1 && (this.renderTarget1.dispose(),
            this.renderTarget1 = null);
            this.renderTarget2 && (this.renderTarget2.dispose(),
            this.renderTarget2 = null)
        },
        configureTarget: function(a, b, c) {
            this.disposeTarget();
            this.renderTarget1 = this.renderer.createRenderTarget(a, b, c);
            this.renderTarget2 = this.renderer.createRenderTarget(a, b, c)
        },
        render: function() {
            var a, b;
            return function(c) {
                a = this.renderTarget1;
                b = this.renderTarget2;
                var d, e = this.passes.length;
                for (d = 0; d < e; d++) {
                    var f = this.passes[d];
                    f.enabled && (f.render(this.renderer, a, b, c),
                    f.needsSwap && d != e - 1 && (f = b,
                    b = a,
                    a = f))
                }
            }
        }()
    };
    t.ShaderPass = function(a, b) {
        this.textureID = void 0 !== b ? b : "tDiffuse";
        this.material = new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);
        this.material.uniforms = t.UniformsUtils.clone(a.uniforms);
        this.uniforms = this.material.uniforms;
        this.renderToScreen = !1;
        this.needsSwap = this.enabled = !0;
        this.clear = !1;
        this.camera = new t.OrthographicCamera(-1,1,1,-1,0,1);
        this.scene = new t.Scene;
        this.quad = new t.Mesh(new t.PlaneBufferGeometry(2,2),this.material);
        this.scene.add(this.quad)
    }
    ;
    t.ShaderPass.prototype = {
        render: function(a, b, c) {
            var d = this.material.uniforms[this.textureID];
            d && (d.value = c);
            this.renderToScreen ? a.render(this.scene, this.camera) : a.render(this.scene, this.camera, b, this.clear)
        },
        dispose: function() {
            this.material.dispose();
            this.quad.geometry.dispose()
        }
    };
    t.RenderPass = function(a, b, c) {
        this.scene = a;
        this.camera = b;
        this.overrideMaterial = c;
        this.needsSwap = this.clear = this.enabled = !0
    }
    ;
    t.RenderPass.prototype = {
        render: function(a, b) {
            var c = this.scene.overrideMaterial;
            this.overrideMaterial && (this.scene.overrideMaterial = this.overrideMaterial);
            a.render(this.scene, this.camera, b, this.clear);
            this.scene.overrideMaterial = c
        }
    };
    function Mb(a) {
        return !isNaN(a) && isFinite(a)
    }
    function Pb(a, b) {
        for (var c = 0, d = a.length; c < d; c++)
            if (a[c] === b)
                return c;
        return -1
    }
    t.Octree = function(a) {
        a = a || {};
        this.nodeCount = 0;
        this.INDEX_INSIDE_CROSS = -1;
        this.INDEX_OUTSIDE_OFFSET = 2;
        this.INDEX_OUTSIDE_POS_X = Mb(a.INDEX_OUTSIDE_POS_X) ? a.INDEX_OUTSIDE_POS_X : 0;
        this.INDEX_OUTSIDE_NEG_X = Mb(a.INDEX_OUTSIDE_NEG_X) ? a.INDEX_OUTSIDE_NEG_X : 1;
        this.INDEX_OUTSIDE_POS_Y = Mb(a.INDEX_OUTSIDE_POS_Y) ? a.INDEX_OUTSIDE_POS_Y : 2;
        this.INDEX_OUTSIDE_NEG_Y = Mb(a.INDEX_OUTSIDE_NEG_Y) ? a.INDEX_OUTSIDE_NEG_Y : 3;
        this.INDEX_OUTSIDE_POS_Z = Mb(a.INDEX_OUTSIDE_POS_Z) ? a.INDEX_OUTSIDE_POS_Z : 4;
        this.INDEX_OUTSIDE_NEG_Z = Mb(a.INDEX_OUTSIDE_NEG_Z) ? a.INDEX_OUTSIDE_NEG_Z : 5;
        this.INDEX_OUTSIDE_MAP = [];
        this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X] = {
            index: this.INDEX_OUTSIDE_POS_X,
            count: 0,
            x: 1,
            y: 0,
            z: 0
        };
        this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X] = {
            index: this.INDEX_OUTSIDE_NEG_X,
            count: 0,
            x: -1,
            y: 0,
            z: 0
        };
        this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y] = {
            index: this.INDEX_OUTSIDE_POS_Y,
            count: 0,
            x: 0,
            y: 1,
            z: 0
        };
        this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y] = {
            index: this.INDEX_OUTSIDE_NEG_Y,
            count: 0,
            x: 0,
            y: -1,
            z: 0
        };
        this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z] = {
            index: this.INDEX_OUTSIDE_POS_Z,
            count: 0,
            x: 0,
            y: 0,
            z: 1
        };
        this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z] = {
            index: this.INDEX_OUTSIDE_NEG_Z,
            count: 0,
            x: 0,
            y: 0,
            z: -1
        };
        this.FLAG_POS_X = 1 << this.INDEX_OUTSIDE_POS_X + 1;
        this.FLAG_NEG_X = 1 << this.INDEX_OUTSIDE_NEG_X + 1;
        this.FLAG_POS_Y = 1 << this.INDEX_OUTSIDE_POS_Y + 1;
        this.FLAG_NEG_Y = 1 << this.INDEX_OUTSIDE_NEG_Y + 1;
        this.FLAG_POS_Z = 1 << this.INDEX_OUTSIDE_POS_Z + 1;
        this.FLAG_NEG_Z = 1 << this.INDEX_OUTSIDE_NEG_Z + 1;
        this.utilVec31Search = new t.Vector3;
        this.utilVec32Search = new t.Vector3;
        if (this.scene = a.scene)
            this.visualGeometry = new t.BoxBufferGeometry(1,1,1),
            this.visualGeometry.addTriangleOrderAttribute(),
            this.visualMaterial = new WALK.WireframeMaterial(new t.Color(65280));
        this.depthMax = Mb(a.depthMax) ? a.depthMax : Infinity;
        this.objectsThreshold = Mb(a.objectsThreshold) ? a.objectsThreshold : 8;
        this.overlapPct = Mb(a.overlapPct) ? a.overlapPct : .15;
        this.root = new t.OctreeNode({
            tree: this,
            parent: null,
            position: new t.Vector3
        })
    }
    ;
    t.Octree.prototype = {
        add: function(a, b, c) {
            b || (b = a.geometry.boundingSphere.center,
            c = a.geometry.boundingSphere.radius);
            0 !== c && this.root.addObject(new t.OctreeObjectData(a,b,c))
        },
        search: function(a, b, c) {
            var d, e = [];
            this.root.appendObjectsFromNode(e);
            0 < b || (b = Number.MAX_VALUE);
            if (c instanceof t.Vector3) {
                c = this.utilVec31Search.copy(c).normalize();
                var f = this.utilVec32Search.set(1, 1, 1).divide(c)
            }
            var g = 0;
            for (d = this.root.nodesIndices.length; g < d; g++) {
                var h = this.root.nodesByIndex[this.root.nodesIndices[g]];
                h.search(a, b, c, f, e)
            }
            return e
        },
        setRoot: function(a) {
            a instanceof t.OctreeNode && (this.root = a,
            this.root.updateProperties())
        },
        getDepthEnd: function() {
            return this.root.getDepthEnd()
        },
        getNodeCountEnd: function() {
            return this.root.getNodeCountEnd()
        },
        getObjectCountEnd: function() {
            return this.root.getObjectCountEnd()
        },
        toConsole: function() {
            this.root.toConsole()
        }
    };
    t.OctreeObjectData = function(a, b, c) {
        this.object = a;
        this.radius = c;
        this.position = b
    }
    ;
    var Qb = new t.Vector3
      , Rb = new t.Vector3;
    new t.Vector3;
    t.OctreeNode = function(a) {
        this.tree = a.tree;
        this.id = this.tree.nodeCount++;
        this.position = a.position;
        this.radius = 0 < a.radius ? a.radius : 1;
        this.indexOctant = a.indexOctant;
        this.depth = 0;
        this.reset();
        this.setParent(a.parent);
        this.overlap = this.radius * this.tree.overlapPct;
        this.radiusOverlap = this.radius + this.overlap;
        this.left = this.position.x - this.radiusOverlap;
        this.right = this.position.x + this.radiusOverlap;
        this.bottom = this.position.y - this.radiusOverlap;
        this.top = this.position.y + this.radiusOverlap;
        this.back = this.position.z - this.radiusOverlap;
        this.front = this.position.z + this.radiusOverlap;
        this.tree.scene && (this.visual = new t.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),
        this.visual.scale.set(2 * this.radiusOverlap, 2 * this.radiusOverlap, 2 * this.radiusOverlap),
        this.visual.position.copy(this.position),
        this.tree.scene.add(this.visual),
        this.tree.scene.updateMatrixWorld())
    }
    ;
    t.OctreeNode.prototype = {
        setParent: function(a) {
            a !== this && this.parent !== a && (this.parent = a,
            this.updateProperties())
        },
        updateProperties: function() {
            var a;
            this.parent instanceof t.OctreeNode ? (this.tree = this.parent.tree,
            this.depth = this.parent.depth + 1) : this.depth = 0;
            var b = 0;
            for (a = this.nodesIndices.length; b < a; b++)
                this.nodesByIndex[this.nodesIndices[b]].updateProperties()
        },
        reset: function(a, b) {
            var c, d = this.nodesIndices || [], e = this.nodesByIndex;
            this.objects = [];
            this.nodesIndices = [];
            this.nodesByIndex = {};
            var f = 0;
            for (c = d.length; f < c; f++) {
                var g = e[d[f]];
                g.setParent(void 0);
                !0 === a && g.reset(a, b)
            }
            !0 === b && this.visual && this.visual.parent && this.visual.parent.remove(this.visual)
        },
        addNode: function(a, b) {
            a.indexOctant = b;
            -1 === Pb(this.nodesIndices, b) && this.nodesIndices.push(b);
            this.nodesByIndex[b] = a;
            a.parent !== this && a.setParent(this)
        },
        removeNode: function(a) {
            var b = Pb(this.nodesIndices, a);
            this.nodesIndices.splice(b, 1);
            var c = c || this.nodesByIndex[a];
            delete this.nodesByIndex[a];
            c.parent === this && c.setParent(void 0)
        },
        addObject: function(a) {
            var b = this.getOctantIndex(a);
            -1 < b && 0 < this.nodesIndices.length ? (b = this.branch(b),
            b.addObject(a)) : -1 > b && this.parent instanceof t.OctreeNode ? this.parent.addObject(a) : (b = Pb(this.objects, a),
            -1 === b && this.objects.push(a),
            a.node = this,
            this.checkGrow())
        },
        addObjectWithoutCheck: function(a) {
            var b;
            var c = 0;
            for (b = a.length; c < b; c++) {
                var d = a[c];
                this.objects.push(d);
                d.node = this
            }
        },
        checkGrow: function() {
            this.objects.length > this.tree.objectsThreshold && 0 < this.tree.objectsThreshold && this.grow()
        },
        grow: function() {
            var a = [], b = [], c = [], d = [], e = [], f;
            var g = 0;
            for (f = this.objects.length; g < f; g++) {
                var h = this.objects[g];
                var l = this.getOctantIndex(h);
                -1 < l ? (c.push(h),
                d.push(l)) : -1 > l ? (a.push(h),
                b.push(l)) : e.push(h)
            }
            0 < c.length && (e = e.concat(this.split(c, d)));
            0 < a.length && (e = e.concat(this.expand(a, b)));
            this.objects = e;
            this.checkMerge()
        },
        split: function(a, b) {
            var c;
            if (this.depth < this.tree.depthMax) {
                a = a || this.objects;
                b = b || [];
                var d = [];
                var e = 0;
                for (c = a.length; e < c; e++) {
                    var f = a[e];
                    var g = b[e];
                    -1 < g ? (g = this.branch(g),
                    g.addObject(f)) : d.push(f)
                }
                a === this.objects && (this.objects = d)
            } else
                d = this.objects;
            return d
        },
        branch: function(a) {
            if (this.nodesByIndex[a]instanceof t.OctreeNode)
                var b = this.nodesByIndex[a];
            else {
                b = .5 * this.radiusOverlap;
                var c = b * this.tree.overlapPct;
                c = b - c;
                c = Qb.set(a & 1 ? c : -c, a & 2 ? c : -c, a & 4 ? c : -c);
                c = (new t.Vector3).addVectors(this.position, c);
                b = new t.OctreeNode({
                    tree: this.tree,
                    parent: this,
                    position: c,
                    radius: b,
                    indexOctant: a
                });
                this.addNode(b, a)
            }
            return b
        },
        expand: function(a, b) {
            var c, d = this.tree.INDEX_OUTSIDE_MAP;
            if (this.tree.root.getDepthEnd() < this.tree.depthMax) {
                a = a || this.objects;
                b = b || [];
                var e = [];
                var f = [];
                var g = 0;
                for (c = d.length; g < c; g++)
                    d[g].count = 0;
                g = 0;
                for (c = a.length; g < c; g++) {
                    var h = a[g];
                    var l = b[g];
                    -1 > l ? (l = -l - this.tree.INDEX_OUTSIDE_OFFSET,
                    l & this.tree.FLAG_POS_X ? d[this.tree.INDEX_OUTSIDE_POS_X].count++ : l & this.tree.FLAG_NEG_X && d[this.tree.INDEX_OUTSIDE_NEG_X].count++,
                    l & this.tree.FLAG_POS_Y ? d[this.tree.INDEX_OUTSIDE_POS_Y].count++ : l & this.tree.FLAG_NEG_Y && d[this.tree.INDEX_OUTSIDE_NEG_Y].count++,
                    l & this.tree.FLAG_POS_Z ? d[this.tree.INDEX_OUTSIDE_POS_Z].count++ : l & this.tree.FLAG_NEG_Z && d[this.tree.INDEX_OUTSIDE_NEG_Z].count++,
                    f.push(h)) : e.push(h)
                }
                if (0 < f.length) {
                    var m = d.slice(0);
                    m.sort(function(a, b) {
                        return b.count - a.count
                    });
                    l = m[0];
                    g = l.index | 1;
                    h = m[1];
                    d = m[2];
                    b = (h.index | 1) !== g ? h : d;
                    c = b.index | 1;
                    h = m[2];
                    d = m[3];
                    m = m[4];
                    var n = h.index | 1;
                    var p = d.index | 1;
                    h = n !== g && n !== c ? h : p !== g && p !== c ? d : m;
                    g = l.x + b.x + h.x;
                    c = l.y + b.y + h.y;
                    b = l.z + b.z + h.z;
                    l = this.getOctantIndexFromPosition(g, c, b);
                    b = this.getOctantIndexFromPosition(-g, -c, -b);
                    c = this.overlap;
                    h = this.radius;
                    g = 0 < this.tree.overlapPct ? c / (.5 * this.tree.overlapPct * (1 + this.tree.overlapPct)) : 2 * h;
                    d = g * this.tree.overlapPct;
                    c = g + d - (h + c);
                    Rb.set(l & 1 ? c : -c, l & 2 ? c : -c, l & 4 ? c : -c);
                    l = (new t.Vector3).addVectors(this.position, Rb);
                    l = new t.OctreeNode({
                        tree: this.tree,
                        position: l,
                        radius: g
                    });
                    l.addNode(this, b);
                    this.tree.setRoot(l);
                    g = 0;
                    for (c = f.length; g < c; g++)
                        this.tree.root.addObject(f[g])
                }
                a === this.objects && (this.objects = e)
            } else
                e = a;
            return e
        },
        shrink: function() {
            this.checkMerge();
            this.tree.root.checkContract()
        },
        checkMerge: function() {
            for (var a = this, b; a.parent instanceof t.OctreeNode && a.getObjectCountEnd() < this.tree.objectsThreshold; )
                b = a,
                a = a.parent;
            a !== this && a.merge(b)
        },
        merge: function(a) {
            var b;
            a = a ? "[object Array]" === Object.prototype.toString.call(a) !== !0 ? [a] : a : [];
            var c = 0;
            for (b = a.length; c < b; c++) {
                var d = a[c];
                this.addObjectWithoutCheck(d.getObjectsEnd());
                d.reset(!0, !0);
                this.removeNode(d.indexOctant, d)
            }
            this.checkMerge()
        },
        checkContract: function() {
            var a;
            if (0 < this.nodesIndices.length) {
                var b = 0;
                var c = this.objects.length;
                var d = 0;
                for (a = this.nodesIndices.length; d < a; d++) {
                    var e = this.nodesByIndex[this.nodesIndices[d]];
                    var f = e.getObjectCountEnd();
                    c += f;
                    if (!1 === g instanceof t.OctreeNode || f > b) {
                        var g = e;
                        b = f
                    }
                }
                c - b < this.tree.objectsThreshold && g instanceof t.OctreeNode && this.contract(g)
            }
        },
        contract: function(a) {
            var b;
            var c = 0;
            for (b = this.nodesIndices.length; c < b; c++) {
                var d = this.nodesByIndex[this.nodesIndices[c]];
                d !== a && (a.addObjectWithoutCheck(d.getObjectsEnd()),
                d.reset(!0, !0))
            }
            a.addObjectWithoutCheck(this.objects);
            this.reset(!1, !0);
            this.tree.setRoot(a);
            a.checkContract()
        },
        getOctantIndex: function(a) {
            var b = this.position
              , c = this.radiusOverlap
              , d = this.overlap
              , e = 0;
            if (a instanceof t.OctreeObjectData) {
                var f = a.radius;
                var g = a.position
            } else
                a instanceof t.OctreeNode && (g = a.position,
                f = 0);
            var h = g.x - b.x;
            var l = g.y - b.y;
            g = g.z - b.z;
            b = Math.abs(h);
            var m = Math.abs(l);
            var n = Math.abs(g);
            if (Math.max(b, m, n) + f > c)
                return b + f > c && (e ^= 0 < h ? this.tree.FLAG_POS_X : this.tree.FLAG_NEG_X),
                m + f > c && (e ^= 0 < l ? this.tree.FLAG_POS_Y : this.tree.FLAG_NEG_Y),
                n + f > c && (e ^= 0 < g ? this.tree.FLAG_POS_Z : this.tree.FLAG_NEG_Z),
                a.indexOctant = -e - this.tree.INDEX_OUTSIDE_OFFSET,
                a.indexOctant;
            if (h - f > -d)
                e |= 1;
            else if (!(h + f < d))
                return a.indexOctant = this.tree.INDEX_INSIDE_CROSS,
                a.indexOctant;
            if (l - f > -d)
                e |= 2;
            else if (!(l + f < d))
                return a.indexOctant = this.tree.INDEX_INSIDE_CROSS,
                a.indexOctant;
            if (g - f > -d)
                e |= 4;
            else if (!(g + f < d))
                return a.indexOctant = this.tree.INDEX_INSIDE_CROSS,
                a.indexOctant;
            a.indexOctant = e;
            return a.indexOctant
        },
        getOctantIndexFromPosition: function(a, b, c) {
            var d = 0;
            0 < a && (d |= 1);
            0 < b && (d |= 2);
            0 < c && (d |= 4);
            return d
        },
        appendObjectsFromNode: function(a) {
            var b, c = this.objects;
            var d = 0;
            for (b = c.length; d < b; d += 1)
                a.push(c[d].object)
        },
        search: function(a, b, c, d, e) {
            var f;
            if (!0 === this.intersectRay(a, c, b, d)) {
                this.appendObjectsFromNode(e);
                var g = 0;
                for (f = this.nodesIndices.length; g < f; g++) {
                    var h = this.nodesByIndex[this.nodesIndices[g]];
                    h.search(a, b, c, d, e)
                }
            }
        },
        intersectRay: function(a, b, c, d) {
            b = (this.left - a.x) * d.x;
            var e = (this.right - a.x) * d.x
              , f = (this.bottom - a.y) * d.y
              , g = (this.top - a.y) * d.y
              , h = (this.back - a.z) * d.z;
            d = (this.front - a.z) * d.z;
            a = Math.min(Math.min(Math.max(b, e), Math.max(f, g)), Math.max(h, d));
            if (0 > a)
                return !1;
            b = Math.max(Math.max(Math.min(b, e), Math.min(f, g)), Math.min(h, d));
            return b > a || b > c ? !1 : !0
        },
        getDepthEnd: function(a) {
            var b;
            if (0 < this.nodesIndices.length) {
                var c = 0;
                for (b = this.nodesIndices.length; c < b; c++) {
                    var d = this.nodesByIndex[this.nodesIndices[c]];
                    a = d.getDepthEnd(a)
                }
            } else
                a = !a || this.depth > a ? this.depth : a;
            return a
        },
        getNodeCountEnd: function() {
            return this.tree.root.getNodeCountRecursive() + 1
        },
        getNodeCountRecursive: function() {
            var a, b = this.nodesIndices.length;
            var c = 0;
            for (a = this.nodesIndices.length; c < a; c++)
                b += this.nodesByIndex[this.nodesIndices[c]].getNodeCountRecursive();
            return b
        },
        getObjectsEnd: function(a) {
            var b;
            a = (a || []).concat(this.objects);
            var c = 0;
            for (b = this.nodesIndices.length; c < b; c++) {
                var d = this.nodesByIndex[this.nodesIndices[c]];
                a = d.getObjectsEnd(a)
            }
            return a
        },
        getObjectCountEnd: function() {
            var a, b = this.objects.length;
            var c = 0;
            for (a = this.nodesIndices.length; c < a; c++)
                b += this.nodesByIndex[this.nodesIndices[c]].getObjectCountEnd();
            return b
        },
        getObjectCountStart: function() {
            for (var a = this.objects.length, b = this.parent; b instanceof t.OctreeNode; )
                a += b.objects.length,
                b = b.parent;
            return a
        },
        toConsole: function(a) {
            var b;
            a = "string" === typeof a ? a : "   ";
            console.log(this.parent ? a + " octree NODE > " : " octree ROOT > ", this, " // id: ", this.id, " // indexOctant: ", this.indexOctant, " // position: ", this.position.x, this.position.y, this.position.z, " // radius: ", this.radius, " // depth: ", this.depth);
            console.log(this.parent ? a + " " : " ", "+ objects ( ", this.objects.length, " ) ", this.objects);
            console.log(this.parent ? a + " " : " ", "+ children ( ", this.nodesIndices.length, " )", this.nodesIndices, this.nodesByIndex);
            var c = 0;
            for (b = this.nodesIndices.length; c < b; c++) {
                var d = this.nodesByIndex[this.nodesIndices[c]];
                d.toConsole(a + "   ")
            }
        }
    };
    t.PolyhedronBufferGeometry = function(a, b, c, d) {
        function e(a) {
            h.push(a.x, a.y, a.z)
        }
        function f(b, c) {
            b *= 3;
            c.x = a[b + 0];
            c.y = a[b + 1];
            c.z = a[b + 2]
        }
        function g(a, b, c, d) {
            0 > d && 1 === a.x && (l[b] = a.x - 1);
            0 === c.x && 0 === c.z && (l[b] = d / 2 / Math.PI + .5)
        }
        t.BufferGeometry.call(this);
        this.type = "PolyhedronBufferGeometry";
        this.parameters = {
            vertices: a,
            indices: b,
            radius: c,
            detail: d
        };
        c = c || 1;
        d = d || 0;
        var h = []
          , l = [];
        (function(a) {
            for (var c = new t.Vector3, d = new t.Vector3, g = new t.Vector3, h = 0; h < b.length; h += 3) {
                f(b[h + 0], c);
                f(b[h + 1], d);
                f(b[h + 2], g);
                var l, m, w = c, x = d, y = g, z = Math.pow(2, a), A = [];
                for (m = 0; m <= z; m++) {
                    A[m] = [];
                    var B = w.clone().lerp(y, m / z)
                      , H = x.clone().lerp(y, m / z)
                      , C = z - m;
                    for (l = 0; l <= C; l++)
                        A[m][l] = 0 === l && m === z ? B : B.clone().lerp(H, l / C)
                }
                for (m = 0; m < z; m++)
                    for (l = 0; l < 2 * (z - m) - 1; l++)
                        w = Math.floor(l / 2),
                        0 === l % 2 ? (e(A[m][w + 1]),
                        e(A[m + 1][w]),
                        e(A[m][w])) : (e(A[m][w + 1]),
                        e(A[m + 1][w + 1]),
                        e(A[m + 1][w]))
            }
        }
        )(d);
        (function(a) {
            for (var b = new t.Vector3, c = 0; c < h.length; c += 3)
                b.x = h[c + 0],
                b.y = h[c + 1],
                b.z = h[c + 2],
                b.normalize().multiplyScalar(a),
                h[c + 0] = b.x,
                h[c + 1] = b.y,
                h[c + 2] = b.z
        }
        )(c);
        (function() {
            for (var a = new t.Vector3, b = 0; b < h.length; b += 3)
                a.x = h[b + 0],
                a.y = h[b + 1],
                a.z = h[b + 2],
                l.push(Math.atan2(a.z, -a.x) / 2 / Math.PI + .5, 1 - (Math.atan2(-a.y, Math.sqrt(a.x * a.x + a.z * a.z)) / Math.PI + .5));
            a = new t.Vector3;
            b = new t.Vector3;
            for (var c = new t.Vector3, d = new t.Vector3, e = new t.Vector2, f = new t.Vector2, v = new t.Vector2, w = 0, x = 0; w < h.length; w += 9,
            x += 6) {
                a.set(h[w + 0], h[w + 1], h[w + 2]);
                b.set(h[w + 3], h[w + 4], h[w + 5]);
                c.set(h[w + 6], h[w + 7], h[w + 8]);
                e.set(l[x + 0], l[x + 1]);
                f.set(l[x + 2], l[x + 3]);
                v.set(l[x + 4], l[x + 5]);
                d.copy(a).add(b).add(c).divideScalar(3);
                var y = Math.atan2(d.z, -d.x);
                g(e, x + 0, a, y);
                g(f, x + 2, b, y);
                g(v, x + 4, c, y)
            }
            for (a = 0; a < l.length; a += 6)
                b = l[a + 0],
                c = l[a + 2],
                d = l[a + 4],
                e = Math.min(b, c, d),
                .9 < Math.max(b, c, d) && .1 > e && (.2 > b && (l[a + 0] += 1),
                .2 > c && (l[a + 2] += 1),
                .2 > d && (l[a + 4] += 1))
        }
        )();
        this.addAttribute("position", new t.BufferAttribute(new Float32Array(h),3));
        this.addAttribute("normal", new t.BufferAttribute(new Float32Array(h.slice()),3));
        this.addAttribute("uv", new t.BufferAttribute(new Float32Array(l),2));
        0 === d ? this.computeVertexNormals() : this.normalizeNormals()
    }
    ;
    t.PolyhedronBufferGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    t.PolyhedronBufferGeometry.prototype.constructor = t.PolyhedronBufferGeometry;
    t.IcosahedronBufferGeometry = function(a, b) {
        var c = (1 + Math.sqrt(5)) / 2;
        t.PolyhedronBufferGeometry.call(this, [-1, c, 0, 1, c, 0, -1, -c, 0, 1, -c, 0, 0, -1, c, 0, 1, c, 0, -1, -c, 0, 1, -c, c, 0, -1, c, 0, 1, -c, 0, -1, -c, 0, 1], [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11, 1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8, 3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9, 4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1], a, b);
        this.type = "IcosahedronBufferGeometry";
        this.parameters = {
            radius: a,
            detail: b
        }
    }
    ;
    t.IcosahedronBufferGeometry.prototype = Object.create(t.PolyhedronBufferGeometry.prototype);
    t.IcosahedronBufferGeometry.prototype.constructor = t.IcosahedronBufferGeometry;
    var Sb = Math
      , Tb = Sb.abs
      , Vb = Sb.cos
      , Yb = Sb.sin
      , Zb = Sb.acos
      , $b = Sb.atan2
      , ac = Sb.sqrt
      , bc = Sb.pow;
    function cc(a) {
        return 0 > a ? -bc(-a, 1 / 3) : bc(a, 1 / 3)
    }
    var dc = Math.PI
      , ec = 2 * dc
      , fc = dc / 2
      , gc = Number.MAX_SAFE_INTEGER || 9007199254740991
      , hc = Number.MIN_SAFE_INTEGER || -9007199254740991
      , ic = {
        x: 0,
        y: 0,
        z: 0
    }
      , Q = {
        Tvalues: [-.06405689286260563, .06405689286260563, -.1911188674736163, .1911188674736163, -.3150426796961634, .3150426796961634, -.4337935076260451, .4337935076260451, -.5454214713888396, .5454214713888396, -.6480936519369755, .6480936519369755, -.7401241915785544, .7401241915785544, -.820001985973903, .820001985973903, -.8864155270044011, .8864155270044011, -.9382745520027328, .9382745520027328, -.9747285559713095, .9747285559713095, -.9951872199970213, .9951872199970213],
        Cvalues: [.12793819534675216, .12793819534675216, .1258374563468283, .1258374563468283, .12167047292780339, .12167047292780339, .1155056680537256, .1155056680537256, .10744427011596563, .10744427011596563, .09761865210411388, .09761865210411388, .08619016153195327, .08619016153195327, .0733464814110803, .0733464814110803, .05929858491543678, .05929858491543678, .04427743881741981, .04427743881741981, .028531388628933663, .028531388628933663, .0123412297999872, .0123412297999872],
        arcfn: function(a, b) {
            a = b(a);
            b = a.x * a.x + a.y * a.y;
            "undefined" !== typeof a.z && (b += a.z * a.z);
            return ac(b)
        },
        compute: function(a, b, c) {
            if (0 === a)
                return b[0].t = 0,
                b[0];
            var d = b.length - 1;
            if (1 === a)
                return b[d].t = 1,
                b[d];
            var e = 1 - a
              , f = b;
            if (0 === d)
                return b[0].t = a,
                b[0];
            if (1 === d) {
                var g = {
                    x: e * f[0].x + a * f[1].x,
                    y: e * f[0].y + a * f[1].y,
                    t: a
                };
                c && (g.z = e * f[0].z + a * f[1].z);
                return g
            }
            if (4 > d) {
                var h = e * e
                  , l = a * a;
                b = 0;
                if (2 === d) {
                    f = [f[0], f[1], f[2], ic];
                    g = h;
                    var m = e * a * 2;
                    var n = l
                } else
                    3 === d && (g = h * e,
                    m = h * a * 3,
                    n = e * l * 3,
                    b = a * l);
                a = {
                    x: g * f[0].x + m * f[1].x + n * f[2].x + b * f[3].x,
                    y: g * f[0].y + m * f[1].y + n * f[2].y + b * f[3].y,
                    t: a
                };
                c && (a.z = g * f[0].z + m * f[1].z + n * f[2].z + b * f[3].z);
                return a
            }
            for (c = JSON.parse(JSON.stringify(b)); 1 < c.length; ) {
                for (f = 0; f < c.length - 1; f++)
                    c[f] = {
                        x: c[f].x + (c[f + 1].x - c[f].x) * a,
                        y: c[f].y + (c[f + 1].y - c[f].y) * a
                    },
                    "undefined" !== typeof c[f].z && (c[f] = c[f].z + (c[f + 1].z - c[f].z) * a);
                c.splice(c.length - 1, 1)
            }
            c[0].t = a;
            return c[0]
        },
        computeWithRatios: function(a, b, c, d) {
            var e = 1 - a
              , f = c[0]
              , g = c[1]
              , h = c[2];
            c = c[3];
            f *= e;
            g *= a;
            if (2 === b.length)
                return e = f + g,
                {
                    x: (f * b[0].x + g * b[1].x) / e,
                    y: (f * b[0].y + g * b[1].y) / e,
                    z: d ? (f * b[0].z + g * b[1].z) / e : !1,
                    t: a
                };
            f *= e;
            g *= 2 * e;
            h *= a * a;
            if (3 === b.length)
                return e = f + g + h,
                {
                    x: (f * b[0].x + g * b[1].x + h * b[2].x) / e,
                    y: (f * b[0].y + g * b[1].y + h * b[2].y) / e,
                    z: d ? (f * b[0].z + g * b[1].z + h * b[2].z) / e : !1,
                    t: a
                };
            f *= e;
            g *= 1.5 * e;
            h *= 3 * e;
            c *= a * a * a;
            if (4 === b.length)
                return e = f + g + h + c,
                {
                    x: (f * b[0].x + g * b[1].x + h * b[2].x + c * b[3].x) / e,
                    y: (f * b[0].y + g * b[1].y + h * b[2].y + c * b[3].y) / e,
                    z: d ? (f * b[0].z + g * b[1].z + h * b[2].z + c * b[3].z) / e : !1,
                    t: a
                }
        },
        derive: function(a, b) {
            for (var c = [], d = a.length, e = d - 1; 1 < d; d--,
            e--) {
                for (var f = [], g = 0, h; g < e; g++)
                    h = {
                        x: e * (a[g + 1].x - a[g].x),
                        y: e * (a[g + 1].y - a[g].y)
                    },
                    b && (h.z = e * (a[g + 1].z - a[g].z)),
                    f.push(h);
                c.push(f);
                a = f
            }
            return c
        },
        between: function(a, b, c) {
            return b <= a && a <= c || Q.approximately(a, b) || Q.approximately(a, c)
        },
        approximately: function(a, b, c) {
            return Tb(a - b) <= (c || 1E-6)
        },
        length: function(a) {
            for (var b = Q.Tvalues.length, c = 0, d = 0, e; d < b; d++)
                e = .5 * Q.Tvalues[d] + .5,
                c += Q.Cvalues[d] * Q.arcfn(e, a);
            return .5 * c
        },
        map: function(a, b, c, d, e) {
            return d + (a - b) / (c - b) * (e - d)
        },
        lerp: function(a, b, c) {
            var d = {
                x: b.x + a * (c.x - b.x),
                y: b.y + a * (c.y - b.y)
            };
            void 0 !== b.z && void 0 !== c.z && (d.z = b.z + a * (c.z - b.z));
            return d
        },
        pointToString: function(a) {
            var b = a.x + "/" + a.y;
            "undefined" !== typeof a.z && (b += "/" + a.z);
            return b
        },
        pointsToString: function(a) {
            return "[" + a.map(Q.pointToString).join(", ") + "]"
        },
        copy: function(a) {
            return JSON.parse(JSON.stringify(a))
        },
        angle: function(a, b, c) {
            var d = b.x - a.x;
            b = b.y - a.y;
            var e = c.x - a.x;
            a = c.y - a.y;
            return $b(d * a - b * e, d * e + b * a)
        },
        round: function(a, b) {
            a = "" + a;
            var c = a.indexOf(".");
            return parseFloat(a.substring(0, c + 1 + b))
        },
        dist: function(a, b) {
            var c = a.x - b.x;
            a = a.y - b.y;
            return ac(c * c + a * a)
        },
        closest: function(a, b) {
            var c = bc(2, 63), d, e;
            a.forEach(function(a, g) {
                e = Q.dist(b, a);
                e < c && (c = e,
                d = g)
            });
            return {
                mdist: c,
                mpos: d
            }
        },
        abcratio: function(a, b) {
            if (2 !== b && 3 !== b)
                return !1;
            if ("undefined" === typeof a)
                a = .5;
            else if (0 === a || 1 === a)
                return a;
            a = bc(a, b) + bc(1 - a, b);
            return Tb((a - 1) / a)
        },
        projectionratio: function(a, b) {
            if (2 !== b && 3 !== b)
                return !1;
            if ("undefined" === typeof a)
                a = .5;
            else if (0 === a || 1 === a)
                return a;
            var c = bc(1 - a, b);
            a = bc(a, b) + c;
            return c / a
        },
        lli8: function(a, b, c, d, e, f, g, h) {
            var l = (a - c) * (f - h) - (b - d) * (e - g);
            return 0 == l ? !1 : {
                x: ((a * d - b * c) * (e - g) - (a - c) * (e * h - f * g)) / l,
                y: ((a * d - b * c) * (f - h) - (b - d) * (e * h - f * g)) / l
            }
        },
        lli4: function(a, b, c, d) {
            return Q.lli8(a.x, a.y, b.x, b.y, c.x, c.y, d.x, d.y)
        },
        lli: function(a, b) {
            return Q.lli4(a, a.c, b, b.c)
        },
        makeline: function(a, b) {
            return new T(a.x,a.y,(a.x + b.x) / 2,(a.y + b.y) / 2,b.x,b.y)
        },
        findbbox: function(a) {
            var b = gc
              , c = gc
              , d = hc
              , e = hc;
            a.forEach(function(a) {
                a = a.bbox();
                b > a.x.min && (b = a.x.min);
                c > a.y.min && (c = a.y.min);
                d < a.x.max && (d = a.x.max);
                e < a.y.max && (e = a.y.max)
            });
            return {
                x: {
                    min: b,
                    mid: (b + d) / 2,
                    max: d,
                    size: d - b
                },
                y: {
                    min: c,
                    mid: (c + e) / 2,
                    max: e,
                    size: e - c
                }
            }
        },
        shapeintersections: function(a, b, c, d, e) {
            if (!Q.bboxoverlap(b, d))
                return [];
            var f = []
              , g = [c.startcap, c.forward, c.back, c.endcap];
            [a.startcap, a.forward, a.back, a.endcap].forEach(function(b) {
                b.virtual || g.forEach(function(d) {
                    if (!d.virtual) {
                        var g = b.intersects(d, e);
                        0 < g.length && (g.c1 = b,
                        g.c2 = d,
                        g.s1 = a,
                        g.s2 = c,
                        f.push(g))
                    }
                })
            });
            return f
        },
        makeshape: function(a, b, c) {
            var d = a.points.length
              , e = Q.makeline(b.points[b.points.length - 1], a.points[0]);
            d = Q.makeline(a.points[d - 1], b.points[0]);
            var f = {
                startcap: e,
                forward: a,
                back: b,
                endcap: d,
                bbox: Q.findbbox([e, a, b, d]),
                intersections: function(a) {
                    return Q.shapeintersections(f, f.bbox, a, a.bbox, c)
                }
            };
            return f
        },
        getminmax: function(a, b, c) {
            if (!c)
                return {
                    min: 0,
                    max: 0
                };
            var d = gc
              , e = hc;
            -1 === c.indexOf(0) && (c = [0].concat(c));
            -1 === c.indexOf(1) && c.push(1);
            for (var f = 0, g = c.length; f < g; f++) {
                var h = c[f];
                h = a.get(h);
                h[b] < d && (d = h[b]);
                h[b] > e && (e = h[b])
            }
            return {
                min: d,
                mid: (d + e) / 2,
                max: e,
                size: e - d
            }
        },
        align: function(a, b) {
            var c = b.p1.x
              , d = b.p1.y
              , e = -$b(b.p2.y - d, b.p2.x - c);
            return a.map(function(a) {
                return {
                    x: (a.x - c) * Vb(e) - (a.y - d) * Yb(e),
                    y: (a.x - c) * Yb(e) + (a.y - d) * Vb(e)
                }
            })
        },
        roots: function(a, b) {
            function c(a) {
                return 0 <= a && 1 >= a
            }
            b = b || {
                p1: {
                    x: 0,
                    y: 0
                },
                p2: {
                    x: 1,
                    y: 0
                }
            };
            var d = a.length - 1;
            a = Q.align(a, b);
            if (2 === d) {
                d = a[0].y;
                b = a[1].y;
                var e = a[2].y;
                a = d - 2 * b + e;
                return 0 !== a ? (e = -ac(b * b - d * e),
                d = -d + b,
                [-(e + d) / a, -(-e + d) / a].filter(c)) : b !== e && 0 === a ? [(2 * b - e) / (2 * b - 2 * e)].filter(c) : []
            }
            d = a[0].y;
            b = a[1].y;
            var f = a[2].y;
            e = -d + 3 * b - 3 * f + a[3].y;
            a = 3 * d - 6 * b + 3 * f;
            f = -3 * d + 3 * b;
            if (Q.approximately(e, 0)) {
                if (Q.approximately(a, 0))
                    return Q.approximately(f, 0) ? [] : [-d / f].filter(c);
                d = ac(f * f - 4 * a * d);
                a *= 2;
                return [(d - f) / a, (-f - d) / a].filter(c)
            }
            a /= e;
            f /= e;
            b = (3 * f - a * a) / 3;
            var g = b / 3;
            d = (2 * a * a * a - 9 * a * f + d / e * 27) / 27;
            e = d / 2;
            f = e * e + g * g * g;
            if (0 > f)
                return b = -b / 3,
                b = ac(b * b * b),
                d = -d / (2 * b),
                e = Zb(-1 > d ? -1 : 1 < d ? 1 : d),
                f = 2 * cc(b),
                d = f * Vb(e / 3) - a / 3,
                b = f * Vb((e + ec) / 3) - a / 3,
                a = f * Vb((e + 2 * ec) / 3) - a / 3,
                [d, b, a].filter(c);
            if (0 === f)
                return d = 0 > e ? cc(-e) : -cc(e),
                [2 * d - a / 3, -d - a / 3].filter(c);
            b = ac(f);
            d = cc(-e + b);
            b = cc(e + b);
            return [d - b - a / 3].filter(c)
        },
        droots: function(a) {
            if (3 === a.length) {
                var b = a[0]
                  , c = a[1]
                  , d = a[2];
                a = b - 2 * c + d;
                return 0 !== a ? (d = -ac(c * c - b * d),
                b = -b + c,
                [-(d + b) / a, -(-d + b) / a]) : c !== d && 0 === a ? [(2 * c - d) / (2 * (c - d))] : []
            }
            return 2 === a.length && (b = a[0],
            c = a[1],
            b !== c) ? [b / (b - c)] : []
        },
        curvature: function(a, b, c, d, e) {
            var f = Q.compute(a, b);
            var g = Q.compute(a, c);
            var h = f.x * f.x + f.y * f.y;
            d ? (g = ac(bc(f.y * g.z - g.y * f.z, 2) + bc(f.z * g.x - g.z * f.x, 2) + bc(f.x * g.y - g.x * f.y, 2)),
            h = bc(h + f.z * f.z, 1.5)) : (g = f.x * g.y - f.y * g.x,
            h = bc(h, 1.5));
            if (0 === g || 0 === h)
                return {
                    k: 0,
                    r: 0
                };
            f = g / h;
            g = h / g;
            if (!e) {
                e = Q.curvature(a - .001, b, c, d, !0).k;
                a = Q.curvature(a + .001, b, c, d, !0).k;
                var l = (a - f + (f - e)) / 2;
                var m = (Tb(a - f) + Tb(f - e)) / 2
            }
            return {
                k: f,
                r: g,
                dk: l,
                adk: m
            }
        },
        inflections: function(a) {
            if (4 > a.length)
                return [];
            a = Q.align(a, {
                p1: a[0],
                p2: a.slice(-1)[0]
            });
            var b = a[2].x * a[1].y
              , c = a[3].x * a[1].y
              , d = a[1].x * a[2].y;
            a = 18 * (-3 * b + 2 * c + 3 * d - a[3].x * a[2].y);
            c = 18 * (3 * b - c - 3 * d);
            b = 18 * (d - b);
            if (Q.approximately(a, 0))
                return !Q.approximately(c, 0) && (a = -b / c,
                0 <= a && 1 >= a) ? [a] : [];
            b = Math.sqrt(c * c - 4 * a * b);
            a *= 2;
            return Q.approximately(a, 0) ? [] : [(b - c) / a, -(c + b) / a].filter(function(a) {
                return 0 <= a && 1 >= a
            })
        },
        bboxoverlap: function(a, b) {
            for (var c = ["x", "y"], d = c.length, e = 0, f, g, h; e < d; e++)
                if (f = c[e],
                g = a[f].mid,
                h = b[f].mid,
                f = (a[f].size + b[f].size) / 2,
                Tb(g - h) >= f)
                    return !1;
            return !0
        },
        expandbox: function(a, b) {
            b.x.min < a.x.min && (a.x.min = b.x.min);
            b.y.min < a.y.min && (a.y.min = b.y.min);
            b.z && b.z.min < a.z.min && (a.z.min = b.z.min);
            b.x.max > a.x.max && (a.x.max = b.x.max);
            b.y.max > a.y.max && (a.y.max = b.y.max);
            b.z && b.z.max > a.z.max && (a.z.max = b.z.max);
            a.x.mid = (a.x.min + a.x.max) / 2;
            a.y.mid = (a.y.min + a.y.max) / 2;
            a.z && (a.z.mid = (a.z.min + a.z.max) / 2);
            a.x.size = a.x.max - a.x.min;
            a.y.size = a.y.max - a.y.min;
            a.z && (a.z.size = a.z.max - a.z.min)
        },
        pairiteration: function(a, b, c) {
            var d = a.bbox()
              , e = b.bbox()
              , f = c || .5;
            if (d.x.size + d.y.size < f && e.x.size + e.y.size < f)
                return [(1E5 * (a._t1 + a._t2) / 2 | 0) / 1E5 + "/" + (1E5 * (b._t1 + b._t2) / 2 | 0) / 1E5];
            a = a.split(.5);
            b = b.split(.5);
            b = [{
                left: a.left,
                right: b.left
            }, {
                left: a.left,
                right: b.right
            }, {
                left: a.right,
                right: b.right
            }, {
                left: a.right,
                right: b.left
            }];
            b = b.filter(function(a) {
                return Q.bboxoverlap(a.left.bbox(), a.right.bbox())
            });
            var g = [];
            if (0 === b.length)
                return g;
            b.forEach(function(a) {
                g = g.concat(Q.pairiteration(a.left, a.right, f))
            });
            return g = g.filter(function(a, b) {
                return g.indexOf(a) === b
            })
        },
        getccenter: function(a, b, c) {
            var d = b.x - a.x
              , e = b.y - a.y
              , f = c.x - b.x
              , g = c.y - b.y
              , h = d * Vb(fc) - e * Yb(fc);
            d = d * Yb(fc) + e * Vb(fc);
            e = f * Vb(fc) - g * Yb(fc);
            f = f * Yb(fc) + g * Vb(fc);
            g = (a.x + b.x) / 2;
            var l = (a.y + b.y) / 2
              , m = (b.x + c.x) / 2
              , n = (b.y + c.y) / 2;
            h = Q.lli8(g, l, g + h, l + d, m, n, m + e, n + f);
            d = Q.dist(h, a);
            a = $b(a.y - h.y, a.x - h.x);
            b = $b(b.y - h.y, b.x - h.x);
            c = $b(c.y - h.y, c.x - h.x);
            if (a < c) {
                if (a > b || b > c)
                    a += ec;
                a > c && (b = c,
                c = a,
                a = b)
            } else
                c < b && b < a ? (b = c,
                c = a,
                a = b) : c += ec;
            h.s = a;
            h.e = c;
            h.r = d;
            return h
        },
        numberSort: function(a, b) {
            return a - b
        }
    };
    function jc(a) {
        this.curves = [];
        this._3d = !1;
        a && (this.curves = a,
        this._3d = this.curves[0]._3d)
    }
    jc.prototype.valueOf = function() {
        return this.toString()
    }
    ;
    jc.prototype.toString = function() {
        return "[" + this.curves.map(function(a) {
            return Q.pointsToString(a.points)
        }).join(", ") + "]"
    }
    ;
    jc.prototype.addCurve = function(a) {
        this.curves.push(a);
        this._3d = this._3d || a._3d
    }
    ;
    jc.prototype.length = function() {
        return this.curves.map(function(a) {
            return a.length()
        }).reduce(function(a, b) {
            return a + b
        })
    }
    ;
    jc.prototype.curve = function(a) {
        return this.curves[a]
    }
    ;
    jc.prototype.bbox = function() {
        for (var a = this.curves, b = a[0].bbox(), c = 1; c < a.length; c++)
            Q.expandbox(b, a[c].bbox());
        return b
    }
    ;
    jc.prototype.offset = function(a) {
        var b = [];
        this.curves.forEach(function(c) {
            b.push.apply(b, k.arrayFromIterable(c.offset(a)))
        });
        return new jc(b)
    }
    ;
    var kc = Math
      , mc = kc.abs
      , nc = kc.min
      , oc = kc.max
      , pc = kc.cos
      , qc = kc.sin
      , rc = kc.acos
      , sc = kc.sqrt
      , tc = Math.PI;
    function T(a) {
        var b = a && a.forEach ? a : Array.from(arguments).slice()
          , c = !1;
        if ("object" === typeof b[0]) {
            c = b.length;
            var d = [];
            b.forEach(function(a) {
                ["x", "y", "z"].forEach(function(b) {
                    "undefined" !== typeof a[b] && d.push(a[b])
                })
            });
            b = d
        }
        var e = !1
          , f = b.length;
        if (c) {
            if (4 < c) {
                if (1 !== arguments.length)
                    throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
                e = !0
            }
        } else if (6 !== f && 8 !== f && 9 !== f && 12 !== f && 1 !== arguments.length)
            throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
        e = this._3d = !e && (9 === f || 12 === f) || a && a[0] && "undefined" !== typeof a[0].z;
        c = this.points = [];
        for (var g = 0, h = e ? 3 : 2; g < f; g += h) {
            var l = {
                x: b[g],
                y: b[g + 1]
            };
            e && (l.z = b[g + 2]);
            c.push(l)
        }
        b = this.order = c.length - 1;
        f = this.dims = ["x", "y"];
        e && f.push("z");
        this.dimlen = f.length;
        f = Q.align(c, {
            p1: c[0],
            p2: c[b]
        });
        c = Q.dist(c[0], c[b]);
        this._linear = f.reduce(function(a, b) {
            return a + mc(b.y)
        }, 0) < c / 50;
        this._lut = [];
        this._t1 = 0;
        this._t2 = 1;
        this.update()
    }
    T.quadraticFromPoints = function(a, b, c, d) {
        "undefined" === typeof d && (d = .5);
        if (0 === d)
            return new T(b,b,c);
        if (1 === d)
            return new T(a,b,b);
        b = T.getABC(2, a, b, c, d);
        return new T(a,b.A,c)
    }
    ;
    T.cubicFromPoints = function(a, b, c, d, e) {
        "undefined" === typeof d && (d = .5);
        var f = T.getABC(3, a, b, c, d);
        "undefined" === typeof e && (e = Q.dist(b, f.C));
        var g = e * (1 - d) / d
          , h = Q.dist(a, c)
          , l = (c.x - a.x) / h;
        h = (c.y - a.y) / h;
        f = f.A;
        return new T(a,{
            x: a.x + (f.x + (b.x - e * l - f.x) / (1 - d) - a.x) / d,
            y: a.y + (f.y + (b.y - e * h - f.y) / (1 - d) - a.y) / d
        },{
            x: c.x + (f.x + (b.x + g * l - f.x) / d - c.x) / (1 - d),
            y: c.y + (f.y + (b.y + g * h - f.y) / d - c.y) / (1 - d)
        },c)
    }
    ;
    T.getUtils = function() {
        return Q
    }
    ;
    T.prototype.getUtils = function() {
        return T.getUtils()
    }
    ;
    T.prototype.valueOf = function() {
        return this.toString()
    }
    ;
    T.prototype.toString = function() {
        return Q.pointsToString(this.points)
    }
    ;
    T.prototype.toSVG = function() {
        if (this._3d)
            return !1;
        for (var a = this.points, b = ["M", a[0].x, a[0].y, 2 === this.order ? "Q" : "C"], c = 1, d = a.length; c < d; c++)
            b.push(a[c].x),
            b.push(a[c].y);
        return b.join(" ")
    }
    ;
    T.prototype.setRatios = function(a) {
        if (a.length !== this.points.length)
            throw Error("incorrect number of ratio values");
        this.ratios = a;
        this._lut = []
    }
    ;
    T.prototype.verify = function() {
        var a = this.coordDigest();
        a !== this._print && (this._print = a,
        this.update())
    }
    ;
    T.prototype.coordDigest = function() {
        return this.points.map(function(a, b) {
            return "" + b + a.x + a.y + (a.z ? a.z : 0)
        }).join("")
    }
    ;
    T.prototype.update = function() {
        this._lut = [];
        this.dpoints = Q.derive(this.points, this._3d);
        this.computedirection()
    }
    ;
    T.prototype.computedirection = function() {
        var a = this.points;
        this.clockwise = 0 < Q.angle(a[0], a[this.order], a[1])
    }
    ;
    T.prototype.length = function() {
        return Q.length(this.derivative.bind(this))
    }
    ;
    T.getABC = function(a, b, c, d, e) {
        a = void 0 === a ? 2 : a;
        e = void 0 === e ? .5 : e;
        var f = Q.projectionratio(e, a)
          , g = 1 - f;
        f = {
            x: f * b.x + g * d.x,
            y: f * b.y + g * d.y
        };
        a = Q.abcratio(e, a);
        return {
            A: {
                x: c.x + (c.x - f.x) / a,
                y: c.y + (c.y - f.y) / a
            },
            B: c,
            C: f,
            S: b,
            E: d
        }
    }
    ;
    T.prototype.getABC = function(a, b) {
        b = b || this.get(a);
        return T.getABC(this.order, this.points[0], b, this.points[this.order], a)
    }
    ;
    T.prototype.getLUT = function(a) {
        this.verify();
        a = a || 100;
        if (this._lut.length === a)
            return this._lut;
        a++;
        this._lut = [];
        for (var b = 0, c, d; b < a; b++)
            d = b / (a - 1),
            c = this.compute(d),
            c.t = d,
            this._lut.push(c);
        return this._lut
    }
    ;
    T.prototype.on = function(a, b) {
        b = b || 5;
        for (var c = this.getLUT(), d = [], e = 0, f; e < c.length; e++)
            f = c[e],
            Q.dist(f, a) < b && d.push(f);
        return d.length ? NaN / d.length : !1
    }
    ;
    T.prototype.project = function(a) {
        var b = this.getLUT()
          , c = b.length - 1
          , d = Q.closest(b, a)
          , e = d.mpos;
        b = (e + 1) / c;
        var f = .1 / c;
        d = d.mdist;
        e = c = (e - 1) / c;
        for (d += 1; c < b + f; c += f) {
            var g = this.compute(c);
            g = Q.dist(a, g);
            g < d && (d = g,
            e = c)
        }
        e = 0 > e ? 0 : 1 < e ? 1 : e;
        g = this.compute(e);
        g.t = e;
        g.d = d;
        return g
    }
    ;
    T.prototype.get = function(a) {
        return this.compute(a)
    }
    ;
    T.prototype.point = function(a) {
        return this.points[a]
    }
    ;
    T.prototype.compute = function(a) {
        return this.ratios ? Q.computeWithRatios(a, this.points, this.ratios, this._3d) : Q.compute(a, this.points, this._3d, this.ratios)
    }
    ;
    T.prototype.raise = function() {
        for (var a = this.points, b = [a[0]], c = a.length, d = 1, e, f; d < c; d++)
            e = a[d],
            f = a[d - 1],
            b[d] = {
                x: (c - d) / c * e.x + d / c * f.x,
                y: (c - d) / c * e.y + d / c * f.y
            };
        b[c] = a[c - 1];
        return new T(b)
    }
    ;
    T.prototype.derivative = function(a) {
        return Q.compute(a, this.dpoints[0], this._3d)
    }
    ;
    T.prototype.dderivative = function(a) {
        return Q.compute(a, this.dpoints[1], this._3d)
    }
    ;
    T.prototype.align = function() {
        var a = this.points;
        return new T(Q.align(a, {
            p1: a[0],
            p2: a[a.length - 1]
        }))
    }
    ;
    T.prototype.curvature = function(a) {
        return Q.curvature(a, this.dpoints[0], this.dpoints[1], this._3d)
    }
    ;
    T.prototype.inflections = function() {
        return Q.inflections(this.points)
    }
    ;
    T.prototype.normal = function(a) {
        return this._3d ? this.__normal3(a) : this.__normal2(a)
    }
    ;
    T.prototype.__normal2 = function(a) {
        a = this.derivative(a);
        var b = sc(a.x * a.x + a.y * a.y);
        return {
            x: -a.y / b,
            y: a.x / b
        }
    }
    ;
    T.prototype.__normal3 = function(a) {
        var b = this.derivative(a);
        a = this.derivative(a + .01);
        var c = sc(b.x * b.x + b.y * b.y + b.z * b.z)
          , d = sc(a.x * a.x + a.y * a.y + a.z * a.z);
        b.x /= c;
        b.y /= c;
        b.z /= c;
        a.x /= d;
        a.y /= d;
        a.z /= d;
        c = a.y * b.z - a.z * b.y;
        d = a.z * b.x - a.x * b.z;
        a = a.x * b.y - a.y * b.x;
        var e = sc(c * c + d * d + a * a);
        c /= e;
        d /= e;
        a /= e;
        a = [c * c, c * d - a, c * a + d, c * d + a, d * d, d * a - c, c * a - d, d * a + c, a * a];
        return {
            x: a[0] * b.x + a[1] * b.y + a[2] * b.z,
            y: a[3] * b.x + a[4] * b.y + a[5] * b.z,
            z: a[6] * b.x + a[7] * b.y + a[8] * b.z
        }
    }
    ;
    T.prototype.hull = function(a) {
        var b = this.points
          , c = []
          , d = 0;
        c[d++] = b[0];
        c[d++] = b[1];
        c[d++] = b[2];
        for (3 === this.order && (c[d++] = b[3]); 1 < b.length; ) {
            var e = [];
            for (var f = 0, g, h = b.length - 1; f < h; f++)
                g = Q.lerp(a, b[f], b[f + 1]),
                c[d++] = g,
                e.push(g);
            b = e
        }
        return c
    }
    ;
    T.prototype.split = function(a, b) {
        if (0 === a && b)
            return this.split(b).left;
        if (1 === b)
            return this.split(a).right;
        var c = this.hull(a);
        c = {
            left: 2 === this.order ? new T([c[0], c[3], c[5]]) : new T([c[0], c[4], c[7], c[9]]),
            right: 2 === this.order ? new T([c[5], c[4], c[2]]) : new T([c[9], c[8], c[6], c[3]]),
            span: c
        };
        c.left._t1 = Q.map(0, 0, 1, this._t1, this._t2);
        c.left._t2 = Q.map(a, 0, 1, this._t1, this._t2);
        c.right._t1 = Q.map(a, 0, 1, this._t1, this._t2);
        c.right._t2 = Q.map(1, 0, 1, this._t1, this._t2);
        if (!b)
            return c;
        b = Q.map(b, a, 1, 0, 1);
        return c.right.split(b).left
    }
    ;
    T.prototype.extrema = function() {
        var a = {}
          , b = [];
        this.dims.forEach(function(c) {
            function d(a) {
                return a[c]
            }
            var e = this.dpoints[0].map(d);
            a[c] = Q.droots(e);
            3 === this.order && (e = this.dpoints[1].map(d),
            a[c] = a[c].concat(Q.droots(e)));
            a[c] = a[c].filter(function(a) {
                return 0 <= a && 1 >= a
            });
            b = b.concat(a[c].sort(Q.numberSort))
        }
        .bind(this));
        a.values = b.sort(Q.numberSort).filter(function(a, d) {
            return b.indexOf(a) === d
        });
        return a
    }
    ;
    T.prototype.bbox = function() {
        var a = this.extrema()
          , b = {};
        this.dims.forEach(function(c) {
            b[c] = Q.getminmax(this, c, a[c])
        }
        .bind(this));
        return b
    }
    ;
    T.prototype.overlaps = function(a) {
        var b = this.bbox();
        a = a.bbox();
        return Q.bboxoverlap(b, a)
    }
    ;
    T.prototype.offset = function(a, b) {
        if ("undefined" !== typeof b) {
            var c = this.get(a)
              , d = this.normal(a)
              , e = {
                c: c,
                n: d,
                x: c.x + d.x * b,
                y: c.y + d.y * b
            };
            this._3d && (e.z = c.z + d.z * b);
            return e
        }
        if (this._linear) {
            var f = this.normal(0);
            b = this.points.map(function(b) {
                var c = {
                    x: b.x + a * f.x,
                    y: b.y + a * f.y
                };
                b.z && f.z && (c.z = b.z + a * f.z);
                return c
            });
            return [new T(b)]
        }
        return this.reduce().map(function(b) {
            return b._linear ? b.offset(a)[0] : b.scale(a)
        })
    }
    ;
    T.prototype.simple = function() {
        if (3 === this.order) {
            var a = Q.angle(this.points[0], this.points[3], this.points[1])
              , b = Q.angle(this.points[0], this.points[3], this.points[2]);
            if (0 < a && 0 > b || 0 > a && 0 < b)
                return !1
        }
        a = this.normal(0);
        b = this.normal(1);
        var c = a.x * b.x + a.y * b.y;
        this._3d && (c += a.z * b.z);
        return mc(rc(c)) < tc / 3
    }
    ;
    T.prototype.reduce = function() {
        var a, b = 0, c = 0, d = [], e = [], f = this.extrema().values;
        -1 === f.indexOf(0) && (f = [0].concat(f));
        -1 === f.indexOf(1) && f.push(1);
        b = f[0];
        for (a = 1; a < f.length; a++) {
            c = f[a];
            var g = this.split(b, c);
            g._t1 = b;
            g._t2 = c;
            d.push(g);
            b = c
        }
        d.forEach(function(a) {
            for (c = b = 0; 1 >= c; )
                for (c = b + .01; 1.01 >= c; c += .01)
                    if (g = a.split(b, c),
                    !g.simple()) {
                        c -= .01;
                        if (.01 > mc(b - c))
                            return [];
                        g = a.split(b, c);
                        g._t1 = Q.map(b, 0, 1, a._t1, a._t2);
                        g._t2 = Q.map(c, 0, 1, a._t1, a._t2);
                        e.push(g);
                        b = c;
                        break
                    }
            1 > b && (g = a.split(b, 1),
            g._t1 = Q.map(b, 0, 1, a._t1, a._t2),
            g._t2 = a._t2,
            e.push(g))
        });
        return e
    }
    ;
    T.prototype.translate = function(a, b, c) {
        c = "number" === typeof c ? c : b;
        var d = this.order
          , e = this.points.map(function(a, e) {
            return (1 - e / d) * b + e / d * c
        });
        return new T(this.points.map(function(b, c) {
            return {
                x: b.x + a.x * e[c],
                y: b.y + a.y * e[c]
            }
        }))
    }
    ;
    T.prototype.scale = function(a) {
        var b = this
          , c = this.order
          , d = !1;
        "function" === typeof a && (d = a);
        if (d && 2 === c)
            return this.raise().scale(d);
        var e = this.clockwise
          , f = this.points;
        if (this._linear)
            return this.translate(this.normal(0), d ? d(0) : a, d ? d(1) : a);
        var g = d ? d(0) : a
          , h = d ? d(1) : a
          , l = [this.offset(0, 10), this.offset(1, 10)]
          , m = []
          , n = Q.lli4(l[0], l[0].c, l[1], l[1].c);
        if (!n)
            throw Error("cannot scale this curve. Try reducing it first.");
        [0, 1].forEach(function(a) {
            var b = m[a * c] = Q.copy(f[a * c]);
            b.x += (a ? h : g) * l[a].n.x;
            b.y += (a ? h : g) * l[a].n.y
        });
        if (!d)
            return [0, 1].forEach(function(a) {
                if (2 !== c || !a) {
                    var d = m[a * c]
                      , e = b.derivative(a);
                    m[a + 1] = Q.lli4(d, {
                        x: d.x + e.x,
                        y: d.y + e.y
                    }, n, f[a + 1])
                }
            }),
            new T(m);
        [0, 1].forEach(function(b) {
            if (2 !== c || !b) {
                var g = f[b + 1]
                  , h = g.x - n.x
                  , l = g.y - n.y
                  , p = d ? d((b + 1) / c) : a;
                d && !e && (p = -p);
                var w = sc(h * h + l * l);
                m[b + 1] = {
                    x: g.x + h / w * p,
                    y: g.y + l / w * p
                }
            }
        });
        return new T(m)
    }
    ;
    T.prototype.outline = function(a, b, c, d) {
        function e(a, b, c, d, e) {
            return function(f) {
                var g = b - a;
                return Q.map(f, 0, 1, a + d / c * g, a + (d + e) / c * g)
            }
        }
        b = void 0 === b ? a : b;
        if (this._linear) {
            var f = this.normal(0)
              , g = this.points[0]
              , h = this.points[this.points.length - 1];
            void 0 === c && (c = a,
            d = b);
            var l = {
                x: g.x + f.x * a,
                y: g.y + f.y * a
            };
            var m = {
                x: h.x + f.x * c,
                y: h.y + f.y * c
            };
            var n = {
                x: (l.x + m.x) / 2,
                y: (l.y + m.y) / 2
            };
            var p = [l, n, m];
            l = {
                x: g.x - f.x * b,
                y: g.y - f.y * b
            };
            m = {
                x: h.x - f.x * d,
                y: h.y - f.y * d
            };
            n = {
                x: (l.x + m.x) / 2,
                y: (l.y + m.y) / 2
            };
            f = [m, n, l];
            g = Q.makeline(f[2], p[0]);
            h = Q.makeline(p[2], f[0]);
            p = [g, new T(p), h, new T(f)];
            return new jc(p)
        }
        f = this.reduce();
        p = f.length;
        var q = [], r = [], u, v = 0, w = this.length(), x = "undefined" !== typeof c && "undefined" !== typeof d;
        f.forEach(function(f) {
            var g = f.length();
            x ? (q.push(f.scale(e(a, c, w, v, g))),
            r.push(f.scale(e(-b, -d, w, v, g)))) : (q.push(f.scale(a)),
            r.push(f.scale(-b)));
            v += g
        });
        r = r.map(function(a) {
            u = a.points;
            a.points = u[3] ? [u[3], u[2], u[1], u[0]] : [u[2], u[1], u[0]];
            return a
        }).reverse();
        f = q[p - 1].points[q[p - 1].points.length - 1];
        g = r[0].points[0];
        p = Q.makeline(r[p - 1].points[r[p - 1].points.length - 1], q[0].points[0]);
        f = Q.makeline(f, g);
        p = [p].concat(q).concat([f]).concat(r);
        return new jc(p)
    }
    ;
    T.prototype.outlineshapes = function(a, b, c) {
        a = this.outline(a, b || a).curves;
        b = [];
        for (var d = 1, e = a.length; d < e / 2; d++) {
            var f = Q.makeshape(a[d], a[e - d], c);
            f.startcap.virtual = 1 < d;
            f.endcap.virtual = d < e / 2 - 1;
            b.push(f)
        }
        return b
    }
    ;
    T.prototype.intersects = function(a, b) {
        if (!a)
            return this.selfintersects(b);
        if (a.p1 && a.p2)
            return this.lineIntersects(a);
        a instanceof T && (a = a.reduce());
        return this.curveintersects(this.reduce(), a, b)
    }
    ;
    T.prototype.lineIntersects = function(a) {
        var b = this
          , c = nc(a.p1.x, a.p2.x)
          , d = nc(a.p1.y, a.p2.y)
          , e = oc(a.p1.x, a.p2.x)
          , f = oc(a.p1.y, a.p2.y);
        return Q.roots(this.points, a).filter(function(a) {
            a = b.get(a);
            return Q.between(a.x, c, e) && Q.between(a.y, d, f)
        })
    }
    ;
    T.prototype.selfintersects = function(a) {
        for (var b = this.reduce(), c = b.length - 2, d = [], e = 0, f, g; e < c; e++)
            f = b.slice(e, e + 1),
            g = b.slice(e + 2),
            f = this.curveintersects(f, g, a),
            d.push.apply(d, k.arrayFromIterable(f));
        return d
    }
    ;
    T.prototype.curveintersects = function(a, b, c) {
        var d = [];
        a.forEach(function(a) {
            b.forEach(function(b) {
                a.overlaps(b) && d.push({
                    left: a,
                    right: b
                })
            })
        });
        var e = [];
        d.forEach(function(a) {
            a = Q.pairiteration(a.left, a.right, c);
            0 < a.length && (e = e.concat(a))
        });
        return e
    }
    ;
    T.prototype.arcs = function(a) {
        return this._iterate(a || .5, [])
    }
    ;
    T.prototype._error = function(a, b, c, d) {
        var e = (d - c) / 4;
        c = this.get(c + e);
        d = this.get(d - e);
        b = Q.dist(a, b);
        c = Q.dist(a, c);
        a = Q.dist(a, d);
        return mc(c - b) + mc(a - b)
    }
    ;
    T.prototype._iterate = function(a, b) {
        var c = 0;
        do {
            var d = 0;
            var e = 1;
            var f = this.get(c);
            var g = void 0;
            var h = !1;
            var l = 1;
            do {
                var m = h;
                var n = g;
                var p = (c + e) / 2;
                g = this.get(p);
                h = this.get(e);
                g = Q.getccenter(f, g, h);
                g.interval = {
                    start: c,
                    end: e
                };
                h = this._error(g, f, c, e) <= a;
                (m = m && !h) || (l = e);
                if (h) {
                    if (1 <= e) {
                        g.interval.end = l = 1;
                        n = g;
                        1 < e && (c = {
                            x: g.x + g.r * pc(g.e),
                            y: g.y + g.r * qc(g.e)
                        },
                        g.e += Q.angle({
                            x: g.x,
                            y: g.y
                        }, c, this.get(1)));
                        break
                    }
                    e += (e - c) / 2
                } else
                    e = p
            } while (!m && 100 > d++);
            if (100 <= d)
                break;
            n = n ? n : g;
            b.push(n);
            c = l
        } while (1 > e);
        return b
    }
    ;
    k.global.Object.defineProperties(T, {
        PolyBezier: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return jc
            }
        }
    });
    WALK.ColorUtils = {
        linearToGamma: function(a) {
            return .0031308 >= a ? 12.92 * a : 1.055 * Math.pow(a, 1 / 2.4) - .055
        },
        gammaToLinear: function(a) {
            return .04045 >= a ? a / 12.92 : Math.pow((a + .055) / 1.055, 2.4)
        },
        hdrEncode: function(a, b) {
            var c = Math.sqrt(a.r) / 2.82842712
              , d = Math.sqrt(a.g) / 2.82842712;
            a = Math.sqrt(a.b) / 2.82842712;
            var e = Math.max(Math.max(c, d), a);
            e = t.Math.clamp(e, 1 / 255, 1);
            e = Math.ceil(255 * e) / 255;
            b.setRGB(c / e, d / e, a / e);
            return 1 - e
        }
    };
    t.Color.prototype.copyGammaToLinear = void 0;
    t.Color.prototype.copyLinearToGamma = void 0;
    t.Color.prototype.convertLinearToGamma = void 0;
    t.Color.prototype.convertGammaToLinear = function() {
        this.r = WALK.ColorUtils.gammaToLinear(this.r);
        this.g = WALK.ColorUtils.gammaToLinear(this.g);
        this.b = WALK.ColorUtils.gammaToLinear(this.b)
    }
    ;
    t.Color.prototype.roundChannels = function() {
        this.r = WALK.round(this.r, 3);
        this.g = WALK.round(this.g, 3);
        this.b = WALK.round(this.b, 3);
        return this
    }
    ;
    WALK.Euler = function(a, b, c) {
        t.Euler.call(this, b, c, a, "ZXY")
    }
    ;
    WALK.Euler.prototype = Object.create(t.Euler.prototype);
    WALK.Euler.prototype.constructor = WALK.Euler;
    Object.defineProperty(WALK.Euler.prototype, "yaw", {
        get: function() {
            return this.z
        },
        set: function(a) {
            this.z = a
        }
    });
    Object.defineProperty(WALK.Euler.prototype, "pitch", {
        get: function() {
            return this.x
        },
        set: function(a) {
            this.x = a
        }
    });
    Object.defineProperty(WALK.Euler.prototype, "roll", {
        get: function() {
            return this.y
        },
        set: function(a) {
            this.y = a
        }
    });
    Object.defineProperty(WALK.Euler.prototype, "yawDeg", {
        get: function() {
            return t.Math.radToDeg(this.yaw)
        },
        set: function(a) {
            this.yaw = t.Math.degToRad(a)
        }
    });
    Object.defineProperty(WALK.Euler.prototype, "pitchDeg", {
        get: function() {
            return t.Math.radToDeg(this.pitch)
        },
        set: function(a) {
            this.pitch = t.Math.degToRad(a)
        }
    });
    Object.defineProperty(WALK.Euler.prototype, "rollDeg", {
        get: function() {
            return t.Math.radToDeg(this.roll)
        },
        set: function(a) {
            this.roll = t.Math.degToRad(a)
        }
    });
    WALK.Euler.prototype.setFromDegTriple = function(a) {
        var b = t.Math.degToRad(a[0])
          , c = t.Math.degToRad(a[1]);
        a = t.Math.degToRad(a[2]);
        this.set(c, a, b);
        return this
    }
    ;
    WALK.Euler.prototype.toDegTriple = function() {
        return [this.yawDeg, this.pitchDeg, this.rollDeg]
    }
    ;
    WALK.Euler.prototype.setFromDirection = function(a) {
        this.set(Math.asin(a.z), 0, Math.atan2(-a.x, a.y));
        return this
    }
    ;
    WALK.Euler.prototype.toQuaternion = function() {
        var a = new t.Quaternion;
        a.setFromEuler(this);
        return a
    }
    ;
    WALK.Euler.prototype.toRotationMatrix = function() {
        var a = new t.Matrix4;
        a.makeRotationFromEuler(this);
        return a
    }
    ;
    var uc = new t.Sphere;
    WALK.Frustum = function() {
        this.planes = [new t.Plane, new t.Plane, new t.Plane, new t.Plane, new t.Plane, new t.Plane]
    }
    ;
    WALK.Frustum.prototype = {
        constructor: WALK.Frustum,
        setFromMatrix: function(a) {
            var b = this.planes
              , c = a.elements;
            a = c[0];
            var d = c[1]
              , e = c[2]
              , f = c[3]
              , g = c[4]
              , h = c[5]
              , l = c[6]
              , m = c[7]
              , n = c[8]
              , p = c[9]
              , q = c[10]
              , r = c[11]
              , u = c[12]
              , v = c[13]
              , w = c[14];
            c = c[15];
            b[0].setComponents(f - a, m - g, r - n, c - u).normalize();
            b[1].setComponents(f + a, m + g, r + n, c + u).normalize();
            b[2].setComponents(f + d, m + h, r + p, c + v).normalize();
            b[3].setComponents(f - d, m - h, r - p, c - v).normalize();
            b[4].setComponents(f - e, m - l, r - q, c - w).normalize();
            b[5].setComponents(f + e, m + l, r + q, c + w).normalize();
            return this
        },
        intersectsObject: function(a) {
            var b = a.geometry;
            null === b.boundingSphere && b.computeBoundingSphere();
            a.matrixWorld ? (uc.copy(b.boundingSphere),
            uc.applyMatrix4(a.matrixWorld),
            a = uc) : a = b.boundingSphere;
            return this.intersectsSphere(a)
        },
        nearPlaneDistanceToCenter: function(a) {
            var b = a.geometry
              , c = this.planes[5];
            a.matrixWorld ? (uc.copy(b.boundingSphere),
            uc.applyMatrix4(a.matrixWorld),
            a = uc) : a = b.boundingSphere;
            return c.distanceToPoint(a.center)
        },
        intersectsSphere: function(a) {
            var b = this.planes
              , c = a.center;
            a = -a.radius;
            for (var d = 0; 6 > d; d += 1)
                if (b[d].distanceToPoint(c) < a)
                    return !1;
            return !0
        },
        intersectsBox: function() {
            var a = new t.Vector3
              , b = new t.Vector3;
            return function(c) {
                for (var d = this.planes, e = 0; 6 > e; e += 1) {
                    var f = d[e];
                    a.x = 0 < f.normal.x ? c.min.x : c.max.x;
                    b.x = 0 < f.normal.x ? c.max.x : c.min.x;
                    a.y = 0 < f.normal.y ? c.min.y : c.max.y;
                    b.y = 0 < f.normal.y ? c.max.y : c.min.y;
                    a.z = 0 < f.normal.z ? c.min.z : c.max.z;
                    b.z = 0 < f.normal.z ? c.max.z : c.min.z;
                    var g = f.distanceToPoint(a);
                    f = f.distanceToPoint(b);
                    if (0 > g && 0 > f)
                        return !1
                }
                return !0
            }
        }(),
        containsPoint: function(a) {
            for (var b = this.planes, c = 0; 6 > c; c += 1)
                if (0 > b[c].distanceToPoint(a))
                    return !1;
            return !0
        }
    };
    var vc = new t.Vector3;
    WALK.Math = {
        toSnorm8: function(a) {
            return Math.round(127 * t.Math.clamp(a, -1, 1))
        },
        minBytesToHold: function(a) {
            return 127 >= a ? 1 : 32767 >= a ? 2 : 4
        },
        anyPositiveRootOfQuadraticEquation: function(a, b, c) {
            c = b * b - 4 * a * c;
            if (0 > c)
                return null;
            c = Math.sqrt(c);
            var d = (-b - c) / (2 * a);
            if (0 < d)
                return d;
            a = (-b + c) / (2 * a);
            return 0 < a ? a : null
        },
        spheresUnion: function(a, b) {
            if (b.empty())
                b.copy(a);
            else {
                var c = b.center.distanceTo(a.center);
                if (a.radius > b.radius) {
                    var d = a;
                    a = b
                } else
                    d = b;
                var e = (d.radius + a.radius + c) / 2;
                e <= d.radius ? b.copy(d) : (c = (e - d.radius) / c,
                console.assert(0 < c),
                vc.copy(a.center).sub(d.center).multiplyScalar(c),
                b.center.copy(d.center).add(vc),
                b.radius = e)
            }
        }
    };
    WALK.DETECTOR = new function() {
        function a(a) {
            function b(b) {
                var c = d[b];
                if (void 0 !== c)
                    return c;
                switch (b) {
                case "EXT_texture_filter_anisotropic":
                    c = a.getExtension("EXT_texture_filter_anisotropic") || a.getExtension("MOZ_EXT_texture_filter_anisotropic") || a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");
                    break;
                case "WEBGL_compressed_texture_s3tc":
                    c = a.getExtension("WEBGL_compressed_texture_s3tc") || a.getExtension("MOZ_WEBGL_compressed_texture_s3tc") || a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
                    break;
                case "WEBGL_compressed_texture_pvrtc":
                    c = a.getExtension("WEBGL_compressed_texture_pvrtc") || a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");
                    break;
                case "WEBGL_compressed_texture_etc1":
                    c = a.getExtension("WEBGL_compressed_texture_etc1");
                    break;
                default:
                    c = a.getExtension(b)
                }
                return d[b] = c
            }
            function c() {
                var a = navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);
                return a ? parseInt(a[2], 10) : !1
            }
            var d = {};
            this.extension = b;
            this.webgl2 = "undefined" !== typeof WebGL2RenderingContext && a instanceof WebGL2RenderingContext;
            this.antialiasNative = a.getContextAttributes().antialias && 1 < a.getParameter(a.SAMPLES);
            this.antialiasSamples = a.getParameter(a.SAMPLES);
            this.antialiasPostprocess = !g.mobile;
            this.floatTextures = this.webgl2 || b("OES_texture_float");
            this.standardDerivatives = this.webgl2 || b("OES_standard_derivatives");
            this.maxAnisotropy = function() {
                var c = b("EXT_texture_filter_anisotropic");
                return null !== c ? a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0
            }();
            this.indexUint = this.webgl2 || b("OES_element_index_uint");
            this.instances = this.webgl2 || b("ANGLE_instanced_arrays");
            this.fragmentPrecision = void 0 === a.getShaderPrecisionFormat || 0 < a.getShaderPrecisionFormat(a.FRAGMENT_SHADER, a.HIGH_FLOAT).precision ? "highp" : 0 < a.getShaderPrecisionFormat(a.FRAGMENT_SHADER, a.MEDIUM_FLOAT).precision ? "mediump" : "lowp";
            var e = 4096 > a.getParameter(a.MAX_TEXTURE_SIZE) ? "Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported." : null;
            this.missingCapabilities = e;
            this.maxRenderBufferSize = a.getParameter(a.MAX_RENDERBUFFER_SIZE);
            this.dxtTextures = function() {
                try {
                    if (WALK.urlHashContains("nodxt"))
                        return !1;
                    for (var c = b("WEBGL_compressed_texture_s3tc"), d = a.getParameter(a.COMPRESSED_TEXTURE_FORMATS), e = !1, f = !1, g = 0; g < d.length; g += 1)
                        e = e || d[g] === c.COMPRESSED_RGB_S3TC_DXT1_EXT,
                        f = f || d[g] === c.COMPRESSED_RGBA_S3TC_DXT5_EXT;
                    return e && f
                } catch (z) {}
                return !1
            }();
            e = WALK.urlHashContains("nopvr") ? !1 : b("WEBGL_compressed_texture_pvrtc");
            this.pvrtcTextures = e;
            e = WALK.urlHashContains("noetc1") ? !1 : b("WEBGL_compressed_texture_etc1") && g.mobile;
            this.etc1Textures = e;
            this.astcTextures = !1;
            this.textureLod = this.webgl2 || b("EXT_shader_texture_lod") && (!g.firefox || !g.android);
            this.mirrorCubeMaps = !g.mobile || WALK.MOBILE_HI;
            this.disableTextureSlotReuse = g.mac || 83 === c();
            this.reportToConsole = function() {
                WALK.log("WebGL" + (this.webgl2 ? "2" : "") + "; " + this.fragmentPrecision + " fragment precision.");
                this.dxtTextures || WALK.log("DXT textures not supported.");
                this.textureLod || WALK.log("Texture fetch level of detail not supported.");
                this.floatTextures || WALK.log("Float textures not supported.");
                this.antialiasNative ? WALK.log("Native anti-aliasing supported with " + this.antialiasSamples + " samples.") : WALK.log("Native anti-aliasing not supported");
                this.disableTextureSlotReuse && WALK.log("WebGL texture slot reuse disabled.");
                this.indexUint || WALK.log("Uint index not supported");
                this.instances || WALK.log("Instanced geometry not supported")
            }
        }
        function b(a) {
            var b = document.createElement("a");
            b.href = a;
            return b.protocol + "//" + b.host
        }
        function c(a, b) {
            a = a.toLowerCase();
            b = b.toLowerCase();
            return -1 !== a.indexOf(b)
        }
        function d(a) {
            return navigator && navigator.userAgent ? c(navigator.userAgent, a) : !1
        }
        function e(a, b) {
            console.assert(void 0 === g[a]);
            g[a] = b;
            void 0 !== g.webp && (l.forEach(function(a) {
                return a()
            }),
            l.length = 0)
        }
        function f() {
            var a = new Image;
            a.onload = function() {
                e("webp", 0 < a.width && 0 < a.height)
            }
            ;
            a.onerror = function() {
                e("webp", !1)
            }
            ;
            a.src = "data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="
        }
        var g = this;
        this.https = "https:" === window.location.protocol;
        this.localhost = "localhost" === window.location.hostname || "127.0.0.1" === window.location.hostname;
        this.canForceBrotliBuffers = !1;
        this.ipad = /iPad/.test(navigator.userAgent) || "MacIntel" === navigator.platform && 1 < navigator.maxTouchPoints;
        this.mobile = /mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent) || this.ipad || WALK.urlHashContains("mobile");
        this.ios = /iPhone|iPod/.test(navigator.userAgent) && !window.MSStream || this.ipad;
        this.android = /Android/.test(navigator.userAgent);
        this.facebookApp = /FBAN|FBAV/.test(navigator.userAgent);
        this.whatsApp = /WhatsApp/.test(navigator.userAgent);
        this.inCrossOriginIframe = function() {
            var a = window.self !== window.top
              , c = b(document.referrer)
              , d = b(window.location.href);
            return a && c !== d
        }();
        this.firefox = d("firefox");
        this.opera = d("opera") || d("OPR/");
        var h;
        (h = d("msie")) || (h = navigator && navigator.appVersion ? c(navigator.appVersion, "trident/") : !1);
        this.ie = h;
        this.edge = d("edge/");
        this.safari = d("safari/") && !(d("chrome/") || d("chromium/"));
        this.mac = d("macintosh") && !this.ipad;
        this.BASIS_DECODE_WORKERS = this.safari || this.ios ? 0 : Math.min(4, navigator.hardwareConcurrency || 4);
        this.gl = null;
        this.resetGlDetector = function(b) {
            this.gl = new a(b)
        }
        ;
        this.webp = void 0;
        var l = [];
        WALK.NO_WEBP ? this.webp = !1 : f();
        this.onAsyncPropertiesDetected = function(a) {
            void 0 !== g.webp ? a() : l.push(a)
        }
    }
    ;
    function wc(a, b) {
        function c() {
            return !1
        }
        function d(a, b) {
            var c = g.callbacks.onPointerDown(a, b);
            h = !0;
            l = a;
            m = b;
            return c
        }
        function e(a, b, d) {
            var e = g.callbacks.onPointerUp(a, b);
            if (h) {
                var f = Date.now();
                e = null !== q && .03 >= Math.abs(n - l) && .03 >= Math.abs(p - m) && 500 >= Math.abs(q - f) && g.callbacks.onDoubleClick !== c ? g.callbacks.onDoubleClick(a, b) || e : g.callbacks.onClick(a, b, d) || e;
                q = f;
                n = a;
                p = b
            }
            return e
        }
        function f(a, b) {
            var c = g.callbacks.onPointerMove(a, b);
            !h || .03 >= Math.abs(a - l) && .03 >= Math.abs(b - m) || (h = !1,
            q = null);
            return c
        }
        var g = this
          , h = !1
          , l = null
          , m = null
          , n = null
          , p = null
          , q = null;
        this.callbacks = {
            onClick: c,
            onDoubleClick: c,
            onPointerDown: c,
            onPointerUp: c,
            onPointerMove: c
        };
        var r = !1;
        this.isEnabled = function() {
            return r
        }
        ;
        this.enable = function() {
            r || (a.addPointerDownListener(d, b),
            a.addPointerUpListener(e, b),
            a.addPointerMoveListener(f, b),
            r = !0)
        }
        ;
        this.disable = function() {
            r && (a.removePointerDownListener(d),
            a.removePointerUpListener(e),
            a.removePointerMoveListener(f),
            r = !1)
        }
        ;
        this.enable()
    }
    ;function xc(a) {
        var b, c, d, e;
        this.set = function(f, g, h) {
            console.assert(void 0 === b && void 0 === c && void 0 === d && void 0 === e);
            b = a.autoClear;
            c = a.autoClearColor;
            d = a.autoClearDepth;
            e = a.autoClearStencil;
            a.autoClear = f || g || h;
            a.autoClearColor = f;
            a.autoClearDepth = g;
            a.autoClearStencil = h
        }
        ;
        this.restore = function() {
            console.assert(void 0 !== b && void 0 !== c && void 0 !== d && void 0 !== e);
            a.autoClear = b;
            a.autoClearColor = c;
            a.autoClearDepth = d;
            a.autoClearStencil = e;
            e = d = c = b = void 0
        }
    }
    ;function yc(a) {
        var b = new t.Color
          , c = null
          , d = !1;
        this.set = function(e, f) {
            console.assert(!d);
            d = !0;
            b.copy(a.getClearColor());
            c = a.getClearAlpha();
            a.setClearColor(e, f)
        }
        ;
        this.restore = function() {
            console.assert(d);
            d = !1;
            a.setClearColor(b, c)
        }
    }
    ;function zc(a, b, c) {
        this.ray = new t.Ray(a,b);
        this.far = c || Infinity;
        this.ignoreVisibility = this.onlyGroundCollisions = this.respectColliderSettings = !1
    }
    function Ac() {
        this.distance = Infinity;
        this.point = new t.Vector3;
        this.object = null
    }
    function Bc(a, b) {
        function c(a, b) {
            if (!b.ignoreVisibility && !a.visible)
                return !1;
            var c = a.node || n;
            if (c.disableCollisions && b.respectColliderSettings || !c.ground && b.onlyGroundCollisions)
                return !1;
            c = b.ray;
            if (a.matrixWorld)
                return !0;
            var d = a.geometry.boundingSphere;
            if (d.distanceToPoint(c.origin) > b.far || !1 === c.isIntersectionSphere(d))
                return !1;
            a = a.geometry.boundingBox;
            return a.distanceToPoint(c.origin) > b.far || !c.isIntersectionBox(a) ? !1 : !0
        }
        var d = a.createRenderTarget(1, 1, {
            format: GLC.RGBA,
            magFilter: GLC.NEAREST,
            minFilter: GLC.NEAREST,
            stencilBuffer: !1,
            depthBuffer: !0,
            generateMipmaps: !1
        })
          , e = new Uint8Array(4)
          , f = new xc(a)
          , g = new yc(a)
          , h = new t.Color(16777215)
          , l = new WALK.ObjectDistanceMaterial(!1)
          , m = new t.PerspectiveCamera(1,1,b.near,b.far)
          , n = {
            disableCollisions: !1,
            ground: !1
        };
        this.closestIntersection = function(b, n, r) {
            for (var p = [], q = 0; q < b.length; q += 1) {
                var w = b[q];
                console.assert(null === w.visibilityId);
                c(w, n) && (w.visibilityId = p.length,
                p.push(w))
            }
            if (0 === p.length)
                return !1;
            m.position.set(0, 0, 0);
            m.lookAt(n.ray.direction);
            m.position.copy(n.ray.origin);
            m.updateMatrixWorld();
            f.set(!0, !0, !1);
            g.set(h);
            b = a.sortObjects;
            a.sortObjects = !1;
            a.renderMeshes(p, l, m, d, !1, n.ignoreVisibility);
            a.sortObjects = b;
            g.restore();
            f.restore();
            a.readPixels(1, 1, e);
            a.setRenderTarget(null);
            b = 256 * e[0] + e[1];
            q = e[2] + e[3] / 255;
            for (w = 0; w < p.length; w += 1)
                p[w].visibilityId = null;
            if (65535 === b || q > n.far)
                return !1;
            console.assert(b < p.length);
            r.object = p[b];
            r.distance = q;
            r.point.copy(n.ray.direction).multiplyScalar(q).add(n.ray.origin);
            return !0
        }
    }
    ;/*
 Copyright (C) 2022-present Shapespark
*/
    function Cc(a) {
        return document.getElementById(a)
    }
    function Dc() {
        if (!WALK.DETECTOR.ios) {
            var a = Cc("walk-canvas");
            a && a.focus()
        }
    }
    function Jc(a) {
        return function(b) {
            b.stopPropagation();
            a();
            Dc()
        }
    }
    function Kc(a, b) {
        a.addEventListener("click", Jc(b))
    }
    function Lc(a, b) {
        Kc(Cc(a), b)
    }
    function Mc(a) {
        a.addEventListener("click", function(a) {
            a.stopPropagation();
            a.target instanceof HTMLInputElement || a.target instanceof HTMLSelectElement || a.target instanceof HTMLTextAreaElement || Dc()
        })
    }
    ;var Nc = null;
    function Oc(a, b, c) {
        var d = !1
          , e = document.getElementById("ext-html-label")
          , f = e.querySelector("#ext-html-label-content");
        this.close = function(a) {
            d ? (e.classList.add("ui-out"),
            Dc(),
            window.setTimeout(function() {
                e.classList.remove("ext-html-label-topleft");
                e.classList.remove("ext-html-label-horizontal-center");
                e.classList.remove("ext-html-label-vertical-center");
                e.classList.remove("ext-html-label-center");
                e.classList.remove("ui-out");
                f.innerHTML = "";
                e.style.display = "none";
                c && c();
                a && a();
                d = !1
            }, 400)) : a()
        }
        ;
        this.open = function() {
            var c = this;
            if (!d) {
                if (a instanceof Node)
                    f.appendChild(a);
                else {
                    var h = WALK.getExtraAssetUrl("").slice(0, -1);
                    h = a.replace(/\$EXTRA_ASSETS/g, h);
                    f.innerHTML = h
                }
                f.style.padding = b.padding || void 0 === b.padding ? "" : 0;
                e.style.display = "";
                b.centerVertically ? b.centerHorizontally ? e.classList.add("ext-html-label-center") : e.classList.add("ext-html-label-vertical-center") : b.centerHorizontally ? e.classList.add("ext-html-label-horizontal-center") : e.classList.add("ext-html-label-topleft");
                e.classList.add("ui-out");
                e.classList.remove("ext-html-label-animated");
                WALK.preventClosureCompilerDeadCodeRemoval(e.offsetHeight);
                e.classList.add("ext-html-label-animated");
                e.classList.remove("ui-out");
                e.querySelector("#ext-html-label-close").onclick = function() {
                    c.close()
                }
                ;
                d = !0
            }
        }
    }
    function Pc(a, b, c) {
        var d = new Oc(a,b,c);
        null !== Nc ? Nc.close(function() {
            return d.open()
        }) : d.open();
        return Nc = d
    }
    ;WALK.Viewer = function(a, b, c) {
        function d() {
            return null
        }
        function e(a) {
            c.isMaterialEditable(a) || console.assert(!1, "Can't access material, call ViewerApi.setMaterialEditable('" + a + "') before the scene is loaded.")
        }
        function f() {
            for (var a = [], b = k.makeIterator(D.materials), d = b.next(); !d.done; d = b.next())
                d = d.value,
                c.isMaterialEditable(d.name) && a.push(d);
            return a
        }
        function g() {
            for (var a = [], b = k.makeIterator(D.nodeConfigs), d = b.next(); !d.done; d = b.next())
                d = d.value,
                c.isNodeTypeEditable(d.name) && a.push(d.name);
            return a
        }
        function h(a) {
            e(a);
            for (var b = k.makeIterator(D.materials), c = b.next(); !c.done; c = b.next())
                if (c = c.value,
                c.name === a)
                    return c;
            return null
        }
        function l() {
            Qa.copy(E.cameraWorldPosition());
            return Qa
        }
        function m() {
            bb.yaw = E.getYawAngle();
            bb.pitch = E.getPitchAngle();
            bb.roll = 0;
            return bb
        }
        function n() {
            return D.boundingBox
        }
        function p(a) {
            var b = [];
            e(a);
            for (var c = k.makeIterator(D.gpuMeshes), d = c.next(); !d.done; d = c.next())
                d = d.value,
                d.material.name === a && b.push(d);
            return b
        }
        function q(a) {
            return (a = D.findNodeConfig(a)) ? a.nodes.slice(0) : []
        }
        function r(a, b) {
            b.geometry.isUvs0Repeating && a.ensureTexturesRepeatable && a.ensureTexturesRepeatable();
            b.material = a;
            ia.requestFrame()
        }
        function u(a, b) {
            console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");
            r(a, b)
        }
        function v(a, b, c) {
            var d;
            (d = "string" === typeof a ? D.findViewByName(a) : a) ? (!0 === b ? b = 0 : !1 === b && (b = void 0),
            Z.isRunning() && (b = 0,
            Z.stop()),
            c ? (S.activateSky(d),
            S.updateHiddenMeshes(d)) : S.switchToView(d, b)) : console.error("Unknown view: " + a)
        }
        function w(a) {
            a = void 0 === a ? {} : a;
            var b = a.isPanorama || !1
              , c = a.width || (b ? 4E3 : window.innerWidth)
              , d = a.height || (b ? 2E3 : window.innerHeight);
            if (a.toDataUrl)
                return da.monoScreenToDataUrl(b, c, d);
            da.monoScreenToLocalImage(b, c, d)
        }
        function x(a) {
            D.addAuxiliaryObject(a);
            a !== a.colliderMesh && F.uploadNewBuffers(a.colliderMesh);
            R.addDynamicObstacle(a.colliderMesh)
        }
        function y(a, b) {
            for (var c = [], d = 1; d < arguments.length; ++d)
                c[d - 1] = arguments[d];
            try {
                return a.apply(null, k.arrayFromIterable(c))
            } catch (oa) {
                console.error(oa)
            }
            return !1
        }
        function z(a, b) {
            for (var c = [], d = 1; d < arguments.length; ++d)
                c[d - 1] = arguments[d];
            if (a) {
                d = k.makeIterator(a);
                for (var e = d.next(); !e.done; e = d.next())
                    y.apply(null, [e.value].concat(k.arrayFromIterable(c)))
            }
        }
        function A() {
            z(V.nextPageInteraction);
            V.nextPageInteraction.length = 0
        }
        function B(a, b) {
            a = new WALK.Anchor(D,a);
            Ga.push(a);
            va && x(a);
            V.anchorClicked[a.colliderMesh.id] = b;
            ka = !0;
            ia.requestFrame();
            return a
        }
        function H(a) {
            delete V.anchorClicked[a.colliderMesh.id];
            va && (D.removeAuxiliaryObject(a),
            R.removeDynamicObstacle(a.colliderMesh));
            WALK.removeFromArray(a, Ga);
            a.dispose();
            ia.requestFrame()
        }
        function C(a, b) {
            a = new WALK.Avatar(D,a,b);
            Ha.push(a);
            D.addAuxiliaryObject(a, !0);
            b = k.makeIterator(a.colliders);
            for (var c = b.next(); !c.done; c = b.next())
                R.addDynamicObstacle(c.value);
            z(V.avatarListChanged);
            return a
        }
        function L(a) {
            for (var b = k.makeIterator(a.colliders), c = b.next(); !c.done; c = b.next())
                R.removeDynamicObstacle(c.value);
            D.removeAuxiliaryObject(a);
            WALK.removeFromArray(a, Ha);
            a.dispose();
            z(V.avatarListChanged)
        }
        function G(a) {
            return WALK.find(Ha, function(b) {
                return b.uuid === a
            })
        }
        function I() {
            for (var a = k.makeIterator(D.getAnimatedMaterials()), b = a.next(); !b.done; b = a.next())
                b.value.sleepAnimation()
        }
        function M() {
            for (var a = k.makeIterator(D.getAnimatedMaterials()), b = a.next(); !b.done; b = a.next())
                b.value.wakeAnimation();
            ia.requestFrame()
        }
        function O(a, b) {
            return Y.getExtension(a, b)
        }
        function K(a, b) {
            var c = a[b];
            if (c)
                return c;
            c = [];
            return a[b] = c
        }
        var F, D = null, E, S, Z, R, da, ha, ia, Y, N, U, ba, W, ka = !1, ca = !1, la = null, ya = null, V = {
            nextPageInteraction: [],
            viewerConfigLoaded: [],
            sceneReadyToDisplay: [],
            sceneLoadComplete: [],
            anchorClicked: {},
            materialPickerClicked: {},
            materialPickerClosed: null,
            nodeTypeClicked: {},
            anyNodeTypeClicked: [],
            materialClicked: {},
            nodeTypeHoverChanged: {},
            materialHoverChanged: {},
            viewSwitchStarted: [],
            viewSwitchDone: [],
            vrChange: [],
            beforeRender: [],
            anchorsVisibilityChanged: [],
            apiUserStateChanged: {},
            anyApiUserStateChanged: [],
            meetingJoined: [],
            avatarListChanged: []
        }, Ga = [], Ha = [], Qa = new t.Vector3, bb = new WALK.Euler;
        document.addEventListener("keydown", A);
        document.addEventListener("mousedown", A);
        WALK.DETECTOR.ios ? document.addEventListener("touchstart", A) : document.addEventListener("touchend", A);
        var va = !0;
        Object.defineProperty(this, "anchorsVisible", {
            get: function() {
                return va
            },
            set: function(a) {
                a !== va && ((va = a) ? Ga.forEach(function(a) {
                    return x(a)
                }) : Ga.forEach(function(a) {
                    D.removeAuxiliaryObject(a);
                    R.removeDynamicObstacle(a.colliderMesh)
                }),
                this.requestFrame(),
                z(V.anchorsVisibilityChanged, va))
            }
        });
        var Db = function() {
            function a(a, b, d) {
                c.set(a.x, a.y, h.z).sub(h);
                a = c.length();
                a > b && (c.normalize().multiplyScalar(a - b),
                d.add(c))
            }
            var b = new t.Vector3, c = new t.Vector3, d = new t.Vector3, e = new t.Sphere, f = new t.Vector3, g = new WALK.Euler, h;
            return function(c) {
                h = E.cameraWorldPosition();
                f.copy(h);
                c instanceof WALK.LightInstance && "sun" === c.light.type ? (WALK.sunRotationToPosition(D, c.rotation, b),
                c = b) : c instanceof WALK.Node ? (WALK.computeNodeBoundingSphere(c, e),
                c = e.center,
                a(c, 1 + e.radius, f)) : (c = c.position,
                a(c, 1, f));
                d.copy(c).sub(f).normalize();
                g.setFromDirection(d);
                S.switchToPoint(f, g)
            }
        }();
        this.openMaterialPicker = function(a, b, c, d, e) {
            console.assert(!la, "Only one material picker can be opened");
            la = new WALK.MaterialPicker(a,d,e,D,E,ha,ba);
            la.meshes.forEach(function(a) {
                D.addAuxiliaryObject(a);
                R.addDynamicObstacle(a);
                V.materialPickerClicked[a.id] = b
            });
            V.materialPickerClosed = c
        }
        ;
        this.closeMaterialPicker = function() {
            la && (la.meshes.forEach(function(a) {
                D.removeAuxiliaryObject(a);
                R.removeDynamicObstacle(a);
                delete V.materialPickerClicked[a.id]
            }),
            la.dispose(),
            la = null,
            V.materialPickerClosed && (V.materialPickerClosed(),
            V.materialPickerClosed = null))
        }
        ;
        window.addEventListener("resize", this.closeMaterialPicker.bind(this));
        this._vrChange = function(a) {
            z(V.vrChange, a)
        }
        ;
        this._update = function(a) {
            z(V.beforeRender, a)
        }
        ;
        this._clickListener = function(a, b, c) {
            function d(a, d) {
                if (a) {
                    a = k.makeIterator(a);
                    for (var e = a.next(); !e.done; e = a.next())
                        if (y(e.value, d, b, c))
                            return !0
                }
                return !1
            }
            if (!ka)
                return !1;
            if (la) {
                var e = V.materialPickerClicked[a.id];
                if (e)
                    return y(e, a.material, la.meshes.indexOf(a)),
                    !0;
                this.closeMaterialPicker();
                return !0
            }
            if (e = V.anchorClicked[a.id])
                return y(e, a.anchor, b, c),
                !0;
            for (e = a.node; e; e = e.parent)
                if (d(V.nodeTypeClicked[e.type], a.node))
                    return !0;
            return a.node && d(V.anyNodeTypeClicked, a.node) ? !0 : a.material ? d(V.materialClicked[a.material.name], a.material) : !1
        }
        ;
        this._createHoverListener = function() {
            var a = V.nodeTypeHoverChanged
              , b = V.materialHoverChanged
              , c = [];
            return 0 === Object.keys(a).length && 0 === Object.keys(b).length ? null : function(d, e) {
                for (var f = d.node; f; f = f.parent)
                    for (var g = k.makeIterator(a[f.type] || c), h = g.next(); !h.done; h = g.next())
                        if (y(h.value, f, e))
                            return !0;
                if (d.material)
                    for (f = k.makeIterator(b[d.material.name] || c),
                    h = f.next(); !h.done; h = f.next())
                        if (y(h.value, d.material, e))
                            return !0;
                return !1
            }
        }
        ;
        this._teleportStarted = function(a) {
            a = a.view;
            null !== a && z(V.viewSwitchStarted, a.name, a)
        }
        ;
        this._teleportDone = function(a) {
            a = a.view;
            null !== a && z(V.viewSwitchDone, a.name, a)
        }
        ;
        this._viewerConfigLoaded = function(a) {
            N = a;
            z(V.viewerConfigLoaded, N);
            V.viewerConfigLoaded = []
        }
        ;
        this._sceneReadyToDisplay = function(a, b, c, d, e, x, y, A, N, ca, ya, la, K) {
            F = a;
            D = b;
            E = c;
            S = d;
            Z = e;
            R = x;
            da = y;
            ha = A;
            U = N;
            ba = ca;
            W = ya;
            ia = la;
            Y = K;
            this.getEditableMaterials = f;
            this.getEditableNodeTypes = g;
            this.findMaterial = h;
            this.findMeshesWithMaterial = p;
            this.findNodesOfType = q;
            this.getCameraPosition = l;
            this.getCameraRotation = m;
            this.getSceneBoundingBox = n;
            this.setMaterialForNode = u;
            this.setMaterialForMesh = r;
            this.switchToView = v;
            this.captureImage = w;
            this.addAnchor = B;
            this.removeAnchor = H;
            this.addAvatar = C;
            this.removeAvatar = L;
            this.findAvatar = G;
            this.seeItem = Db;
            this.sleepAnimatedMaterials = I;
            this.wakeAnimatedMaterials = M;
            this.getExtension = O;
            z(V.sceneReadyToDisplay, D);
            V.sceneReadyToDisplay = [];
            S.addEventListener("teleportStarted", this._teleportStarted.bind(this));
            S.addEventListener("teleportDone", this._teleportDone.bind(this))
        }
        ;
        this._contextLost = function() {
            ca = !1;
            N = D = S = Z = R = da = W = ia = null;
            this.getExtension = this.wakeAnimatedMaterials = this.sleepAnimatedMaterials = this.findAvatar = this.removeAnchor = this.addAvatar = this.addAnchor = this.captureImage = this.switchToView = this.setMaterialForMesh = this.setMaterialForNode = this.findNodesOfType = this.findMeshesWithMaterial = this.findMaterial = this.getEditableNodeTypes = this.getEditableMaterials = d
        }
        ;
        this._sceneLoadComplete = function() {
            z(V.sceneLoadComplete);
            V.sceneLoadComplete = [];
            ca = !0;
            for (var a = k.makeIterator(Ga), b = a.next(); !b.done; b = a.next())
                b.value.enableLightProbe()
        }
        ;
        this.openUrl = function(b, c) {
            if (c || a)
                return window.open(b);
            window.location.href = b
        }
        ;
        this.onNextPageInteraction = function(a) {
            V.nextPageInteraction.push(a)
        }
        ;
        this.onViewerConfigLoaded = function(a) {
            N ? a(N) : V.viewerConfigLoaded.push(a)
        }
        ;
        this.isSceneReadyToDisplay = function() {
            return null !== D
        }
        ;
        this.onSceneReadyToDisplay = function(a) {
            D ? a(D) : V.sceneReadyToDisplay.push(a)
        }
        ;
        this.onSceneLoadComplete = function(a) {
            ca ? a(D) : V.sceneLoadComplete.push(a)
        }
        ;
        this.requestFrame = function() {
            ia && ia.requestFrame()
        }
        ;
        this.setNodeTypeEditable = function(a) {
            console.assert(null === D, "setNodeTypeEditable must be called before the scene is loaded");
            c.setNodeTypeEditable(a)
        }
        ;
        this.setMaterialEditable = function(a) {
            console.assert(null === D, "setMaterialEditable must be called before the scene is loaded");
            c.setMaterialEditable(a)
        }
        ;
        this.setAllMaterialsEditable = function() {
            console.assert(null === D, "setAllMaterialsEditable must be called before the scene is loaded");
            c.setAllMaterialsEditable()
        }
        ;
        this.onNodeTypeClicked = function(a, b) {
            "function" === typeof a ? V.anyNodeTypeClicked.push(a) : K(V.nodeTypeClicked, a).push(b);
            ka = !0
        }
        ;
        this.removeOnNodeTypeClicked = function(a, b) {
            "function" === typeof a ? WALK.removeFromArray(a, V.anyNodeTypeClicked) : WALK.removeFromArray(b, V.nodeTypeClicked[a])
        }
        ;
        this.onMaterialClicked = function(a, b) {
            this.setMaterialEditable(a);
            K(V.materialClicked, a).push(b);
            ka = !0
        }
        ;
        this.onNodeTypeHoverChanged = function(a, b) {
            this.setNodeTypeEditable(a);
            K(V.nodeTypeHoverChanged, a).push(b)
        }
        ;
        this.onMaterialHoverChanged = function(a, b) {
            this.setMaterialEditable(a);
            K(V.materialHoverChanged, a).push(b)
        }
        ;
        this.onViewSwitchStarted = function(a) {
            V.viewSwitchStarted.push(a)
        }
        ;
        this.onViewSwitchDone = function(a) {
            V.viewSwitchDone.push(a)
        }
        ;
        this.onVrChange = function(a) {
            V.vrChange.push(a)
        }
        ;
        this.onBeforeRender = function(a) {
            V.beforeRender.push(a)
        }
        ;
        this.createTextureFromHtmlImage = function(a, b) {
            function c() {
                e.needsUpdate = !0;
                e.width = a.naturalWidth;
                e.height = a.naturalHeight;
                t.Math.isPowerOfTwo(e.width) && t.Math.isPowerOfTwo(e.height) || (e.minFilter = GLC.LINEAR);
                e.notifyLoaded()
            }
            function d() {
                c();
                f && f();
                a.onload = f
            }
            b = void 0 === b ? !1 : b;
            var e = new ob;
            e.image = a;
            e.wrapS = e.wrapT = GLC.REPEAT;
            e.minFilter = GLC.LINEAR_MIPMAP_LINEAR;
            e.anisotropy = WALK.DEFAULT_ANISOTROPY;
            e.format = b ? GLC.RGBA : GLC.RGB;
            e.hasAlpha = b;
            var f = null;
            a.complete && 0 !== a.naturalHeight ? c() : (f = a.onload,
            a.onload = d);
            return e
        }
        ;
        this.createTextureFromHtmlVideo = function(a) {
            var b = new rb;
            b.video = a;
            b.minFilter = GLC.LINEAR;
            b.anisotropy = WALK.DEFAULT_ANISOTROPY;
            b.format = GLC.RGB;
            b.generateMipmaps = !1;
            a.setAttribute("playsinline", "");
            a.setAttribute("webkit-playsinline", "");
            a.crossOrigin = "anonymous";
            WALK.onVideoDataReady(a, function(a) {
                b.width = a.videoWidth;
                b.height = a.videoHeight;
                t.Math.isPowerOfTwo(b.width) && t.Math.isPowerOfTwo(b.height) ? (b.wrapS = GLC.REPEAT,
                b.wrapT = GLC.REPEAT) : (b.wrapS = GLC.CLAMP_TO_EDGE,
                b.wrapT = GLC.CLAMP_TO_EDGE);
                b.notifyLoaded()
            });
            return b
        }
        ;
        this.createStreamTextureFromHtmlVideo = function(a) {
            a = this.createTextureFromHtmlVideo(a);
            a._interruptible = !1;
            return a
        }
        ;
        this.addAnchor = function() {
            console.assert(!1, "Can't add anchors until the scene is ready to display")
        }
        ;
        this.removeAnchor = function() {
            console.assert(!1, "Can't remove anchors until the scene is ready to display")
        }
        ;
        this.addAvatar = function() {
            console.assert(!1, "Can't add avatars until the scene is ready to display")
        }
        ;
        this.removeAvatar = function() {
            console.assert(!1, "Can't remove avatars until the scene is ready to display")
        }
        ;
        this.findAvatar = function() {
            console.assert(!1, "Can't find avatars until the scene is ready to display")
        }
        ;
        this.sleepAnimatedMaterials = function() {
            console.assert(!1, "Can't sleep animated materials until the scene is ready to display")
        }
        ;
        this.wakeAnimatedMaterials = function() {
            console.assert(!1, "Can't wake animated materials until the scene is ready to display")
        }
        ;
        this.getExtension = function() {
            console.assert(!1, "Can't get extension until the scene is ready to display")
        }
        ;
        this.onAnchorsVisibilityChanged = function(a) {
            V.anchorsVisibilityChanged.push(a)
        }
        ;
        this.removeAnchorsVisibilityChangedListener = function(a) {
            V.anchorsVisibilityChanged = V.anchorsVisibilityChanged.filter(function(b) {
                return b !== a
            })
        }
        ;
        this.seeItem = this.captureImage = this.switchToView = this.setMaterialForNode = this.getSceneBoundingBox = this.getCameraRotation = this.getCameraPosition = this.findNodesOfType = this.findMeshesWithMaterial = this.findMaterial = this.getEditableNodeTypes = this.getEditableMaterials = d;
        this.getViewerAssetUrl = function(a) {
            return WALK.getViewerAssetUrl(a)
        }
        ;
        this.addMenuButton = function(a) {
            return b.addExtraButton(a)
        }
        ;
        this.removeMenuButton = function(a) {
            b.removeExtraButton(a)
        }
        ;
        this.getMenuButtonIcon = function(a) {
            return b.getExtraButonIcon(a)
        }
        ;
        Object.defineProperty(this, "menuVisible", {
            get: function() {
                return b.visible
            },
            set: function(a) {
                b.visible = a
            }
        });
        this.onMenuVisibilityChanged = function(a) {
            b.addEventListener("visibilityChanged", function() {
                a()
            })
        }
        ;
        Object.defineProperty(this, "helpVisible", {
            get: function() {
                return b.helpVisible
            },
            set: function(a) {
                b.helpVisible = a
            }
        });
        this.play = function() {
            WALK.play()
        }
        ;
        var Ta = {};
        this.apiUserChangeState = function(a, b) {
            WALK.deepEqual(Ta[a], b) || (Ta[a] = WALK.readOnlyCopy(b),
            b = WALK.cloneObject(b),
            z(V.apiUserStateChanged[a], a, b),
            z(V.anyApiUserStateChanged, a, b))
        }
        ;
        this.onApiUserStateChanged = function(a, b) {
            "function" === typeof a ? V.anyApiUserStateChanged.push(a) : K(V.apiUserStateChanged, a).push(b)
        }
        ;
        this.removeOnApiUserStateChanged = function(a, b) {
            "function" === typeof a ? WALK.removeFromArray(a, V.anyApiUserStateChanged) : WALK.removeFromArray(b, V.apiUserStateChanged[a])
        }
        ;
        this.getApiUserState = function(a) {
            if (void 0 === a)
                return WALK.cloneObject(Ta);
            a = Ta[a];
            return void 0 === a ? void 0 : WALK.cloneObject(a)
        }
        ;
        this._meetingJoined = function(a) {
            console.assert(null === ya);
            ya = a;
            z(V.meetingJoined, ya)
        }
        ;
        this._isMeeting = function() {
            return WALK.urlHashContains("meeting-key") || WALK.urlHashContains("meeting")
        }
        ;
        this._onMeetingJoined = function(a) {
            V.meetingJoined.push(a);
            null !== ya && a(ya)
        }
        ;
        this._removeOnMeetingJoined = function(a) {
            WALK.removeFromArray(a, V.meetingJoined)
        }
        ;
        this._onAvatarListChanged = function(a) {
            V.avatarListChanged.push(a)
        }
        ;
        this._removeOnAvatarListChanged = function(a) {
            WALK.removeFromArray(a, V.avatarListChanged)
        }
        ;
        this._createPointerEventHelper = function(a) {
            return new wc(W,a)
        }
        ;
        this._disableControls = function() {
            E.disable()
        }
        ;
        this._enableControls = function() {
            E.enable()
        }
        ;
        var vb = new Ac;
        this._findIntersectionAtPosition = function(a, b) {
            R.findIntersectionAtPosition(a, b, !0, vb);
            return vb
        }
        ;
        this.getWalkMaxSpeed = function() {
            console.assert(D, "getWalkMaxSpeed must be called after the scene is loaded");
            return D.camera.moveMaxSpeed
        }
        ;
        this.setWalkMaxSpeed = function(a) {
            console.assert(D, "setWalkMaxSpeed must be called after the scene is loaded");
            D.camera.moveMaxSpeed = a
        }
        ;
        this.openPopup = function(a, b, c) {
            b = void 0 === b ? {} : b;
            return Pc(a, b, c)
        }
        ;
        this.enableMinimap = function() {
            console.assert(D, "enableMinimap must be called after the scene is loaded");
            D.minimapConfig.enabled = !0
        }
        ;
        this.disableMinimap = function() {
            console.assert(D, "disableMinimap must be called after the scene is loaded");
            D.minimapConfig.enabled = !1
        }
        ;
        this.isMinimapEnabled = function() {
            console.assert(D, "isMinimapEnabled must be called after the scene is loaded");
            return D.minimapConfig.enabled
        }
        ;
        this.vrEnabled = function() {
            console.assert(D, "vrEnabled must be called after the scene is loaded");
            return U.vrEnabled()
        }
        ;
        this.enableVr = function() {
            console.assert(D, "enableVr must be called after the scene is loaded");
            U.vrEnabled() || U.enableVr(F.context)
        }
        ;
        this.disableVr = function() {
            console.assert(D, "disableVr must be called after the scene is loaded");
            U.vrEnabled() && U.disableVr()
        }
    }
    ;
    function Qc(a) {
        a = void 0 === a ? {} : a;
        t.EventDispatcher.call(this);
        var b = this;
        this._distanceEnabled = a.distanceEnabled || !1;
        this._distanceDensity = a.distanceDensity || .01;
        this._distanceStart = a.distanceStart || 0;
        this._heightEnabled = a.heightEnabled || !1;
        this._heightDensity = a.heightDensity || .01;
        this._heightStart = a.heightStart || 0;
        this._color = (new t.Color).fromArray(a.color || [.5, .5, .5]);
        this._updated = function() {
            return b.dispatchEvent({
                type: "updated",
                target: b
            })
        }
    }
    k.inherits(Qc, t.EventDispatcher);
    Qc.prototype.enabled = function() {
        return this._distanceEnabled || this.heightEnabled
    }
    ;
    Qc.prototype.serialize = function() {
        return {
            distanceEnabled: this._distanceEnabled,
            distanceDensity: this._distanceDensity,
            distanceStart: this._distanceStart,
            heightEnabled: this._heightEnabled,
            heightDensity: this._heightDensity,
            heightStart: this._heightStart,
            color: this._color.toArray()
        }
    }
    ;
    k.global.Object.defineProperties(Qc.prototype, {
        distanceEnabled: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._distanceEnabled
            },
            set: function(a) {
                this._distanceEnabled = a;
                this._updated()
            }
        },
        distanceDensity: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._distanceDensity
            },
            set: function(a) {
                this._distanceDensity = a;
                this._updated()
            }
        },
        distanceStart: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._distanceStart
            },
            set: function(a) {
                this._distanceStart = a;
                this._updated()
            }
        },
        heightEnabled: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._heightEnabled
            },
            set: function(a) {
                this._heightEnabled = a;
                this._updated()
            }
        },
        heightDensity: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._heightDensity
            },
            set: function(a) {
                this._heightDensity = a;
                this._updated()
            }
        },
        heightStart: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._heightStart
            },
            set: function(a) {
                this._heightStart = a;
                this._updated()
            }
        },
        color: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._color
            },
            set: function(a) {
                this._color.fromArray(a);
                this._updated()
            }
        }
    });
    function Rc(a) {
        function b(a, b, c) {
            var d = new t.SphereBufferGeometry(1,64,64);
            return new WALK.SkyMesh(a,d,b,c)
        }
        function c(a) {
            var c = new WALK.ProceduralSkyMaterial;
            return b(a.name, c, a.center)
        }
        this.loadSkyTexture = function(b, c) {
            b.material.map && b.material.map.dispose();
            b.material.map = a.load(WALK.LOAD_PRIORITY.SKY, c, !1, !1, WALK.NO_ANISOTROPY);
            b.yawRotationDeg = 0
        }
        ;
        this.loadSingleSky = function(d, e, f) {
            if ("procedural" === d.type || void 0 === d.type)
                d = c(d);
            else if ("equirect" === d.type) {
                var g = new WALK.EquirectSkyMaterial;
                g.map = a.load(WALK.LOAD_PRIORITY.SKY, d.texture, !1, !1, WALK.NO_ANISOTROPY);
                g = b(d.name, g, d.center);
                g.geometry.applyMatrix((new t.Matrix4).makeScale(1, 1, -1));
                g.rotation.x = Math.PI / 2;
                g.yawRotationDeg = d.yawRotation || 0;
                d = g
            } else
                console.warn("Unknown sky type: ", d.type),
                d = c(d);
            d.fog = f;
            e.addSkyMesh(d)
        }
        ;
        this.load = function(a, b) {
            var c = new Qc(a[0].fog);
            b.addFog(c);
            this.loadSingleSky({
                name: WALK.DEFAULT_SKY_NAME,
                type: "procedural"
            }, b, c);
            for (var d = 0; d < a.length; d += 1)
                this.loadSingleSky(a[d], b, c)
        }
    }
    ;var Sc = function() {
        function a(a, c) {
            return {
                formatIdx: a,
                gpuFormat: c
            }
        }
        return {
            ETC1: a(0, GLC.COMPRESSED_RGB_ETC1_WEBGL),
            BC1: a(2, GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),
            BC3: a(3, GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),
            PVRTC1_4_RGB: a(8, GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),
            PVRTC1_4_RGBA: a(9, GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),
            ASTC_4x4: a(10, GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),
            RGBA32: a(13, GLC.RGBA)
        }
    }();
    function Tc(a, b, c, d, e) {
        a({
            wasmBinary: b
        }).then(function(a) {
            function b(a, b, e) {
                var f = 0 === Math.log2(b) % 1 && 0 === Math.log2(e) % 1;
                return d.dxtTextures ? a ? c.BC3 : c.BC1 : d.pvrtcTextures && b === e && f ? a ? c.PVRTC1_4_RGBA : c.PVRTC1_4_RGB : d.etc1Textures && !a ? c.ETC1 : d.astcTextures ? c.ASTC_4x4 : c.RGBA32
            }
            a.initializeBasis();
            e(function(c) {
                function d(a) {
                    e.close();
                    e.delete();
                    throw a;
                }
                var e = new a.BasisFile(new self.Uint8Array(c));
                c = e.getHasAlpha();
                var f = e.getNumImages()
                  , g = e.getNumLevels(0)
                  , h = e.getImageWidth(0, 0)
                  , r = e.getImageHeight(0, 0);
                0 !== h && 0 !== r && 0 !== f && 0 !== g || d("Invalid .basis file");
                1 < f && d("Missing multiple images handling");
                f = b(c, h, r);
                h = f.formatIdx;
                e.startTranscoding() || d("startTranscoding failed");
                r = [];
                for (var u = 0; u < g; ++u) {
                    var v = e.getImageWidth(0, u)
                      , w = e.getImageHeight(0, u)
                      , x = e.getImageTranscodedSizeInBytes(0, u, h);
                    x = new self.Uint8Array(new self.ArrayBuffer(x));
                    e.transcodeImage(x, 0, u, h, 0, c) || d(".transcodeImage failed");
                    r.push({
                        data: x,
                        width: v,
                        height: w
                    })
                }
                e.close();
                e.delete();
                return {
                    gpuFormat: f.gpuFormat,
                    mipmaps: r
                }
            })
        })
    }
    function Uc(a, b, c, d) {
        function e() {
            g.removeEventListener("error", f);
            g.removeEventListener("message", e);
            g.addEventListener("error", function(a) {
                a = "Worker error @L" + a.lineno + ": " + a.message;
                h && (h.onError(a),
                h = null)
            });
            g.addEventListener("message", function(a) {
                console.assert(h);
                h.onSuccess(a.data);
                h = null;
                d(l)
            });
            c();
            d(l)
        }
        function f(a) {
            throw "Worker error @L" + a.lineno + ": " + a.message;
        }
        var g = new window.Worker(a)
          , h = null
          , l = {
            processItem: function(a) {
                console.assert(!h);
                h = a;
                g.postMessage(a.texBuffer, [a.texBuffer])
            },
            terminate: function() {
                console.assert(!h);
                g.terminate()
            }
        };
        g.addEventListener("error", f);
        g.addEventListener("message", e);
        g.postMessage(b)
    }
    function Vc(a, b, c, d) {
        function e() {
            n.deferRun();
            0 !== m.length && (0 < l.length ? (l.pop().processItem(m.pop()),
            e()) : h < d && !g && (h++,
            g = !0,
            Uc(f, c, function() {
                g = !1
            }, function(a) {
                l.push(a);
                e()
            })))
        }
        a = "\nself.importScripts(" + JSON.stringify(a) + ");\nconst initBasis = " + Tc.toString() + ";\nconst basisFormats = " + JSON.stringify(Sc) + ";\nconst glDetector = " + JSON.stringify({
            astcTextures: b.gl.astcTextures,
            dxtTextures: b.gl.dxtTextures,
            etc1Textures: b.gl.etc1Textures,
            pvrtcTextures: b.gl.pvrtcTextures
        }) + ";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, glDetector,\n            decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
        var f = window.URL.createObjectURL(new window.Blob([a]))
          , g = !1
          , h = 0
          , l = []
          , m = []
          , n = new WALK.DeferringExecutorOnce(function() {
            for (var a = k.makeIterator(l), b = a.next(); !b.done; b = a.next())
                b.value.terminate();
            h -= l.length;
            l.length = 0
        }
        ,5E3);
        return function(a, b, c) {
            m.push({
                texBuffer: a,
                onSuccess: b,
                onError: c
            });
            e()
        }
    }
    function Wc(a, b) {
        WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"), !0, function(c) {
            var d = WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js")
              , e = a.BASIS_DECODE_WORKERS;
            if (0 >= e) {
                var f = window.document.createElement("script");
                f.addEventListener("load", function h() {
                    f.removeEventListener("load", h);
                    Tc(window.BASIS, c, Sc, a.gl, function(a) {
                        b(function(b, c, d) {
                            try {
                                c(a(b))
                            } catch (q) {
                                d(q)
                            }
                        })
                    })
                });
                f.src = d;
                window.document.head.appendChild(f)
            } else
                b(Vc(d, a, c, e))
        }, function(a) {
            throw a;
        })
    }
    function Xc(a) {
        function b(a) {
            for (var b = [], c = 0; c < arguments.length; ++c)
                b[c - 0] = arguments[c];
            d.push(b)
        }
        function c(a) {
            b = a;
            d.forEach(function(a) {
                return b.apply(null, k.arrayFromIterable(a))
            });
            d.length = 0
        }
        if (!window.WebAssembly || !(a.gl.pvrtcTextures || a.gl.etc1Textures || a.gl.dxtTextures || a.gl.astcTextures))
            return null;
        var d = []
          , e = !1;
        return {
            load: function(d, g, h) {
                var f = new pb;
                e || (e = !0,
                Wc(a, c));
                d(function(a) {
                    b(a, function(a) {
                        f.format = a.gpuFormat;
                        a = a.mipmaps;
                        f.mipmaps = a;
                        f.width = a[0].width;
                        f.height = a[0].height;
                        f.generateMipmaps = !1;
                        f.minFilter = 1 === a.length ? GLC.LINEAR : GLC.LINEAR_MIPMAP_LINEAR;
                        f.flipY = !1;
                        f.needsUpdate = !0;
                        g(f)
                    }, h)
                }, h);
                return f
            }
        }
    }
    ;var Yc = !1;
    function Zc(a, b, c) {
        function d() {
            Yc = !0;
            var d = CryptoJS.lib.WordArray.create(a)
              , f = d.clone();
            f.sigBytes = 16;
            f.clamp();
            d.words.splice(0, 4);
            d.sigBytes -= 16;
            var g = CryptoJS.enc.Base64.parse(b);
            f = CryptoJS.AES.decrypt({
                ciphertext: d
            }, g, {
                iv: f,
                mode: CryptoJS.mode.CFB
            });
            d = f.sigBytes;
            f = f.words;
            g = new Uint8Array(d);
            for (var h = 0, l = 0; h !== d; ) {
                var m = f[l++];
                g[h++] = (m & 4278190080) >>> 24;
                if (h === d)
                    break;
                g[h++] = (m & 16711680) >>> 16;
                if (h === d)
                    break;
                g[h++] = (m & 65280) >>> 8;
                if (h === d)
                    break;
                g[h++] = m & 255
            }
            c(g.buffer)
        }
        Yc ? d() : WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/crypto-js.min.js"), d, function() {
            return Ba.error("Cannot load required library")
        })
    }
    ;function $c() {
        this.load = function(a, b, c, d) {
            var e = []
              , f = new pb;
            f.image = e;
            WALK.queueAjaxGet(a, b, !0, function(a) {
                var b = []
                  , d = new Int32Array(a,0,16);
                67305985 === d[3] && console.assert("Big endian machines not supported");
                console.assert(0 === d[4]);
                console.assert(1 === d[5]);
                console.assert(0 === d[6]);
                if (35842 === d[7]) {
                    console.assert(6408 === d[8]);
                    var g = GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG
                } else
                    36196 === d[7] ? (console.assert(6407 === d[8]),
                    g = GLC.COMPRESSED_RGB_ETC1_WEBGL) : 33776 === d[7] ? (console.assert(6407 === d[8]),
                    g = GLC.COMPRESSED_RGB_S3TC_DXT1_EXT) : 33779 === d[7] ? (console.assert(6408 === d[8]),
                    g = GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT) : console.error("Unknown KTX glInternalFormat: " + d[7]);
                var n = d[9]
                  , p = d[10];
                console.assert(0 === (n & n - 1));
                console.assert(0 === (p & p - 1));
                console.assert(0 === d[11]);
                console.assert(0 === d[12]);
                console.assert(1 === d[13]);
                var q = d[14];
                d = d[15];
                console.assert(0 === d % 4);
                d = 64 + d;
                for (var r = new DataView(a,0), u = n, v = p, w = 0; w < q; ++w) {
                    var x = r.getUint32(d, !0);
                    d += 4;
                    var y = new Uint8Array(a,d,x);
                    b.push({
                        data: y,
                        width: u,
                        height: v
                    });
                    d += x + (3 - (x + 3) % 4);
                    u = Math.max(u / 2, 1);
                    v = Math.max(v / 2, 1)
                }
                console.assert(d === a.byteLength);
                a = {
                    format: g,
                    width: n,
                    height: p,
                    mipmapCount: q,
                    mipmaps: b
                };
                if (a.isCubemap)
                    for (b = a.mipmaps.length / a.mipmapCount,
                    g = 0; g < b; g += 1)
                        for (e[g] = {
                            mipmaps: []
                        },
                        n = 0; n < a.mipmapCount; n += 1)
                            e[g].mipmaps.push(a.mipmaps[g * a.mipmapCount + n]),
                            e[g].format = a.format,
                            e[g].width = a.width,
                            e[g].height = a.height;
                else
                    f.image.width = a.width,
                    f.image.height = a.height,
                    f.mipmaps = a.mipmaps;
                1 === a.mipmapCount && (f.minFilter = GLC.LINEAR);
                f.format = a.format;
                f.width = a.width;
                f.height = a.height;
                c && c(f)
            }, d);
            return f
        }
    }
    ;function ad() {
        var a = {};
        this.cacheKey = function(a, c, d, e, f) {
            return a + "@" + c + "@" + d + "@" + e + "@" + f
        }
        ;
        this.get = function(b) {
            return a[b]
        }
        ;
        this.insert = function(b, c) {
            a[b] = c
        }
    }
    function bd(a, b) {
        return function(c, d) {
            WALK.queueAjaxGet(a, b, !0, c, d)
        }
    }
    function cd(a, b, c) {
        return function(d, e) {
            bd(a, b)(function(a) {
                Zc(a, c, d, e)
            }, e)
        }
    }
    function dd(a, b, c, d, e, f) {
        function g(a) {
            h.image = a;
            h.width = a.width;
            h.height = a.height;
            e(h)
        }
        var h = new ob;
        h.format = c;
        void 0 !== d ? cd(a, b, d)(function(a) {
            a = new Uint8Array(a);
            var c = b.endsWith("png") ? "image/png" : "image/jpeg";
            a = new Blob([a],{
                type: c
            });
            a = (window.URL || window.webkitURL).createObjectURL(a);
            var d = new Image;
            d.onload = function() {
                g(d)
            }
            ;
            d.src = a
        }, f) : WALK.queueImageGet(a, b, g, f);
        return h
    }
    function ed(a, b, c, d, e, f) {
        var g = new rb;
        g.format = c;
        WALK.queueVideoGet(a, b, function(a) {
            g.video = a;
            g.width = a.videoWidth;
            g.height = a.videoHeight;
            a = t.Math.isPowerOfTwo(g.width) && t.Math.isPowerOfTwo(g.height);
            g.wrapS = a ? GLC.REPEAT : GLC.CLAMP_TO_EDGE;
            g.wrapT = a ? GLC.REPEAT : GLC.CLAMP_TO_EDGE;
            e(g);
            d && g.pause()
        }, f);
        return g
    }
    function fd(a, b) {
        !1 === a.importGpuCompress && (b.importGpuCompress = !1);
        !1 === a.importAutoScale && (b.importAutoScale = !1)
    }
    function gd(a, b, c, d, e, f, g) {
        function h(c) {
            var d = c.id
              , e = c.webFormats;
            console.assert(e && 0 < e.length, "No web format for texture: " + c.id + "." + c.rawExt);
            if (c.video)
                return a + "video/" + e[0] + "/" + d + "." + c.stdExt;
            var f = a + "img/"
              , g = b.ios && c.rgbm;
            if (v && !g) {
                if (!b.mobile && -1 < e.indexOf("large/basis"))
                    return f + "large/basis/" + d + ".basis";
                if (-1 < e.indexOf("small/basis"))
                    return f + "small/basis/" + d + ".basis"
            }
            if (b.gl.pvrtcTextures && !g && -1 < e.indexOf("small/pvr"))
                return f + "small/pvr/" + d + ".ktx";
            if (b.gl.etc1Textures && -1 < e.indexOf("small/etc1"))
                return f + "small/etc1/" + d + ".ktx";
            if (b.gl.dxtTextures && -1 < e.indexOf("large/dxt"))
                return f + "large/dxt/" + d + ".ktx";
            g = -1 < e.indexOf("small/std");
            return !(-1 < e.indexOf("large/std")) || b.mobile && g ? f + "small/std/" + d + "." + c.stdExt : f + "large/std/" + d + "." + c.stdExt
        }
        function l(a) {
            --q.texturesToLoad;
            a.needsUpdate = !0;
            c(a);
            a.notifyLoaded()
        }
        function m() {
            --q.texturesToLoad;
            d()
        }
        function n() {
            --q.texturesToLoad;
            e()
        }
        function p(a, b, c, d, e) {
            var f = new qb;
            WALK.queueAjaxGet(a, b, !0, function(a) {
                a = new Uint8Array(a,0,a.byteLength);
                var b = a[1];
                f.image.width = Math.pow(2, a[0]);
                f.image.height = Math.pow(2, b);
                f.format = c;
                f.type = GLC.UNSIGNED_BYTE;
                f.image.data = a.subarray(2);
                d && d(f);
                f = null
            }, e);
            return f
        }
        var q = this
          , r = new ad
          , u = new $c
          , v = !WALK.NO_BASIS && Xc(b);
        f && (r.insert = function() {}
        );
        this.texturesToLoad = 0;
        this.clearCache = function() {
            r = null
        }
        ;
        this.load = function(a, b, c, d, e) {
            var f = b.alpha ? GLC.RGBA : GLC.RGB
              , w = h(b)
              , x = /\.basis$/.test(w)
              , y = /\.ktx$/.test(w)
              , A = /\.buf$/.test(w)
              , z = b.video
              , M = !(y || A || z)
              , O = b.passphrase
              , K = r.cacheKey(w, c, d, e, f)
              , F = r.get(K);
            if (F)
                return fd(b, F),
                F;
            q.texturesToLoad += 1;
            A ? F = p(a, w, f, l, m) : x ? (a = void 0 === O ? bd(a, w) : cd(a, w, O),
            F = v.load(a, l, m)) : y ? F = u.load(a, w, l, m) : M ? F = dd(a, w, f, O, l, m) : (console.assert(z),
            F = ed(WALK.LOAD_PRIORITY.VIDEO, w, f, g, l, n));
            F.hasAlpha = !!b.alpha;
            F.isRgbm = !!b.rgbm;
            c && (F.wrapS = GLC.REPEAT,
            F.wrapT = GLC.REPEAT);
            d && !z ? (F.minFilter = GLC.LINEAR_MIPMAP_LINEAR,
            F.generateMipmaps = !y) : (F.minFilter = GLC.LINEAR,
            F.generateMipmaps = !1);
            e && (F.anisotropy = e);
            r.insert(K, F);
            F.id = b.id;
            F.name = b.name;
            F.webFormats = b.webFormats;
            b.passphrase && (F.passphrase = b.passphrase);
            fd(b, F);
            b.rawExt && (F.rawExt = b.rawExt);
            F.stdExt = b.stdExt;
            return F
        }
    }
    ;function hd(a) {
        for (var b = 0, c = 0; c < a.length; c += 1)
            a[c].id >= b && (b = a[c].id + 1);
        return b
    }
    function id(a, b) {
        for (var c = 0; c < a.length; c += 1)
            if (a[c].name === b)
                return !1;
        return !0
    }
    function jd(a, b) {
        for (var c = a, d = 2; !id(b, c); d += 1)
            c = a + d.toString();
        return c
    }
    WALK.EditorHooks = function(a, b, c, d, e, f, g, h, l, m, n) {
        function p() {
            Ba.info("Failed to load texture")
        }
        var q = {
            geometryFacesCnt: a.nodes.reduce(function(a, b) {
                return a + b.facesInSubtree()
            }, 0),
            objectsCnt: function() {
                var b = 0;
                a.visitAllNodes(function(a) {
                    a.mesh && b++
                });
                return b
            }(),
            lightMapsCnt: function() {
                var b = -1;
                a.visitAllNodes(function(a) {
                    a.mesh && a.mesh.lightMapIdx > b && (b = a.mesh.lightMapIdx)
                });
                return b + 1
            }()
        }
          , r = new gd(WALK.ASSETS_URL,WALK.DETECTOR,function(a) {
            null === a.isCutout && m.isCutoutTexture(a);
            h.requestFrame()
        }
        ,p,p,!0,!1)
          , u = new Rc(r)
          , v = e.transformControls;
        this.getExtensionManager = function() {
            return f
        }
        ;
        this.getCameraPosition = function() {
            var a = c.cameraWorldPosition();
            return [a.x, a.y, a.z]
        }
        ;
        this.getCameraRotation = function() {
            return [t.Math.radToDeg(c.getYawAngle()), t.Math.radToDeg(c.getPitchAngle())]
        }
        ;
        this.getCamera = function() {
            return a.camera
        }
        ;
        this.getSceneStats = function() {
            return q
        }
        ;
        this.getMaterials = function() {
            return a.sortedMaterials()
        }
        ;
        this.getLights = function() {
            return a.lights
        }
        ;
        this.getLightProbes = function() {
            return a.lightProbes
        }
        ;
        this.getCameraVolumes = function() {
            return a.cameraVolumes
        }
        ;
        this.getNodes = function() {
            return a.nodes
        }
        ;
        this.getMinimap = function() {
            return l
        }
        ;
        this.getMinimapConfig = function() {
            return a.minimapConfig
        }
        ;
        this.setLevelSelectedCallback = function(a) {
            l.addEventListener("minimapLevelSelected", function(b) {
                null !== b.level && a(b.level)
            })
        }
        ;
        this.getBoundingBox = function() {
            return a.boundingBox
        }
        ;
        this.addLight = function(b, c, d) {
            b = new WALK.Light({
                name: jd(b, a.lights),
                type: c,
                doNotImport: !0
            });
            b.addInstance(d);
            a.addLight(b)
        }
        ;
        this.removeLight = function(b) {
            a.removeLight(b)
        }
        ;
        this.renameLight = function(b, c) {
            c = c.trim() || "light";
            b.name = "";
            b.name = jd(c, a.lights)
        }
        ;
        this.addLightInstance = function(a, b, c) {
            a.addInstance(b, c)
        }
        ;
        this.removeLightInstance = function(a, b) {
            a.removeInstance(b)
        }
        ;
        this.addLightProbe = function(b) {
            var c = hd(a.lightProbes);
            b = new WALK.LightProbe({
                id: c,
                position: b
            });
            b.enableBoundingBox();
            a.addLightProbe(b);
            1 === a.lightProbes.length && a.enableLightProbesForMaterials()
        }
        ;
        this.removeLightProbe = function(b) {
            a.removeLightProbe(b);
            0 === a.lightProbes.length && a.disableLightProbesForMaterials()
        }
        ;
        this.getCameraVolumeTypes = function() {
            return WALK.CameraVolume.CameraVolumeTypes
        }
        ;
        this.addCameraVolume = function(b, c) {
            var d = (new t.Vector3).fromArray(this.getCameraPosition())
              , e = this.getCameraRotation();
            e = (new t.Vector3(0,3,0)).applyEuler(new WALK.Euler(e[0] / 180 * Math.PI,e[1] / 180 * Math.PI,0));
            var f = hd(a.cameraVolumes);
            a.addCameraVolume(new WALK.CameraVolume({
                id: f,
                name: c || b + f,
                type: b,
                position: d.add(e).toArray(),
                rotation: [0, 0, 0],
                scale: [1, 1, 1],
                exposure: a.camera.defaultExposure,
                gamma: a.camera.defaultGamma
            }))
        }
        ;
        this.removeCameraVolume = function(b) {
            a.removeCameraVolume(b)
        }
        ;
        this.shiftCameraVolume = function(b, c) {
            a.shiftCameraVolume(b, c)
        }
        ;
        this.getViews = function() {
            return a.views.filter(function(a) {
                return !a.internal
            })
        }
        ;
        this.markScreenshotArea = function(a) {
            g.markArea(a)
        }
        ;
        this.unmarkScreenshotArea = function() {
            g.unmarkArea()
        }
        ;
        this.monoScreenToBuffer = function(a, b, c) {
            return g.monoScreenToBuffer(a, b, c)
        }
        ;
        this.stereoPanoramaToBuffer = function(a, b, c, d) {
            return g.stereoPanoramaToBuffer(a, b, c, d)
        }
        ;
        this.addViewFromCamera = function(b, d) {
            var e = [];
            console.assert("fps" === d || "top" === d || "orbit" === d);
            var f = c.cameraWorldPosition()
              , g = c.orbit;
            e[0] = t.Math.radToDeg(c.getYawAngle());
            e[1] = t.Math.radToDeg(c.getPitchAngle());
            b = {
                id: hd(a.views),
                name: jd(b.trim() || "view", a.views),
                rotation: e
            };
            "fps" === d ? (b.mode = "fps",
            b.sky = WALK.EDITOR_CONTROLLED_SKY_NAME,
            b.position = f.toArray()) : "top" === d ? (b.mode = "orbit",
            b.sky = WALK.DEFAULT_SKY_NAME,
            b.panPrimary = !0,
            b.noPitchRotate = !0,
            b.rotation[1] = -90,
            b.minUpAngle = 0,
            b.maxUpAngle = Math.PI / 2,
            g.isEnabled() ? (b.target = [g.target.x, g.target.y, a.boundingBox.min.z],
            b.distance = g.getCameraDistance(),
            b.minDistance = g.getMinDistance(),
            b.maxDistance = g.getMaxDistance()) : (b.target = [f.x, f.y, a.boundingBox.min.z],
            b.distance = Math.max(f.z - a.boundingBox.min.z, 1))) : (b.mode = "orbit",
            b.sky = WALK.DEFAULT_SKY_NAME,
            b.panPrimary = !1,
            b.noPitchRotate = !1,
            g.isEnabled() ? (b.target = g.target.toArray(),
            b.distance = g.getCameraDistance(),
            b.minDistance = g.getMinDistance(),
            b.maxDistance = g.getMaxDistance(),
            b.minUpAngle = -g.getMaxPitchAngle(),
            b.maxUpAngle = -g.getMinPitchAngle(),
            b.noPan = g.getNoPan()) : (b.minUpAngle = 0,
            b.maxUpAngle = Math.PI / 2,
            d = a.boundingBox.center(),
            b.target = d.toArray(),
            d.sub(f),
            b.distance = d.length(),
            d.normalize(),
            b.rotation = [t.Math.radToDeg(Math.atan2(-d.x, d.y)), t.Math.radToDeg(Math.asin(d.z))],
            b.rotation[1] = t.Math.clamp(b.rotation[1], -b.maxUpAngle, b.minUpAngle)));
            f = new WALK.View(b);
            a.addView(f);
            return f
        }
        ;
        this.cloneView = function(b) {
            var c = [t.Math.radToDeg(b.rotation.yaw), t.Math.radToDeg(b.rotation.pitch)]
              , d = b.serialize();
            d.id = hd(a.views);
            d.name = jd(b.name.trim() || "view", a.views);
            d.rotation = c;
            "fps" === b.mode ? d.position = b.position.toArray() : d.target = b.target.toArray();
            var e = new WALK.View(d);
            a.addView(e);
            a.nodeConfigs.forEach(function(a) {
                a.hideInViews && a.isOnHideInViews(b.id) && a.addToHideInViews(e.id)
            });
            return e
        }
        ;
        this.resetViewFromCamera = function(a) {
            var b = c.cameraWorldPosition();
            "fps" === a.mode ? a.position.copy(b) : (a.target.copy(c.orbit.target),
            a.distance = b.distanceTo(a.target));
            "fps" !== a.mode && a.isTop() || (a.rotation.pitch = c.getPitchAngle());
            a.setYaw(c.getYawAngle())
        }
        ;
        this.removeView = function(b) {
            a.removeView(b)
        }
        ;
        this.shiftView = function(b, c) {
            a.shiftView(b, c)
        }
        ;
        this.activateSkyForView = function(a) {
            d.activateSky(a)
        }
        ;
        this.setCameraPosition = function(a, b, d) {
            c.cameraWorldPosition().set(a, b, d);
            c.cameraPositionUpdated()
        }
        ;
        this.isTeleporting = function() {
            return d.teleportingToView || d.teleportingToPoint
        }
        ;
        this.switchToView = function(a, b) {
            n.isRunning() && n.stop();
            d.switchToView(a, b);
            Dc()
        }
        ;
        this.renameView = function(b, c) {
            c = c.trim() || "view";
            b.name = "";
            b.setName(jd(c, a.views))
        }
        ;
        this.updateHiddenMeshes = function(a) {
            d.updateHiddenMeshes(a)
        }
        ;
        this.getSky = function() {
            return a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)
        }
        ;
        this.loadTexture = function(a, b) {
            a = r.load(WALK.LOAD_PRIORITY.CORE_RESOURCE, a, !0, !0, WALK.DEFAULT_ANISOTROPY);
            "baseColorTexture" === b && (a.isCutout = null);
            return a
        }
        ;
        this.materialTextureUpdated = function(b, c) {
            var d = new Set
              , e = "";
            b.textureNeedsUv0(c) && a.visitMeshesWithMaterial(b, function(a) {
                0 === a.geometry.vertexCnt || a.uv0InBuffers() || d.has(a.node.type) || (d.add(a.node.type),
                5 < d.size || ("" !== e && (e += ", "),
                e += "'" + a.node.type + "'"))
            });
            return 0 < d.size && "Texture " + c + " won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: " + e + (5 < d.size ? " (plus " + (d.size - 5) + " more)." : ".")
        }
        ;
        this.changeSkyTexture = function(b) {
            var c = a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);
            c.isEquirect ? u.loadSkyTexture(c, b) : (a.removeSkyMesh(c),
            u.loadSingleSky({
                name: WALK.EDITOR_CONTROLLED_SKY_NAME,
                type: "equirect",
                texture: b
            }, a, a.sharedMaterialState.fog));
            a.adjustSkiesAndCameraFarToSpanWholeScene()
        }
        ;
        this.removeSkyTexture = function() {
            var b = a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);
            b.isEquirect && (a.removeSkyMesh(b),
            u.loadSingleSky({
                name: WALK.EDITOR_CONTROLLED_SKY_NAME,
                type: "procedural"
            }, a, a.sharedMaterialState.fog));
            a.adjustSkiesAndCameraFarToSpanWholeScene()
        }
        ;
        this.getColorMapName = function() {
            return a.camera.colorMap ? a.camera.colorMap.name : null
        }
        ;
        this.loadColorMap = function(a) {
            a = r.load(WALK.LOAD_PRIORITY.CORE_RESOURCE, a, !1, !1, WALK.NO_ANISOTROPY);
            a.flipY = !1;
            return a
        }
        ;
        this.getSceneJson = function() {
            return a.serialize()
        }
        ;
        this.getCoverJson = function() {
            var a = b.cover;
            a.extensions = f.getConfig();
            return a
        }
        ;
        this.disableSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)
        }
        ;
        this.enableMaterialSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)
        }
        ;
        this.enableLightSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)
        }
        ;
        this.enableLightProbeSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)
        }
        ;
        this.enableExtensionSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)
        }
        ;
        this.enablePositionSelection = function(a) {
            e.setDistanceToObject(a);
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)
        }
        ;
        this.enableNodeSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)
        }
        ;
        this.enableCameraVolumeSelection = function() {
            e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)
        }
        ;
        this.selectMaterial = function(a) {
            e.selectMaterial(a)
        }
        ;
        this.replaceMaterial = function(b, c) {
            b = a.replaceMaterial(b, c);
            b.isAnimated && b.play();
            return b
        }
        ;
        this.selectLights = function(a, b) {
            e.selectLights(a, b)
        }
        ;
        this.selectLightInstances = function(a, b, c) {
            e.selectLightInstances(a, b, c)
        }
        ;
        this.selectLightProbe = function(a) {
            e.selectLightProbe(a, !1)
        }
        ;
        this.selectCameraVolume = function(a) {
            e.selectEditorCameraVolume(a)
        }
        ;
        this.selectExtension = function(a) {
            e.selectExtension(a, !1)
        }
        ;
        this.selectNodes = function(a, b, c, d, f) {
            e.selectNodes(a, b, c, d, f)
        }
        ;
        this.setMaterialClickedCallback = function(a) {
            e.setMaterialClickedCallback(a)
        }
        ;
        this.setLightInstanceClickedCallback = function(a) {
            e.setLightInstanceClickedCallback(a)
        }
        ;
        this.setLightProbeClickedCallback = function(a) {
            e.setLightProbeClickedCallback(a)
        }
        ;
        this.setNodeClickedCallback = function(a) {
            e.setNodeClickedCallback(a)
        }
        ;
        this.setExtensionClickedCallback = function(a) {
            e.setExtensionClickedCallback(a)
        }
        ;
        this.setPositionClickedCallback = function(a) {
            e.setPositionClickedCallback(a)
        }
        ;
        this.setItemModifiedCallback = function(a) {
            v.setItemModifiedCallback(a)
        }
        ;
        this.setViewSelectedCallback = function(a) {
            d.addEventListener("teleportStarted", function(b) {
                null !== b.view && a(b.view)
            })
        }
        ;
        this.coverModified = function(a) {
            b.updateCover(a)
        }
        ;
        this.autoTourModified = function() {
            b.refresh()
        }
        ;
        this.hasLightMap = function() {
            return a.hasLightMap()
        }
        ;
        this.getAutoTour = function() {
            return a.autoTour
        }
        ;
        this.getDisableProgressiveLoader = function() {
            return a.disableProgressiveLoader
        }
        ;
        this.setDisableProgressiveLoader = function(b) {
            a.disableProgressiveLoader = b
        }
        ;
        this.getInteractionPrompt = function() {
            return a.interactionPrompt
        }
        ;
        this.setInteractionPrompt = function(b) {
            a.interactionPrompt = b
        }
        ;
        this.getSceneScaleHtmlWarning = function() {
            var b = a.boundingBox;
            return !b.empty() && (b = b.size(),
            200 < b.x || 200 < b.y || 200 < b.z) ? "The scene has unusually large dimensions: <strong>" + Math.round(b.x) + "m x " + Math.round(b.y) + "m x " + Math.round(b.z) + 'm</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.' : null
        }
        ;
        this.getTransformMode = function() {
            return v.mode
        }
        ;
        this.setTransformMode = function(a) {
            v.setTransformMode(a)
        }
        ;
        this.getSupportedTransformModes = function() {
            return v.supportedModes
        }
        ;
        this.seeItem = function(a) {
            WALK.getViewer().seeItem(a)
        }
    }
    ;
    WALK.SceneLoadConfig = function() {
        this.onSceneLoaded = null;
        this.enableCollisions = !0;
        this.forcedInitialCameraRotation = this.forcedInitialCameraPosition = null;
        this.sendCoverToServer = !1
    }
    ;
    function kd() {
        var a = new t.BufferGeometry
          , b = new Float32Array(288);
        a.addAttribute("position", new t.BufferAttribute(b,3));
        var c = 0;
        [[[-1, -1, -1], [-1, -.6, -1], [-.6, -1, -1]], [[-1, -1, -1], [-1, -1, -.6], [-1, -.6, -1]], [[-1, -1, -1], [-.6, -1, -1], [-1, -1, -.6]], [[-.6, -1, -1], [-1, -.6, -1], [-1, -1, -.6]], [[-1, -1, 1], [-.6, -1, 1], [-1, -.6, 1]], [[-1, -1, 1], [-1, -.6, 1], [-1, -1, .6]], [[-1, -1, 1], [-1, -1, .6], [-.6, -1, 1]], [[-.6, -1, 1], [-1, -1, .6], [-1, -.6, 1]], [[1, -1, -1], [.6, -1, -1], [1, -.6, -1]], [[1, -1, -1], [1, -.6, -1], [1, -1, -.6]], [[1, -1, -1], [1, -1, -.6], [.6, -1, -1]], [[.6, -1, -1], [1, -1, -.6], [1, -.6, -1]], [[-1, 1, -1], [-.6, 1, -1], [-1, .6, -1]], [[-1, 1, -1], [-1, .6, -1], [-1, 1, -.6]], [[-1, 1, -1], [-1, 1, -.6], [-.6, 1, -1]], [[-.6, 1, -1], [-1, 1, -.6], [-1, .6, -1]], [[1, 1, 1], [.6, 1, 1], [1, .6, 1]], [[1, 1, 1], [1, .6, 1], [1, 1, .6]], [[1, 1, 1], [1, 1, .6], [.6, 1, 1]], [[.6, 1, 1], [1, 1, .6], [1, .6, 1]], [[1, -1, 1], [1, -.6, 1], [.6, -1, 1]], [[1, -1, 1], [1, -1, .6], [1, -.6, 1]], [[1, -1, 1], [.6, -1, 1], [1, -1, .6]], [[.6, -1, 1], [1, -.6, 1], [1, -1, .6]], [[1, 1, -1], [1, .6, -1], [.6, 1, -1]], [[1, 1, -1], [1, 1, -.6], [1, .6, -1]], [[1, 1, -1], [.6, 1, -1], [1, 1, -.6]], [[.6, 1, -1], [1, .6, -1], [1, 1, -.6]], [[-1, 1, 1], [-1, .6, 1], [-.6, 1, 1]], [[-1, 1, 1], [-1, 1, .6], [-1, .6, 1]], [[-1, 1, 1], [-.6, 1, 1], [-1, 1, .6]], [[-.6, 1, 1], [-1, .6, 1], [-1, 1, .6]]].forEach(function(a) {
            for (var d = 0; 3 > d; d += 1)
                for (var f = 0; 3 > f; f += 1)
                    b[c] = a[d][f],
                    c += 1
        });
        a.computeVertexNormals();
        a.convertNormalsToSpherical();
        return a
    }
    function ld() {
        var a = new WALK.StandardMaterial;
        a.disableLightProbe = !0;
        a.headLight = !0;
        a.baseColor = WALK.EDITOR_SELECTION_COLOR;
        a.setUniforms();
        return a
    }
    function md() {
        function a(a, b) {
            g.push([[a.x, a.y, a.z], [b.x, a.y, a.z], [a.x, b.y, a.z]]);
            g.push([[a.x, b.y, a.z], [b.x, a.y, a.z], [b.x, b.y, a.z]])
        }
        function b(a, b) {
            g.push([[a.x, a.y, a.z], [a.x, b.y, a.z], [a.x, a.y, b.z]]);
            g.push([[a.x, a.y, b.z], [a.x, b.y, a.z], [a.x, b.y, b.z]])
        }
        function c(a, b) {
            g.push([[a.x, a.y, a.z], [b.x, a.y, a.z], [a.x, a.y, b.z]]);
            g.push([[a.x, a.y, b.z], [b.x, a.y, a.z], [b.x, a.y, b.z]])
        }
        function d(d, e, f) {
            var g = Math.min(d.x, e.x)
              , h = Math.min(d.y, e.y)
              , l = Math.min(d.z, e.z)
              , m = Math.max(d.x, e.x)
              , n = Math.max(d.y, e.y);
            d = Math.max(d.z, e.z);
            "XY" !== f && (a({
                x: m,
                y: h,
                z: l
            }, {
                x: g,
                y: n,
                z: l
            }),
            a({
                x: g,
                y: h,
                z: d
            }, {
                x: m,
                y: n,
                z: d
            }));
            "YZ" !== f && (b({
                x: g,
                y: n,
                z: l
            }, {
                x: g,
                y: h,
                z: d
            }),
            b({
                x: m,
                y: h,
                z: l
            }, {
                x: m,
                y: n,
                z: d
            }));
            "XZ" !== f && (c({
                x: m,
                y: n,
                z: l
            }, {
                x: g,
                y: n,
                z: d
            }),
            c({
                x: g,
                y: h,
                z: l
            }, {
                x: m,
                y: h,
                z: d
            }))
        }
        var e = new t.BufferGeometry
          , f = new Float32Array(864);
        e.addAttribute("position", new t.BufferAttribute(f,3));
        var g = [];
        d({
            x: -.876,
            y: .876,
            z: .876
        }, {
            x: .876,
            y: .866,
            z: .866
        }, "YZ");
        d({
            x: -.876,
            y: .876,
            z: -.866
        }, {
            x: .876,
            y: .866,
            z: -.876
        }, "YZ");
        d({
            x: -.876,
            y: -.876,
            z: -.876
        }, {
            x: .876,
            y: -.866,
            z: -.866
        }, "YZ");
        d({
            x: -.876,
            y: -.876,
            z: .876
        }, {
            x: .876,
            y: -.866,
            z: .866
        }, "YZ");
        d({
            x: .876,
            y: .876,
            z: .876
        }, {
            x: .866,
            y: -.876,
            z: .866
        }, "XZ");
        d({
            x: .876,
            y: .876,
            z: -.876
        }, {
            x: .866,
            y: -.876,
            z: -.866
        }, "XZ");
        d({
            x: -.876,
            y: .876,
            z: -.876
        }, {
            x: -.866,
            y: -.876,
            z: -.866
        }, "XZ");
        d({
            x: -.876,
            y: .876,
            z: .876
        }, {
            x: -.866,
            y: -.876,
            z: .866
        }, "XZ");
        d({
            x: .876,
            y: .876,
            z: .876
        }, {
            x: .866,
            y: .866,
            z: -.876
        }, "XY");
        d({
            x: .876,
            y: -.876,
            z: .876
        }, {
            x: .866,
            y: -.866,
            z: -.876
        }, "XY");
        d({
            x: -.876,
            y: .876,
            z: .876
        }, {
            x: -.866,
            y: .866,
            z: -.876
        }, "XY");
        d({
            x: -.876,
            y: -.876,
            z: .876
        }, {
            x: -.866,
            y: -.866,
            z: -.876
        }, "XY");
        var h = 0;
        g.forEach(function(a) {
            for (var b = 0; 3 > b; b += 1)
                for (var c = 0; 3 > c; c += 1)
                    f[h] = a[b][c],
                    h += 1
        });
        e.computeVertexNormals();
        e.convertNormalsToSpherical();
        return e
    }
    WALK.LightControls = function(a, b) {
        function c(a) {
            if ("spot" === a.type) {
                var b = t.Math.degToRad(a.angle);
                a = 1 * Math.cos(b / 2);
                b = new t.CylinderBufferGeometry(0,1 * Math.sin(b / 2),a,32,1);
                u.makeTranslation(0, -a / 2, 0);
                r.makeRotationZ(Math.PI);
                v.multiplyMatrices(r, u);
                b.applyMatrix(v);
                b.convertNormalsToSpherical()
            } else
                b = "area" === a.type ? x : w;
            return b
        }
        function d(b, c, d) {
            var e = new WALK.LightMaterial(b);
            d = new t.Mesh(d,e);
            d.visibilityId = null;
            var f = new t.Mesh(y,A);
            d.add(f);
            var g = new t.Mesh(z,A);
            c === p.selectedLightInstance || p.subSelectedLightInstances.includes(c) || (g.visible = !1);
            d.add(g);
            if ("sun" !== b.type) {
                var h = c.rotation.toQuaternion().multiply(d.quaternion);
                d.setRotationFromQuaternion(h);
                d.position.copy(c.position);
                "area" === b.type ? (e.side = t.DoubleSide,
                d.scale.set(b.width, 1, b.height),
                e = Math.max(b.width, b.height) / 2,
                f.scale.set(e / b.width, e, e / b.height),
                g.scale.set(e / b.width, e, e / b.height)) : d.scale.set(b.size, b.size, b.size)
            } else
                b = a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,
                b = 1 * Math.PI * b * 1.5 / 360,
                WALK.sunRotationToPosition(a, c.rotation, d.position),
                d.scale.set(b, b, b);
            d.userData.lightInstance = c;
            d.updateMatrixWorld();
            p.lightInstanceMeshes.push(d);
            q && a.addAuxiliaryObject(d)
        }
        function e(a) {
            var b = c(a);
            a.forEachLightInstance(function(c) {
                d(a, c, b)
            })
        }
        function f(a) {
            for (var b = 0; b < p.lightInstanceMeshes.length; b += 1) {
                var c = p.lightInstanceMeshes[b];
                if (c.userData.lightInstance === a)
                    return c
            }
            return null
        }
        function g(b) {
            for (var c = [], d = 0; d < p.lightInstanceMeshes.length; d += 1) {
                var e = p.lightInstanceMeshes[d];
                e.userData.lightInstance.light === b ? (q && a.removeAuxiliaryObject(e),
                e.geometry !== w && e.geometry !== x && e.geometry.dispose(),
                e.material.dispose()) : c.push(e)
            }
            p.lightInstanceMeshes = c
        }
        function h(a) {
            a = a.target;
            g(a);
            e(a)
        }
        function l(a) {
            a = a.instance;
            var e = a.light;
            var g = e.instances[0] !== a ? f(e.instances[0]).geometry : c(e);
            d(e, a, g);
            b.requestFrame()
        }
        function m(a) {
            a = a.instance.light;
            g(a);
            e(a);
            b.requestFrame()
        }
        function n(a) {
            e(a);
            a.addEventListener("updated", h);
            a.addEventListener("instanceAdded", l);
            a.addEventListener("instanceRemoved", m)
        }
        var p = this
          , q = !1
          , r = new t.Matrix4
          , u = new t.Matrix4
          , v = new t.Matrix4
          , w = new t.SphereBufferGeometry(1,32,16);
        w.convertNormalsToSpherical();
        var x = new t.PlaneBufferGeometry(1,1);
        r.makeRotationX(-Math.PI / 2);
        x.applyMatrix(r);
        x.convertNormalsToSpherical();
        var y = kd()
          , z = md()
          , A = ld();
        this.selectedLightInstance = null;
        this.subSelectedLightInstances = [];
        this.lightInstanceMeshes = [];
        this.getLightInstanceMaterial = function(a) {
            return f(a).material
        }
        ;
        this.showLights = function() {
            if (!q) {
                q = !0;
                for (var b = 0; b < this.lightInstanceMeshes.length; b += 1)
                    a.addAuxiliaryObject(this.lightInstanceMeshes[b])
            }
        }
        ;
        this.showSelectionMesh = function(a, b) {
            this.lightInstanceMeshes.forEach(function(c) {
                c.children[0].visible = c.userData.lightInstance.light === a || b.includes(c.userData.lightInstance.light)
            })
        }
        ;
        this.showInstancesSelectionMesh = function(a, b) {
            this.selectedLightInstance = a;
            this.subSelectedLightInstances = b;
            this.lightInstanceMeshes.forEach(function(c) {
                c.children[1].visible = c.userData.lightInstance === a || b.includes(c.userData.lightInstance)
            })
        }
        ;
        this.hideLights = function() {
            if (q) {
                q = !1;
                for (var b = 0; b < this.lightInstanceMeshes.length; b += 1)
                    a.removeAuxiliaryObject(this.lightInstanceMeshes[b])
            }
        }
        ;
        a.lights.forEach(n);
        a.addEventListener("lightAdded", function(a) {
            n(a.light);
            b.requestFrame()
        });
        a.addEventListener("lightRemoved", function(a) {
            g(a.light);
            b.requestFrame()
        })
    }
    ;
    WALK.LightProbeControls = function(a, b) {
        function c(a, b) {
            b.position.addVectors(a.boxMin, a.boxMax).multiplyScalar(.5).sub(a.position);
            b.scale.subVectors(a.boxMax, a.boxMin);
            b.scale.subScalar(.005)
        }
        function d(b) {
            var d = new WALK.StandardMaterial;
            d.hideFromLightProbes = !0;
            d.disableLightProbe = !1;
            d.highlight = WALK.EDITOR_SELECTION_COLOR;
            d.metallic = 1;
            d.roughness = 0;
            d.setUniforms();
            d = new t.Mesh(q,d);
            d.visibilityId = null;
            d.lightProbe = b;
            d.position.copy(b.position);
            var e = new t.Mesh(u,r);
            e.visible = !1;
            d.add(e);
            b.isBoundingBoxEnabled() && c(b, e);
            d.updateMatrixWorld(!0);
            d.visible = n;
            m.lightProbeMeshes.push(d);
            a.addAuxiliaryObject(d)
        }
        function e(a) {
            for (var b = 0; b < m.lightProbeMeshes.length; b += 1)
                if (m.lightProbeMeshes[b].lightProbe === a)
                    return b;
            console.assert(!1);
            return null
        }
        function f(a) {
            a = a.target;
            var b = m.lightProbeMeshes[e(a)];
            b.position.copy(a.position);
            var d = b.children[0];
            a.isBoundingBoxEnabled() ? (c(a, d),
            d.visible = !0) : d.visible = !1;
            b.updateMatrixWorld()
        }
        function g(a) {
            a = a.lightProbe;
            d(a);
            a.addEventListener("positionUpdated", f);
            a.addEventListener("boundsUpdated", f)
        }
        function h(b) {
            b = e(b.lightProbe);
            var c = m.lightProbeMeshes[b];
            a.removeAuxiliaryObject(c);
            c.material.dispose();
            m.lightProbeMeshes.splice(b, 1)
        }
        function l(a) {
            for (var b = 0; b < m.lightProbeMeshes.length; b += 1) {
                var c = m.lightProbeMeshes[b];
                if (c.lightProbe === a)
                    return c
            }
            return null
        }
        var m = this
          , n = !1
          , p = null;
        this.lightProbeMeshes = [];
        var q = new t.SphereBufferGeometry(.2,32,16);
        q.convertNormalsToSpherical();
        var r = WALK.createBoundingBoxMaterial()
          , u = new t.BoxBufferGeometry(1,1,1);
        u.addTriangleOrderAttribute();
        u.convertNormalsToSpherical();
        this.getLightProbeMaterial = function(a) {
            return (a = l(a)) ? a.material : null
        }
        ;
        this.showLightProbeBoundingBox = function(a) {
            p && (p.visible = !1,
            p = null);
            a.isBoundingBoxEnabled() && (p = l(a).children[0],
            p.visible = !0)
        }
        ;
        this.showLightProbes = function() {
            if (!n) {
                n = !0;
                for (var a = 0; a < this.lightProbeMeshes.length; a += 1)
                    this.lightProbeMeshes[a].visible = !0
            }
            b.requestFrame()
        }
        ;
        this.hideLightProbes = function() {
            if (n) {
                n = !1;
                for (var a = 0; a < this.lightProbeMeshes.length; a += 1)
                    this.lightProbeMeshes[a].visible = !1
            }
            b.requestFrame()
        }
        ;
        (function() {
            for (var b = 0; b < a.lightProbes.length; b += 1) {
                var c = a.lightProbes[b];
                d(c);
                c.addEventListener("positionUpdated", f);
                c.addEventListener("boundsUpdated", f)
            }
            a.addEventListener("lightProbeAdded", g);
            a.addEventListener("lightProbeRemoved", h)
        }
        )()
    }
    ;
    WALK.CameraVolumeControls = function(a, b) {
        function c() {}
        function d(a) {
            function b() {
                d.position.copy(a.position);
                d.rotation.copy(a.rotation);
                d.scale.copy(a.scale);
                d.updateMatrixWorld()
            }
            var c = WALK.createBoundingBoxMaterial()
              , d = new t.Mesh(a.getVolumeGeometry(),c);
            d.visible = !1;
            d.visibilityId = null;
            f.add(d);
            e.set(a, d);
            b(a);
            a.addEventListener("updated", b)
        }
        var e = new Map
          , f = new t.Object3D;
        f.visible = !1;
        a.addAuxiliaryObject(f);
        this.setHighlightedCameraVolume = function(a) {
            c();
            var b = e.get(a);
            b.visible = !0;
            c = function() {
                return b.visible = !1
            }
            ;
            return b.material
        }
        ;
        this.setControlsVisible = function(a) {
            f.visible = a;
            b.requestFrame()
        }
        ;
        a.addEventListener("cameraVolumeAdded", function(a) {
            d(a.cameraVolume);
            b.requestFrame()
        });
        a.addEventListener("cameraVolumeRemoved", function(a) {
            a = a.cameraVolume;
            var c = e.get(a);
            f.remove(c);
            c.material.dispose();
            e.delete(a);
            b.requestFrame()
        });
        for (var g = 0; g < a.cameraVolumes.length; g += 1)
            d(a.cameraVolumes[g])
    }
    ;
    /*
 Copyright (C) 2019-present Shapespark
*/
    WALK.sunRotationToPosition = function(a, b, c) {
        a = a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);
        c.set(0, -a.radius, 0);
        c.applyEuler(b);
        c.add(a.position)
    }
    ;
    WALK.computeNodeBoundingSphere = function(a, b) {
        b.radius = 0;
        a.visitSubtree(function(a) {
            a.mesh && WALK.Math.spheresUnion(a.mesh.geometry.boundingSphere, b)
        })
    }
    ;
    var nd = {
        MAIN: 0,
        AUXILIARY: 1,
        SECONDARY: 2,
        NONE: -1
    }
      , rd = {
        SHIFT: 1,
        CTRL_EQUIVALENT: 2,
        ALT_EQUIVALENT: 4
    };
    WALK.hasShiftKeyModifier = function(a) {
        return a & rd.SHIFT
    }
    ;
    WALK.hasCtrlEquivalentKeyModifier = function(a) {
        return a & rd.CTRL_EQUIVALENT
    }
    ;
    WALK.hasAltEquivalentModifier = function(a) {
        return a & rd.ALT_EQUIVALENT
    }
    ;
    function sd(a, b) {
        function c(a) {
            if (void 0 === a.button)
                return nd.MAIN;
            switch (a.button) {
            case 0:
                return nd.MAIN;
            case 1:
                return nd.AUXILIARY;
            case 2:
                return nd.SECONDARY
            }
            return nd.NONE
        }
        function d(a, b, c) {
            if (!c)
                for (c = 0; c < a.changedTouches.length; c++) {
                    var d = a.changedTouches[c];
                    if (d.identifier === b)
                        return d
                }
            for (c = 0; c < a.touches.length; c++)
                if (d = a.touches[c],
                d.identifier === b)
                    return d;
            return null
        }
        function e(a, b) {
            if (0 !== a.length) {
                var c = void 0 !== b.touches;
                if (!c && (document.pointerLockElement || document.mozPointerLockElement || document.webkitPointerLockElement))
                    u.clipX = 0,
                    u.clipY = 0;
                else {
                    if (c) {
                        var e = d(b, r);
                        console.assert(null !== e);
                        c = e.clientX;
                        e = e.clientY
                    } else
                        c = b.clientX,
                        e = b.clientY;
                    u.clipX = c / window.innerWidth * 2 - 1;
                    u.clipY = 2 * -(e / window.innerHeight) + 1
                }
                c = u;
                for (e = 0; e < a.length; e++) {
                    var f = a[e].callback
                      , g = c.clipX
                      , h = c.clipY
                      , l = 0;
                    if (b.ctrlKey && !WALK.DETECTOR.mac || b.metaKey && WALK.DETECTOR.mac)
                        l |= rd.CTRL_EQUIVALENT;
                    b.altKey && (l |= rd.ALT_EQUIVALENT);
                    b.shiftKey && (l |= rd.SHIFT);
                    if (f(g, h, l))
                        break
                }
            }
        }
        function f(a) {
            c(a) !== nd.MAIN || q || (q = !0,
            void 0 !== a.touches && (console.assert(0 < a.changedTouches.length),
            r = a.changedTouches[0].identifier),
            e(m, a))
        }
        function g(a) {
            if (c(a) === nd.MAIN) {
                var b = void 0 !== a.touches;
                b && d(a, r, !0) || !q || (q = !1,
                e(n, a),
                b && (r = -1))
            }
        }
        function h(a) {
            void 0 !== a.touches && -1 === r || e(p, a)
        }
        function l(a, b, c) {
            var d = a.filter(function(a) {
                return a.callback === b
            });
            console.assert(0 === d.length, "Do not add the same callback twice!");
            c = {
                callback: b,
                priority: c
            };
            for (d = d = 0; d < a.length; d += 1) {
                var e = a[d];
                if (c.priority <= e.priority) {
                    if (c.priority === e.priority) {
                        console.error("Adding two listeners with the same priority is not allowed!");
                        return
                    }
                    break
                }
            }
            a.splice(d, 0, c)
        }
        var m = []
          , n = []
          , p = []
          , q = !1
          , r = -1
          , u = {
            clipX: 0,
            clipY: 0
        };
        this.addPointerDownListener = function(a, b) {
            l(m, a, b)
        }
        ;
        this.removePointerDownListener = function(a) {
            m = m.filter(function(b) {
                return b.callback !== a
            })
        }
        ;
        this.addPointerUpListener = function(a, b) {
            l(n, a, b)
        }
        ;
        this.removePointerUpListener = function(a) {
            n = n.filter(function(b) {
                return b.callback !== a
            })
        }
        ;
        this.addPointerMoveListener = function(a, b) {
            l(p, a, b)
        }
        ;
        this.removePointerMoveListener = function(a) {
            p = p.filter(function(b) {
                return b.callback !== a
            })
        }
        ;
        var v = !1;
        this.isEnabled = function() {
            return v
        }
        ;
        this.enable = function() {
            v || (a.addEventListener("mousedown", f, !1),
            a.addEventListener("touchstart", f, !1),
            a.addEventListener("mouseup", g, !1),
            a.addEventListener("touchend", g, !1),
            a.addEventListener("mousemove", h, !1),
            a.addEventListener("touchmove", h, !1),
            window.addEventListener("mouseup", g, !1),
            b && window.top.addEventListener("mouseup", g, !1),
            v = !0)
        }
        ;
        this.disable = function() {
            v && (a.removeEventListener("mousedown", f, !1),
            a.removeEventListener("touchstart", f, !1),
            a.removeEventListener("mouseup", g, !1),
            a.removeEventListener("touchend", g, !1),
            a.removeEventListener("mousemove", h, !1),
            a.removeEventListener("touchmove", h, !1),
            window.removeEventListener("mouseup", g, !1),
            b && window.top.removeEventListener("mouseup", g, !1),
            v = !1)
        }
        ;
        this.enable()
    }
    ;WALK.TRANSFORM_MODE = {
        TRANSLATE: 0,
        ROTATE: 1,
        SCALE: 2
    };
    var td = new t.Color(16777215)
      , ud = new t.Color(16711680)
      , vd = new t.Color(65280)
      , wd = new t.Color(255)
      , X = {
        NONE: 0,
        X: 1,
        Y: 2,
        Z: 4,
        ALL: 7
    }
      , xd = new t.Vector3(0,0,1)
      , yd = new t.Vector3(1,0,0)
      , zd = new t.Vector3(0,1,0);
    function Ad(a) {
        var b = new t.Box3;
        a instanceof t.Object3D && a.traverse(function(a) {
            a instanceof t.Mesh && (a.geometry.boundingBox || a.geometry.computeBoundingBox(),
            b.union(a.geometry.boundingBox))
        });
        return b
    }
    function Bd(a, b) {
        var c = Ad(a);
        a = c.size();
        a = new t.BoxBufferGeometry(a.x,a.y,a.z);
        c = c.center();
        var d = new t.Matrix4;
        d.makeTranslation(c.x, c.y, c.z);
        a.applyMatrix(d);
        a.computeBoundingBox();
        b = new t.Mesh(a,b);
        b.visible = !1;
        b.visibilityId = null;
        return b
    }
    function Cd(a, b) {
        var c = new WALK.StandardMaterial;
        c.hideFromLightProbes = !0;
        c.baseColor.copy(a);
        c.opacity = b;
        c.specularOff = 1;
        c.depthTest = !1;
        c.depthWrite = !1;
        return c
    }
    function Dd(a, b, c) {
        t.Object3D.call(this);
        this.add(a);
        this.add(b);
        this.material = c;
        this.collider = b;
        this.defaultOpacity = c.opacity;
        this.hoveredOpacity = .99;
        this.notUsedOpacity = .3;
        this.usedAxes = X.NONE
    }
    Dd.prototype = Object.create(t.Object3D.prototype);
    Dd.prototype.constructor = Dd;
    function Ed(a) {
        for (var b = [], c = 0; c < arguments.length; ++c)
            b[c - 0] = arguments[c];
        console.assert(0 < b.length, "Part must have at least one element!");
        var d = new t.Object3D;
        b.forEach(function(a) {
            return d.add(a)
        });
        b = Bd(d, Cd(td, .6));
        return new Dd(d,b,d.children[0].material)
    }
    function Fd() {
        function a(a) {
            a = Cd(a, .6);
            a.depthTest = !0;
            return new t.Mesh(b,a)
        }
        t.Object3D.call(this);
        var b = new t.CylinderBufferGeometry(.005,.005,1E3,4,1,!1)
          , c = a(ud);
        c.rotation.set(0, 0, Math.PI / 2);
        var d = a(vd)
          , e = a(wd);
        e.rotation.set(Math.PI / 2, 0, 0);
        this.add(c);
        this.add(d);
        this.add(e);
        var f = [!1, !1, !1];
        this.show = function(a) {
            f[0] = (X.X & a) === X.X;
            f[1] = (X.Y & a) === X.Y;
            f[2] = (X.Z & a) === X.Z;
            c.visible = f[0];
            d.visible = f[1];
            e.visible = f[2]
        }
        ;
        var g = new t.Vector3;
        this.update = function(a) {
            g.copy(a);
            g.sub(this.position);
            g.normalize();
            c.visible = f[0] && .998 > Math.abs(yd.dot(g));
            d.visible = f[1] && .998 > Math.abs(zd.dot(g));
            e.visible = f[2] && .998 > Math.abs(xd.dot(g))
        }
    }
    Fd.prototype = Object.create(t.Object3D.prototype);
    Fd.prototype.constructor = Fd;
    function Gd() {
        function a() {
            var a = Cd(td, .99);
            return new t.Mesh(b,a)
        }
        t.Object3D.call(this);
        var b = new t.SphereBufferGeometry(.012,10,10)
          , c = a()
          , d = a()
          , e = a();
        this.add(c);
        this.add(d);
        this.add(e);
        this.show = function(a) {
            c.visible = (X.X & a) === X.X;
            d.visible = (X.Y & a) === X.Y;
            e.visible = (X.Z & a) === X.Z
        }
        ;
        this.update = function(a) {
            c.position.set(a.x, 0, 0);
            c.updateMatrixWorld();
            d.position.set(0, a.y, 0);
            d.updateMatrixWorld();
            e.position.set(0, 0, a.z);
            e.updateMatrixWorld()
        }
    }
    Gd.prototype = Object.create(t.Object3D.prototype);
    Gd.prototype.constructor = Gd;
    function Hd() {
        function a(a) {
            a = Cd(a, .2);
            a.depthTest = !0;
            a.side = t.DoubleSide;
            return Ed(new t.Mesh(b,a))
        }
        t.Object3D.call(this);
        var b = new t.PlaneBufferGeometry(1E3,1E3,1,1)
          , c = a(td);
        this.add(c);
        var d = new t.Object3D;
        this.add(d);
        var e = a(wd);
        e.rotation.set(0, 0, 0);
        var f = a(vd);
        f.rotation.set(Math.PI / 2, 0, 0);
        var g = a(ud);
        g.rotation.set(0, Math.PI / 2, 0);
        d.add(e);
        d.add(f);
        d.add(g);
        this.setLocalRotation = function(a) {
            a ? d.rotation.copy(a) : d.rotation.set(0, 0, 0)
        }
        ;
        this.update = function(a) {
            c.rotation.setFromRotationMatrix(a.matrixWorld);
            c.updateMatrixWorld()
        }
        ;
        this.cameraPlane = c;
        this.findPlaneIntersectionPoint = function() {
            function a(a) {
                switch (a) {
                case X.X:
                    return g;
                case X.Y:
                    return f;
                case X.Z:
                    return e;
                case X.X | X.Y:
                    return e;
                case X.X | X.Z:
                    return f;
                case X.Y | X.Z:
                    return g;
                case X.ALL:
                    return c;
                default:
                    throw "Impossible";
                }
            }
            var b = new t.Vector3
              , d = new t.Vector3;
            return function(c, e, f, g) {
                var h = a(c);
                h.getWorldPosition(b).sub(e);
                h.getWorldDirection(d);
                if (c === X.X || c === X.Y || c === X.Z) {
                    c = d.dot(d);
                    h = d.dot(f);
                    var l = f.dot(f)
                      , m = d.dot(b)
                      , r = f.dot(b);
                    l = c * l - h * h;
                    c = 1E-5 > Math.abs(l) ? Infinity : (c * r - h * m) / l
                } else
                    c = d.dot(f),
                    c = 1E-5 > Math.abs(c) ? Infinity : d.dot(b) / c;
                if (Infinity === c)
                    return !1;
                g.copy(f).multiplyScalar(c).add(e);
                return !0
            }
        }();
        this.show = function(a) {
            c.visible = a === X.ALL ? !0 : !1;
            e.visible = (X.X | X.Y) === a;
            f.visible = (X.X | X.Z) === a;
            g.visible = (X.Y | X.Z) === a
        }
    }
    Hd.prototype = Object.create(t.Object3D.prototype);
    Hd.prototype.constructor = Hd;
    function Id(a, b, c) {
        var d = a.material;
        d.opacity = b === a.collider ? a.hoveredOpacity : c && null !== b ? a.notUsedOpacity : a.defaultOpacity;
        d.setUniforms()
    }
    function Jd() {
        function a(a) {
            for (var b = new Uint8Array(4096), c = Math.floor(255 * a.r), e = Math.floor(255 * a.g), f = Math.floor(255 * a.b), g = 0, h = 0; 32 > h; h++)
                for (var l = 0; 32 > l; l++)
                    b[g] = c,
                    b[g + 1] = e,
                    b[g + 2] = f,
                    b[g + 3] = 0 === h || 0 === l || 31 === h || 31 === l ? 220 : 150,
                    g += 4;
            b = new qb(b,32,32,t.RGBAFormat);
            b.hasAlpha = !0;
            b.needsUpdate = !0;
            b.loaded = !0;
            c = new WALK.StandardMaterial;
            c.hideFromLightProbes = !0;
            c.specularOff = 1;
            c.disableLightProbe = !0;
            c.depthTest = !1;
            c.depthWrite = !1;
            c.transparent = !0;
            c.baseColor = a;
            c.side = t.DoubleSide;
            c.baseColorTexture = b;
            c.opacity = .6;
            c.configureTransparency();
            c.setUniforms();
            return Ed(new t.Mesh(d.squareGeometry,c))
        }
        function b(a) {
            a = Cd(a, .6);
            return Ed(new t.Mesh(d.lineGeometry,a), new t.Mesh(d.arrowHeadGeometry,a))
        }
        var c = this;
        t.Object3D.call(this);
        var d = function() {
            var a = new t.Matrix4
              , b = new t.SphereBufferGeometry(.1,16,16)
              , c = new t.PlaneBufferGeometry(.23,.23,1,1);
            a.makeTranslation(.45, .45, 0);
            c.applyMatrix(a);
            c.addTriangleOrderAttribute();
            var d = new t.CylinderBufferGeometry(.015,.015,1,4,1,!1);
            a.makeTranslation(0, .65, 0);
            d.applyMatrix(a);
            var e = new t.CylinderBufferGeometry(0,.05,.2,10,1,!1);
            a.makeTranslation(0, 1.25, 0);
            e.applyMatrix(a);
            return {
                pickerGeometry: b,
                squareGeometry: c,
                lineGeometry: d,
                arrowHeadGeometry: e
            }
        }()
          , e = function() {
            var a = Cd(td, .6);
            return Ed(new t.Mesh(d.pickerGeometry,a))
        }()
          , f = b(ud);
        f.rotation.set(0, 0, -Math.PI / 2);
        var g = b(vd)
          , h = b(wd);
        h.rotation.set(Math.PI / 2, 0, 0);
        var l = a(wd)
          , m = a(vd);
        m.rotation.set(Math.PI / 2, 0, 0);
        var n = a(ud);
        n.rotation.set(0, -Math.PI / 2, 0);
        e.usedAxes = X.ALL;
        f.usedAxes = X.X;
        g.usedAxes = X.Y;
        h.usedAxes = X.Z;
        l.usedAxes = X.X | X.Y;
        m.usedAxes = X.X | X.Z;
        n.usedAxes = X.Y | X.Z;
        var p = [e, f, g, h, l, m, n];
        p.forEach(function(a) {
            return c.add(a)
        });
        var q = new Map(p.map(function(a) {
            return [a.collider, a]
        }));
        this.colliders = [].concat(k.arrayFromIterable(q.keys()));
        this.highlight = function(a, b) {
            p.forEach(function(c) {
                return Id(c, a, b)
            })
        }
        ;
        this.usedAxes = function(a) {
            return q.get(a).usedAxes
        }
    }
    Jd.prototype = Object.create(t.Object3D.prototype);
    Jd.prototype.constructor = Jd;
    function Kd() {
        function a(a) {
            var b = new t.TorusBufferGeometry(a,.012,6,64);
            a = new t.TorusBufferGeometry(a,.038,6,64);
            return {
                torusGeometry: b,
                colliderGeometry: a
            }
        }
        function b(a, b) {
            a = new WALK.RotateGizmoMaterial(a,.6);
            var c = new t.Object3D;
            c.add(new t.Mesh(b.torusGeometry,a));
            b = new t.Mesh(b.colliderGeometry,a);
            b.visible = !1;
            b.visibilityId = null;
            return new Dd(c,b,a)
        }
        var c = this;
        t.Object3D.call(this);
        var d = a(.9)
          , e = b(ud, d);
        e.rotation.set(0, Math.PI / 2, 0);
        var f = b(vd, d);
        f.rotation.set(Math.PI / 2, 0, 0);
        d = b(wd, d);
        var g = a(1.12)
          , h = b(td, g)
          , l = function(a, b) {
            a = Cd(a, 0);
            var c = new t.SphereBufferGeometry(b,32,32);
            b = new t.Object3D;
            b.add(new t.Mesh(c,a));
            c = new t.Mesh(c,a);
            c.visible = !1;
            c.visibilityId = null;
            a = new Dd(b,c,a);
            a.defaultOpacity = 0;
            a.hoveredOpacity = .2;
            a.notUsedOpacity = 0;
            return a
        }(td, .848)
          , m = [e, f, d, h, l];
        m.forEach(function(a) {
            return c.add(a)
        });
        var n = new Map(m.map(function(a) {
            return [a.collider, a]
        }));
        this.colliders = [].concat(k.arrayFromIterable(n.keys()));
        this.update = function(a) {
            var b = this;
            m.filter(function(a) {
                return a !== l
            }).forEach(function(a) {
                a = a.material;
                a.gizmoPosition.copy(b.position);
                a.sphereRadius = .86 * b.scale.x
            });
            h.rotation.setFromRotationMatrix(a.matrixWorld);
            h.updateMatrixWorld()
        }
        ;
        e.usedAxes = X.X;
        f.usedAxes = X.Y;
        d.usedAxes = X.Z;
        h.usedAxes = X.ALL;
        l.usedAxes = X.NONE;
        this.highlight = function(a, b) {
            m.forEach(function(c) {
                return Id(c, a, b)
            })
        }
        ;
        this.usedAxes = function(a) {
            return n.get(a).usedAxes
        }
    }
    Kd.prototype = Object.create(t.Object3D.prototype);
    Kd.prototype.constructor = Kd;
    function Ld() {
        function a(a) {
            for (var b = new Uint8Array(4096), c = Math.floor(255 * a.r), e = Math.floor(255 * a.g), f = Math.floor(255 * a.b), g = 0, h = 0; 32 > h; h++)
                for (var l = 0; 32 > l; l++)
                    b[g] = c,
                    b[g + 1] = e,
                    b[g + 2] = f,
                    b[g + 3] = 0 === h || 0 === l || 31 === h || 31 === l ? 220 : 150,
                    g += 4;
            b = new qb(b,32,32,t.RGBAFormat);
            b.hasAlpha = !0;
            b.needsUpdate = !0;
            b.loaded = !0;
            c = new WALK.StandardMaterial;
            c.hideFromLightProbes = !0;
            c.specularOff = 1;
            c.disableLightProbe = !0;
            c.depthTest = !1;
            c.depthWrite = !1;
            c.transparent = !0;
            c.baseColor = a;
            c.side = t.DoubleSide;
            c.baseColorTexture = b;
            c.opacity = .6;
            c.configureTransparency();
            c.setUniforms();
            return Ed(new t.Mesh(d.squareGeometry,c))
        }
        function b(a) {
            a = Cd(a, .6);
            return Ed(new t.Mesh(d.lineGeometry,a), new t.Mesh(d.cubeGeometry,a))
        }
        var c = this;
        t.Object3D.call(this);
        var d = function() {
            var a = new t.Matrix4
              , b = new t.BoxBufferGeometry(.3,.3,.3)
              , c = new t.PlaneBufferGeometry(.23,.23,1,1);
            a.makeTranslation(.45, .45, 0);
            c.applyMatrix(a);
            c.addTriangleOrderAttribute();
            var d = new t.CylinderBufferGeometry(.015,.015,1,4,1,!1);
            a.makeTranslation(0, .65, 0);
            d.applyMatrix(a);
            var e = new t.BoxBufferGeometry(.1,.1,.1);
            a.makeTranslation(0, 1.1, 0);
            e.applyMatrix(a);
            return {
                pickerGeometry: b,
                squareGeometry: c,
                lineGeometry: d,
                cubeGeometry: e
            }
        }()
          , e = function() {
            var a = Cd(td, .6);
            return Ed(new t.Mesh(d.pickerGeometry,a))
        }()
          , f = b(ud);
        f.rotation.set(0, 0, -Math.PI / 2);
        var g = b(vd)
          , h = b(wd);
        h.rotation.set(Math.PI / 2, 0, 0);
        var l = a(wd)
          , m = a(vd);
        m.rotation.set(Math.PI / 2, 0, 0);
        var n = a(ud);
        n.rotation.set(0, -Math.PI / 2, 0);
        e.usedAxes = X.ALL;
        f.usedAxes = X.X;
        g.usedAxes = X.Y;
        h.usedAxes = X.Z;
        l.usedAxes = X.X | X.Y;
        m.usedAxes = X.X | X.Z;
        n.usedAxes = X.Y | X.Z;
        var p = [e, f, g, h, l, m, n];
        p.forEach(function(a) {
            return c.add(a)
        });
        var q = new Map(p.map(function(a) {
            return [a.collider, a]
        }));
        this.colliders = [].concat(k.arrayFromIterable(q.keys()));
        this.highlight = function(a, b) {
            p.forEach(function(c) {
                return Id(c, a, b)
            })
        }
        ;
        this.usedAxes = function(a) {
            return q.get(a).usedAxes
        }
    }
    Ld.prototype = Object.create(t.Object3D.prototype);
    Ld.prototype.constructor = Ld;
    WALK.TransformGizmo = function(a, b, c, d) {
        function e(a) {
            h.oldPosition.copy(a);
            h.newPosition.copy(a);
            l.position.copy(a);
            m.position.copy(a);
            n.position.copy(a);
            p.position.copy(a);
            q.position.copy(a);
            r.position.copy(a)
        }
        function f(a) {
            h.oldRotation.copy(a);
            h.newRotation.copy(a);
            y === WALK.TRANSFORM_MODE.SCALE ? (l.rotation.copy(a),
            m.setLocalRotation(a),
            r.rotation.copy(h.oldRotation)) : (l.rotation.set(0, 0, 0),
            m.setLocalRotation(null))
        }
        function g() {
            z ? y === WALK.TRANSFORM_MODE.TRANSLATE ? (a.addAuxiliaryObject(l),
            a.addAuxiliaryObject(m),
            a.addAuxiliaryObject(n),
            a.addAuxiliaryObject(p),
            a.removeAuxiliaryObject(q),
            a.removeAuxiliaryObject(r)) : y === WALK.TRANSFORM_MODE.ROTATE ? (a.addAuxiliaryObject(l),
            a.removeAuxiliaryObject(p),
            a.addAuxiliaryObject(q),
            a.removeAuxiliaryObject(r)) : (a.addAuxiliaryObject(l),
            a.addAuxiliaryObject(m),
            a.removeAuxiliaryObject(p),
            a.removeAuxiliaryObject(q),
            a.addAuxiliaryObject(r)) : (a.removeAuxiliaryObject(l),
            a.removeAuxiliaryObject(m),
            a.removeAuxiliaryObject(n),
            a.removeAuxiliaryObject(p),
            a.removeAuxiliaryObject(q),
            a.removeAuxiliaryObject(r))
        }
        var h = this;
        this.subTargetsInfo = this.target = null;
        var l = new Fd;
        l.show(X.ALL);
        var m = new Hd;
        m.show(X.NONE);
        var n = new Gd;
        n.show(X.NONE);
        var p = new Jd
          , q = new Kd
          , r = new Ld
          , u = !1;
        Object.defineProperty(this, "transforming", {
            get: function() {
                return u
            }
        });
        var v = new t.Vector3(0,0,0)
          , w = 0
          , x = new t.Vector3;
        this.oldPosition = new t.Vector3(0,0,0);
        this.newPosition = new t.Vector3(0,0,0);
        this.oldRotation = new t.Euler(0,0,0);
        this.newRotation = new t.Euler(0,0,0);
        this.oldScale = new t.Vector3(1,1,1);
        this.newScale = new t.Vector3(1,1,1);
        Object.defineProperty(this, "position", {
            get: function() {
                return l.position
            }
        });
        Object.defineProperty(this, "rotation", {
            get: function() {
                return h.oldRotation
            }
        });
        var y = !1;
        Object.defineProperty(this, "scale", {
            get: function() {
                return h.oldScale
            }
        });
        var z = !1;
        Object.defineProperty(this, "mode", {
            get: function() {
                return y
            },
            set: function(a) {
                y !== a && (y = a,
                g(),
                d.requestFrame())
            }
        });
        Object.defineProperty(this, "visible", {
            get: function() {
                return z
            },
            set: function(a) {
                z !== a && (z = a,
                g())
            }
        });
        this.mode = WALK.TRANSFORM_MODE.TRANSLATE;
        var A = Infinity
          , B = Infinity
          , H = new t.Vector3(0,0,0)
          , C = null
          , L = !1
          , G = X.ALL
          , I = function() {
            var b = new t.Vector3
              , d = new t.Vector3
              , e = new t.Quaternion;
            return function(f, g, h) {
                b.set(g, h, 1).unproject(a.camera);
                b.sub(c).normalize();
                if (!m.findPlaneIntersectionPoint(f, c, b, d))
                    return null;
                d.sub(l.position);
                d.applyQuaternion(e.setFromEuler(l.rotation).inverse());
                f & X.X || (d.x = 0);
                f & X.Y || (d.y = 0);
                f & X.Z || (d.z = 0);
                return d
            }
        }()
          , M = function() {
            var a = new t.Vector3
              , b = new t.Vector3
              , c = new t.Vector3;
            return function(d, e) {
                var f = m.cameraPlane;
                a.set(0, 0, -1);
                a.transformDirection(f.matrixWorld);
                b.set(-1, 0, 0);
                b.transformDirection(f.matrixWorld);
                d = I(X.ALL, d, e).normalize();
                c.copy(b).cross(d);
                return Math.sign(a.dot(c)) * Math.acos(b.dot(d))
            }
        }()
          , O = new t.Vector3;
        this.rotationSpeed = 5;
        var K = function() {
            var a = new t.Vector2(0,0)
              , b = new t.Quaternion
              , c = new t.Euler
              , d = new t.Quaternion
              , e = new t.Quaternion
              , f = new t.Vector3
              , g = new t.Vector3
              , l = new t.Vector3;
            return function(n, r) {
                b.setFromEuler(h.oldRotation);
                b.normalize();
                a.set(A - n, B - r);
                a.multiplyScalar(h.rotationSpeed);
                if (G === X.NONE)
                    return n = m.cameraPlane,
                    f.copy(yd),
                    f.transformDirection(n.matrixWorld),
                    g.set(0, 1, 0),
                    g.transformDirection(n.matrixWorld),
                    e.setFromAxisAngle(f, a.y),
                    d.setFromAxisAngle(g, -a.x),
                    d.multiply(e),
                    d.multiply(b),
                    d.normalize(),
                    c.setFromQuaternion(d, "ZXY"),
                    c;
                if (G === X.ALL) {
                    var p = m.cameraPlane;
                    l.set(0, 0, -1);
                    l.transformDirection(p.matrixWorld);
                    p = l;
                    n = M(n, r);
                    n -= w
                } else {
                    G !== X.Z && a.multiplyScalar((G === X.X ? -1 : 1) * Math.sign((G === X.X ? zd : yd).dot(O)));
                    a: {
                        switch (G) {
                        case X.X:
                            p = yd;
                            break a;
                        case X.Y:
                            p = zd;
                            break a;
                        case X.Z:
                            p = xd;
                            break a
                        }
                        console.error("Unable to get direction for this value!");
                        p = void 0
                    }
                    n = G === X.Z ? -a.x : a.y
                }
                d.setFromAxisAngle(p, n);
                d.multiply(b);
                d.normalize();
                c.setFromQuaternion(d, "ZXY");
                return c
            }
        }()
          , F = function() {
            var a = {
                hoveredCollider: null,
                hasAnythingChanged: !1
            };
            return function(c, d, e) {
                var f = y === WALK.TRANSFORM_MODE.TRANSLATE ? p : y === WALK.TRANSFORM_MODE.ROTATE ? q : r;
                c = b.findMeshFromListAtPosition(f.colliders, c, d, !0);
                d = !1;
                if (c !== C || L !== e)
                    C = c,
                    f.highlight(c, e),
                    d = !0;
                a.hoveredCollider = c;
                a.hasAnythingChanged = d;
                return a
            }
        }();
        this.onCanvasPointerMove = function(a, b) {
            if (this.transforming) {
                if (this.mode === WALK.TRANSFORM_MODE.TRANSLATE) {
                    var c = I(G, a, b);
                    c && this.newPosition.copy(c.sub(v).add(l.position));
                    H.copy(this.newPosition);
                    H.sub(l.position);
                    H.divide(l.scale);
                    n.update(H);
                    if (a !== A || b !== B)
                        p.visible = !1,
                        n.show(G),
                        l.show(G)
                } else if (this.mode === WALK.TRANSFORM_MODE.ROTATE) {
                    if (l.show(G),
                    this.newRotation.copy(K(a, b)),
                    a !== A || b !== B)
                        q.visible = !1
                } else {
                    l.show(G);
                    if (c = I(G, a, b))
                        c.addScalar(1).divide(x),
                        this.newScale.copy(c);
                    if (a !== A || b !== B)
                        r.visible = !1
                }
                d.requestFrame();
                return !0
            }
            F(a, b, L).hasAnythingChanged && d.requestFrame();
            return !1
        }
        ;
        this.onCanvasPointerDown = function(a, b) {
            var c = F(a, b, !0);
            L = !0;
            if (null !== c.hoveredCollider)
                return u = !0,
                G = (y === WALK.TRANSFORM_MODE.TRANSLATE ? p : y === WALK.TRANSFORM_MODE.ROTATE ? q : r).usedAxes(c.hoveredCollider),
                A = a,
                B = b,
                this.mode === WALK.TRANSFORM_MODE.TRANSLATE ? (m.show(G),
                this.newPosition.copy(this.oldPosition),
                v.copy(I(G, a, b))) : this.mode === WALK.TRANSFORM_MODE.ROTATE ? G === X.ALL && (this.newRotation.copy(this.oldRotation),
                w = M(a, b)) : (m.show(G === X.ALL ? X.NONE : G),
                this.newScale.copy(this.oldScale),
                a = I(G, a, b),
                x.copy(a).addScalar(1).divide(this.oldScale)),
                !0;
            G = X.ALL;
            u = !1;
            c.hasAnythingChanged && d.requestFrame();
            return !1
        }
        ;
        this.onCanvasPointerUp = function(a, b) {
            if (this.transforming) {
                e(this.newPosition);
                f(this.newRotation);
                var c = this.newScale;
                h.oldScale.copy(c);
                h.newScale.copy(c);
                m.show(X.NONE);
                n.show(X.NONE);
                G = X.ALL;
                l.show(G);
                this.mode === WALK.TRANSFORM_MODE.TRANSLATE ? p.visible = !0 : this.mode === WALK.TRANSFORM_MODE.ROTATE ? q.visible = !0 : r.visible = !0
            }
            c = this.transforming;
            u = !1;
            this.update();
            F(a, b, !1).hasAnythingChanged && d.requestFrame();
            L = !1;
            return c
        }
        ;
        this.update = function() {
            if (!this.transforming && (void 0 !== this.target.position && e(this.target.position),
            void 0 !== this.target.rotation && f(this.target.rotation),
            void 0 !== this.target.scale)) {
                var b = this.target.scale;
                h.oldScale.copy(b);
                h.newScale.copy(b)
            }
            O.copy(c);
            O.sub(l.position);
            O.normalize();
            b = .18 * l.position.distanceTo(c) * a.camera.fov / 90;
            l.scale.set(b, b, b);
            m.scale.set(b, b, b);
            n.scale.set(b, b, b);
            p.scale.set(b, b, b);
            q.scale.set(b, b, b);
            r.scale.set(b, b, b);
            q.update(a.camera);
            m.update(a.camera);
            l.update(c);
            l.updateMatrixWorld();
            m.updateMatrixWorld();
            n.updateMatrixWorld();
            p.updateMatrixWorld();
            q.updateMatrixWorld();
            r.updateMatrixWorld()
        }
    }
    ;
    WALK.SubTargetData = function(a, b) {
        this.isSupported = function(a) {
            return b[a]
        }
        ;
        this.offsetPosition = function(b) {
            b = a.position.clone().add(b);
            a.setPosition(b.x, b.y, b.z)
        }
        ;
        this.offsetRotation = function(b) {
            a.setRotation(a.rotation.z + b.z, a.rotation.x + b.x, a.rotation.y + b.y)
        }
        ;
        this.offsetScale = function(b) {
            b = a.scale.clone().add(b);
            a.setScale(b.x, b.y, b.z)
        }
        ;
        Object.defineProperty(this, "target", {
            get: function() {
                return a
            }
        })
    }
    ;
    WALK.TransformControls = function(a, b, c, d, e) {
        function f() {}
        function g(a) {
            e.isEnabled() !== a && (a ? e.enable() : e.disable())
        }
        var h = this
          , l = !1
          , m = new WALK.TransformGizmo(c,d,e.cameraWorldPosition(),b);
        m.mode = WALK.TRANSFORM_MODE.TRANSLATE;
        var n = {
            itemModified: f
        }
          , p = [];
        Object.defineProperty(this, "supportedModes", {
            get: function() {
                return p
            }
        });
        Object.defineProperty(this, "mode", {
            get: function() {
                return m.mode
            }
        });
        this.setItemModifiedCallback = function(a) {
            console.assert(n.itemModified === f);
            n.itemModified = a
        }
        ;
        var q = new wc(a,WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);
        q.callbacks.onPointerDown = function(a, b) {
            a = m.onCanvasPointerDown(a, b);
            g(!m.transforming);
            return a
        }
        ;
        q.callbacks.onPointerUp = function(a, b) {
            a = m.onCanvasPointerUp(a, b);
            g(!m.transforming);
            return a
        }
        ;
        q.callbacks.onPointerMove = function(a, b) {
            a = m.onCanvasPointerMove(a, b);
            if (m.transforming)
                if (m.mode === WALK.TRANSFORM_MODE.TRANSLATE) {
                    b = m.newPosition;
                    var c = b.clone().sub(h.target.position);
                    h.target.setPosition(b.x, b.y, b.z);
                    n.itemModified(h.target);
                    h.subTargetsData && h.subTargetsData.forEach(function(a) {
                        a.isSupported(m.mode) && (a.offsetPosition(c),
                        n.itemModified(a.target))
                    })
                } else if (m.mode === WALK.TRANSFORM_MODE.ROTATE) {
                    b = m.newRotation;
                    var d = {
                        x: b.x - h.target.rotation.x,
                        y: b.y - h.target.rotation.y,
                        z: b.z - h.target.rotation.z
                    };
                    h.target.setRotation(h.target.rotation.z + d.z, h.target.rotation.x + d.x, h.target.rotation.y + d.y);
                    n.itemModified(h.target);
                    h.subTargetsData && h.subTargetsData.forEach(function(a) {
                        a.isSupported(m.mode) && (a.offsetRotation(d),
                        n.itemModified(a.target))
                    })
                } else {
                    b = m.newScale;
                    var e = b.clone().sub(h.target.scale);
                    h.target.setScale(b.x, b.y, b.z);
                    n.itemModified(h.target);
                    h.subTargetsData && h.subTargetsData.forEach(function(a) {
                        a.isSupported(m.mode) && (a.offsetScale(e),
                        n.itemModified(a.target))
                    })
                }
            return a
        }
        ;
        q.disable();
        Object.defineProperty(this, "target", {
            get: function() {
                return m.target
            }
        });
        Object.defineProperty(this, "subTargetsData", {
            get: function() {
                return m.subTargetsData
            }
        });
        this.setTransformMode = function(a) {
            m.mode = a
        }
        ;
        this.update = function() {
            l && m.update()
        }
        ;
        this.enable = function(a, b, c) {
            l = !0;
            m.target = a;
            m.subTargetsData = c;
            null !== a && (m.update(),
            m.visible = !0);
            p = b;
            -1 === b.indexOf(m.mode) && (m.mode = b[0]);
            q.enable()
        }
        ;
        this.disable = function() {
            l = !1;
            p = [];
            m.visible = !1;
            q.disable()
        }
    }
    ;
    function Md(a, b) {
        this._nodesPrimary = a;
        this._nodesSecondary = b
    }
    Md.prototype.constructor = Md;
    Object.defineProperty(Md.prototype, "highlightMix", {
        set: function(a) {
            this._nodesPrimary.forEach(function(b) {
                b.highlightMix = a
            });
            this._nodesSecondary.forEach(function(b) {
                b.highlightMix = a
            })
        }
    });
    Object.defineProperty(Md.prototype, "selected", {
        set: function(a) {
            this._nodesPrimary.forEach(function(b) {
                b.selected = a
            });
            this._nodesSecondary.forEach(function(b) {
                b.selectedSecondary = a
            })
        }
    });
    WALK.EditorSelector = function(a, b, c, d, e, f, g, h, l) {
        function m() {}
        function n() {
            x.highlightMix = .8 * Math.pow(y / w.selectionTimeSec, 2)
        }
        function p(a) {
            null !== x && (x.highlightMix = 0);
            null !== a && (x = a,
            y = w.selectionTimeSec,
            n());
            h.requestFrame()
        }
        function q(a) {
            var b = a.geometry;
            b && void 0 === b.getAttribute("order") && a.visible && (a.visible = !1,
            K.push(a))
        }
        function r() {
            for (var a = k.makeIterator(K), b = a.next(); !b.done; b = a.next())
                b.value.visible = !0
        }
        function u() {
            L.set(!0, !1, !1);
            G.set(I);
            b.gpuMeshes.forEach(function(a) {
                a.geometry.addTriangleOrderAttribute();
                a.highlightMix = 0;
                a.selected = !1;
                c.uploadNewBuffers(a)
            });
            K.length = 0;
            b.threeScene.traverse(q);
            b.threeScene.overrideMaterial = M;
            b.skyMeshes.forEach(function(a) {
                a.visible = !1
            })
        }
        function v() {
            L.restore();
            G.restore();
            r();
            b.threeScene.overrideMaterial = null;
            b.gpuMeshes.forEach(function(a) {
                a.highlightMix = null;
                a.selected = null;
                a.selectedSecondary = !1
            });
            z = null;
            b.skyMeshes.forEach(function(a) {
                a.visible = !0
            })
        }
        var w = this
          , x = null
          , y = 0
          , z = null
          , A = 0
          , B = new Ac
          , H = new WALK.TransformControls(a,h,b,d,l)
          , C = {
            materialClicked: m,
            lightInstanceClicked: m,
            lightProbeClicked: m,
            nodeClicked: m,
            extensionClicked: m,
            positionClicked: m
        }
          , L = new xc(c)
          , G = new yc(c)
          , I = new t.Color(16777215)
          , M = new WALK.WireframeMaterial(new t.Color(0));
        M.highlight = M.meshSelectedLineColor;
        var O;
        this.selectionTimeSec = 1;
        this.selectMaterial = function(a) {
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.MATERIAL);
            p(a)
        }
        ;
        this.selectLights = function(a, b) {
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.LIGHT);
            e.showSelectionMesh(a, b);
            h.requestFrame()
        }
        ;
        this.selectLightInstances = function(a, b, c) {
            function d(a) {
                return a.map(function(a) {
                    var b = WALK.SubTargetData
                      , c = [];
                    switch (a.light.type) {
                    case "point":
                        c[WALK.TRANSFORM_MODE.TRANSLATE] = !0;
                        break;
                    case "sun":
                        c[WALK.TRANSFORM_MODE.ROTATE] = !0;
                        break;
                    default:
                        c[WALK.TRANSFORM_MODE.TRANSLATE] = !0,
                        c[WALK.TRANSFORM_MODE.ROTATE] = !0
                    }
                    return new b(a,c)
                })
            }
            e.showInstancesSelectionMesh(a, b);
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.LIGHT);
            if (a) {
                var f = a.light.type;
                H.enable(a, "point" === f ? [WALK.TRANSFORM_MODE.TRANSLATE] : "sun" === f ? [WALK.TRANSFORM_MODE.ROTATE] : [WALK.TRANSFORM_MODE.TRANSLATE, WALK.TRANSFORM_MODE.ROTATE], d(b))
            } else
                H.disable();
            c ? (a = e.getLightInstanceMaterial(c),
            p(a)) : h.requestFrame()
        }
        ;
        this.selectLightProbe = function(a) {
            var b = null;
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);
            a ? (f.showLightProbeBoundingBox(a),
            b = f.getLightProbeMaterial(a),
            H.enable(a, [WALK.TRANSFORM_MODE.TRANSLATE])) : H.disable();
            p(b)
        }
        ;
        this.selectEditorCameraVolume = function(a) {
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);
            a ? (p(g.setHighlightedCameraVolume(a)),
            H.enable(a, [WALK.TRANSFORM_MODE.TRANSLATE, WALK.TRANSFORM_MODE.ROTATE, WALK.TRANSFORM_MODE.SCALE])) : (p(null),
            H.disable())
        }
        ;
        this.selectExtension = function(a) {
            var b = null;
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.EXTENSION);
            a && 0 < a.triggers.length && (a = a.triggers[0].mesh) && (b = a.material);
            p(b)
        }
        ;
        this.selectNodes = function(a, b, c, d, e) {
            console.assert(O === WALK.EditorSelector.SELECTION_MODE.NODE);
            z && (z.selected = !1);
            a || b.length ? (a = [a].concat(c),
            b = b.concat(d),
            z = new Md(a,b),
            z.selected = !0) : z = null;
            e && (e = new Md([e],e.config.nodes),
            p(e))
        }
        ;
        this.update = function(a) {
            H.update();
            null !== x && (y -= a,
            0 < y ? n() : (x.highlightMix = 0,
            x = null),
            h.requestFrame())
        }
        ;
        var K = [];
        this.setDistanceToObject = function(a) {
            A = a
        }
        ;
        this.setSelectionMode = function(a) {
            if (a !== O) {
                O === WALK.EditorSelector.SELECTION_MODE.NODE && v();
                O === WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME && g.setControlsVisible(!1);
                switch (a) {
                case WALK.EditorSelector.SELECTION_MODE.OFF:
                case WALK.EditorSelector.SELECTION_MODE.MATERIAL:
                case WALK.EditorSelector.SELECTION_MODE.EXTENSION:
                case WALK.EditorSelector.SELECTION_MODE.POSITION:
                case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:
                    e.hideLights();
                    f.hideLightProbes();
                    break;
                case WALK.EditorSelector.SELECTION_MODE.LIGHT:
                    e.showLights();
                    f.hideLightProbes();
                    break;
                case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:
                    e.hideLights();
                    f.showLightProbes();
                    break;
                case WALK.EditorSelector.SELECTION_MODE.NODE:
                    e.hideLights(),
                    f.hideLightProbes(),
                    u()
                }
                a === WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME && g.setControlsVisible(!0);
                H.disable();
                if (a === WALK.EditorSelector.SELECTION_MODE.MATERIAL || a === WALK.EditorSelector.SELECTION_MODE.EXTENSION)
                    for (var c = k.makeIterator(b.getAnimatedMaterials()), d = c.next(); !d.done; d = c.next())
                        d.value.play();
                else
                    for (c = k.makeIterator(b.getAnimatedMaterials()),
                    d = c.next(); !d.done; d = c.next())
                        d.value.pause();
                O = a
            }
        }
        ;
        this.setMaterialClickedCallback = function(a) {
            console.assert(C.materialClicked === m);
            C.materialClicked = a
        }
        ;
        this.setLightInstanceClickedCallback = function(a) {
            console.assert(C.lightInstanceClicked === m);
            C.lightInstanceClicked = a
        }
        ;
        this.setLightProbeClickedCallback = function(a) {
            console.assert(C.lightProbeClicked === m);
            C.lightProbeClicked = a
        }
        ;
        this.setNodeClickedCallback = function(a) {
            console.assert(C.nodeClicked === m);
            C.nodeClicked = a
        }
        ;
        this.setExtensionClickedCallback = function(a) {
            console.assert(C.extensionClicked === m);
            C.extensionClicked = a
        }
        ;
        this.setPositionClickedCallback = function(a) {
            console.assert(C.positionClicked === m);
            C.positionClicked = a
        }
        ;
        (function() {
            var b = new wc(a,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);
            b.callbacks.onClick = function(a, b, c) {
                if (O === WALK.EditorSelector.SELECTION_MODE.OFF)
                    return !1;
                var g = !1;
                switch (O) {
                case WALK.EditorSelector.SELECTION_MODE.MATERIAL:
                    a = d.findObstacleMeshAtPosition(a, b, !1);
                    a = null !== a ? a.material : null;
                    null !== a && (g = C.materialClicked(a, c));
                    break;
                case WALK.EditorSelector.SELECTION_MODE.LIGHT:
                    a = d.findMeshFromListAtPosition(e.lightInstanceMeshes, a, b);
                    a = null !== a ? a.userData.lightInstance : null;
                    null !== a && (g = C.lightInstanceClicked(a, c));
                    break;
                case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:
                    a = d.findMeshFromListAtPosition(f.lightProbeMeshes, a, b);
                    a = null !== a ? a.lightProbe : null;
                    null !== a && (g = C.lightProbeClicked(a, c));
                    break;
                case WALK.EditorSelector.SELECTION_MODE.NODE:
                    a = d.findObstacleMeshAtPosition(a, b, !1);
                    (a = null !== a ? a.node : null) && (g = C.nodeClicked(a, c));
                    break;
                case WALK.EditorSelector.SELECTION_MODE.EXTENSION:
                    a = d.findIntersectionAtPosition(a, b, !1, B) ? B.object.anchor || null : null;
                    a && a.extension && (g = C.extensionClicked(a.extension, a, c));
                    break;
                case WALK.EditorSelector.SELECTION_MODE.POSITION:
                    a = d.findIntersectionAtPosition(a, b, !1, B) && !B.object.anchor ? d.movePointTowardsTheCamera(B.point, A) : null,
                    a && (g = C.positionClicked(a, c))
                }
                return g
            }
            ;
            b.callbacks.onDoubleClick = function() {
                return !1
            }
        }
        )();
        Object.defineProperty(this, "transformControls", {
            get: function() {
                return H
            }
        });
        this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)
    }
    ;
    WALK.EditorSelector.SELECTION_MODE = {
        OFF: 0,
        MATERIAL: 1,
        LIGHT: 2,
        LIGHT_PROBE: 3,
        NODE: 4,
        EXTENSION: 6,
        POSITION: 7,
        CAMERA_VOLUME: 8
    };
    function Nd() {
        var a = {
            uniforms: {
                inputBuffer: {
                    type: "t",
                    value: null
                },
                weight: {
                    type: "f",
                    value: 1
                }
            },
            vertexShader: WALK.getShader("accumulate_vertex.glsl"),
            fragmentShader: WALK.getShader("accumulate_fragment.glsl")
        };
        t.ShaderPass.call(this, a, "inputBuffer");
        this.material.depthTest = !1;
        this.material.depthWrite = !1;
        this.material.blending = t.CustomBlending;
        this.material.blendEquation = GLC.FUNC_ADD;
        this.material.blendDst = GLC.ONE_MINUS_SRC_ALPHA;
        this.material.blendSrc = GLC.SRC_ALPHA
    }
    Nd.prototype = Object.create(t.ShaderPass.prototype);
    Nd.prototype.constructor = WALK.AccumulatePass;
    function Od(a, b, c, d, e) {
        var f = a / b
          , g = Math.tan(.5 * t.Math.degToRad(e.fov));
        g = e.near * g / e.zoom;
        var h = -g
          , l = h * f;
        f *= g;
        a = (f - l) / a;
        b = (g - h) / b;
        e.projectionMatrix.makeFrustum(l - c * a, f - c * a, h - d * b, g - d * b, e.near, e.far)
    }
    function Pd(a, b, c, d, e) {
        var f = e.top
          , g = e.bottom
          , h = e.left
          , l = e.right;
        a = (l - h) / a;
        b = (g - f) / b;
        e.projectionMatrix.makeOrthographic(h - c * a, l - c * a, f - d * b, g - d * b, e.near, e.far)
    }
    function Qd() {
        var a = {
            uniforms: {
                tDiffuse: {
                    type: "t",
                    value: null
                }
            },
            vertexShader: WALK.getShader("copy_opaque_vertex.glsl"),
            fragmentShader: WALK.getShader("copy_opaque_fragment.glsl")
        };
        a = new t.ShaderPass(a);
        a.renderToScreen = !0;
        return a
    }
    function Rd(a, b, c) {
        void 0 === c && (c = b.camera);
        var d, e, f = 0, g = [[.375, .4375], [.625, .0625], [.875, .1875], [.125, .0625], [.375, .6875], [.875, .4375], [.625, .5625], [.375, .9375], [.625, .3125], [.125, .5625], [.125, .8125], [.375, .1875], [.875, .9375], [.875, .6875], [.125, .3125], [.625, .8125]], h = new Nd, l = Qd(), m = new xc(a);
        if (c instanceof t.PerspectiveCamera)
            var n = Od;
        else
            c instanceof t.OrthographicCamera ? n = Pd : (console.error("Unsupported camera type"),
            n = void 0);
        var p = n;
        this.reset = function() {
            f = 0
        }
        ;
        this.renderSample = function(l, n) {
            console.assert(f < g.length);
            m.set(!0, !0, !1);
            p(e.width, e.height, g[f][0] - .5, g[f][1] - .5, c);
            l ? a.renderMeshes(l, n, c, d, !0) : (console.assert(!1 === (void 0 !== n && void 0 === l), "Passing overrideMaterial without passing meshes is not implemented"),
            a.render(b.threeScene, c, d, !0));
            m.restore();
            m.set(!1, !1, !1);
            h.uniforms.weight.value = 1 / (f + 1);
            h.render(a, e, d);
            m.restore();
            c.updateProjectionMatrix();
            f += 1
        }
        ;
        this.renderedSamplesCount = function() {
            return f
        }
        ;
        this.allSamplesRendered = function() {
            return f === g.length
        }
        ;
        this.renderAllSamples = function(a, b) {
            for (; !this.allSamplesRendered(); )
                this.renderSample(a, b)
        }
        ;
        this.renderAccumulatedSamplesToScreen = function() {
            m.set(!0, !0, !1);
            l.render(a, void 0, e);
            m.restore()
        }
        ;
        this.copyAccumulatedSamplesToBuffer = function() {
            var b = e.width
              , c = e.height
              , d = new Uint8Array(b * c * 4);
            a.readPixels(b, c, d);
            return d
        }
        ;
        this.setTargets = function(a, b) {
            console.assert(a.width === b.width && a.height === b.height);
            d = a;
            e = b
        }
        ;
        this.dispose = function() {
            h.material.dispose()
        }
    }
    ;function Sd(a) {
        return a.split("\n").map(function(a, c) {
            return c + 1 + ": " + a
        }).join("\n")
    }
    function Td(a, b, c) {
        b = a.createShader(b);
        a.shaderSource(b, c);
        a.compileShader(b);
        var d = !1 === a.getShaderParameter(b, a.COMPILE_STATUS);
        d && console.error("Shader failed to compile.");
        if (d || WALK.LOG_INFO)
            a = a.getShaderInfoLog(b),
            "" !== a && console.warn("Shader info log: ", a, Sd(c));
        return b
    }
    ;var Ud = "viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" ")
      , Vd = 0;
    function Wd(a, b) {
        var c = b.index0AttributeName
          , d = a.createProgram()
          , e = Td(a, a.VERTEX_SHADER, b.generateVertexShader())
          , f = Td(a, a.FRAGMENT_SHADER, b.generateFragmentShader());
        a.attachShader(d, e);
        a.attachShader(d, f);
        void 0 !== c && a.bindAttribLocation(d, 0, c);
        a.linkProgram(d);
        c = a.getProgramInfoLog(d).trim();
        !1 === a.getProgramParameter(d, a.LINK_STATUS) && console.error("Shader link error: " + a.getError(), "validate status: ", a.getProgramParameter(d, a.VALIDATE_STATUS));
        "" !== c && "\x00" !== c && console.warn("program info log: " + c);
        a.deleteShader(e);
        a.deleteShader(f);
        e = {};
        f = 0;
        for (c = Ud.length; f < c; f++) {
            var g = Ud[f];
            e[g] = a.getUniformLocation(d, g)
        }
        this.transformUniformCache = e;
        e = b.uniforms;
        f = {
            i: [],
            f: [],
            v2: [],
            v3: [],
            c: [],
            v4: [],
            m4: [],
            t: []
        };
        var h;
        for (l in e)
            e.hasOwnProperty(l) && (c = a.getUniformLocation(d, l)) && (g = e[l].type,
            console.assert(f.hasOwnProperty(g)),
            "i" === g || "f" === g || "t" === g ? h = null : "v2" === g ? h = [null, null] : "v3" === g || "c" === g ? h = [null, null, null] : "v4" === g ? h = [null, null, null, null] : "m4" === g ? h = null : console.assert(!1),
            f[g].push({
                id: l,
                value: h,
                location: c
            }));
        this.materialUniformCache = f;
        b = b.attributes;
        h = {};
        var l = 0;
        for (e = b.length; l < e; l++)
            f = b[l],
            h[f] = a.getAttribLocation(d, f);
        this.attributes = h;
        this.attributesKeys = Object.keys(this.attributes);
        this.id = Vd++;
        this.usedTimes = 1;
        this.program = d;
        return this
    }
    function Xd(a) {
        var b = new Map;
        this.assignProgramToMaterial = function(c) {
            console.assert(c instanceof WALK.BaseMaterial);
            var d = c.generateProgramId()
              , e = b[d];
            e ? e.usedTimes++ : (e = new Wd(a,c),
            b[d] = e);
            c.program && this.resetProgramAssignment(c);
            c.program = e
        }
        ;
        this.resetProgramAssignment = function(c) {
            var d = c.program;
            c.program = null;
            --d.usedTimes;
            if (0 === d.usedTimes) {
                for (var e in b)
                    if (b.hasOwnProperty(e) && b[e] === d) {
                        delete b[e];
                        break
                    }
                a.deleteProgram(d.program)
            }
        }
    }
    ;function Yd(a) {
        var b = Array(16).fill(0)
          , c = Array(16).fill(null)
          , d = b.map(function() {
            return 0
        })
          , e = null
          , f = null
          , g = null
          , h = null
          , l = null
          , m = null
          , n = null
          , p = null
          , q = null
          , r = null
          , u = null
          , v = null
          , w = null
          , x = null
          , y = null
          , z = null;
        this.resetAttributeStates = function() {
            for (var a = 0, c = b.length; a < c; a++)
                b[a] = 0
        }
        ;
        this.disableAttributeStates = function() {
            for (var c = 0, d = b.length; c < d; c++)
                a.disableVertexAttribArray(c),
                b[c] = 0
        }
        ;
        this.enableAttributeArray = function(c) {
            2 !== b[c] && (a.enableVertexAttribArray(c),
            b[c] = 2)
        }
        ;
        this.disableAttributeArray = function(d, e) {
            1 !== b[d] && (a.disableVertexAttribArray(d),
            b[d] = 1);
            c[d] !== e && (2 === e.length ? a.vertexAttrib2fv(d, e) : 3 === e.length ? a.vertexAttrib3fv(d, e) : 4 === e.length && a.vertexAttrib4fv(d, e),
            c[d] = e)
        }
        ;
        this.resetAttributeDivisors = function() {
            for (var b = 0, c = d.length; b < c; b++)
                d[b] && (a.vertexAttribDivisor(b, 0),
                d[b] = 0)
        }
        ;
        this.setAttributeDivisor = function(b, c) {
            a.vertexAttribDivisor(b, c);
            d[b] = c
        }
        ;
        this.setBlending = function(b) {
            var c = b.blending;
            c !== e && (c === t.NoBlending ? a.disable(a.BLEND) : c === t.AdditiveBlending ? (a.enable(a.BLEND),
            a.blendEquation(a.FUNC_ADD),
            a.blendFunc(a.SRC_ALPHA, a.ONE)) : c === t.SubtractiveBlending ? (a.enable(a.BLEND),
            a.blendEquation(a.FUNC_ADD),
            a.blendFunc(a.ZERO, a.ONE_MINUS_SRC_COLOR)) : c === t.MultiplyBlending ? (a.enable(a.BLEND),
            a.blendEquation(a.FUNC_ADD),
            a.blendFunc(a.ZERO, a.SRC_COLOR)) : c === t.CustomBlending ? a.enable(a.BLEND) : (a.enable(a.BLEND),
            a.blendEquationSeparate(a.FUNC_ADD, a.FUNC_ADD),
            a.blendFuncSeparate(a.SRC_ALPHA, a.ONE_MINUS_SRC_ALPHA, a.ONE, a.ONE_MINUS_SRC_ALPHA)),
            e = c);
            if (c === t.CustomBlending) {
                c = b.blendEquation;
                var d = b.blendEquationAlpha || c
                  , p = b.blendSrc
                  , r = b.blendDst
                  , q = b.blendSrcAlpha || p;
                b = b.blendDstAlpha || r;
                if (c !== f || d !== l)
                    a.blendEquationSeparate(c, d),
                    f = c,
                    l = d;
                if (p !== g || r !== h || q !== m || b !== n)
                    a.blendFuncSeparate(p, r, q, b),
                    g = p,
                    h = r,
                    m = q,
                    n = b
            } else
                n = m = l = h = g = f = null
        }
        ;
        this.setDepthTest = function(b) {
            p !== b && (b ? a.enable(a.DEPTH_TEST) : a.disable(a.DEPTH_TEST),
            p = b)
        }
        ;
        this.setDepthWrite = function(b) {
            q !== b && (a.depthMask(b),
            q = b)
        }
        ;
        this.setColorWrite = function(b) {
            r !== b && (a.colorMask(b, b, b, b),
            r = b)
        }
        ;
        this.setDoubleSided = function(b) {
            u !== b && (b ? a.disable(a.CULL_FACE) : a.enable(a.CULL_FACE),
            u = b)
        }
        ;
        this.setFlipSided = function(b) {
            v !== b && (b ? a.frontFace(a.CW) : a.frontFace(a.CCW),
            v = b)
        }
        ;
        this.setViewport = function(b, c, d, e) {
            if (w !== b || x !== c || y !== d || z !== e)
                a.viewport(b, c, d, e),
                w = b,
                x = c,
                y = d,
                z = e
        }
    }
    ;function Zd() {
        this.texture = null;
        this.locked = !1;
        this.usedCount = 0
    }
    function $d(a) {
        for (var b = [], c = 0; c < a; c += 1)
            b[c] = new Zd;
        return b
    }
    function ae(a) {
        var b = a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS)
          , c = $d(b);
        this.setSlot = function(a, e) {
            var d = a.__webglSlot;
            if (null !== d) {
                var g = c[d];
                g.usedCount += 1;
                g.locked = g.locked || e;
                return !1
            }
            for (var h = Infinity, l = 0; l < b; l += 1)
                g = c[l],
                !g.locked && g.usedCount < h && (h = g.usedCount,
                d = l);
            null === d && (console.warn("Not enough texture units"),
            d = 0);
            g = c[d];
            g.texture && (g.texture.__webglSlot = null);
            g.texture = a;
            g.usedCount = 1;
            g.locked = e;
            a.__webglSlot = d;
            return !0
        }
        ;
        this.unlockAllSlots = function() {
            for (var a = 0; a < b; a += 1)
                c[a].locked = !1
        }
        ;
        this.freeSlot = function(a) {
            if (null !== a.__webglSlot) {
                var b = c[a.__webglSlot];
                a.__webglSlot = null;
                b.texture = null;
                b.locked = !1;
                b.usedCount = 0
            }
        }
    }
    function be(a) {
        var b = a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS)
          , c = 0;
        this.setSlot = function(a, e) {
            c === b && (console.warn("Not enough texture units"),
            c = 0);
            a.__webglSlot = c;
            e && (c += 1);
            return !0
        }
        ;
        this.unlockAllSlots = function() {
            c = 0
        }
        ;
        this.freeSlot = function(a) {
            a.__webglSlot = null
        }
    }
    ;function ce(a, b) {
        a.drawArraysInstanced = function(a) {
            for (var c = [], e = 0; e < arguments.length; ++e)
                c[e - 0] = arguments[e];
            return b.drawArraysInstancedANGLE.apply(b, k.arrayFromIterable(c))
        }
        ;
        a.drawElementsInstanced = function(a) {
            for (var c = [], e = 0; e < arguments.length; ++e)
                c[e - 0] = arguments[e];
            return b.drawElementsInstancedANGLE.apply(b, k.arrayFromIterable(c))
        }
        ;
        a.vertexAttribDivisor = function(a) {
            for (var c = [], e = 0; e < arguments.length; ++e)
                c[e - 0] = arguments[e];
            return b.vertexAttribDivisorANGLE.apply(b, k.arrayFromIterable(c))
        }
    }
    function de(a, b) {
        for (var c = {
            HALF_FLOAT_OES: "OES_texture_half_float",
            COMPRESSED_RGB_S3TC_DXT1_EXT: "WEBGL_compressed_texture_s3tc",
            COMPRESSED_RGBA_S3TC_DXT1_EXT: "WEBGL_compressed_texture_s3tc",
            COMPRESSED_RGBA_S3TC_DXT3_EXT: "WEBGL_compressed_texture_s3tc",
            COMPRESSED_RGBA_S3TC_DXT5_EXT: "WEBGL_compressed_texture_s3tc",
            COMPRESSED_RGB_PVRTC_4BPPV1_IMG: "WEBGL_compressed_texture_pvrtc",
            COMPRESSED_RGBA_PVRTC_4BPPV1_IMG: "WEBGL_compressed_texture_pvrtc",
            COMPRESSED_RGB_PVRTC_2BPPV1_IMG: "WEBGL_compressed_texture_pvrtc",
            COMPRESSED_RGBA_PVRTC_2BPPV1_IMG: "WEBGL_compressed_texture_pvrtc",
            COMPRESSED_RGB_ETC1_WEBGL: "WEBGL_compressed_texture_etc1",
            COMPRESSED_RGBA_ASTC_4x4_KHR: "WEBGL_compressed_texture_astc"
        }, d = k.makeIterator(Object.entries(GLC)), e = d.next(); !e.done; e = d.next()) {
            var f = k.makeIterator(e.value);
            e = f.next().value;
            f = f.next().value;
            var g = c[e];
            void 0 !== g ? (g = b.gl.extension(g)) && console.assert(g[e] === f) : console.assert(a[e] === f)
        }
    }
    function ee(a) {
        return WALK.DETECTOR.gl.disableTextureSlotReuse ? new be(a) : new ae(a)
    }
    function fe(a, b) {
        function c(a, c) {
            if (!WALK.DETECTOR.gl.webgl2)
                return a;
            if (c === GLC.FLOAT) {
                if (a === GLC.RGB)
                    return b.RGB32F;
                console.assert("Missing mapping")
            }
            return a
        }
        function d() {
            K = !!WALK.DETECTOR.gl.instances;
            G = L = null;
            I = -1;
            O = M = null;
            !WALK.DETECTOR.gl.webgl2 && K && ce(b, WALK.DETECTOR.gl.instances);
            F = new Yd(b);
            D = new Xd(b);
            b.clearColor(0, 0, 0, 1);
            b.clearDepth(1);
            b.clearStencil(0);
            b.enable(b.DEPTH_TEST);
            b.depthFunc(b.LEQUAL);
            b.frontFace(b.CCW);
            b.cullFace(b.BACK);
            b.enable(b.CULL_FACE);
            b.enable(b.BLEND);
            b.blendEquation(b.FUNC_ADD);
            b.blendFunc(b.SRC_ALPHA, b.ONE_MINUS_SRC_ALPHA);
            F.setViewport(0, 0, a.width, a.height);
            b.clearColor(z.r, z.g, z.b, A);
            WALK.DETECTOR.ie || b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL, b.NONE)
        }
        function e(a) {
            a = a.target;
            a.removeEventListener("dispose", e);
            delete a.__webglInit;
            a = a.attributes;
            for (var c in a)
                if (a.hasOwnProperty(c)) {
                    var d = a[c];
                    void 0 !== d.buffer && (b.deleteBuffer(d.buffer),
                    delete d.buffer)
                }
            F.disableAttributeStates();
            M = null
        }
        function f(a) {
            a = a.target;
            a.removeEventListener("dispose", f);
            R.freeSlot(a);
            a.__webglTexture && (b.deleteTexture(a.__webglTexture),
            a.__webglTexture = null)
        }
        function g(a) {
            a = a.target;
            a.removeEventListener("dispose", g);
            R.freeSlot(a);
            b.deleteTexture(a.__webglTexture);
            a.__webglTexture = null;
            a.__webglFramebuffer && C.deallocateRenderTargetRenderingBuffers(a)
        }
        function h(a) {
            a = a.target;
            a.removeEventListener("dispose", h);
            D.resetProgramAssignment(a)
        }
        function l(a, c, d) {
            var e = d.attributes
              , f = c.attributes;
            c = c.attributesKeys;
            d = 16 * (d.instanceId || 0);
            for (var g = 0, h = c.length; g < h; g++) {
                var l = c[g]
                  , m = f[l];
                if (0 <= m) {
                    var n = e[l];
                    if (void 0 !== n) {
                        l = n.itemSize;
                        var p = n.glType;
                        b.bindBuffer(b.ARRAY_BUFFER, n.buffer);
                        n = n.divisor || 0;
                        F.enableAttributeArray(m);
                        b.vertexAttribPointer(m, l, p, !1, 0, d * n);
                        K && F.setAttributeDivisor(m, n)
                    } else
                        F.disableAttributeArray(m, a.defaultAttributeValues[l])
                }
            }
        }
        function m(a, c) {
            var d = WALK.DETECTOR;
            b.texParameteri(a, b.TEXTURE_WRAP_S, c.wrapS);
            b.texParameteri(a, b.TEXTURE_WRAP_T, c.wrapT);
            b.texParameteri(a, b.TEXTURE_MAG_FILTER, c.magFilter);
            b.texParameteri(a, b.TEXTURE_MIN_FILTER, c.minFilter);
            var e = d.gl.extension("EXT_texture_filter_anisotropic");
            e && 1 < c.anisotropy && b.texParameterf(a, e.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(c.anisotropy, d.gl.maxAnisotropy))
        }
        function n(a, b) {
            var c = a.material
              , d = b.material
              , e = c.program
              , f = d.program;
            return e && f && e.id !== f.id ? e.id - f.id : c.id - d.id || a.id - b.id
        }
        function p(a, b) {
            var c = a.material.transparentRenderOrder - b.material.transparentRenderOrder;
            return c ? c : b.cameraDistance - a.cameraDistance || a.id - b.id
        }
        function q(a, b, c) {
            if (c || !1 !== a.visible) {
                a instanceof t.Mesh && (!1 === a.frustumCulled || !0 === E.intersectsObject(a)) && ((b || a.material).transparent ? (!0 === C.sortObjects && (a.cameraDistance = E.nearPlaneDistanceToCenter(a)),
                H.push(a)) : B.push(a));
                for (var d = 0, e = a.children.length; d < e; d++)
                    q(a.children[d], b, c)
            }
        }
        function r(a) {
            F.setDoubleSided(a.side === t.DoubleSide);
            F.setFlipSided(a.side === t.BackSide)
        }
        function u(a) {
            a.__webglTexture || (a.addEventListener("dispose", f),
            a.__webglTexture = b.createTexture());
            b.activeTexture(b.TEXTURE0 + a.__webglSlot);
            b.bindTexture(b.TEXTURE_2D, a.__webglTexture);
            b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL, a.flipY);
            b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL, a.premultiplyAlpha);
            b.pixelStorei(b.UNPACK_ALIGNMENT, a.unpackAlignment);
            var d = a.image
              , e = t.Math.isPowerOfTwo(d.width) && t.Math.isPowerOfTwo(d.height)
              , g = a.format
              , h = a.type
              , l = c(g, h);
            m(b.TEXTURE_2D, a);
            var n = a.mipmaps;
            if (a instanceof qb)
                if (0 < n.length && e) {
                    for (var p = 0, r = n.length; p < r; p++)
                        d = n[p],
                        b.texImage2D(b.TEXTURE_2D, p, l, d.width, d.height, 0, g, h, d.data),
                        a.releaseOnLoadedToGpu && (d.data = null);
                    a.generateMipmaps = !1
                } else
                    b.texImage2D(b.TEXTURE_2D, 0, l, d.width, d.height, 0, g, h, d.data),
                    a.releaseOnLoadedToGpu && (d.data = null);
            else if (a instanceof pb)
                for (p = 0,
                r = n.length; p < r; p++)
                    d = n[p],
                    a.format !== GLC.RGBA && a.format !== GLC.RGB ? b.compressedTexImage2D(b.TEXTURE_2D, p, l, d.width, d.height, 0, d.data) : b.texImage2D(b.TEXTURE_2D, p, l, d.width, d.height, 0, g, h, d.data),
                    a.releaseOnLoadedToGpu && (d.data = null);
            else if (0 < n.length && e) {
                p = 0;
                for (r = n.length; p < r; p++)
                    d = n[p],
                    b.texImage2D(b.TEXTURE_2D, p, l, g, h, d);
                a.releaseOnLoadedToGpu && (a.mipmaps = null);
                a.generateMipmaps = !1
            } else
                b.texImage2D(b.TEXTURE_2D, 0, l, g, h, a.image),
                a.releaseOnLoadedToGpu && (a.image = null);
            a.generateMipmaps && e && b.generateMipmap(b.TEXTURE_2D);
            a.needsUpdate = !1
        }
        function v(a) {
            F.setBlending(a);
            F.setDepthTest(a.depthTest);
            F.setDepthWrite(a.depthWrite);
            F.setColorWrite(a.colorWrite)
        }
        function w(a, d, e) {
            if (e) {
                var f = e;
                v(f);
                r(f)
            }
            for (var g = 0, n = a.length; g < n; g += 1) {
                var p = a[g]
                  , q = p.geometry
                  , w = p.material;
                try {
                    e ? e.doNotOverrideSide && w && r(w) : (f = w,
                    v(f),
                    r(f));
                    var x = w = void 0
                      , y = void 0
                      , z = void 0
                      , C = void 0
                      , A = f;
                    if (!1 !== A.visible && 0 !== q.vertexCnt) {
                        var B = d
                          , N = A;
                        console.assert(N instanceof WALK.BaseMaterial);
                        N.programNeedsUpdate && (D.assignProgramToMaterial(N),
                        N.addEventListener("dispose", h),
                        N.programNeedsUpdate = !1);
                        console.assert(!N.morphTargets);
                        var E = !1
                          , S = !1
                          , Y = N.program
                          , G = Y.transformUniformCache
                          , H = N.uniforms;
                        Y.id !== L && (b.useProgram(Y.program),
                        L = Y.id,
                        S = E = !0);
                        N.id !== I && (I = N.id,
                        S = !0);
                        E && (b.uniformMatrix4fv(G.projectionMatrix, !1, B.projectionMatrix.elements),
                        null !== G.cameraPosition && (Z.setFromMatrixPosition(B.matrixWorld),
                        b.uniform3f(G.cameraPosition, Z.x, Z.y, Z.z)),
                        null !== G.viewMatrix && b.uniformMatrix4fv(G.viewMatrix, !1, B.matrixWorldInverse.elements));
                        if (E || p.matrixWorld !== O) {
                            O = p.matrixWorld;
                            E = void 0;
                            var U = G;
                            p.matrixWorld ? (ha.multiplyMatrices(B.matrixWorldInverse, p.matrixWorld),
                            E = ha) : E = B.matrixWorldInverse;
                            b.uniformMatrix4fv(U.modelViewMatrix, !1, E.elements);
                            U.normalMatrix && (ia.getNormalMatrix(E),
                            b.uniformMatrix3fv(U.normalMatrix, !1, ia.elements));
                            null !== U.modelMatrix && (p.matrixWorld ? b.uniformMatrix4fv(U.modelMatrix, !1, p.matrixWorld.elements) : b.uniformMatrix4fv(U.modelMatrix, !1, da))
                        }
                        N.refreshPerObjectUniforms && N.refreshPerObjectUniforms(p, H) && (S = !0);
                        if (S) {
                            var oa = U = B = E = S = N = void 0
                              , za = void 0
                              , sa = void 0
                              , qa = void 0
                              , pa = void 0
                              , Da = void 0
                              , P = void 0
                              , fa = void 0
                              , Oa = Y
                              , Za = H;
                            fa = Oa.materialUniformCache.i;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                P = fa[B],
                                Da = P.id,
                                pa = Za[Da].value,
                                P.value !== pa && (b.uniform1i(P.location, pa),
                                P.value = pa);
                            fa = Oa.materialUniformCache.f;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                P = fa[B],
                                Da = P.id,
                                pa = Za[Da].value,
                                P.value !== pa && (b.uniform1f(P.location, pa),
                                P.value = pa);
                            fa = Oa.materialUniformCache.v2;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                if (P = fa[B],
                                Da = P.id,
                                pa = Za[Da].value,
                                qa = pa.x,
                                sa = pa.y,
                                P.value[0] !== qa || P.value[1] !== sa)
                                    b.uniform2f(P.location, qa, sa),
                                    P.value[0] = qa,
                                    P.value[1] = sa;
                            fa = Oa.materialUniformCache.v3;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                if (P = fa[B],
                                Da = P.id,
                                pa = Za[Da].value,
                                qa = pa.x,
                                sa = pa.y,
                                za = pa.z,
                                P.value[0] !== qa || P.value[1] !== sa || P.value[2] !== za)
                                    b.uniform3f(P.location, qa, sa, za),
                                    P.value[0] = qa,
                                    P.value[1] = sa,
                                    P.value[2] = za;
                            fa = Oa.materialUniformCache.c;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                if (P = fa[B],
                                Da = P.id,
                                pa = Za[Da].value,
                                qa = pa.r,
                                sa = pa.g,
                                za = pa.b,
                                P.value[0] !== qa || P.value[1] !== sa || P.value[2] !== za)
                                    b.uniform3f(P.location, qa, sa, za),
                                    P.value[0] = qa,
                                    P.value[1] = sa,
                                    P.value[2] = za;
                            fa = Oa.materialUniformCache.v4;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                if (P = fa[B],
                                Da = P.id,
                                pa = Za[Da].value,
                                qa = pa.x,
                                sa = pa.y,
                                za = pa.z,
                                oa = pa.w,
                                P.value[0] !== qa || P.value[1] !== sa || P.value[2] !== za || P.value[3] !== oa)
                                    b.uniform4f(P.location, qa, sa, za, oa),
                                    P.value[0] = qa,
                                    P.value[1] = sa,
                                    P.value[2] = za,
                                    P.value[3] = oa;
                            fa = Oa.materialUniformCache.m4;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                P = fa[B],
                                Da = P.id,
                                b.uniformMatrix4fv(location, !1, Za[Da].value.elements);
                            fa = Oa.materialUniformCache.t;
                            B = 0;
                            for (E = fa.length; B < E; B += 1)
                                if (P = fa[B],
                                Da = P.id,
                                U = Za[Da].value,
                                S = R.setSlot(U, !0),
                                N = U.__webglSlot,
                                P.value !== N && (b.uniform1i(P.location, N),
                                P.value = N),
                                S || U.needsUpdate)
                                    if (U.isCube) {
                                        if (oa = U,
                                        b.activeTexture(b.TEXTURE0 + oa.__webglSlot),
                                        b.bindTexture(b.TEXTURE_CUBE_MAP, oa.__webglTexture),
                                        oa.needsUpdate) {
                                            b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL, oa.flipY);
                                            var Pa = oa instanceof pb
                                              , Ec = oa.image
                                              , Fc = oa.format
                                              , Gc = oa.type
                                              , lc = c(Fc, Gc);
                                            m(b.TEXTURE_CUBE_MAP, oa);
                                            for (za = 0; 6 > za; za++)
                                                if (Pa) {
                                                    var Hc = Ec[za].mipmaps;
                                                    sa = 0;
                                                    for (var Ic = Hc.length; sa < Ic; sa++) {
                                                        var jb = Hc[sa];
                                                        oa.format !== GLC.RGBA && oa.format !== GLC.RGB ? b.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X + za, sa, lc, jb.width, jb.height, 0, jb.data) : b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X + za, sa, lc, jb.width, jb.height, 0, Fc, Gc, jb.data);
                                                        oa.releaseOnLoadedToGpu && (jb.data = null)
                                                    }
                                                } else
                                                    b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X + za, 0, lc, Fc, Gc, Ec[za]),
                                                    oa.releaseOnLoadedToGpu && (Ec[za] = null);
                                            oa.generateMipmaps && b.generateMipmap(b.TEXTURE_CUBE_MAP);
                                            oa.needsUpdate = !1
                                        }
                                    } else
                                        oa = U,
                                        oa.needsUpdate ? u(oa) : (b.activeTexture(b.TEXTURE0 + oa.__webglSlot),
                                        b.bindTexture(b.TEXTURE_2D, oa.__webglTexture));
                            R.unlockAllSlots()
                        }
                        var Cb = Y;
                        N = !1;
                        if (q.id !== M || Cb.id !== L)
                            M = q.id,
                            N = !0;
                        console.assert(p instanceof t.Mesh);
                        var Ub = b.TRIANGLES
                          , $a = q.attributes.index;
                        if ($a) {
                            var Fa = $a.glType;
                            C = q.indexUint ? 4 : 2;
                            N && (l(A, Cb, q),
                            b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, $a.buffer));
                            void 0 !== q.indexOffset ? (z = q.indexCnt,
                            y = C * q.indexOffset) : (z = $a.length,
                            y = 0);
                            q.isInstanced ? b.drawElementsInstanced(Ub, z, Fa, y, q.instanceCount) : b.drawElements(Ub, z, Fa, y)
                        } else {
                            N && l(A, Cb, q);
                            var od = q.attributes.position;
                            void 0 !== q.vertexOffset ? (x = q.vertexCnt,
                            w = q.vertexOffset) : (x = od.length / od.itemSize,
                            w = 0);
                            q.isInstanced ? b.drawArraysInstanced(Ub, w, x, q.instanceCount) : b.drawArrays(Ub, w, x)
                        }
                        K && F.resetAttributeDivisors()
                    }
                } catch (Xb) {
                    console.error("Failed to render material " + (f ? f.name : "null") + ": " + Xb.stack)
                }
            }
        }
        function x(a, c) {
            b.bindRenderbuffer(b.RENDERBUFFER, a);
            c.depthBuffer ? (b.renderbufferStorage(b.RENDERBUFFER, b.DEPTH_STENCIL, c.width, c.height),
            b.framebufferRenderbuffer(b.FRAMEBUFFER, b.DEPTH_STENCIL_ATTACHMENT, b.RENDERBUFFER, a)) : b.renderbufferStorage(b.RENDERBUFFER, b.RGBA4, c.width, c.height)
        }
        function y(a, d) {
            d.addEventListener("dispose", g);
            d.__webglTexture = b.createTexture();
            var e = d.format
              , f = d.type
              , h = c(e, f);
            R.setSlot(d, !1);
            b.activeTexture(b.TEXTURE0 + d.__webglSlot);
            if (a) {
                b.bindTexture(b.TEXTURE_CUBE_MAP, d.__webglTexture);
                m(b.TEXTURE_CUBE_MAP, d);
                for (a = 0; 6 > a; a++) {
                    d.__webglFramebuffer[a] = b.createFramebuffer();
                    d.__webglRenderbuffer[a] = b.createRenderbuffer();
                    b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X + a, 0, h, d.width, d.height, 0, e, f, null);
                    var l = b.TEXTURE_CUBE_MAP_POSITIVE_X + a
                      , n = d.__webglTexture;
                    b.bindFramebuffer(b.FRAMEBUFFER, d.__webglFramebuffer[a]);
                    b.framebufferTexture2D(b.FRAMEBUFFER, b.COLOR_ATTACHMENT0, l, n, 0);
                    x(d.__webglRenderbuffer[a], d)
                }
                d.generateMipmaps && b.generateMipmap(b.TEXTURE_CUBE_MAP)
            } else
                d.__webglFramebuffer = b.createFramebuffer(),
                d.__webglRenderbuffer = d.shareDepthFrom ? d.shareDepthFrom.__webglRenderbuffer : b.createRenderbuffer(),
                b.bindTexture(b.TEXTURE_2D, d.__webglTexture),
                m(b.TEXTURE_2D, d),
                b.texImage2D(b.TEXTURE_2D, 0, h, d.width, d.height, 0, e, f, null),
                e = b.TEXTURE_2D,
                f = d.__webglTexture,
                b.bindFramebuffer(b.FRAMEBUFFER, d.__webglFramebuffer),
                b.framebufferTexture2D(b.FRAMEBUFFER, b.COLOR_ATTACHMENT0, e, f, 0),
                d.shareDepthFrom ? d.depthBuffer && b.framebufferRenderbuffer(b.FRAMEBUFFER, b.DEPTH_STENCIL_ATTACHMENT, b.RENDERBUFFER, d.__webglRenderbuffer) : x(d.__webglRenderbuffer, d),
                d.generateMipmaps && b.generateMipmap(b.TEXTURE_2D);
            b.bindRenderbuffer(b.RENDERBUFFER, null);
            b.bindFramebuffer(b.FRAMEBUFFER, null)
        }
        var z = new t.Color(0)
          , A = 0
          , B = []
          , H = [];
        this.domElement = a;
        this.sortObjects = this.autoClearStencil = this.autoClearDepth = this.autoClearColor = this.autoClear = !0;
        var C = this, L, G, I, M, O, K, F, D, E = new WALK.Frustum, S = new t.Matrix4, Z = new t.Vector3;
        d();
        de(b, WALK.DETECTOR);
        this.webGLContextRestored = function() {
            d()
        }
        ;
        this.context = b;
        this.state = F;
        var R = ee(b)
          , da = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
        this.setCanvasSize = function(b, c) {
            a.width = b;
            a.height = c;
            null === G && this.setViewport(0, 0, b, c)
        }
        ;
        this.setViewport = function(a, b, c, d) {
            F.setViewport(a, b, c, d)
        }
        ;
        this.setScissor = function(a, c, d, e) {
            b.scissor(a, c, d, e)
        }
        ;
        this.enableScissorTest = function(a) {
            a ? b.enable(b.SCISSOR_TEST) : b.disable(b.SCISSOR_TEST)
        }
        ;
        this.setClearColor = function(a, c) {
            z.copy(a);
            A = void 0 !== c ? c : 1;
            b.clearColor(z.r, z.g, z.b, A)
        }
        ;
        this.getClearColor = function() {
            return z
        }
        ;
        this.getClearAlpha = function() {
            return A
        }
        ;
        this.clear = function(a, c, d) {
            var e = 0;
            a && (e |= b.COLOR_BUFFER_BIT);
            c && (e |= b.DEPTH_BUFFER_BIT);
            d && (e |= b.STENCIL_BUFFER_BIT);
            b.clear(e)
        }
        ;
        this.clearColor = function() {
            b.clear(b.COLOR_BUFFER_BIT)
        }
        ;
        this.clearDepth = function() {
            b.clear(b.DEPTH_BUFFER_BIT)
        }
        ;
        this.clearStencil = function() {
            b.clear(b.STENCIL_BUFFER_BIT)
        }
        ;
        this.deallocateRenderTargetRenderingBuffers = function(a) {
            if (a.isCube)
                for (var c = 0; 6 > c; c++)
                    b.deleteFramebuffer(a.__webglFramebuffer[c]),
                    b.deleteRenderbuffer(a.__webglRenderbuffer[c]);
            else
                b.deleteFramebuffer(a.__webglFramebuffer),
                b.deleteRenderbuffer(a.__webglRenderbuffer);
            a.__webglFramebuffer = null;
            a.__webglRenderbuffer = null
        }
        ;
        var ha = new t.Matrix4
          , ia = new t.Matrix3;
        this.setRenderTarget = function(c) {
            if (c) {
                var d = c.isCube ? c.__webglFramebuffer[c.activeCubeFace] : c.__webglFramebuffer;
                var e = c.x;
                var f = c.y;
                var g = c.width;
                c = c.height
            } else
                d = null,
                f = e = 0,
                g = a.width,
                c = a.height;
            d !== G && (b.bindFramebuffer(b.FRAMEBUFFER, d),
            G = d);
            F.setViewport(e, f, g, c)
        }
        ;
        this.render = function(a, b, c, d) {
            this.renderMeshes(a.children, a.overrideMaterial, b, c, d)
        }
        ;
        this.renderMeshes = function(a, c, d, e, f, g) {
            M = null;
            I = -1;
            O = L = null;
            d.matrixWorldInverse.getInverse(d.matrixWorld);
            S.multiplyMatrices(d.projectionMatrix, d.matrixWorldInverse);
            E.setFromMatrix(S);
            B.length = 0;
            H.length = 0;
            g = void 0 === g ? !1 : g;
            for (var h = 0; h < a.length; h += 1)
                q(a[h], c, g);
            !0 === C.sortObjects && (B.sort(n),
            H.sort(p));
            this.setRenderTarget(e);
            (this.autoClear || f) && this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);
            w(B, d, c);
            w(H, d, c);
            e && e.generateMipmaps && (a = R.setSlot(e, !1),
            b.activeTexture(b.TEXTURE0 + e.__webglSlot),
            e.isCube ? (a && b.bindTexture(b.TEXTURE_CUBE_MAP, e.__webglTexture),
            b.generateMipmap(b.TEXTURE_CUBE_MAP)) : (a && b.bindTexture(b.TEXTURE_2D, e.__webglTexture),
            b.generateMipmap(b.TEXTURE_2D)));
            F.setDepthTest(!0);
            F.setDepthWrite(!0);
            F.setColorWrite(!0);
            F.resetAttributeStates()
        }
        ;
        this.uploadNewBuffers = function(a) {
            var c = a.geometry;
            a = c.attributes;
            var d = c.attributesKeys;
            void 0 === c.__webglInit && (c.__webglInit = !0,
            c.addEventListener("dispose", e));
            console.assert(c instanceof t.BufferGeometry);
            c = 0;
            for (var f = d.length; c < f; c += 1) {
                var g = d[c]
                  , h = a[g];
                g = "index" === g ? b.ELEMENT_ARRAY_BUFFER : b.ARRAY_BUFFER;
                if (h.buffer)
                    !0 === h.needsUpdate && console.assert(!1);
                else {
                    h.buffer = b.createBuffer();
                    b.bindBuffer(g, h.buffer);
                    var l = h.array;
                    WALK.DETECTOR.ios && g === b.ARRAY_BUFFER && console.assert(0 === h.itemSize * l.BYTES_PER_ELEMENT % 4);
                    b.bufferData(g, l, b.STATIC_DRAW);
                    l instanceof Float32Array ? h.glType = b.FLOAT : l instanceof Int8Array ? h.glType = b.BYTE : l instanceof Int16Array ? h.glType = b.SHORT : l instanceof Uint16Array ? h.glType = b.UNSIGNED_SHORT : l instanceof Uint32Array ? h.glType = b.UNSIGNED_INT : console.assert(!1);
                    h.releaseOnLoadedToGpu && (h.array = null);
                    h.needsUpdate = !1
                }
            }
        }
        ;
        this.uploadTexture = function(a) {
            R.setSlot(a, !1);
            u(a)
        }
        ;
        this.copyBufferToCubeFaceMip = function(a, c, d, e, f) {
            R.setSlot(f, !1);
            b.activeTexture(b.TEXTURE0 + f.__webglSlot);
            b.bindTexture(b.TEXTURE_CUBE_MAP, f.__webglTexture);
            b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X + d, a, b.RGBA, c, c, 0, b.RGBA, b.UNSIGNED_BYTE, e)
        }
        ;
        this.createCubeTexture = function(a, c) {
            var d = new ob;
            d.isCube = !0;
            d.minFilter = c ? GLC.LINEAR_MIPMAP_NEAREST : GLC.LINEAR;
            d.generateMipmaps = !1;
            d.needsUpdate = !1;
            d.addEventListener("dispose", f);
            d.__webglTexture = b.createTexture();
            R.setSlot(d, !1);
            b.activeTexture(b.TEXTURE0 + d.__webglSlot);
            b.bindTexture(b.TEXTURE_CUBE_MAP, d.__webglTexture);
            b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL, !1);
            b.texParameteri(b.TEXTURE_CUBE_MAP, b.TEXTURE_WRAP_S, b.CLAMP_TO_EDGE);
            b.texParameteri(b.TEXTURE_CUBE_MAP, b.TEXTURE_WRAP_T, b.CLAMP_TO_EDGE);
            b.texParameteri(b.TEXTURE_CUBE_MAP, b.TEXTURE_MAG_FILTER, b.LINEAR);
            c ? b.texParameteri(b.TEXTURE_CUBE_MAP, b.TEXTURE_MIN_FILTER, b.LINEAR_MIPMAP_NEAREST) : b.texParameteri(b.TEXTURE_CUBE_MAP, b.TEXTURE_MIN_FILTER, b.LINEAR);
            for (var e = 0; 6 > e; e += 1)
                b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X + e, 0, b.RGBA, a, a, 0, b.RGBA, b.UNSIGNED_BYTE, null);
            c && b.generateMipmap(b.TEXTURE_CUBE_MAP);
            return d
        }
        ;
        this.createFrameBufferRenderTarget = function(a) {
            return new tb(a)
        }
        ;
        this.createRenderTarget = function(a, b, c) {
            a = new sb(a,b,c);
            y(!1, a);
            return a
        }
        ;
        this.createRenderTargetCube = function(a, b, c) {
            a = new ub(a,b,c);
            y(!0, a);
            return a
        }
        ;
        this.readPixels = function(a, c, d) {
            b.readPixels(0, 0, a, c, b.RGBA, b.UNSIGNED_BYTE, d)
        }
    }
    ;var ge = {
        minFilter: GLC.LINEAR,
        magFilter: GLC.LINEAR,
        format: GLC.RGBA,
        stencilBuffer: !1,
        generateMipmaps: !1
    };
    function he(a, b) {
        void 0 === b.alpha && (b.alpha = !0);
        void 0 === b.depth && (b.depth = !0);
        void 0 === b.stencil && (b.stencil = !1);
        void 0 === b.premultipliedAlpha && (b.premultipliedAlpha = !0);
        void 0 === b.antialias && (b.antialias = !0);
        void 0 === b.preserveDrawingBuffer && (b.preserveDrawingBuffer = !1);
        try {
            var c = (WALK.FORCE_WEBGL1 ? null : a.getContext("webgl2", b)) || a.getContext("webgl", b) || a.getContext("experimental-webgl", b)
        } catch (d) {
            c = null
        }
        b = c;
        if (!b)
            return null;
        WALK.DETECTOR.resetGlDetector(b);
        WALK.DETECTOR.gl.reportToConsole();
        return new fe(a,b)
    }
    function ie(a) {
        if (a = he(a, {
            antialias: !WALK.FORCE_FXAA
        }))
            a.autoClear = !0,
            a.autoClearColor = !1,
            a.autoClearDepth = !0,
            a.autoClearStencil = !1,
            a.sortObjects = !0;
        return a
    }
    function je(a, b, c, d) {
        var e = null, f, g, h = c.camera, l = c.threeScene, m = function() {
            var b = new WALK.Frustum
              , d = new t.Matrix4;
            return function(e) {
                if (0 !== c.mirrors.length) {
                    e.matrixWorldInverse.getInverse(e.matrixWorld);
                    d.multiplyMatrices(e.projectionMatrix, e.matrixWorldInverse);
                    b.setFromMatrix(d);
                    for (var f = 0; f < c.mirrors.length; f += 1) {
                        var g = c.mirrors[f];
                        g.updateCameraPosition(e, b);
                        g.inFrustum() && g.render(a)
                    }
                }
            }
        }();
        this.resize = function(b) {
            if (!b) {
                var d = window.innerWidth;
                var l = window.innerHeight;
                var m = d * window.devicePixelRatio;
                var n = l * window.devicePixelRatio;
                h.aspect = m / n;
                h.updateProjectionMatrix();
                a.setCanvasSize(m, n);
                a.domElement.style.width = d + "px";
                a.domElement.style.height = l + "px";
                f && (f.configureTarget(m, n, ge),
                g.setTargets(f.renderTarget1, f.renderTarget2));
                e && e.uniforms.resolution.value.set(1 / m, 1 / n)
            }
            d = n;
            b ? (b = m / 2,
            m = 70) : (b = m,
            m = h.fov);
            l = b / d;
            for (n = 0; n < c.mirrors.length; n += 1)
                c.mirrors[n].configure(b, d, l, m)
        }
        ;
        this.renderIdle = function(a, b) {
            0 === b && (d.adaptExposure(),
            g && g.reset());
            if (d.exposureNeedsUpdate())
                return this.renderToScreen(a, !1),
                !0;
            if (!g)
                return !1;
            g.renderSample();
            4 <= g.renderedSamplesCount() && g.renderAccumulatedSamplesToScreen();
            return !g.allSamplesRendered()
        }
        ;
        this.renderToScreen = function(c, g) {
            d.update(c);
            g ? b.render(l, h.matrixWorld, m) : (m(h),
            e ? f.render(c) : a.render(l, h))
        }
        ;
        this.enableAutoExposure = function() {
            d.enableAutoExposure()
        }
        ;
        this.disableAutoExposure = function() {
            d.disableAutoExposure()
        }
        ;
        (function() {
            if (WALK.DETECTOR.gl.antialiasPostprocess) {
                f = new t.EffectComposer(a);
                if (!WALK.DETECTOR.gl.antialiasNative) {
                    WALK.log("using FXAA");
                    a.autoClear = !1;
                    e = new t.ShaderPass(t.FXAAShader);
                    e.clear = !1;
                    e.renderToScreen = !0;
                    e.material.depthTest = !1;
                    e.material.depthWrite = !1;
                    e.uniforms.resolution.value.set(1 / window.innerWidth, 1 / window.innerHeight);
                    var b = new t.RenderPass(l,h);
                    f.addPass(b);
                    f.addPass(e)
                }
                g = new Rd(a,c)
            }
        }
        )()
    }
    ;function qe() {
        WALK.BaseMaterial.call(this, WALK.getShader("static_render_vertex.glsl"), WALK.getShader("static_render_fragment.glsl"));
        this.uniforms = {
            staticRender: {
                type: "t",
                value: null
            },
            sizeInv: {
                type: "v2",
                value: new t.Vector2
            }
        }
    }
    qe.prototype = Object.create(WALK.BaseMaterial.prototype);
    qe.prototype.constructor = qe;
    function re(a) {
        a = he(a, {
            antialias: !1
        });
        a.autoClear = !1;
        a.autoUpdateObjects = !1;
        a.sortObjects = !1;
        return a
    }
    WALK.StaticRenderViewer = function(a) {
        var b = re(a)
          , c = new qe
          , d = new t.OrthographicCamera(-1,1,1,-1,0,1)
          , e = new t.Scene;
        a = new t.Mesh(new t.PlaneBufferGeometry(2,2),c);
        b.uploadNewBuffers(a);
        e.add(a);
        this.update = function(a) {
            var f = new Float32Array(a,0,a.byteLength / 4);
            a = f[0];
            var h = f[1];
            f = f.subarray(2);
            console.assert(a * h === f.length / 3);
            f = new qb(f,a,h,GLC.RGB,GLC.FLOAT);
            f.minFilter = GLC.NEAREST;
            f.magFilter = GLC.NEAREST;
            f.generateMipmaps = !1;
            f.flipY = !1;
            f.needsUpdate = !0;
            c.uniforms.staticRender.value = f;
            c.uniforms.sizeInv.value.set(1 / a, 1 / h);
            b.setCanvasSize(a, h);
            b.render(e, d);
            f.dispose()
        }
    }
    ;
    function se(a, b, c, d, e, f, g) {
        function h() {
            return WALK.DETECTOR.ios && void 0 !== DeviceMotionEvent && "function" === typeof DeviceMotionEvent.requestPermission && void 0 !== DeviceOrientationEvent && "function" === typeof DeviceOrientationEvent.requestPermission ? new Promise(function(a, b) {
                Promise.all([DeviceMotionEvent.requestPermission(), DeviceOrientationEvent.requestPermission()]).then(function(c) {
                    "granted" === c[0] && "granted" === c[1] ? a() : b()
                }, function() {
                    b()
                })
            }
            ) : Promise.resolve()
        }
        function l() {
            q = null;
            A.dispose();
            u = r = w = A = null;
            b.removeAllXrGamepads();
            g(!1);
            if (z) {
                var a = z;
                z = null;
                a()
            }
        }
        function m(a) {
            for (var c = k.makeIterator(a.removed), d = c.next(); !d.done; d = c.next())
                d = d.value,
                d.gamepad && b.removeXrGamepad(d.gamepad);
            a = k.makeIterator(a.added);
            for (d = a.next(); !d.done; d = a.next())
                c = d.value,
                c.gamepad && b.addXrGamepad(c.gamepad, c.handedness)
        }
        var n = navigator.xr, p = c ? !c.nativeWebXR : !1, q, r, u, v = !1, w, x, y, z = null, A, B = new t.Matrix4, H = WALK.CAMERA_MIN_FAR;
        this.setCameraFar = function(a) {
            H = a;
            q && (w.depthFar = H,
            q.updateRenderState(w))
        }
        ;
        this.render = function(b, c, d) {
            y.set(!1, !0, !1);
            x.matrixWorld = c;
            c = x.projectionMatrix;
            for (var e = u.views, f = 0; f < e.length; ++f) {
                var g = e[f];
                B.fromArray(g.transform.inverse.matrix);
                c.fromArray(u.transform.matrix);
                B.multiply(c);
                c.fromArray(g.projectionMatrix);
                c.multiply(B);
                d(x);
                a.enableScissorTest(!0);
                g = w.baseLayer.getViewport(g);
                a.setScissor(g.x, g.y, g.width, g.height);
                A.x = g.x;
                A.y = g.y;
                A.width = g.width;
                A.height = g.height;
                a.render(b, x, A);
                a.enableScissorTest(!1)
            }
            y.restore()
        }
        ;
        this.enableVr = function(b) {
            n ? v ? (f(!0),
            h().then(function() {
                return b.makeXRCompatible().then(function() {
                    return navigator.xr.requestSession("immersive-vr", {
                        requiredFeatures: ["local-floor"]
                    })
                }).then(function(a) {
                    q = a;
                    return q.requestReferenceSpace("local-floor")
                }).then(function(c) {
                    r = c;
                    c = new XRWebGLLayer(q,b);
                    A = a.createFrameBufferRenderTarget(c.framebuffer);
                    w = {
                        baseLayer: c
                    };
                    x || (x = new t.PerspectiveCamera,
                    y = new xc(a));
                    w.depthNear = WALK.CAMERA_WALK_NEAR;
                    w.depthFar = H;
                    q.updateRenderState(w);
                    q.addEventListener("end", l);
                    p || q.addEventListener("inputsourceschange", m);
                    f(!1);
                    g(!0)
                }).catch(function() {
                    f(!1);
                    Ba.info("Failed to enable VR mode")
                })
            }).catch(function() {
                f(!1);
                Ba.info("Permissions necessary for VR mode not granted")
            })) : Ba.info("VR device not connected") : Ba.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')
        }
        ;
        this.disableVr = function() {
            q.end().then(function() {
                Ba.hideInfo()
            }, function() {
                Ba.info("Failed to exit VR mode")
            })
        }
        ;
        this.vrEnabled = function() {
            return !!r
        }
        ;
        this.requestAnimationFrame = function() {
            function a(a, b) {
                u = b.getViewerPose(r);
                z && (b = z,
                z = null,
                b(a))
            }
            return function(b) {
                z = b;
                q.requestAnimationFrame(a)
            }
        }();
        this.update = function() {
            var a = new WALK.Euler
              , b = new t.Vector3;
            return function() {
                if (u) {
                    var c = u.transform;
                    if (null !== c.orientation) {
                        a.setFromQuaternion(c.orientation, "YXZ");
                        var d = a.y;
                        a.y = -a.z;
                        a.z = d;
                        c = c.position;
                        e(a, c && b.set(c.x, -c.z, c.y, c.w))
                    }
                }
            }
        }();
        (WALK.DETECTOR.https || WALK.DETECTOR.localhost) && n ? (c = function() {
            navigator.xr.isSessionSupported("immersive-vr").then(function(a) {
                v = a;
                d(a)
            })
        }
        ,
        c(),
        navigator.xr.addEventListener("devicechange", c, !1)) : d(!1)
    }
    ;var te = function() {
        var a = new t.Vector3;
        return function(b, c, d) {
            a.copy(b);
            a.sub(c).normalize();
            a.multiplyScalar(d);
            return b.sub(a)
        }
    }();
    function ue(a, b, c) {
        var d = this
          , e = new t.Octree({
            scene: null,
            depthMax: Infinity,
            objectsThreshold: 8,
            overlapPct: .15
        })
          , f = c.cameraWorldPosition()
          , g = b.camera
          , h = [];
        this.addStaticObstacle = function(a, b, c) {
            e.add(a, b, c)
        }
        ;
        this.addDynamicObstacle = function(a) {
            h.push(a)
        }
        ;
        this.removeDynamicObstacle = function(a) {
            WALK.removeFromArray(a, h)
        }
        ;
        var l = function() {
            var b = new Bc(a,g);
            return function(a, c) {
                for (var d = e.search(a.ray.origin, a.far, a.ray.direction), f = 0; f < h.length; f += 1)
                    d.push(h[f]);
                return b.closestIntersection(d, a, c) ? !0 : !1
            }
        }()
          , m = function() {
            var a = new Ac;
            return function(b) {
                return l(b, a) ? a.distance : Infinity
            }
        }()
          , n = function() {
            var a = new zc;
            a.ray.direction.set(0, 0, -1);
            a.respectColliderSettings = !0;
            a.onlyGroundCollisions = g.autoClimb;
            return function(b, c) {
                a.ray.origin.copy(b);
                a.far = c;
                b = m(a);
                return g.autoClimb || 1 <= b ? b : Infinity
            }
        }();
        this.distanceToGround = function(a) {
            return n(f, a)
        }
        ;
        this.findIntersectionBelow = function() {
            var a = new zc;
            a.ray.direction.set(0, 0, -1);
            a.respectColliderSettings = !1;
            return function(b, c, d) {
                a.ray.origin.copy(b);
                a.far = c;
                return l(a, d)
            }
        }();
        this.distanceToCeiling = function() {
            var a = new zc(f);
            a.ray.direction.set(0, 0, 1);
            a.respectColliderSettings = !0;
            return function(b) {
                a.far = b;
                return m(a)
            }
        }();
        this.distanceToCeilingFrom = function() {
            var a = new zc;
            a.ray.direction.set(0, 0, 1);
            a.respectColliderSettings = !0;
            return function(b, c) {
                a.ray.origin.copy(b);
                a.far = c;
                return m(a)
            }
        }();
        this.cameraHeightFromPoint = function(a) {
            a = n(a, WALK.MAX_GROUND_SEARCH_DEPTH);
            return Infinity === a ? null : a
        }
        ;
        this.adjustPointToMatchCameraHeight = function(a) {
            var b = g.fixedHeight || WALK.CAMERA_FIXED_HEIGHT || c.cameraHeight;
            if (null === b)
                return !1;
            var d = n(a, WALK.MAX_GROUND_SEARCH_DEPTH);
            if (Infinity === d)
                return !1;
            b -= d;
            if (.01 > Math.abs(b) || 0 < b && Infinity !== this.distanceToCeilingFrom(a, b + WALK.MIN_DISTANCE_TO_CEILING))
                return !1;
            a.z += b;
            return !0
        }
        ;
        this.findIntersectionAtPosition = function() {
            var a = new zc(f)
              , b = a.ray.direction;
            return function(d, e, g, h) {
                b.set(d, e, 1).unproject(c.camera());
                b.sub(f).normalize();
                a.respectColliderSettings = g;
                return l(a, h)
            }
        }();
        this.findObstacleMeshAtPosition = function() {
            var a = new Ac;
            return function(b, c, d) {
                return this.findIntersectionAtPosition(b, c, d, a) ? a.object : null
            }
        }();
        this.findMeshFromListAtPosition = function() {
            var b = new zc(f)
              , c = new Ac
              , d = new Bc(a,g)
              , e = b.ray.direction;
            return function(a, h, l, m, n) {
                b.ignoreVisibility = void 0 === m ? !1 : m;
                m = void 0 === n ? c : n;
                e.set(h, l, 1).unproject(g);
                e.sub(f).normalize();
                return d.closestIntersection(a, b, m) ? m.object : null
            }
        }();
        this.clickedPointToMoveTarget = function() {
            function a(f) {
                var m = c.x - h.x;
                var n = c.y - h.y;
                m = Math.sqrt(m * m + n * n);
                b.far = m + WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;
                e.x = h.x - c.x;
                e.y = h.y - c.y;
                if (!(.01 > Math.abs(e.x) && .01 > Math.abs(e.y)))
                    if (e.z = 0,
                    e.normalize(),
                    l(b, g)) {
                        if (n = g.distance - WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,
                        0 < n && (f.x = c.x + e.x * n,
                        f.y = c.y + e.y * n,
                        f.z = c.z),
                        n = Math.min(g.distance - .01, m),
                        c.x += e.x * n,
                        c.y += e.y * n,
                        d.adjustPointToMatchCameraHeight(c))
                            return a(f)
                    } else
                        f.x = h.x,
                        f.y = h.y,
                        f.z = c.z
            }
            var b = new zc;
            b.respectColliderSettings = !0;
            var c = b.ray.origin
              , e = b.ray.direction
              , g = new Ac
              , h = new t.Vector3;
            return function(b) {
                c.copy(f);
                h.copy(b);
                b.copy(f);
                a(b);
                d.adjustPointToMatchCameraHeight(b)
            }
        }();
        this.movePointTowardsTheCamera = function(a, b) {
            return te(a, f, b)
        }
        ;
        this.handleCollisions = function() {
            function a(a) {
                c.applyCameraYaw(d);
                d.normalize();
                var l = e.start.distanceTo(f)
                  , n = e.end.distanceTo(f);
                if (h - .02 < l + n && l + n < h + .02 && n >= a && g.equals(d))
                    return !1;
                l = m(b);
                Infinity === l && (l = b.far);
                g.copy(d);
                e.start.copy(f);
                e.end.copy(d).multiplyScalar(l).add(f);
                h = e.distance();
                return l < a
            }
            var b = new zc(f)
              , d = b.ray.direction
              , e = new t.Line3
              , g = new t.Vector3
              , h = 0;
            b.respectColliderSettings = !0;
            b.far = 5;
            console.assert(b.far > WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);
            return function(b) {
                b = c.maxFrameMoveLinearDistance(b) + WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;
                c.movesForward() && (d.set(0, 1, 0),
                a(b) && c.stopForward());
                c.movesBackward() && (d.set(0, -1, 0),
                a(b) && c.stopBackward());
                c.movesLeft() && (d.set(-1, 0, 0),
                a(b) && c.stopLeft());
                c.movesRight() && (d.set(1, 0, 0),
                a(b) && c.stopRight());
                c.movesDown() && (d.set(0, 0, -1),
                a(b) && c.stopDown());
                c.movesUp() && (d.set(0, 0, 1),
                a(b) && c.stopUp())
            }
        }()
    }
    ;function ve(a, b, c, d) {
        function e(a, b) {
            r.collider && r.mouseZoomToPointer && r.collider.findIntersectionAtPosition(a / window.innerWidth * 2 - 1, 2 * -(b / window.innerHeight) + 1, !0, v) ? I.copy(v.point) : I.copy(r.target)
        }
        function f() {
            var c = b.getYawAngle()
              , e = b.getPitchAngle()
              , f = b.cameraWorldPosition();
            r.autoRotate && U === N.NONE && r.rotateLeft(2 * Math.PI / 60 / 60 * r.autoRotateSpeed);
            var g = r.getMinYawAngle()
              , h = r.getMaxYawAngle();
            Math.abs(h - g) >= 2 * Math.PI - 1E-6 ? c += F : g === h ? c = g : (g > h && (h += 2 * Math.PI,
            c < g && (c += 2 * Math.PI)),
            c = 0 > F ? Math.min(Math.max(c + F, g), h) : Math.max(Math.min(c + F, h), g));
            e = t.Math.clamp(e + D, r.getMinPitchAngle(), r.getMaxPitchAngle());
            M.copy(r.target).sub(f);
            h = M.length();
            g = t.Math.clamp(h * E, r.getMinDistance(), r.getMaxDistance());
            h = g / h;
            O.copy(I).sub(f);
            K.copy(I).sub(r.target).multiplyScalar(1 - h);
            r.target.add(K);
            r.target.add(S);
            ve.computeCameraPosition(f, r.target, c, e, g);
            b.cameraPositionUpdated();
            b.setYawAngle(c);
            b.setPitchAngle(e);
            c = ve.computeCameraNear(g);
            1E-6 < Math.abs(c - a.near) && (a.near = c,
            a.updateProjectionMatrix());
            D = F = 0;
            E = 1;
            S.set(0, 0, 0);
            d.requestFrame()
        }
        function g() {
            ia = Y = da = ha = R = 0;
            ba && (ba(),
            ba = !1)
        }
        function h(a) {
            if (!1 !== u) {
                a.preventDefault();
                var b = c === document ? c.body : c;
                if (U === N.ROTATE) {
                    if (!0 === r.noRotate)
                        return;
                    x.set(a.clientX, a.clientY);
                    y.subVectors(x, w);
                    r.rotateLeft(y.x / b.clientWidth * r.mouseRotateSpeed);
                    !1 === r.noPitchRotate && r.rotateUp(y.y / b.clientHeight * r.mouseRotateSpeed);
                    w.copy(x)
                } else if (U === N.DOLLY) {
                    if (!0 === r.noZoom)
                        return;
                    L.set(a.clientX, a.clientY);
                    G.subVectors(L, C);
                    0 < G.y ? r.dollyIn() : 0 > G.y && r.dollyOut();
                    C.copy(L)
                } else if (U === N.PAN) {
                    if (!0 === r.getNoPan())
                        return;
                    A.set(a.clientX, a.clientY);
                    B.subVectors(A, z);
                    r.pan(B.x / b.clientHeight, B.y / b.clientWidth);
                    z.copy(A)
                }
                U !== N.NONE && f()
            }
        }
        function l() {
            !1 !== u && ba && (ba(),
            ba = !1)
        }
        function m(a) {
            if (!1 !== u && !0 !== r.noZoom && U === N.NONE) {
                a.preventDefault();
                var b = 0;
                void 0 !== a.wheelDelta ? b = a.wheelDelta : void 0 !== a.detail && (b = -a.detail);
                e(a.clientX, a.clientY);
                0 < b ? r.dollyOut() : 0 > b && r.dollyIn();
                f()
            }
        }
        function n(a, b, c) {
            return !0 === c ? b : a === b ? 0 : a
        }
        function p(a, b) {
            var c = !1
              , e = a.keyCode;
            if (!1 !== u) {
                if (!0 === Z && !1 === r.getNoPan())
                    if (38 === e || 87 === e)
                        Y = n(Y, 1, b),
                        c = !0;
                    else if (40 === e || 83 === e)
                        Y = n(Y, -1, b),
                        c = !0;
                    else if (37 === e || 65 === e)
                        ia = n(ia, 1, b),
                        c = !0;
                    else {
                        if (39 === e || 68 === e)
                            ia = n(ia, -1, b),
                            c = !0
                    }
                else if (!1 === Z && !1 === r.noRotate)
                    if ((38 === e || 87 === e) && !1 === r.noPitchRotate)
                        ha = n(ha, 1, b),
                        c = !0;
                    else if ((40 === e || 83 === e) && !1 === r.noPitchRotate)
                        ha = n(ha, -1, b),
                        c = !0;
                    else if (37 === e || 65 === e)
                        da = n(da, 1, b),
                        c = !0;
                    else if (39 === e || 68 === e)
                        da = n(da, -1, b),
                        c = !0;
                switch (e) {
                case r.dollyKeys.IN1:
                case r.dollyKeys.IN2:
                case r.dollyKeys.IN3:
                    !1 === r.noZoom && (R = n(R, 1, b),
                    c = !0);
                    break;
                case r.dollyKeys.OUT1:
                case r.dollyKeys.OUT2:
                case r.dollyKeys.OUT3:
                    !1 === r.noZoom && (R = n(R, -1, b),
                    c = !0)
                }
                c && (a.preventDefault(),
                d.requestFrame())
            }
        }
        function q(a) {
            return r.getNoPan() ? !1 : Z && 1 === a.length ? !0 : Z || 2 !== a.length ? !1 : Math.abs(a[0].clientY - a[1].clientY) <= WALK.MAX_TWO_POINTERS_IN_LINE_DIFF
        }
        this.collider = null;
        this.target = new t.Vector3;
        this.noZoom = !1;
        this.mouseZoomToPointer = !0;
        this.mouseZoomSpeed = .97;
        this.keyZoomSpeed = .7;
        this.minZoom = 0;
        this.maxZoom = Infinity;
        this.noPitchRotate = this.noRotate = !1;
        this.mouseRotateSpeed = 2 * Math.PI;
        this.keyYawRotateSpeed = WALK.CAMERA_ARROWS_TURN_SPEED;
        this.keyPitchRotateSpeed = WALK.CAMERA_ARROWS_TURN_SPEED / 2;
        this.autoRotate = !1;
        this.autoRotateSpeed = 2;
        this.getMinPitchAngle = function() {
            return -Math.PI / 2
        }
        ;
        this.getMaxPitchAngle = function() {
            return Math.PI / 2
        }
        ;
        this.getMinYawAngle = function() {
            return -Math.PI
        }
        ;
        this.getMaxYawAngle = function() {
            return Math.PI
        }
        ;
        this.getMinDistance = function() {
            return 0
        }
        ;
        this.getMaxDistance = function() {
            return Infinity
        }
        ;
        this.getNoPan = function() {
            return !1
        }
        ;
        this.keyPanSpeed = .25;
        this.dollyKeys = {
            IN1: 61,
            IN2: 187,
            IN3: 69,
            OUT1: 173,
            OUT2: 189,
            OUT3: 81
        };
        this.primaryMouseButton = t.MOUSE.LEFT;
        this.secondaryMouseButton = t.MOUSE.RIGHT;
        this.mouseButtons = {
            ROTATE: this.primaryMouseButton,
            ZOOM: t.MOUSE.MIDDLE,
            PAN: this.secondaryMouseButton
        };
        var r = this
          , u = !1
          , v = new Ac
          , w = new t.Vector2
          , x = new t.Vector2
          , y = new t.Vector2
          , z = new t.Vector2
          , A = new t.Vector2
          , B = new t.Vector2
          , H = new t.Vector3
          , C = new t.Vector2
          , L = new t.Vector2
          , G = new t.Vector2
          , I = new t.Vector3
          , M = new t.Vector3
          , O = new t.Vector3
          , K = new t.Vector3
          , F = 0
          , D = 0
          , E = 1
          , S = new t.Vector3
          , Z = !1
          , R = 0
          , da = 0
          , ha = 0
          , ia = 0
          , Y = 0
          , N = {
            NONE: -1,
            ROTATE: 0,
            DOLLY: 1,
            PAN: 2,
            TOUCH_ROTATE: 3,
            TOUCH_DOLLY: 4,
            TOUCH_PAN: 5
        }
          , U = N.NONE
          , ba = !1;
        this.enable = function() {
            u = !0;
            f()
        }
        ;
        this.disable = function() {
            u = !1;
            g()
        }
        ;
        this.isEnabled = function() {
            return u
        }
        ;
        this.setPanPrimary = function(a) {
            Z = a;
            !0 === Z ? (this.mouseButtons.PAN = this.primaryMouseButton,
            this.mouseButtons.ROTATE = this.secondaryMouseButton) : (this.mouseButtons.ROTATE = this.primaryMouseButton,
            this.mouseButtons.PAN = this.secondaryMouseButton)
        }
        ;
        this.getCameraDistance = function() {
            var a = new t.Vector3;
            return function() {
                a.copy(b.cameraWorldPosition()).sub(this.target);
                return a.length()
            }
        }();
        this.rotateLeft = function(a) {
            void 0 === a && (a = 2 * Math.PI / 60 / 60 * r.autoRotateSpeed);
            F -= a
        }
        ;
        this.rotateUp = function(a) {
            void 0 === a && (a = 2 * Math.PI / 60 / 60 * r.autoRotateSpeed);
            D -= a
        }
        ;
        this.panLeft = function(b) {
            var c = a.matrixWorld.elements;
            H.set(c[0], c[1], c[2]);
            H.multiplyScalar(-b);
            S.add(H)
        }
        ;
        this.panUp = function(b) {
            var c = a.matrixWorld.elements;
            H.set(c[4], c[5], c[6]);
            H.multiplyScalar(b);
            S.add(H)
        }
        ;
        this.pan = function(c, d) {
            if (a instanceof t.PerspectiveCamera) {
                var e = b.cameraWorldPosition().clone().sub(r.target).length();
                e *= Math.tan(a.fov / 2 * Math.PI / 180);
                r.panLeft(2 * c * e);
                r.panUp(2 * d * e)
            } else
                a instanceof t.OrthographicCamera && (r.panLeft(c * (a.right - a.left)),
                r.panUp(d * (a.top - a.bottom)))
        }
        ;
        this.dollyIn = function(b) {
            void 0 === b && (b = this.mouseZoomSpeed);
            a instanceof t.PerspectiveCamera ? E /= b : a instanceof t.OrthographicCamera && (a.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, a.zoom * b)),
            a.updateProjectionMatrix())
        }
        ;
        this.dollyOut = function(b) {
            void 0 === b && (b = this.mouseZoomSpeed);
            a instanceof t.PerspectiveCamera ? E *= b : a instanceof t.OrthographicCamera && (a.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, a.zoom / b)),
            a.updateProjectionMatrix())
        }
        ;
        this.update = function(a) {
            if (u && a) {
                var b = !1;
                0 !== da && (r.rotateLeft(da * r.keyYawRotateSpeed * a),
                b = !0);
                0 !== ha && (r.rotateUp(ha * r.keyPitchRotateSpeed * a),
                b = !0);
                if (0 !== ia || 0 !== Y)
                    r.pan(ia * r.keyPanSpeed * a, Y * r.keyPanSpeed * a),
                    b = !0;
                0 !== R && (a = Math.pow(r.keyZoomSpeed, a),
                -1 === R ? r.dollyIn(a) : r.dollyOut(a),
                b = !0);
                b && f()
            }
        }
        ;
        c.addEventListener("mousedown", function(a) {
            if (!1 !== u) {
                c.focus();
                a.preventDefault();
                if (a.button === r.mouseButtons.ROTATE) {
                    if (!0 === r.noRotate)
                        return;
                    U = N.ROTATE;
                    w.set(a.clientX, a.clientY)
                } else if (a.button === r.mouseButtons.ZOOM) {
                    if (!0 === r.noZoom)
                        return;
                    U = N.DOLLY;
                    C.set(a.clientX, a.clientY);
                    e(a.clientX, a.clientY)
                } else if (a.button === r.mouseButtons.PAN) {
                    if (!0 === r.getNoPan())
                        return;
                    U = N.PAN;
                    z.set(a.clientX, a.clientY)
                }
                U !== N.NONE && (document.addEventListener("mousemove", h, !1),
                document.addEventListener("mouseup", l, !1),
                ba = function() {
                    document.removeEventListener("mousemove", h, !1);
                    document.removeEventListener("mouseup", l, !1);
                    U = N.NONE
                }
                )
            }
        }, !1);
        c.addEventListener("mousewheel", m, !1);
        c.addEventListener("DOMMouseScroll", m, !1);
        c.addEventListener("touchstart", function(a) {
            if (!1 !== u) {
                var b = a.touches.length;
                a.preventDefault();
                if (q(a.touches))
                    U = N.TOUCH_PAN,
                    z.set(a.touches[0].clientX, a.touches[0].clientY);
                else if (r.noRotate || Z || 1 !== b)
                    if (r.noZoom || 2 !== b)
                        U = N.NONE;
                    else {
                        U = N.TOUCH_DOLLY;
                        b = a.touches[0].clientX - a.touches[1].clientX;
                        var c = a.touches[0].clientY - a.touches[1].clientY;
                        C.set(0, Math.sqrt(b * b + c * c));
                        e(a.touches[0].clientX - b / 2, a.touches[0].clientY - c / 2)
                    }
                else
                    U = N.TOUCH_ROTATE,
                    w.set(a.touches[0].clientX, a.touches[0].clientY)
            }
        }, !1);
        c.addEventListener("touchend", function() {
            !1 !== u && (U = N.NONE)
        }, !1);
        c.addEventListener("touchmove", function(a) {
            if (!1 !== u) {
                var b = a.touches.length;
                a.preventDefault();
                var d = c === document ? c.body : c;
                q(a.touches) && U === N.TOUCH_PAN ? (A.set(a.touches[0].clientX, a.touches[0].clientY),
                B.subVectors(A, z),
                r.pan(B.x / d.clientHeight, B.y / d.clientWidth),
                z.copy(A),
                f()) : r.noRotate || Z || 1 !== b || U !== N.TOUCH_ROTATE ? r.noZoom || 2 !== b || U !== N.TOUCH_DOLLY ? U = N.NONE : (b = a.touches[0].clientX - a.touches[1].clientX,
                a = a.touches[0].clientY - a.touches[1].clientY,
                L.set(0, Math.sqrt(b * b + a * a)),
                G.subVectors(L, C),
                0 < G.y ? r.dollyOut() : 0 > G.y && r.dollyIn(),
                C.copy(L),
                f()) : (x.set(a.touches[0].clientX, a.touches[0].clientY),
                y.subVectors(x, w),
                r.rotateLeft(y.x / d.clientWidth * r.mouseRotateSpeed),
                r.rotateUp(y.y / d.clientHeight * r.mouseRotateSpeed),
                w.copy(x),
                f())
            }
        }, !1);
        c.addEventListener("blur", function() {
            g()
        }, !1);
        c.addEventListener("keydown", function(a) {
            WALK.isModifierPressed(a) || p(a, !0)
        }, !1);
        c.addEventListener("keyup", function(a) {
            p(a, !1)
        }, !1);
        a instanceof t.PerspectiveCamera || a instanceof t.OrthographicCamera || console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")
    }
    ve.prototype.constructor = ve;
    ve.computeCameraPosition = function() {
        var a = new t.Vector3;
        return function(b, c, d, e, f) {
            d -= Math.PI / 2;
            e += Math.PI / 2;
            a.x = f * Math.sin(e) * Math.cos(d);
            a.y = f * Math.sin(e) * Math.sin(d);
            a.z = f * Math.cos(e);
            b.copy(c).add(a)
        }
    }();
    ve.computeCameraNear = function(a) {
        return a * WALK.CAMERA_ORBIT_NEAR_FROM_1M
    }
    ;
    function we(a, b, c, d) {
        function e(a) {
            this.activeDirection = 0;
            this.activeSource = x;
            this.speed = 0;
            this.moves = function() {
                return this.activeDirection || this.speed
            }
            ;
            this.movesInDirection = function(a) {
                return this.activeDirection === a || Math.sign(this.speed) === a
            }
            ;
            this.activateDirectionFromSource = function(a, b) {
                this.activeDirection = a;
                this.activeSource = b
            }
            ;
            this.deactivateDirectionFromSource = function(a, b) {
                this.activeDirection === a && this.activeSource === b && (this.activeDirection = 0,
                this.activeSource = b)
            }
            ;
            this.deactivateSource = function(a) {
                this.activeSource === a && (this.activeDirection = 0,
                this.activeSource = x)
            }
            ;
            this.stopInDirection = function(a) {
                this.activeDirection === a && (this.activeDirection = 0,
                this.activeSource = x);
                Math.sign(this.speed) === a && (this.speed = 0)
            }
            ;
            this.update = function(b, c) {
                if (!this.moves())
                    return 0;
                var d = Math.sign(this.speed)
                  , e = this.activeDirection || -d;
                e = c * e * (d === e ? b / WALK.CAMERA_FULL_ACCELERATION_TIME : b / WALK.CAMERA_FULL_DECELERATION_TIME);
                c *= this.speed + e / 2;
                this.speed = t.Math.clamp(this.speed + e, -b, b);
                this.activeDirection || Math.sign(this.speed) === d || (this.speed = 0);
                return t.Math.clamp(c, -a, a)
            }
        }
        function f() {
            N.rotation.z = WALK.normalizeRotation(W.z + ba.z)
        }
        function g() {
            f();
            Y.rotation.x = WALK.normalizeRotation(W.x + ba.x);
            ia.rotation.y = W.y;
            N.updateMatrixWorld(!0)
        }
        function h(a) {
            return Math.abs(a[0].y - a[1].y) <= WALK.MAX_TWO_POINTERS_IN_LINE_DIFF
        }
        function l(a) {
            M[0].copy(I[0]);
            M[1].copy(I[1]);
            a.touches ? (I[0].set(a.touches[0].clientX, a.touches[0].clientY),
            2 === a.touches.length ? I[1].set(a.touches[1].clientX, a.touches[1].clientY) : I[1].set(0, 0)) : (I[0].set(a.clientX, a.clientY),
            I[1].set(0, 0))
        }
        function m(a) {
            if (v)
                if (a.preventDefault(),
                l(a),
                S) {
                    if (S !== E) {
                        if (S === K) {
                            var b = Z[0].distanceTo(Z[1]);
                            a = I[0].distanceTo(I[1]);
                            10 <= Math.abs(a - b) ? (S = F,
                            b = !0) : h(I) && h(Z) && 10 <= Math.abs(I[0].y - Z[0].y) ? (S = D,
                            b = !0) : b = !1;
                            if (!b)
                                return
                        }
                        S === F ? (b = M[1].distanceTo(M[0]),
                        b = I[1].distanceTo(I[0]) - b,
                        0 < Math.abs(b) && (R = Date.now(),
                        C.activateDirectionFromSource(Math.sign(b), z)),
                        d.requestFrame()) : S === D && h(I) && (b = I[0].y - M[0].y,
                        0 < Math.abs(b) && (da = Date.now(),
                        L.activateDirectionFromSource(Math.sign(b), z)),
                        d.requestFrame())
                    }
                } else if (!u.mousePressLook || ha || !S && a.touches) {
                    b = a.movementX || a.mozMovementX || a.webkitMovementX;
                    void 0 === b && (b = I[0].x - M[0].x);
                    var c = a.movementY || a.mozMovementY || a.webkitMovementY;
                    void 0 === c && (c = I[0].y - M[0].y);
                    a = u.flipMouseLook || !S && a.touches ? 1 : -1;
                    la.x += a * b * WALK.CAMERA_LOOK_SPEED;
                    u.mouseControlsPitch && (la.y += a * c * WALK.CAMERA_LOOK_SPEED);
                    d.requestFrame()
                }
        }
        function n(a) {
            v && (b.focus(),
            a.preventDefault(),
            l(a),
            ha = !0,
            d.requestFrame())
        }
        function p(a) {
            v && (a.preventDefault(),
            ha = !1)
        }
        function q(a) {
            var c = 0, e;
            (e = !v) || (e = void 0 !== document.hasFocus ? document.hasFocus() : document.activeElement === b,
            e = !e);
            e || (a || (a = window.event),
            a.preventDefault(),
            a.wheelDelta ? c = a.wheelDelta / 120 : a.detail && (c = -a.detail / 3),
            O += c * WALK.CAMERA_SCROLL_SPEED,
            O = 0 <= O ? Math.min(O, .5) : Math.max(O, -.5),
            d.requestFrame())
        }
        function r() {
            u.stopForward();
            u.stopBackward();
            u.stopLeft();
            u.stopRight();
            u.stopUp();
            u.stopDown();
            G.stopInDirection(1);
            G.stopInDirection(-1)
        }
        var u = this
          , v = !0
          , w = Math.PI / 12;
        k.initSymbol();
        var x = Symbol("MOVE_SOURCE_NONE");
        k.initSymbol();
        var y = Symbol("MOVE_SOURCE_KEY");
        k.initSymbol();
        var z = Symbol("MOVE_SOURCE_GESTURE");
        k.initSymbol();
        var A = Symbol("MOVE_SOURCE_GAMEPAD")
          , B = 1
          , H = new e(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)
          , C = new e(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)
          , L = new e(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)
          , G = new e(w)
          , I = [new t.Vector2(0,0), new t.Vector2(0,0)]
          , M = [new t.Vector2(0,0), new t.Vector2(0,0)]
          , O = 0;
        k.initSymbol();
        var K = Symbol("GESTURE_RECOGNITION");
        k.initSymbol();
        var F = Symbol("GESTURE_PINCH");
        k.initSymbol();
        var D = Symbol("GESTURE_TWO_POINTER_DRAG");
        k.initSymbol();
        var E = Symbol("GESTURE_IGNORE")
          , S = null
          , Z = [new t.Vector2(0,0), new t.Vector2(0,0)]
          , R = 0
          , da = 0
          , ha = !1
          , ia = new t.Object3D
          , Y = new t.Object3D
          , N = new t.Object3D
          , U = !1
          , ba = new t.Vector3(0,0,0)
          , W = new t.Euler(0,0,0)
          , ka = new t.Vector2
          , ca = new t.Vector2
          , la = new t.Vector2;
        ia.add(a);
        Y.add(ia);
        N.add(Y);
        this.flipMouseLook = this.mousePressLook = !1;
        this.restrictVerticalAngle = this.mouseControlsPitch = !0;
        this.verticalAngleMin = -Math.PI / 2;
        this.verticalAngleMax = Math.PI / 3;
        this.arrowsTurn = !0;
        this.orbit = new ve(a,this,b,d);
        this.cameraHeight = null;
        this.isFpsEnabled = function() {
            return v
        }
        ;
        this.isOrbitEnabled = function() {
            return this.orbit.isEnabled()
        }
        ;
        this.orbitModeEnable = function() {
            v = !1;
            this.orbit.enable()
        }
        ;
        this.camera = function() {
            return a
        }
        ;
        this.applyCameraYaw = function(a) {
            a.applyEuler(N.rotation)
        }
        ;
        this.cameraWorldPosition = function() {
            return N.position
        }
        ;
        this.cameraPositionUpdated = function() {
            var b = {
                type: "positionChanged",
                target: null
            }
              , c = null
              , d = null
              , e = null;
            return function() {
                N.updateMatrixWorld(!0);
                var f = N.position;
                if (c !== f.x || d !== f.y || e !== f.z)
                    c = f.x,
                    d = f.y,
                    e = f.z,
                    a.dispatchEvent(b)
            }
        }();
        this.resetRollAngle = function() {
            0 !== ia.rotation.y && (W.y = 0,
            g())
        }
        ;
        this.getPitchAngle = function() {
            return Y.rotation.x
        }
        ;
        this.setPitchAngle = function(a) {
            a !== Y.rotation.x && (ba.x = a,
            W.x = 0,
            g())
        }
        ;
        this.resetPitchAngle = function() {
            this.setPitchAngle(0)
        }
        ;
        this.getYawAngle = function() {
            return N.rotation.z
        }
        ;
        this.setYawAngle = function(a) {
            a !== N.rotation.z && (ba.z = a,
            W.z = 0,
            g())
        }
        ;
        this.resetYawAngle = function() {
            this.setYawAngle(0)
        }
        ;
        this.isHandlingGesture = function() {
            return null !== S
        }
        ;
        this.hmdReset = function() {
            U = !0;
            this.resetPitchAngle()
        }
        ;
        this.onHmdUpdate = function() {
            var a = new t.Vector3
              , b = new t.Vector3
              , c = new t.Vector3
              , d = new t.Vector3
              , e = new t.Vector3;
            return function(f, h) {
                v && (W.copy(f),
                U ? ba.z -= W.z : h && (d.subVectors(h, c),
                a.set(Math.cos(ba.z), Math.sin(ba.z), 0),
                b.set(-Math.sin(ba.z), Math.cos(ba.z), 0),
                e.copy(a.multiplyScalar(d.x)),
                e.add(b.multiplyScalar(d.y)),
                e.z = d.z,
                N.position.add(e)),
                h && c.copy(h),
                U = !1,
                g())
            }
        }();
        this.maxFrameMoveLinearDistance = function(b) {
            return Math.min(b * a.moveMaxSpeed * B, WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)
        }
        ;
        this.movesForward = function() {
            return C.movesInDirection(1) || 0 < O
        }
        ;
        this.stopForward = function() {
            0 < O && (O = 0);
            C.stopInDirection(1)
        }
        ;
        this.movesBackward = function() {
            return C.movesInDirection(-1) || 0 > O
        }
        ;
        this.stopBackward = function() {
            0 > O && (O = 0);
            C.stopInDirection(-1)
        }
        ;
        this.movesLeft = function() {
            return H.movesInDirection(-1)
        }
        ;
        this.stopLeft = function() {
            H.stopInDirection(-1)
        }
        ;
        this.movesRight = function() {
            return H.movesInDirection(1)
        }
        ;
        this.stopRight = function() {
            H.stopInDirection(1)
        }
        ;
        this.movesUp = function() {
            return L.movesInDirection(1)
        }
        ;
        this.stopUp = function() {
            L.stopInDirection(1)
        }
        ;
        this.movesDown = function() {
            return L.movesInDirection(-1)
        }
        ;
        this.stopDown = function() {
            L.stopInDirection(-1)
        }
        ;
        this.enable = function() {
            this.orbit.disable();
            v = !0;
            ha = 0
        }
        ;
        this.disable = function() {
            this.orbit.disable();
            v = !1;
            r()
        }
        ;
        this.update = function(b) {
            if (v) {
                1E-4 < ca.distanceTo(la) ? (ca.lerp(la, Math.min(b / WALK.CAMERA_LOOK_SMOOTHING, 1)),
                ba.z += ca.x - ka.x,
                ba.x += ca.y - ka.y,
                u.restrictVerticalAngle && (ba.x > u.verticalAngleMax ? ba.x = u.verticalAngleMax : ba.x < u.verticalAngleMin && (ba.x = u.verticalAngleMin)),
                g(),
                ka.copy(ca),
                d.requestFrame()) : (ka.set(0, 0),
                ca.set(0, 0),
                la.set(0, 0));
                C.activeSource === z && 100 < Date.now() - R && C.deactivateSource(z);
                L.activeSource === z && 100 < Date.now() - da && L.deactivateSource(z);
                var c = H.update(a.moveMaxSpeed * B, b)
                  , e = C.update(a.moveMaxSpeed * B, b)
                  , h = L.update(a.moveMaxSpeed * B, b);
                var l = 0;
                e ? O = 0 : (O && (e = u.maxFrameMoveLinearDistance(b),
                l = t.Math.clamp(O, -e, e),
                O -= l),
                e = l);
                N.translateX(c);
                N.translateY(e);
                N.translateZ(h);
                b = G.update(WALK.CAMERA_ARROWS_TURN_SPEED, b);
                ba.z += b;
                f();
                (H.moves() || C.moves() || L.moves() || G.moves() || O) && d.requestFrame();
                this.cameraPositionUpdated()
            } else
                this.orbit.update(b)
        }
        ;
        a.rotation.set(0, 0, 0);
        a.up.set(0, 0, 1);
        a.lookAt(new t.Vector3(0,1,0));
        b.setAttribute("tabindex", -1);
        b.addEventListener("contextmenu", function(a) {
            a.preventDefault()
        }, !1);
        b.addEventListener("mousedown", n, !1);
        b.addEventListener("touchstart", function(a) {
            v && (a.preventDefault(),
            l(a),
            2 === a.touches.length ? (S = K,
            Z[0].copy(I[0]),
            Z[1].copy(I[1])) : 2 < a.touches.length && (S = E))
        }, !1);
        b.addEventListener("mousemove", m, !1);
        b.addEventListener("touchmove", m, !1);
        b.addEventListener("mouseup", p, !1);
        b.addEventListener("touchend", function(a) {
            v && (a.preventDefault(),
            S = 0 === a.touches.length ? null : E)
        }, !1);
        b.addEventListener("keydown", function(a) {
            var b = !0;
            if (v && !WALK.isModifierPressed(a)) {
                B = a.shiftKey ? WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR : 1;
                switch (a.keyCode) {
                case 38:
                case 32:
                case 87:
                    C.activateDirectionFromSource(1, y);
                    break;
                case 37:
                    u.arrowsTurn ? G.activateDirectionFromSource(1, y) : H.activateDirectionFromSource(-1, y);
                    break;
                case 65:
                    H.activateDirectionFromSource(-1, y);
                    break;
                case 40:
                case 83:
                    C.activateDirectionFromSource(-1, y);
                    break;
                case 39:
                    u.arrowsTurn ? G.activateDirectionFromSource(-1, y) : H.activateDirectionFromSource(1, y);
                    break;
                case 68:
                    H.activateDirectionFromSource(1, y);
                    break;
                case 33:
                case 69:
                    L.activateDirectionFromSource(1, y);
                    break;
                case 34:
                case 81:
                    L.activateDirectionFromSource(-1, y);
                    break;
                default:
                    b = !1
                }
                b && (a.preventDefault(),
                d.requestFrame())
            }
        }, !1);
        b.addEventListener("keyup", function(a) {
            var b = !0;
            if (v) {
                B = a.shiftKey ? WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR : 1;
                switch (a.keyCode) {
                case 38:
                case 32:
                case 87:
                    C.deactivateDirectionFromSource(1, y);
                    break;
                case 37:
                case 65:
                    G.deactivateDirectionFromSource(1, y);
                    H.deactivateDirectionFromSource(-1, y);
                    break;
                case 40:
                case 83:
                    C.deactivateDirectionFromSource(-1, y);
                    break;
                case 39:
                case 68:
                    G.deactivateDirectionFromSource(-1, y);
                    H.deactivateDirectionFromSource(1, y);
                    break;
                case 33:
                case 69:
                    L.deactivateDirectionFromSource(1, y);
                    break;
                case 34:
                case 81:
                    L.deactivateDirectionFromSource(-1, y);
                    break;
                default:
                    b = !1
                }
                b && a.preventDefault()
            }
        }, !1);
        b.addEventListener("mouseout", function(a) {
            p(a)
        }, !1);
        b.addEventListener("mouseenter", function(a) {
            0 < a.buttons && n(a)
        }, !1);
        b.addEventListener("DOMMouseScroll", q, !1);
        b.addEventListener("mousewheel", q, !1);
        b.addEventListener("blur", function() {
            r()
        }, !1);
        c.addEventListener("actionActivated", function(a) {
            if (v)
                switch (a.action) {
                case WALK.GAMEPAD_ACTION.BACKWARD:
                    C.activateDirectionFromSource(-1, A);
                    break;
                case WALK.GAMEPAD_ACTION.FORWARD:
                    C.activateDirectionFromSource(1, A);
                    break;
                case WALK.GAMEPAD_ACTION.LEFT:
                    u.arrowsTurn ? G.activateDirectionFromSource(1, A) : H.activateDirectionFromSource(-1, A);
                    break;
                case WALK.GAMEPAD_ACTION.RIGHT:
                    u.arrowsTurn ? G.activateDirectionFromSource(-1, A) : H.activateDirectionFromSource(1, A);
                    break;
                case WALK.GAMEPAD_ACTION.DOWN:
                    L.activateDirectionFromSource(-1, A);
                    break;
                case WALK.GAMEPAD_ACTION.UP:
                    L.activateDirectionFromSource(1, A)
                }
        });
        c.addEventListener("actionDeactivated", function(a) {
            if (v)
                switch (a.action) {
                case WALK.GAMEPAD_ACTION.BACKWARD:
                    C.deactivateDirectionFromSource(-1, A);
                    break;
                case WALK.GAMEPAD_ACTION.FORWARD:
                    C.deactivateDirectionFromSource(1, A);
                    break;
                case WALK.GAMEPAD_ACTION.LEFT:
                    H.deactivateDirectionFromSource(-1, A);
                    G.deactivateDirectionFromSource(1, A);
                    break;
                case WALK.GAMEPAD_ACTION.RIGHT:
                    H.deactivateDirectionFromSource(1, A);
                    G.deactivateDirectionFromSource(-1, A);
                    break;
                case WALK.GAMEPAD_ACTION.DOWN:
                    L.deactivateDirectionFromSource(-1, A);
                    break;
                case WALK.GAMEPAD_ACTION.UP:
                    L.deactivateDirectionFromSource(1, A)
                }
        });
        this.isEnabled = function() {
            return v
        }
    }
    ;function xe() {
        var a = new WALK.StandardMaterial;
        a.baseColor.setRGB(.298, .619, .851);
        a.highlight = (new t.Color).setRGB(.033, .125, .445);
        a.setUniforms();
        return a
    }
    function ye(a) {
        var b = new t.CylinderBufferGeometry(.05,.05,.011,32)
          , c = new t.CylinderBufferGeometry(.05,.03,.011,32,1,!1)
          , d = new t.CylinderBufferGeometry(0,.05,.2,32,1,!0);
        WALK.EDIT_MODE && (b.addTriangleOrderAttribute(),
        c.addTriangleOrderAttribute(),
        d.addTriangleOrderAttribute());
        var e = new t.Matrix4;
        e.makeRotationX(Math.PI / 2);
        b.applyMatrix(e);
        b.convertNormalsToSpherical();
        b = new t.Mesh(b,a);
        b.position.z += .0055;
        e.makeTranslation(0, -(.1 + .0055), 0);
        c.applyMatrix(e);
        c.convertNormalsToSpherical();
        c = new t.Mesh(c,a);
        d.convertNormalsToSpherical();
        a = new t.Mesh(d,a);
        a.add(c);
        a.rotateX(-Math.PI / 2);
        a.position.z = .158;
        d = new t.Object3D;
        d.add(b);
        d.add(a);
        return d
    }
    function ze(a) {
        var b = xe()
          , c = ye(b)
          , d = c.children[0]
          , e = !1
          , f = 1;
        this.hide = function() {
            e && (a.removeAuxiliaryObject(c),
            e = !1)
        }
        ;
        this.isVisible = function() {
            return e
        }
        ;
        this.showTargetAtPosition = function(b, f, l, m) {
            e || (a.addAuxiliaryObject(c),
            e = !0);
            d.visible = m;
            c.position.set(b, f, l);
            c.updateMatrixWorld()
        }
        ;
        this.update = function(a) {
            b.highlightMix += a * f;
            1 <= b.highlightMix && (b.highlightMix = 1,
            f = -1);
            0 >= b.highlightMix && (b.highlightMix = 0,
            f = 1)
        }
    }
    function Ae(a, b, c, d) {
        function e() {
            d.teleportingToPoint && d.cancelSwitchToPoint()
        }
        function f() {
            !c.mousePressLook && d.teleportingToPoint && d.cancelSwitchToPoint()
        }
        var g = new ze(a)
          , h = new Ac;
        d.addEventListener("teleportDone", function() {
            g.hide()
        });
        this.onMeshClicked = function(a, e) {
            if (!c.isOrbitEnabled() && !c.isHandlingGesture() && 0 !== c.camera().moveMaxSpeed) {
                b.clickedPointToMoveTarget(e);
                a = e.x;
                var f = e.y
                  , l = e.z
                  , m = !1;
                if (b.findIntersectionBelow(e, 4, h)) {
                    l = h.point.z;
                    var r = h.object.geometry.boundingBox;
                    r && l > r.max.z - .01 && (m = !0)
                } else
                    l -= c.cameraHeight || 1.6;
                WALK.CLICK_MOVE_SHOW_TARGET_INDICATOR && g.showTargetAtPosition(a, f, l, m);
                d.switchToPoint(e)
            }
        }
        ;
        this.update = function(a) {
            g.isVisible() && g.update(a)
        }
        ;
        this.dispose = function() {
            document.removeEventListener("keydown", e, !1);
            document.removeEventListener("mousedown", e, !1);
            document.removeEventListener("mousemove", f, !1);
            document.removeEventListener("touchstart", e, !1);
            document.removeEventListener("DOMMouseScroll", e, !1);
            document.removeEventListener("mousewheel", e, !1)
        }
        ;
        document.addEventListener("keydown", e, !1);
        document.addEventListener("mousedown", e, !1);
        document.addEventListener("mousemove", f, !1);
        document.addEventListener("touchstart", e, !1);
        document.addEventListener("DOMMouseScroll", e, !1);
        document.addEventListener("mousewheel", e, !1)
    }
    ;function Be(a, b, c) {
        var d, e, f = b.cameraWorldPosition(), g = new t.Vector3;
        this.updateCameraHeight = function(h) {
            if (d) {
                var l = f.z - g.z;
                null !== b.cameraHeight && (b.cameraHeight += l);
                f.x !== g.x || f.y !== g.y ? e = a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH) : Infinity !== e && (e += l);
                Infinity !== e && (null === b.cameraHeight && (b.cameraHeight = e),
                l = b.cameraHeight,
                e < l - .005 || e > l + .005) && (l = b.cameraHeight,
                h = Math.min(Math.max(Math.sqrt(Math.pow(f.x - g.x, 2) + Math.pow(f.y - g.y, 2)) / h * 1.5, WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED) * h, Math.abs(e - l)),
                e > l && (h = -h),
                0 > h || Infinity === a.distanceToCeiling(h + WALK.MIN_DISTANCE_TO_CEILING)) && (f.z += h,
                e += h,
                c.requestFrame());
                g.copy(f)
            }
        }
        ;
        this.enable = function() {
            d = !0;
            e = a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);
            b.cameraHeight = Infinity !== e ? e : null;
            g.copy(f)
        }
        ;
        this.disable = function() {
            d = !1
        }
        ;
        this.isEnabled = function() {
            return d
        }
        ;
        this.enable()
    }
    ;function Ce(a, b) {
        var c = a.cameraWorldPosition(), d, e, f;
        this.onHmdPositionUpdate = function(g) {
            d && !f && 1 < g.z && (a.cameraHeight = g.z,
            b.adjustPointToMatchCameraHeight(c),
            a.cameraPositionUpdated(),
            e = c.z,
            f = !0)
        }
        ;
        this.onTeleportDone = function() {
            d && (e = c.z)
        }
        ;
        this.updateCameraHeight = function() {
            d && (a.cameraHeight += c.z - e,
            e = c.z)
        }
        ;
        this.enable = function() {
            d = !0;
            a.cameraHeight = b.cameraHeightFromPoint(c);
            null === a.cameraHeight && (a.cameraHeight = WALK.FALLBACK_CAMERA_HEIGHT);
            e = c.z;
            f = !1
        }
        ;
        this.disable = function() {
            d = !1;
            a.cameraHeight = null
        }
    }
    ;function De(a, b) {
        function c(a) {
            var b = [];
            this.start = function() {
                var a = performance.now();
                b.push({
                    start: a,
                    end: a,
                    delta: 0
                })
            }
            ;
            this.end = function() {
                var a = performance.now();
                void 0 !== b[b.length - 1] && (b[b.length - 1].end = a,
                b[b.length - 1].delta = b[b.length - 1].end - b[b.length - 1].start)
            }
            ;
            this.stats = function() {
                var c = b[b.length - 1].delta
                  , f = b.reduce(function(a, b) {
                    return a.delta < b.delta ? a : b
                }).delta
                  , g = b.reduce(function(a, b) {
                    return a.delta > b.delta ? a : b
                }).delta
                  , h = e(b, "delta") / b.length;
                return {
                    name: a,
                    last: d(c),
                    best: d(f),
                    worst: d(g),
                    average: d(h)
                }
            }
        }
        function d(a) {
            return parseFloat(a.toFixed(4))
        }
        function e(a, b) {
            return a.reduce(function(a, c) {
                return a + c[b]
            }, 0)
        }
        function f(a, b, c, d) {
            var e = 2 * a.x;
            a = 2 * a.y;
            d = 2 * (void 0 === d ? 1 : d);
            n.lineWidth = 2 * (void 0 === c ? 1 : c);
            n.strokeStyle = void 0 === b ? "black" : b;
            n.beginPath();
            n.arc(e, a, d, 0, 2 * Math.PI);
            n.stroke()
        }
        function g(a) {
            a.forEach(function(a) {
                var b = 255 * a.distanceToObstacle;
                b = 0 === a.distanceToObstacle ? "black" : "rgb(255," + b + "," + b + ")";
                var c = 0
                  , d = !0;
                b = void 0 === b ? "black" : b;
                d = void 0 === d ? !1 : d;
                var e = 2 * a.x - 1;
                a = 2 * a.y - 1;
                n.lineWidth = 2 * (void 0 === c ? 1 : c);
                n.strokeStyle = b;
                n.fillStyle = b;
                n.beginPath();
                n.rect(e, a, 2, 2);
                n.stroke();
                d && n.fill()
            })
        }
        function h(a) {
            a.forEach(function(a) {
                a = new t.Vector2(a.x,a.y);
                f(a, "green", .5, .5)
            })
        }
        function l(a) {
            a.forEach(function(b, c) {
                b = new t.Vector2(b.x,b.y);
                if (0 < c) {
                    c = new t.Vector2(a[c - 1].x,a[c - 1].y);
                    var d = "blue"
                      , e = 1;
                    n.lineWidth = 2 * (void 0 === e ? 1 : e);
                    n.strokeStyle = void 0 === d ? "black" : d;
                    n.beginPath();
                    n.moveTo(2 * c.x, 2 * c.y);
                    n.lineTo(2 * b.x, 2 * b.y);
                    n.stroke()
                }
                f(b, "blue", 1, 1)
            })
        }
        console.warn("Camera path debug mode");
        var m = document.createElement("canvas")
          , n = m.getContext("2d");
        m.width = 2 * a;
        m.height = 2 * b;
        m.style.position = "absolute";
        m.style.left = "0";
        m.style.top = "0";
        m.style.maxWidth = "100%";
        document.body.appendChild(m);
        var p = {};
        this.render = function(c, d, e) {
            n.clearRect(0, 0, 2 * a, 2 * b);
            g(c);
            h(d);
            l(e)
        }
        ;
        this.timeStart = function(a) {
            void 0 === p[a] && (p[a] = new c(a));
            p[a].start()
        }
        ;
        this.timeEnd = function(a) {
            void 0 !== p[a] && p[a].end()
        }
        ;
        this.logTime = function() {
            var a = [];
            Object.values(p).forEach(function(b) {
                a.push(b.stats())
            });
            var b = {
                name: "TOTAL",
                last: d(e(a, "last")),
                best: d(e(a, "best")),
                worst: d(e(a, "worst")),
                average: d(e(a, "average"))
            };
            a.push(b);
            console.table(a)
        }
    }
    function Ee(a) {
        function b(b) {
            for (var c = d[b]; 0 < b; ) {
                var e = Math.floor((b - 1) / 2)
                  , h = d[e];
                if (c[a] <= h[a])
                    d[e] = c,
                    d[b] = h,
                    b = e;
                else
                    break
            }
        }
        function c(b) {
            for (var c = d[b]; ; ) {
                var e = 2 * b + 1
                  , h = 2 * b + 2
                  , l = void 0
                  , m = null;
                e < d.length && (l = d[e],
                c[a] > l[a] && (m = e));
                h < d.length && (e = d[h],
                null === m && c[a] > e[a] || null !== m && l[a] > e[a]) && (m = h);
                if (null !== m)
                    d[b] = d[m],
                    d[m] = c,
                    b = m;
                else
                    break
            }
        }
        a = void 0 === a ? "score" : a;
        var d = [];
        this.extract = function() {
            var a = d[0]
              , b = d.pop();
            0 < d.length && (d[0] = b,
            c(0));
            return a
        }
        ;
        this.insert = function(a) {
            d.push(a);
            b(d.length - 1)
        }
        ;
        this.update = function(e) {
            var f = d.indexOf(e);
            0 !== f && (e[a] < d[Math.floor((f - 1) / 2)] ? b(f) : c(f))
        }
        ;
        this.size = function() {
            return d.length
        }
    }
    function Fe(a, b, c, d) {
        this.id = a;
        this.x = b;
        this.y = c;
        this.distanceToObstacle = d;
        this.parent = null;
        this.score = 0
    }
    Fe.prototype = {
        distanceTo: function(a) {
            return Math.sqrt(Math.pow(this.x - a.x, 2) + Math.pow(this.y - a.y, 2))
        },
        distanceMeasured: function() {
            return void 0 !== this.distanceToObstacle
        },
        isObstacle: function() {
            return 0 === this.distanceToObstacle
        },
        visited: function() {
            return null !== this.parent
        },
        visit: function(a, b) {
            this.parent = a;
            this.score = b
        }
    };
    function Ge(a, b, c, d) {
        var e = [-1, 1, -b, b]
          , f = a.canvasRange
          , g = a.collisionRange
          , h = [];
        (function(a) {
            for (var c = new Ee("distanceToObstacle"), f = 0; f <= a.data.length; f += 4) {
                var g = 255 === a.data[f - 1]
                  , l = Math.floor(f / (4 * b));
                l = new Fe(f / 4,f / 4 - l * b,l,g ? 0 : void 0);
                h.push(l);
                g && c.insert(l)
            }
            for (a = {}; 0 < c.size(); )
                a.$jscomp$loop$prop$current$179 = c.extract(),
                e.forEach(function(a) {
                    return function(b) {
                        b = a.$jscomp$loop$prop$current$179.id + b;
                        1 > a.$jscomp$loop$prop$current$179.distanceToObstacle && void 0 !== h[b] && !1 === h[b].distanceMeasured() && (h[b].distanceToObstacle = Math.min(1, a.$jscomp$loop$prop$current$179.distanceToObstacle + 1 / d),
                        c.insert(h[b]))
                    }
                }(a)),
                a = {
                    $jscomp$loop$prop$current$179: a.$jscomp$loop$prop$current$179
                }
        }
        )(a.collisionImageData);
        this.forEachNeighbour = function(a, c) {
            var d = a.x + a.y * b;
            e.forEach(function(e) {
                var f;
                if (f = void 0 !== h[d + e])
                    if (f = h[d + e],
                    0 !== a.x && a.x !== b - 1)
                        f = !0;
                    else {
                        var g = a.x + f.x !== b - 2;
                        f = 1 === a.x + f.x && !g
                    }
                f && c(h[d + e])
            })
        }
        ;
        this.hasObstacleAt = function(a, c) {
            return h[Math.round(a) + Math.round(c) * b].isObstacle()
        }
        ;
        this.getNodeAtScenePosition = function(a) {
            var c = Math.round(t.Math.mapLinear(a.position.x, g.x.min, g.x.max, f.x.min, f.x.max));
            a = Math.round(t.Math.mapLinear(a.position.y, g.y.min, g.y.max, f.y.min, f.y.max));
            return h[c + a * b]
        }
        ;
        this.getScenePointFromNode = function(a) {
            var b = t.Math.mapLinear(a.x, f.x.min, f.x.max, g.x.min, g.x.max);
            a = t.Math.mapLinear(a.y, f.y.min, f.y.max, g.y.min, g.y.max);
            return new t.Vector2(b,a)
        }
        ;
        this.resetNodeMap = function() {
            h.forEach(function(a) {
                a.parent = null;
                a.score = 0
            })
        }
        ;
        this.getNodeMap = function() {
            return h
        }
    }
    function He(a, b) {
        function c(a, b) {
            var c = h.getNodeAtScenePosition(a);
            b = h.getNodeAtScenePosition(b);
            if (!c || !b)
                return [];
            var d = new Ee;
            d.insert(c);
            a = [];
            for (var e = {}; 0 < d.size(); ) {
                e.$jscomp$loop$prop$current$181 = d.extract();
                if (e.$jscomp$loop$prop$current$181 === b) {
                    for (b = e.$jscomp$loop$prop$current$181; b; b = b.parent)
                        b && a.push(b);
                    a.reverse();
                    break
                }
                h.forEachNeighbour(e.$jscomp$loop$prop$current$181, function(a) {
                    return function(b) {
                        if (!b.isObstacle()) {
                            var e = a.$jscomp$loop$prop$current$181.score + 1 / (b.distanceToObstacle ? b.distanceToObstacle : 1)
                              , f = b.visited() || b === c;
                            if (!f || e < b.score)
                                b.visit(a.$jscomp$loop$prop$current$181, e),
                                f ? d.update(b) : d.insert(b)
                        }
                    }
                }(e));
                e = {
                    $jscomp$loop$prop$current$181: e.$jscomp$loop$prop$current$181
                }
            }
            return a
        }
        function d(a, b, c, e) {
            var f;
            a: {
                for (f = a + 1; f < b.length; f++) {
                    b: {
                        var g = b[a]
                          , l = b[f]
                          , m = g.x < l.x ? g : l
                          , n = g.x < l.x ? l : g
                          , p = g.y < l.y ? g : l
                          , r = g.y < l.y ? l : g;
                        var q = m.x === n.x ? null : (n.y - m.y) / (n.x - m.x);
                        var u = null === q ? m.x : m.y - q * m.x;
                        if (Math.abs(g.y - l.y) > Math.abs(g.x - l.x))
                            for (m = p.y; m <= r.y; m += .2) {
                                if (h.hasObstacleAt(null === q ? p.x : (m - u) / q, m)) {
                                    q = !0;
                                    break b
                                }
                            }
                        else
                            for (p = m.x; p <= n.x; p += .2)
                                if (h.hasObstacleAt(p, null === q ? m.y : q * p + u)) {
                                    q = !0;
                                    break b
                                }
                        q = !1
                    }
                    if (q)
                        break a
                }
                f = -1
            }
            -1 === f ? c.push(b[b.length - 1]) : (a = f - a,
            a = a > e ? f - e : f - Math.floor(a / 2),
            c.push(b[a]),
            d(a, b, c, e))
        }
        function e(a) {
            var b = [a[0]];
            d(0, a, b, 5);
            return b
        }
        function f(a, b, c) {
            var d = [];
            d.push(new t.Vector2(b.position.x,b.position.y));
            for (b = 1; b < a.length - 1; b++)
                d.push(h.getScenePointFromNode(a[b]));
            d.push(new t.Vector2(c.position.x,c.position.y));
            return d
        }
        var g = null
          , h = null;
        a = b.calculateRenderSize(200, a.collisionBoundingBox);
        var l = a.width
          , m = a.height
          , n = WALK.DEBUG_CAMERA_PATH ? new De(l,m) : null;
        this.findPath = function(a, d) {
            n && n.timeStart("Graph");
            var p = d.position.z.toFixed(4);
            if (p !== g) {
                var q = {
                    outlineThickness: 2,
                    outlineColor: new t.Color(0,0,0),
                    slicePlaneHeight: d.position.z
                };
                q = b.getCollisionData(q, l, m);
                h = new Ge(q,l,m,7);
                g = p
            } else
                h.resetNodeMap();
            n && n.timeEnd("Graph");
            n && n.timeStart("Raw path");
            p = c(a, d);
            n && n.timeEnd("Raw path");
            q = [];
            var v = [];
            2 <= p.length && (n && n.timeStart("Refine path"),
            q.push.apply(q, k.arrayFromIterable(e(p))),
            n && n.timeEnd("Refine path"),
            n && n.timeStart("Calculate points"),
            v.push.apply(v, k.arrayFromIterable(f(q, a, d))),
            n && n.timeEnd("Calculate points"));
            n && (n.render(h.getNodeMap(), p, q),
            n.logTime());
            return v
        }
    }
    ;var Ie = Math.PI / 3
      , Je = 2 * WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;
    function Ke(a) {
        return -(Math.cos(Math.PI * a) - 1) / 2
    }
    function Le(a) {
        this.distance = a;
        this.time = this.velocity = 0;
        this.setVelocityFromCornerAngle = function(a) {
            this.velocity = t.Math.mapLinear(Math.max(Ie, a), Ie, Math.PI, 1, Je)
        }
    }
    function Me(a, b, c) {
        this.endTime = function() {
            return b.time
        }
        ;
        this.getDistance = function(b) {
            b -= a.time;
            return a.distance + (a.velocity * b + .5 * c * Math.pow(b, 2))
        }
        ;
        this.isTimeWithinEquation = function(c) {
            return c >= a.time && c <= b.time
        }
    }
    function Ne(a, b, c, d, e, f) {
        this.endTime = function() {
            return b.time
        }
        ;
        this.getDistance = function(b) {
            b -= a.time;
            return b < d ? a.distance + (a.velocity * b + .5 * f * Math.pow(b, 2)) : a.distance + e + (c * (b - d) - .5 * f * Math.pow(b - d, 2))
        }
        ;
        this.isTimeWithinEquation = function(c) {
            return c >= a.time && c <= b.time
        }
    }
    function Oe(a, b, c) {
        this.endDistance = b;
        this.getPoint = function(d) {
            d = t.Math.mapLinear(d, a, b, 0, 1);
            return c.get(d)
        }
        ;
        this.getRotation = function(d) {
            d = t.Math.mapLinear(d, a, b, 0, 1);
            d = c.normal(d);
            return Math.atan2(d.y, d.x) - Math.PI
        }
        ;
        this.isDistanceWithinCurve = function(c) {
            return c >= a && c <= b
        }
    }
    function Pe(a, b, c) {
        var d = a.velocity
          , e = b.velocity
          , f = b.distance - a.distance
          , g = Math.sqrt(.5 * Math.pow(d, 2) + .5 * Math.pow(e, 2) + f * c);
        if (g > d && g > e) {
            var h = .5 * (Math.pow(g, 2) - Math.pow(d, 2)) / c;
            console.assert(.001 > Math.abs(f - h - .5 * (Math.pow(g, 2) - Math.pow(e, 2)) / c));
            d = (g - d) / c;
            b.time = a.time + d + (g - e) / c;
            return new Ne(a,b,g,d,h,c)
        }
        if (g <= e)
            return e = Math.sqrt(Math.pow(d, 2) + 2 * f * c),
            console.assert(.001 > Math.abs(f - .5 * (Math.pow(e, 2) - Math.pow(d, 2)) / c)),
            b.time = a.time + (e - d) / c,
            b.velocity = e,
            new Me(a,b,c);
        c = 2 * f / (d + e);
        console.assert(.001 > Math.abs(f - (d * c + .5 * (e - d) * c)));
        b.time = a.time + c;
        return new Me(a,b,(e - d) / c)
    }
    var Qe = function() {
        var a = new t.Vector2
          , b = new t.Vector2;
        return function(c, d, e) {
            a.subVectors(d, c);
            b.subVectors(e, d);
            return Math.asin((a.x * b.y - a.y * b.x) / (a.length() * b.length()))
        }
    }();
    function Re(a) {
        return new t.Vector2(a.x,a.y)
    }
    function Se(a, b) {
        return new T([a, a.clone().lerp(b, 1 / 3), a.clone().lerp(b, 2 / 3), b])
    }
    function Te(a, b, c, d) {
        var e = b.distanceTo(a)
          , f = b.distanceTo(c)
          , g = Math.min(f, e);
        e = g / e;
        f = g / f;
        g = .5 > d / g ? d / g : .5;
        d = b.clone().lerp(a, g * e);
        a = b.clone().lerp(a, g / 3 * e);
        e = b.clone().lerp(c, g / 3 * f);
        b = b.clone().lerp(c, g * f);
        return new T([d, a, e, b])
    }
    function Ue(a, b, c, d, e, f, g, h, l, m, n, p) {
        function q(a) {
            return F.find(function(b) {
                return b.isDistanceWithinCurve(a)
            })
        }
        function r() {
            for (var a = [], b = 1; b < c.length - 1; b++) {
                var d = c[b - 1]
                  , e = c[b]
                  , f = c[b + 1]
                  , g = Qe(d, e, f)
                  , h = t.Math.mapLinear(Math.max(Ie, g), Ie, Math.PI, 2, 6);
                d = Te(d, e, f, h);
                a.push({
                    bezier: d,
                    angle: g
                })
            }
            b = [];
            b.push(new Le(0));
            d = c[0];
            for (e = g = 0; e < a.length; e++) {
                var l = a[e - 1];
                f = a[e];
                h = a[e + 1];
                void 0 !== l && (d = Re(l.bezier.points[3]));
                l = Re(f.bezier.points[0]);
                l = Se(d, l);
                if (0 < l.length()) {
                    var p = g
                      , r = g + l.length();
                    p = new Oe(p,r,l);
                    F.push(p);
                    g += l.length()
                }
                l = f.bezier.length() / 2;
                p = new Oe(g,g + 2 * l,f.bezier);
                F.push(p);
                g += l;
                p = Math.abs(f.angle);
                p > Ie && (r = new Le(g),
                r.setVelocityFromCornerAngle(p),
                b.push(r));
                g += l;
                void 0 === h && (d = Re(f.bezier.points[3]))
            }
            a = Se(d, c[c.length - 1]);
            d = g + a.length();
            d = new Oe(g,d,a);
            F.push(d);
            g += a.length();
            b.push(new Le(g));
            for (a = 1; a < b.length; a++)
                d = Pe(b[a - 1], b[a], n),
                D.push(d);
            G = function(a) {
                return C.getPoint(a)
            }
            ;
            C = F[0];
            L = D[0];
            B = g;
            a = D[D.length - 1].endTime();
            A = Math.max(1.5, Math.min(a, m));
            H = D[D.length - 1].endTime() / A
        }
        function u() {
            if (5 < B) {
                var a = q(1.25)
                  , b = WALK.normalizeRotation(a.getRotation(1.25) - e.x)
                  , c = B - 3.75;
                a = q(c);
                var d = WALK.normalizeRotation(h.x - a.getRotation(c));
                M = function(a) {
                    return 1.25 > a ? (a = Ke(a / 1.25),
                    e.x + a * b) : a > c ? (a = 1 - Ke((a - c) / (B - c)),
                    h.x - a * d) : C.getRotation(a)
                }
            } else {
                var f = WALK.normalizeRotation(h.x - e.x);
                M = function(a) {
                    a = Ke(a / B);
                    return e.x + a * f
                }
            }
            if (5 < B) {
                var g = WALK.normalizeRotation(0 - e.y)
                  , l = B - 3.25
                  , m = WALK.normalizeRotation(h.y);
                O = function(a) {
                    return 1.75 > a ? (a = Ke(a / 1.75),
                    e.y + a * g) : a > l ? Ke((a - l) / (B - l)) * m : 0
                }
            } else {
                var n = WALK.normalizeRotation(h.y - e.y);
                O = function(a) {
                    a = Ke(a / B);
                    return e.y + a * n
                }
            }
        }
        function v() {
            var a = WALK.normalizeRotation(h.x - e.x);
            M = function(b) {
                return e.x + Ke(b / A) * a
            }
            ;
            var b = WALK.normalizeRotation(h.y - e.y);
            O = function(a) {
                return e.y + Ke(a / A) * b
            }
        }
        function w() {
            var a = 3 < B ? 3 : B;
            I = function(b) {
                return b < a ? (b = Ke(b / a),
                t.Math.mapLinear(b, 0, 1, d, g)) : g
            }
        }
        function x() {
            I = function(a) {
                a = Ke(a / A);
                return t.Math.mapLinear(a, 0, 1, d, g)
            }
        }
        function y() {
            var a = z * H;
            a > L.endTime() && (L = D.find(function(b) {
                return b.isTimeWithinEquation(a)
            }));
            return L.getDistance(a)
        }
        var z = 0
          , A = 1.5
          , B = 0
          , H = 1
          , C = null
          , L = null
          , G = null
          , I = null
          , M = null
          , O = null
          , K = null
          , F = []
          , D = []
          , E = .001 < c[0].distanceTo(c[c.length - 1]);
        E && r();
        p && E ? (u(),
        w()) : (v(),
        void 0 !== g && (!E && .001 < Math.abs(g - d) && (B = Math.abs(g - d),
        A = Math.max(1.5, Math.min(Math.sqrt(B / n), m))),
        x()),
        v());
        void 0 !== l && (K = function(a) {
            a = Ke(a / A);
            return t.Math.mapLinear(a, 0, 1, f, l)
        }
        );
        this.update = function(c, d) {
            z += c;
            if (z < A) {
                p && E ? (c = y(),
                c > C.endDistance && (C = q(c))) : c = z;
                if (G) {
                    var e = G(y());
                    d.setX(e.x);
                    d.setY(e.y)
                }
                I && (e = I(c),
                d.setZ(e));
                K && (a.fov = K(z),
                a.updateProjectionMatrix());
                b.setYawAngle(M(c));
                b.setPitchAngle(O(c));
                b.cameraPositionUpdated();
                return !0
            }
            return !1
        }
    }
    ;var Ve = 1 / 180;
    function We(a) {
        var b = null;
        this.activateSky = function(c) {
            if (b) {
                if (b.name === c)
                    return;
                a.removeAuxiliaryObject(b)
            }
            var d = a.findSkyMesh(c);
            (c = d.material.map) && !c.loaded ? (this.activateSky(WALK.DEFAULT_SKY_NAME),
            b = d,
            c.addLoadedListener(function() {
                b === d && (a.addAuxiliaryObject(d),
                d.updateMatrixWorld(!0))
            })) : (a.addAuxiliaryObject(d),
            d.updateMatrixWorld(!0),
            b = d)
        }
        ;
        this.activeSkyName = function() {
            return b.name
        }
    }
    function Xe(a, b, c) {
        this.position = a || new t.Vector3;
        this.rotation = b || new t.Vector2;
        this.fov = c || 0
    }
    function Ye(a, b, c, d, e) {
        function f() {
            v = [];
            for (var b = 0; b < a.views.length; b += 1)
                v[a.views[b].id] = [];
            for (b = 0; b < a.gpuMeshes.length; b += 1) {
                var c = a.gpuMeshes[b]
                  , d = c.hideInViews;
                if (d)
                    for (var e = 0; e < d.length; e += 1)
                        v[d[e]] ? v[d[e]].push(c) : console.warn("Invalid view id in hideInViews list: '" + d[b] + "'")
            }
        }
        function g(a) {
            for (var b = 0; b < a.length; b += 1) {
                var c = a[b];
                c.visible = !1;
                w.push(c)
            }
        }
        function h() {
            for (var a = 0; a < w.length; a += 1)
                w[a].visible = !0;
            w.length = 0
        }
        function l(a) {
            h();
            g(a)
        }
        function m() {
            u.fov = z.fov;
            r.copy(z.position);
            b.setYawAngle(z.rotation.x);
            b.setPitchAngle(z.rotation.y);
            b.cameraPositionUpdated();
            y = null
        }
        function n() {
            return [new t.Vector2(F().position.x,F().position.y), new t.Vector2(z.position.x,z.position.y)]
        }
        var p = this, q = new We(a), r = b.cameraWorldPosition(), u = a.camera, v, w = [], x = new He(a,e), y = null, z = new Xe, A = new t.Vector3, B, H, C, L = !1, G = {
            type: "teleportStarted",
            target: this,
            view: null
        }, I = {
            type: "teleportDone",
            target: this,
            view: null
        }, M = null;
        this.lastDestinationView = null;
        var O = this.teleportingToPoint = this.teleportingToView = !1
          , K = !1
          , F = function() {
            var a = new Xe(b.cameraWorldPosition());
            return function() {
                a.rotation.set(WALK.normalizeRotation(b.getYawAngle()), WALK.normalizeRotation(b.getPitchAngle()));
                a.fov = u.fov;
                return a
            }
        }();
        this.update = function(a) {
            if (p.teleportingToView || p.teleportingToPoint) {
                a = Math.min(a, .067);
                a = Math.max(a, Ve);
                var c = !0;
                null !== y && (this.teleportingToPoint && (z.position.z = r.z),
                y.update(a, r) ? c = !1 : m());
                c && (this.teleportingToView && ("orbit" !== C.mode || L ? (a = b.camera(),
                a.near = WALK.CAMERA_WALK_NEAR,
                a.updateProjectionMatrix(),
                b.enable()) : (b.orbit.minDistance = B,
                b.orbit.maxDistance = H,
                b.orbit.setPanPrimary(C.panPrimary || !1),
                b.orbit.noRotate = C.noRotate || !1,
                b.orbit.noPitchRotate = C.noPitchRotate || !1,
                b.orbit.getNoPan = function() {
                    return C.noPan
                }
                ,
                b.orbit.getMinPitchAngle = function() {
                    return -C.maxUpAngle
                }
                ,
                b.orbit.getMaxPitchAngle = function() {
                    return -C.minUpAngle
                }
                ,
                b.orbit.getMinYawAngle = function() {
                    return C.minSideAngle
                }
                ,
                b.orbit.getMaxYawAngle = function() {
                    return C.maxSideAngle
                }
                ,
                b.orbit.getMinDistance = function() {
                    return C.minDistance
                }
                ,
                b.orbit.getMaxDistance = function() {
                    return C.maxDistance
                }
                ,
                b.orbit.target.copy(A),
                b.orbitModeEnable()),
                q.activateSky(C.sky),
                l(v[C.id] || [])),
                this.teleportingToView = this.teleportingToPoint = !1,
                I.view = C,
                this.dispatchEvent(I));
                d.requestFrame()
            }
        }
        ;
        this.cancelSwitchToPoint = function() {
            console.assert(this.teleportingToPoint);
            this.teleportingToPoint = !1;
            I.view = null;
            this.dispatchEvent(I)
        }
        ;
        this.switchToPoint = function(a, c) {
            var e;
            if (e = a.x === r.x && a.y === r.y)
                (e = void 0 === c) || (e = WALK.normalizeRotation(c.yaw) === F().rotation.x && WALK.normalizeRotation(c.pitch) === F().rotation.y);
            e || (C = null,
            this.teleportingToPoint = !0,
            this.teleportingToView = !1,
            G.view = null,
            this.dispatchEvent(G),
            O ? z.position.set(a.x, a.y, a.z) : z.position.set(a.x, a.y, r.z),
            c ? z.rotation.set(WALK.normalizeRotation(c.yaw), WALK.normalizeRotation(c.pitch)) : (a = WALK.yawRotationToPoint(r, a),
            a = WALK.normalizeRotation(a),
            z.rotation.set(a, 0)),
            z.fov = u.defaultFov,
            O ? (m(),
            this.update(Ve)) : (y = new Ue(u,b,n(),F().position.z,F().rotation,u.fov,void 0,z.rotation,z.fov,WALK.TELEPORT_TO_POINT_MAX_TIME,WALK.TELEPORT_TO_POINT_ACCELERATION,!1),
            d.requestFrame()))
        }
        ;
        this.switchToView = function(a, e) {
            var f = "orbit" !== a.mode;
            var h = p.lastDestinationView ? "orbit" !== p.lastDestinationView.mode : !0;
            f = u.autoPath && f && h;
            a.hideFromMenu || (M = a);
            this.lastDestinationView = C = a;
            this.teleportingToView = !0;
            this.teleportingToPoint = !1;
            G.view = C;
            this.dispatchEvent(G);
            b.disable();
            b.resetRollAngle();
            g(v[C.id] || []);
            void 0 !== C.rotation ? z.rotation.set(C.rotation.yaw, C.rotation.pitch) : z.rotation.set(0, 0);
            z.fov = C.fov || u.defaultFov;
            "orbit" === C.mode ? (void 0 !== C.target ? A.set(C.target.x, C.target.y, C.target.z) : A.set(0, 0, 0),
            B = C.minDistance,
            H = C.maxDistance,
            a = t.Math.clamp(C.distance || 10, B, H),
            ve.computeCameraPosition(z.position, A, z.rotation.x, z.rotation.y, a),
            u.near = ve.computeCameraNear(a),
            u.updateProjectionMatrix()) : void 0 !== C.position ? (z.position.set(C.position.x, C.position.y, C.position.z),
            (K || null !== WALK.CAMERA_FIXED_HEIGHT || u.autoClimb && null !== u.fixedHeight) && c.adjustPointToMatchCameraHeight(z.position)) : z.position.set(0, 0, 0);
            if (void 0 === e && 0 === WALK.TELEPORT_TO_VIEW_MAX_TIME || 0 === e || O)
                m(),
                this.update(Ve);
            else {
                C.sky !== q.activeSkyName() && q.activateSky(WALK.DEFAULT_SKY_NAME);
                a = f ? x.findPath(F(), z) : [];
                h = 0 < a.length;
                a = (f = f && h) ? a : n();
                h = f ? WALK.TELEPORT_PATH_ACCELERATION : WALK.TELEPORT_TO_VIEW_ACCELERATION;
                void 0 === e && (e = f ? WALK.TELEPORT_PATH_MAX_TIME : WALK.TELEPORT_TO_VIEW_MAX_TIME);
                if (void 0 === C.rotation) {
                    var l = WALK.yawRotationToPoint(a[a.length - 2], a[a.length - 1]);
                    l = WALK.normalizeRotation(l);
                    z.rotation.set(l, 0)
                }
                y = new Ue(u,b,a,F().position.z,F().rotation,u.fov,z.position.z,z.rotation,z.fov,e,h,f);
                d.requestFrame()
            }
        }
        ;
        this._switchToAdjacentVisibleView = function(b, c) {
            var d = a.visibleViews();
            if (0 !== d.length)
                if (null === M)
                    this.switchToView(d[0], c);
                else {
                    var e = d.indexOf(M);
                    -1 === e && this.switchToView(d[0], c);
                    this.switchToView(d[(e + d.length + b) % d.length], c)
                }
        }
        ;
        this.switchToPreviousVisibleView = function(a) {
            this._switchToAdjacentVisibleView(-1, a)
        }
        ;
        this.switchToNextVisibleView = function(a) {
            this._switchToAdjacentVisibleView(1, a)
        }
        ;
        this.updateHiddenMeshes = function(a) {
            f();
            a ? l(v[a.id] || []) : h();
            d.requestFrame()
        }
        ;
        this.activateSky = function(a) {
            q.activateSky(a.sky);
            d.requestFrame()
        }
        ;
        this.executeWithViewVisibilitySettings = function(a, b) {
            var c = w.slice();
            l(v[a.id] || []);
            q.activateSky(a.sky);
            b();
            q.activateSky(this.lastDestinationView.sky);
            l(c)
        }
        ;
        this.onVrChange = function(a) {
            K = O = L = a;
            this.lastDestinationView && "orbit" === this.lastDestinationView.mode && this.switchToView(this.lastDestinationView, 0)
        }
        ;
        f();
        a.addEventListener("viewAdded", f);
        a.addEventListener("viewRemoved", f);
        a.addEventListener("skyMeshAdded", function(a) {
            q.activateSky(a.skyMesh.name);
            d.requestFrame()
        });
        a.addEventListener("skyMeshRemoved", function(a) {
            q.activeSkyName() === a.skyMesh.name && (q.activateSky(WALK.DEFAULT_SKY_NAME),
            d.requestFrame())
        })
    }
    t.EventDispatcher.prototype.apply(Ye.prototype);
    function Ze(a) {
        function b() {
            c && a.switchToNextVisibleView(4)
        }
        var c = !1
          , d = {
            type: "tourStarted"
        }
          , e = {
            type: "tourStopped"
        };
        a.addEventListener("teleportDone", function() {
            c && setTimeout(b, WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)
        });
        this.isRunning = function() {
            return c
        }
        ;
        this.start = function() {
            console.assert(!c);
            c = !0;
            this.dispatchEvent(d);
            b()
        }
        ;
        this.stop = function() {
            console.assert(c);
            c = !1;
            a.switchToView(a.lastDestinationView, 0);
            this.dispatchEvent(e)
        }
    }
    t.EventDispatcher.prototype.apply(Ze.prototype);
    WALK.GAMEPAD_ACTION = {
        TRIGGER: 0,
        BACKWARD: 1,
        FORWARD: 2,
        LEFT: 3,
        RIGHT: 4,
        DOWN: 5,
        UP: 6,
        PREVIOUS: 7,
        NEXT: 8
    };
    var $e = [{
        gamepadIdPattern: /^Spatial Controller \(Spatial Interaction Source\).*$/,
        axisMapping: new Map([[2, [WALK.GAMEPAD_ACTION.PREVIOUS, WALK.GAMEPAD_ACTION.NEXT]], [3, [WALK.GAMEPAD_ACTION.UP, WALK.GAMEPAD_ACTION.DOWN]], [0, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [1, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]]]),
        buttonMapping: new Map([[1, WALK.GAMEPAD_ACTION.TRIGGER]])
    }, {
        gamepadIdPattern: /Oculus Touch \(Left\)/,
        axisMapping: new Map([[0, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [1, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]]]),
        buttonMapping: new Map([[1, WALK.GAMEPAD_ACTION.TRIGGER], [3, WALK.GAMEPAD_ACTION.DOWN], [4, WALK.GAMEPAD_ACTION.UP]])
    }, {
        gamepadIdPattern: /Oculus Touch \(Right\)/,
        axisMapping: new Map([[0, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [1, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]]]),
        buttonMapping: new Map([[1, WALK.GAMEPAD_ACTION.TRIGGER], [3, WALK.GAMEPAD_ACTION.NEXT], [4, WALK.GAMEPAD_ACTION.PREVIOUS]])
    }, {
        gamepadIdPattern: /OpenVR (Gamepad|Controller)/,
        axisMapping: new Map([[0, [WALK.GAMEPAD_ACTION.PREVIOUS, WALK.GAMEPAD_ACTION.NEXT]], [1, [WALK.GAMEPAD_ACTION.DOWN, WALK.GAMEPAD_ACTION.UP]]]),
        buttonMapping: new Map([[1, WALK.GAMEPAD_ACTION.TRIGGER]])
    }, {
        gamepadIdPattern: /.*/,
        gamepadLayoutMappingId: "standard",
        axisMapping: new Map([[0, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [1, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]], [2, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [3, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]]]),
        buttonMapping: new Map([[0, WALK.GAMEPAD_ACTION.DOWN], [1, WALK.GAMEPAD_ACTION.NEXT], [2, WALK.GAMEPAD_ACTION.PREVIOUS], [3, WALK.GAMEPAD_ACTION.UP], [4, WALK.GAMEPAD_ACTION.TRIGGER], [5, WALK.GAMEPAD_ACTION.TRIGGER]])
    }, {
        gamepadIdPattern: /.*/,
        axisMapping: new Map([[0, [WALK.GAMEPAD_ACTION.PREVIOUS, WALK.GAMEPAD_ACTION.NEXT]], [1, [WALK.GAMEPAD_ACTION.UP, WALK.GAMEPAD_ACTION.DOWN]]]),
        buttonMapping: new Map([[0, WALK.GAMEPAD_ACTION.TRIGGER], [1, WALK.GAMEPAD_ACTION.TRIGGER], [2, WALK.GAMEPAD_ACTION.TRIGGER], [3, WALK.GAMEPAD_ACTION.TRIGGER]])
    }]
      , af = {
        axisMapping: new Map([[2, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [3, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]]]),
        buttonMapping: new Map([[0, WALK.GAMEPAD_ACTION.TRIGGER], [4, WALK.GAMEPAD_ACTION.DOWN], [5, WALK.GAMEPAD_ACTION.UP]])
    }
      , bf = {
        axisMapping: new Map([[2, [WALK.GAMEPAD_ACTION.LEFT, WALK.GAMEPAD_ACTION.RIGHT]], [3, [WALK.GAMEPAD_ACTION.FORWARD, WALK.GAMEPAD_ACTION.BACKWARD]]]),
        buttonMapping: new Map([[0, WALK.GAMEPAD_ACTION.TRIGGER], [4, WALK.GAMEPAD_ACTION.NEXT], [5, WALK.GAMEPAD_ACTION.PREVIOUS]])
    };
    function cf(a) {
        return -.7 >= a ? 0 : .7 <= a ? 1 : -1
    }
    function df(a, b) {
        if ("xr-standard" === a.mapping)
            return "left" === (a.hand ? a.hand : b) ? af : bf;
        b = k.makeIterator($e);
        for (var c = b.next(); !c.done; c = b.next()) {
            c = c.value;
            var d = a;
            var e = c;
            d = e.gamepadIdPattern.test(d.id) ? void 0 !== e.gamepadLayoutMappingId ? d.mapping === e.gamepadLayoutMappingId : !0 : !1;
            if (d)
                return c
        }
        console.error("No matching action mapping for gamepad found", a.id);
        return null
    }
    function ef(a, b) {
        b = df(a, b);
        this.axisMapping = b.axisMapping;
        this.buttonMapping = b.buttonMapping;
        this.axisPosition = a.axes.map(cf);
        this.buttonPressed = a.buttons.map(function(a) {
            return a.pressed
        })
    }
    function ff() {
        function a(a) {
            var b = a.gamepad;
            a = new ef(a.gamepad);
            c.set(b.index, a)
        }
        function b(a) {
            c.delete(a.gamepad.index)
        }
        var c = new Map
          , d = new Map
          , e = new Set
          , f = new Set
          , g = {
            type: "actionActivated",
            action: null
        }
          , h = {
            type: "actionDeactivated",
            action: null
        };
        this.hasGamepads = function() {
            return 0 < c.size || 0 < d.size
        }
        ;
        this.update = function() {
            function a(a, b) {
                for (var c = 0; c < b.axes.length; ++c) {
                    var d = cf(b.axes[c])
                      , g = a.axisPosition[c];
                    if (d !== g) {
                        var h = a.axisMapping.get(c);
                        void 0 !== h && (-1 !== g && f.add(h[g]),
                        -1 !== d && e.add(h[d]))
                    }
                    a.axisPosition[c] = d
                }
                for (c = 0; c < b.buttons.length; ++c)
                    d = b.buttons[c].pressed,
                    g = a.buttonPressed[c],
                    d !== g && (h = a.buttonMapping.get(c),
                    void 0 !== h && (g ? f.add(h) : e.add(h))),
                    a.buttonPressed[c] = d
            }
            if (this.hasGamepads()) {
                e.clear();
                f.clear();
                var b = navigator.getGamepads ? navigator.getGamepads() : [];
                b = k.makeIterator(b);
                for (var n = b.next(); !n.done; n = b.next())
                    if (n = n.value) {
                        var p = c.get(n.index);
                        a(p, n)
                    }
                b = k.makeIterator(d);
                for (n = b.next(); !n.done; n = b.next())
                    p = k.makeIterator(n.value),
                    n = p.next().value,
                    p = p.next().value,
                    a(p, n);
                n = k.makeIterator(f);
                for (b = n.next(); !b.done; b = n.next())
                    h.action = b.value,
                    this.dispatchEvent(h);
                n = k.makeIterator(e);
                for (b = n.next(); !b.done; b = n.next())
                    g.action = b.value,
                    this.dispatchEvent(g)
            }
        }
        ;
        this.addXrGamepad = function(a, b) {
            b = new ef(a,b);
            d.set(a, b)
        }
        ;
        this.removeXrGamepad = function(a) {
            d.delete(a)
        }
        ;
        this.removeAllXrGamepads = function() {
            d.clear()
        }
        ;
        (function() {
            if (navigator.getGamepads) {
                window.addEventListener("gamepadconnected", a);
                window.addEventListener("gamepaddisconnected", b);
                for (var d = k.makeIterator(navigator.getGamepads()), e = d.next(); !e.done; e = d.next())
                    if (e = e.value) {
                        var f = new ef(e);
                        c.set(e.index, f)
                    }
            }
        }
        )()
    }
    t.EventDispatcher.prototype.apply(ff.prototype);
    /*
 Copyright (C) 2020-present Shapespark
*/
    function gf() {
        var a = this
          , b = !1
          , c = {
            type: "modeDisabled"
        }
          , d = {
            type: "modeEnabled"
        };
        this.enableMode = function() {
            b = !0;
            a.dispatchEvent(d)
        }
        ;
        this.disableMode = function() {
            b = !1;
            a.dispatchEvent(c)
        }
        ;
        this.modeIsEnabled = function() {
            return b
        }
    }
    t.EventDispatcher.prototype.apply(gf.prototype);
    /*
 Copyright (C) 2017-present Shapespark
*/
    console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S <= WALK.GAZE_POINTER_ACTIVATE_AFTER_S);
    var rf = Math.PI / 60;
    function sf() {
        var a = new t.BufferGeometry
          , b = new Float32Array(18);
        a.addAttribute("position", new t.BufferAttribute(b,3));
        b[0] = .05;
        b[1] = -.05;
        b[2] = -2;
        b[3] = .05;
        b[4] = .05;
        b[5] = -2;
        b[6] = -.05;
        b[7] = -.05;
        b[8] = -2;
        b[9] = .05;
        b[10] = .05;
        b[11] = -2;
        b[12] = -.05;
        b[13] = .05;
        b[14] = -2;
        b[15] = -.05;
        b[16] = -.05;
        b[17] = -2;
        a.computeBoundingSphere();
        return a
    }
    function tf(a, b, c, d) {
        function e() {
            if (!g)
                f();
            else if (!p) {
                var d = new WALK.GazePointerMaterial
                  , e = new t.Mesh(sf(),d);
                a.addAuxiliaryObject(e);
                e.frustumCulled = !1;
                e.matrixWorld = b.camera().matrixWorld;
                p = {
                    setVisible: function(a) {
                        e.visible = a;
                        c()
                    },
                    setCircleSpan: function(a) {
                        d.circleSpan = a;
                        c()
                    }
                };
                f()
            }
            p && p.setVisible(g)
        }
        function f() {
            h = l = null;
            m = 0;
            n = !1;
            p && p.setCircleSpan(0)
        }
        var g = d.modeIsEnabled(), h, l, m, n, p = null, q = null, r = null;
        this.setGazeHandlers = function(a, b) {
            q = a;
            r = b
        }
        ;
        d.addEventListener("modeDisabled", function() {
            g = !1;
            e()
        });
        d.addEventListener("modeEnabled", function() {
            g = !0;
            e()
        });
        this.reset = function() {
            null !== h && f()
        }
        ;
        this.update = function(a) {
            if (g) {
                var c = b.getPitchAngle()
                  , d = b.getYawAngle();
                null === h ? (h = c,
                l = d) : Math.abs(h - c) > rf || Math.abs(l - d) > rf ? f() : (m += a,
                m >= WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S && (n ? (p.setCircleSpan(Math.min((m - WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S) / (WALK.GAZE_POINTER_ACTIVATE_AFTER_S - WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S), 1)),
                m >= WALK.GAZE_POINTER_ACTIVATE_AFTER_S && (r && r(),
                f())) : q && q() ? n = !0 : f()))
            }
        }
        ;
        e()
    }
    ;/*
 Copyright (C) 2018-present Shapespark
*/
    function uf(a, b) {
        function c() {
            var c = WALK.urlHashGetArgument("view");
            c && (c = a.findViewByName(c)) && (b.switchToView(c),
            window.location.hash = WALK.urlHashRemoveArgument("view"))
        }
        window.addEventListener("hashchange", c, !1);
        this.dispose = function() {
            window.removeEventListener("hashchange", c, !1)
        }
    }
    ;var vf = WALK.getShader("standard_material_vertex.glsl")
      , wf = WALK.getShader("standard_material_fragment.glsl")
      , xf = new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}")
      , yf = new t.Color
      , zf = new t.Vector3(0,0,0)
      , Af = new t.Vector4(0,0,1,1);
    WALK.ParallaxModes = {
        basic: "USE_BASIC_PARALLAX",
        steep: "USE_STEEP_PARALLAX",
        occlusion: "USE_OCLUSION_PARALLAX",
        relief: "USE_RELIEF_PARALLAX"
    };
    WALK.StandardMaterial = function() {
        WALK.BaseMaterial.call(this, vf, wf, this.fragmentShaderHooks());
        this.type = "standard";
        this.merged = !1;
        this._opacity = 1;
        Object.defineProperty(this, "opacity", {
            get: function() {
                return this._opacity
            },
            set: function(a) {
                this._opacity = .99 < a ? 1 : a;
                this.configureTransparency();
                this.setUniforms();
                this._updated()
            }
        });
        this.baseColor = new t.Color(16777215);
        this._baseColorTexture = null;
        this._baseColorTextureCorrection = this.planarReflector = !1;
        this._baseColorTextureContrast = 0;
        this.baseColorTextureHslOffset = {
            h: 0,
            s: 0,
            l: 0
        };
        this._baseColorCorrectionUniform = new t.Vector4;
        this.lightMapped = !1;
        this._lightMapSize = new t.Vector2;
        this._emissive = !1;
        this._roughness = this._emissionStrength = 1;
        this._metallic = 0;
        this._lastUsedLightProbeId = this.cubeCameraIndex = null;
        this._haveTextureLod = WALK.DETECTOR.gl.textureLod;
        this._mipLevel1 = this._mipLevel0 = null;
        this.disableLightProbeTmp = this.disableLightProbe = !1;
        this._envMapProject = !0;
        this._bumpScale = .001;
        this.parallaxCorrection = !1;
        this.parallaxMode = "basic";
        this.parallaxScale = -.03;
        this.parallaxMinLayers = 10;
        this.parallaxMaxLayers = 15;
        this.headLight = !1;
        this._uvOffsetScale = null;
        this._repeatableTexturesRequired = !1;
        this.highlight = WALK.EDIT_MODE ? WALK.EDITOR_SELECTION_COLOR : null;
        this._specularOff = this._highlightMix = 0;
        this.doNotImport = {
            baseColor: !1,
            opacity: !1
        };
        this._alphaInLowerHalf = !1;
        this._chromaKeyEnabled = void 0;
        this.chromaKeyColor = (new t.Color).setRGB(0, .94, 0);
        this._chromaKeyDelta = new t.Vector3(.1,.1,.1);
        this._chromaKeyDeltaCoeff = new t.Vector3;
        this.toneMappingSupported = this.exposureAndGammaSupported = this.colorMapSupported = this.hdrOutputSupported = this.fogSupported = !0
    }
    ;
    WALK.StandardMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.StandardMaterial.prototype.constructor = WALK.StandardMaterial;
    WALK.StandardMaterial.prototype.addTextureProperty = function(a) {
        var b = "_" + a;
        Object.defineProperty(this, a, {
            get: function() {
                return this[b] || null
            },
            set: function(a) {
                var c = this;
                (this[b] = a) ? a.addLoadedListener(function() {
                    c.setUniforms();
                    c._updated();
                    c = a = null
                }) : (c.setUniforms(),
                c._updated())
            }
        })
    }
    ;
    WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");
    WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");
    WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");
    WALK.StandardMaterial.prototype.fragmentShaderHooks = function() {
        return xf
    }
    ;
    WALK.StandardMaterial.prototype._useChromaKey = function() {
        return !(!this.isAnimated || !this.chromaKeyEnabled)
    }
    ;
    WALK.StandardMaterial.prototype._useAlphaInLowerHalf = function() {
        return !(!this.isAnimated || !this.alphaInLowerHalf)
    }
    ;
    WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout = function() {
        var a = this._baseColorTexture;
        return 1 === this.opacity && (a && a.isCutout || this._useAlphaInLowerHalf() || this._useChromaKey())
    }
    ;
    WALK.StandardMaterial.prototype.configureTransparency = function() {
        var a = this._baseColorTexture;
        a = a && (a.hasAlpha || this._useAlphaInLowerHalf() || this._useChromaKey());
        this.transparent = 1 > this.opacity || a;
        a = this._useBaseColorTextureAsCutout();
        this.transparent ? (this.blending = t.NormalBlending,
        this.transparentRenderOrder = a ? 0 : 1) : this.blending = t.NoBlending;
        this.depthWrite = !this.transparent || a
    }
    ;
    Object.defineProperty(WALK.StandardMaterial.prototype, "alphaInLowerHalf", {
        get: function() {
            return this._alphaInLowerHalf
        },
        set: function(a) {
            this._alphaInLowerHalf = a;
            this.configureTransparency();
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "chromaKeyEnabled", {
        get: function() {
            return !!this._chromaKeyEnabled
        },
        set: function(a) {
            this._chromaKeyEnabled = !!a;
            this.configureTransparency();
            this.setUniforms();
            this._updated()
        }
    });
    WALK.StandardMaterial.prototype.setChromaKeyColorRGB = function(a, b, c) {
        this.chromaKeyColor.setRGB(a, b, c);
        this.setUniforms();
        this._updated()
    }
    ;
    WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent = function(a) {
        return this._chromaKeyDelta.getComponent(a)
    }
    ;
    WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent = function(a, b) {
        this._chromaKeyDelta.setComponent(a, b);
        this.setUniforms();
        this._updated()
    }
    ;
    Object.defineProperty(WALK.StandardMaterial.prototype, "isAnimated", {
        get: function() {
            var a = this.baseColorTexture;
            return a && a.isAnimated
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "isPlaying", {
        get: function() {
            var a = this.baseColorTexture;
            return a && a.isAnimated && a.isPlaying
        }
    });
    WALK.StandardMaterial.prototype.rewind = function() {
        this.baseColorTexture.rewind()
    }
    ;
    WALK.StandardMaterial.prototype.play = function() {
        console.assert(this.isAnimated);
        var a = this.baseColorTexture.isPlaying;
        this.baseColorTexture.play();
        this.baseColorTexture.isPlaying !== a && this._updated()
    }
    ;
    WALK.StandardMaterial.prototype.pause = function() {
        console.assert(this.isAnimated);
        var a = this.baseColorTexture.isPlaying;
        this.baseColorTexture.pause();
        this.baseColorTexture.isPlaying !== a && this._updated()
    }
    ;
    WALK.StandardMaterial.prototype.sleepAnimation = function() {
        console.assert(this.isAnimated);
        this.baseColorTexture.sleepAnimation()
    }
    ;
    WALK.StandardMaterial.prototype.wakeAnimation = function() {
        console.assert(this.isAnimated);
        this.baseColorTexture.wakeAnimation()
    }
    ;
    Object.defineProperty(WALK.StandardMaterial.prototype, "doubleSided", {
        get: function() {
            return this.side === t.DoubleSide
        },
        set: function(a) {
            this.side = a ? t.DoubleSide : t.FrontSide;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "envMapMirror", {
        get: function() {
            return 0 === this.roughness && !this.roughnessTexture
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "specularOff", {
        get: function() {
            return this._specularOff
        },
        set: function(a) {
            a !== this._specularOff && (this._specularOff = a,
            this.setUniforms())
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "highlightMix", {
        get: function() {
            return this._highlightMix
        },
        set: function(a) {
            a !== this._highlightMix && (this._highlightMix = a,
            this.uniforms.highlightMix.value = a)
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "baseColorTexture", {
        get: function() {
            return this._baseColorTexture
        },
        set: function(a) {
            var b = this;
            (this._baseColorTexture = a) ? a.addLoadedListener(function() {
                b.configureTransparency();
                b._repeatableTexturesRequired && b.ensureTexturesRepeatable();
                b.setUniforms();
                b._updated();
                b = a = null
            }) : (b.setUniforms(),
            b._updated())
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "baseColorTextureCorrection", {
        get: function() {
            return this._baseColorTextureCorrection
        },
        set: function(a) {
            this._baseColorTextureCorrection = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "baseColorTextureContrast", {
        get: function() {
            return this._baseColorTextureContrast
        },
        set: function(a) {
            this._baseColorTextureContrast = a;
            this.setUniforms();
            this._updated()
        }
    });
    WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset = function(a, b, c) {
        this.baseColorTextureHslOffset.h = a;
        this.baseColorTextureHslOffset.s = b;
        this.baseColorTextureHslOffset.l = c;
        this.setUniforms();
        this._updated()
    }
    ;
    Object.defineProperty(WALK.StandardMaterial.prototype, "emissive", {
        get: function() {
            return this._emissive
        },
        set: function(a) {
            this._emissive = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "emissionStrength", {
        get: function() {
            return this._emissionStrength
        },
        set: function(a) {
            this._emissionStrength = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "roughness", {
        get: function() {
            return this._roughness
        },
        set: function(a) {
            this._roughness = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "metallic", {
        get: function() {
            return this._metallic
        },
        set: function(a) {
            this._metallic = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "envMapProject", {
        get: function() {
            return this._envMapProject
        },
        set: function(a) {
            this._envMapProject = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "bumpScale", {
        get: function() {
            return this._bumpScale
        },
        set: function(a) {
            this._bumpScale = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterial.prototype, "uvOffsetAndScaleEnabled", {
        get: function() {
            return null !== this._uvOffsetScale
        },
        set: function(a) {
            a ? this.setUvOffsetAndScale(Af) : (this._uvOffsetScale = null,
            this.setUniforms(),
            this._updated())
        }
    });
    WALK.StandardMaterial.prototype.setDoNotImport = function(a, b) {
        this.doNotImport[a] = b;
        this.setUniforms();
        this._updated()
    }
    ;
    WALK.StandardMaterial.prototype.isLightProbeDisabled = function() {
        return this.disableLightProbe || this.disableLightProbeTmp || this.specularOff || 1 === this.roughness && !this._roughnessTexture || this.transparent && this.doubleSided
    }
    ;
    WALK.StandardMaterial.prototype._setLightProbeUniforms = function() {
        this.setUniform("envMap", "t", null);
        if (!this.condDefine(this._haveTextureLod, "HAVE_TEXTURE_LOD")) {
            var a = WALK.LIGHT_PROBE_MIPS_COUNT - 1;
            this._mipLevel0 = Math.floor(this.roughness * a);
            this._mipLevel1 = Math.min(this._mipLevel0 + 1, a);
            this.setUniform("envMap2", "t", null)
        }
        this.envMapMirror ? this.setUniform("envMipsCount", "f", 1) : this.setUniform("envMipsCount", "f", 0);
        this.condDefine(this.envMapProject, "USE_ENVMAP_PROJECT") && (this.setUniform("envMapPosW", "v3", zf),
        this.setUniform("envBoxMin", "v3", zf),
        this.setUniform("envBoxMax", "v3", zf));
        this._lastUsedLightProbeId = null
    }
    ;
    WALK.StandardMaterial.prototype.getUvOffsetAndScale = function(a) {
        return a.copy(this._uvOffsetScale || Af)
    }
    ;
    WALK.StandardMaterial.prototype._uvOffsetAndScaleModified = function() {
        this.ensureTexturesRepeatable();
        this._updated()
    }
    ;
    WALK.StandardMaterial.prototype.setUvOffsetAndScale = function(a, b, c, d) {
        this._uvOffsetScale || (this._uvOffsetScale = new t.Vector4,
        this.setUniforms());
        a instanceof t.Vector4 ? this._uvOffsetScale.copy(a) : this._uvOffsetScale.set(a, b, c, d);
        this._uvOffsetAndScaleModified()
    }
    ;
    WALK.StandardMaterial.prototype.getUvOffsetAndScaleByProperty = function(a) {
        return this._uvOffsetScale[a]
    }
    ;
    WALK.StandardMaterial.prototype.setUvOffsetAndScaleByProperty = function(a, b) {
        switch (a) {
        case "x":
            this._uvOffsetScale.setX(b);
            break;
        case "y":
            this._uvOffsetScale.setY(b);
            break;
        case "z":
            this._uvOffsetScale.setZ(b);
            break;
        case "w":
            this._uvOffsetScale.setW(b)
        }
        this._uvOffsetAndScaleModified()
    }
    ;
    WALK.StandardMaterial.prototype.ensureTexturesRepeatable = function() {
        this._repeatableTexturesRequired = !0;
        var a = this.baseColorTexture;
        a && a.parentTexture && a.parentTexture.loaded && (this._haveTextureLod && WALK.DETECTOR.gl.standardDerivatives ? (this.enableStandardDerivativesExtension(),
        this.enableTextureLodExtension(),
        this.addDefine("USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT")) : this._baseColorTexture.extractedTexture || (a.extractTexture(),
        this.setUniforms()))
    }
    ;
    WALK.StandardMaterial.prototype.setUniforms = function() {
        this.setUniform("opacity", "f", this.opacity);
        var a = !this.isLightProbeDisabled()
          , b = !1
          , c = this.roughnessTexture;
        this.condDefine(c && c.loaded && a, "USE_ROUGHNESS_TEXTURE") ? (this.setUniform("roughnessTexture", "t", c),
        b = !0) : this.setUniform("roughness", "f", this.roughness);
        c = this.metallicTexture;
        this.condDefine(c && c.loaded && a, "USE_METALLIC_TEXTURE") ? (this.setUniform("metallicTexture", "t", c),
        b = !0) : this.setUniform("metallic", "f", this.metallic);
        this.setUniform("emissionStrength", "f", this.emissive ? this.emissionStrength : 0);
        this._baseColorTexture && this.baseColorTextureCorrection ? (yf.set(this.baseColor),
        yf.offsetHSL(this.baseColorTextureHslOffset.h, this.baseColorTextureHslOffset.s, this.baseColorTextureHslOffset.l),
        c = Math.max(1 + this.baseColorTextureContrast, 0),
        this._baseColorCorrectionUniform.set(c * (yf.r - this.baseColor.r - .5) + .5, c * (yf.g - this.baseColor.g - .5) + .5, c * (yf.b - this.baseColor.b - .5) + .5, c)) : this._baseColorCorrectionUniform.set(0, 0, 0, 1);
        this.setUniform("baseColorCorrection", "v4", this._baseColorCorrectionUniform);
        c = null;
        if (this._baseColorTexture)
            if (this._baseColorTexture.parentTexture && !this._baseColorTexture.extractedTexture) {
                c = this._baseColorTexture.parentTexture;
                var d = this._baseColorTexture.uvOffsetScale
            } else
                c = this._baseColorTexture.extractedTexture || this._baseColorTexture,
                d = Af;
        this.condDefine(c && c.loaded, "USE_BASE_COLOR_TEXTURE") ? (this.setUniform("baseColorTexture", "t", c),
        b = !0,
        this.setUniform("baseColorAtlasUvMod", "v4", d),
        this._useBaseColorTextureAsCutout() ? this.setUniform("alphaDiscardThreshold", "f", .25) : this.setUniform("alphaDiscardThreshold", "f", 0)) : this.setUniform("baseColor", "c", this.baseColor);
        this.condDefine(this._useAlphaInLowerHalf(), "USE_ALPHA_IN_LOWER_HALF");
        this.condDefine(this._useChromaKey(), "USE_CHROMA_KEY") && (this.setUniform("chromaKeyColor", "c", this.chromaKeyColor),
        d = this._chromaKeyDelta,
        this._chromaKeyDeltaCoeff.x = 1 / (1.22 * d.x),
        this._chromaKeyDeltaCoeff.y = 1 / (1.22 * d.y),
        this._chromaKeyDeltaCoeff.z = 1 / (1.22 * d.z),
        this.setUniform("chromaKeyDeltaCoeff", "v3", this._chromaKeyDeltaCoeff));
        c = this.bumpTexture;
        this.condDefine(c && c.loaded && a, "USE_BUMP_TEXTURE") && (this.enableStandardDerivativesExtension(),
        this.setUniform("bumpTexture", "t", c),
        b = !0,
        this.setUniform("bumpScale", "f", this.bumpScale),
        this.condDefine(this.parallaxCorrection, "USE_PARALLAX_CORRECTION") && (this.addDefine(WALK.ParallaxModes[this.parallaxMode]),
        this.setUniform("parallaxScale", "f", this.parallaxScale),
        this.setUniform("parallaxMinLayers", "f", this.parallaxMinLayers),
        this.setUniform("parallaxMaxLayers", "f", this.parallaxMaxLayers)));
        b && this.setUniform("uvMod", "v4", this._uvOffsetScale || Af);
        this.condDefine(this.lightMapped, "USE_LIGHTMAP") && (this.setUniform("lightMap", "t", null),
        this.setUniform("lightMapSize", "v2", this._lightMapSize));
        this.condDefine(a, "USE_ENVMAP") && (this._haveTextureLod && this.enableTextureLodExtension(),
        this._setLightProbeUniforms());
        this.condDefine(this.highlight, "USE_HIGHLIGTH") && (this.setUniform("highlight", "c", this.highlight),
        this.setUniform("highlightMix", "f", this.highlightMix));
        this.condDefine((this.headLight || !this.lightMapped) && !this.specularOff, "USE_HEADLIGHT")
    }
    ;
    WALK.StandardMaterial.prototype.forceObjectUniformsRefresh = function() {
        this._lastUsedLightProbeId = null
    }
    ;
    WALK.StandardMaterial.prototype.textureNeedsUv0 = function() {
        return !0
    }
    ;
    WALK.StandardMaterial.prototype.hash = function() {
        return this.baseColorTexture ? "standard" + this.baseColorTexture.name : "standard#" + this.baseColor.r + ":" + this.baseColor.g + ":" + this.baseColor.b
    }
    ;
    WALK.StandardMaterial.prototype.canMerge = function(a) {
        if (this.type !== a.type || this.opacity !== a.opacity)
            return !1;
        if (this._baseColorTexture || a._baseColorTexture) {
            if (this._baseColorTexture !== a._baseColorTexture || this.baseColorTextureCorrection !== a.baseColorTextureCorrection || this.baseColorTextureContrast !== a.baseColorTextureContrast || this.baseColorTextureHslOffset.h !== a.baseColorTextureHslOffset.h || this.baseColorTextureHslOffset.s !== a.baseColorTextureHslOffset.s || this.baseColorTextureHslOffset.l !== a.baseColorTextureHslOffset.l || this._useAlphaInLowerHalf() !== a._useAlphaInLowerHalf() || (this._useChromaKey() ? !(a._useChromaKey() && this.chromaKeyColor.equals(a.chromaKeyColor) && this._chromaKeyDelta.equals(a._chromaKeyDelta)) : a._useChromaKey()))
                return !1
        } else if (!this.baseColor.equals(a.baseColor))
            return !1;
        if (this.emissive || a.emissive)
            if (this.emissive !== a.emissive || this.emissionStrength !== a.emissionStrength)
                return !1;
        if (this.roughnessTexture || a.roughnessTexture) {
            if (this.roughnessTexture !== a.roughnessTexture)
                return !1
        } else if (this.roughness !== a.roughness)
            return !1;
        if (this.metallicTexture || a.metallicTexture) {
            if (this.metallicTexture !== a.metallicTexture)
                return !1
        } else if (this.metallic !== a.metallic)
            return !1;
        return (this.bumpTexture || a.bumpTexture) && (this.bumpTexture !== a.bumpTexture || this.bumpScale !== a.bumpScale) || this.envMapProject !== a.envMapProject || this.doubleSided !== a.doubleSided || this.parallaxCorrection || a.parallaxCorrection ? !1 : !0
    }
    ;
    WALK.StandardMaterial.prototype.refreshPerObjectUniforms = function(a, b) {
        var c = !1;
        if (!this.isLightProbeDisabled()) {
            var d = a.lightProbe;
            if (this._lastUsedLightProbeId !== d.id) {
                c = !0;
                this._lastUsedLightProbeId = d.id;
                var e = this.envMapMirror ? d.getMirrorTexture() : this._haveTextureLod ? d.getFilteredTexture() : d.getFilteredTextureNoLod(this._mipLevel0);
                b.envMap.value = e;
                this._haveTextureLod || (b.envMap2.value = d.getFilteredTextureNoLod(this._mipLevel1));
                this.envMapMirror || (b.envMipsCount.value = WALK.LIGHT_PROBE_MIPS_COUNT);
                this.envMapProject && (d.isBoundingBoxEnabled() ? (b.envMapPosW.value = d.position,
                b.envBoxMin.value = d.boxMin,
                b.envBoxMax.value = d.boxMax) : (b.envBoxMin.value = zf,
                b.envBoxMax.value = zf))
            }
        }
        a = a.lightMap;
        this.lightMapped && b.lightMap.value !== a && (c = !0,
        b.lightMap.value = a,
        b.lightMapSize.value.x = a.width,
        b.lightMapSize.value.y = a.height);
        return c
    }
    ;
    WALK.StandardMaterial.prototype.setBaseColorRGB = function(a, b, c) {
        this.baseColor.setRGB(a, b, c);
        this.setUniforms();
        this._updated()
    }
    ;
    WALK.StandardMaterial.prototype.setTexture = function(a, b) {
        if (b) {
            var c = this.baseColorTexture;
            c && (b.wrapS = c.wrapS,
            b.wrapT = c.wrapT,
            b.anisotropy = c.anisotropy)
        }
        this[a] = b || null;
        "baseColorTexture" === a ? (this._baseColorTextureCorrection = !1,
        this._baseColorTextureContrast = 0,
        this.baseColorTextureHslOffset.h = 0,
        this.baseColorTextureHslOffset.s = 0,
        this.baseColorTextureHslOffset.l = 0) : "bumpTexture" === a && (this._bumpScale = .001)
    }
    ;
    WALK.StandardMaterial.prototype.serialize = function() {
        function a(a) {
            var c = b[a];
            d[a] = c ? c.serialize() : null
        }
        var b = this
          , c = null;
        console.assert(!this.merged);
        this.baseColorTextureCorrection && (c = {
            contrast: this.baseColorTextureContrast,
            hslOffset: [this.baseColorTextureHslOffset.h, this.baseColorTextureHslOffset.s, this.baseColorTextureHslOffset.l]
        });
        var d = {
            name: this.name,
            type: this.type,
            baseColor: this.baseColor.roundChannels().toArray(),
            baseColorTextureCorrection: c,
            alphaInLowerHalf: this.alphaInLowerHalf,
            opacity: this.opacity,
            emissive: this.emissive,
            emissionStrength: this.emissionStrength,
            roughness: this.roughness,
            metallic: this.metallic,
            envMapProject: this.envMapProject,
            bumpScale: this.bumpScale,
            doubleSided: this.doubleSided,
            doNotImport: this.doNotImport
        };
        void 0 !== this._chromaKeyEnabled && (d.chromaKeyEnabled = this.chromaKeyEnabled,
        d.chromaKeyColor = this.chromaKeyColor.roundChannels().toArray(),
        d.chromaKeyDelta = this._chromaKeyDelta.toArray());
        d.uvOffsetScale = this.uvOffsetAndScaleEnabled ? this._uvOffsetScale.toArray() : null;
        a("baseColorTexture");
        a("roughnessTexture");
        a("metallicTexture");
        a("bumpTexture");
        return d
    }
    ;
    WALK.StandardMaterialWater = function() {
        WALK.StandardMaterial.call(this);
        this.type = "water";
        this._isPlaying = !0;
        this._isSleeping = !1;
        this.setUniform("time", "f", 0);
        this._roughness = 0;
        this.baseColor = new t.Color(0);
        this._wavesScale = this._wavesSpeed = 1;
        this._refractionFactor = 0;
        this.opacity = .2;
        this.doNotImport = {
            baseColor: !0,
            baseColorTexture: !0,
            opacity: !0
        }
    }
    ;
    WALK.StandardMaterialWater.prototype = Object.create(WALK.StandardMaterial.prototype);
    WALK.StandardMaterialWater.prototype.constructor = WALK.StandardMaterialWater;
    WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");
    WALK.StandardMaterialWater.prototype.textureNeedsUv0 = function() {
        return !1
    }
    ;
    WALK.StandardMaterialWater.prototype.hash = function() {
        return "water"
    }
    ;
    WALK.StandardMaterialWater.prototype.canMerge = function(a) {
        return this.type === a.type && this.opacity === a.opacity && this.baseColor.equals(a.baseColor) && this.normalTexture === a.normalTexture && this.wavesSpeed === a.wavesSpeed && this.wavesScale === a.wavesScale && this.refractionFactor === a.refractionFactor
    }
    ;
    WALK.StandardMaterialWater.prototype.setUniforms = function() {
        WALK.StandardMaterial.prototype.setUniforms.call(this);
        var a = this.normalTexture;
        this.condDefine(a && a.loaded && !this.isLightProbeDisabled(), "USE_NORMAL_TEXTURE") && (this.setUniform("normalTexture", "t", a),
        this.setUniform("wavesScale", "f", this.wavesScale),
        1 !== this.opacity ? this.setUniform("refractionFactor", "f", this.refractionFactor) : this.setUniform("refractionFactor", "f", 0))
    }
    ;
    WALK.StandardMaterialWater.prototype.fragmentShaderHooks = function() {
        return WALK.getShader("water.glsl")
    }
    ;
    Object.defineProperty(WALK.StandardMaterialWater.prototype, "refractionFactor", {
        get: function() {
            return this._refractionFactor
        },
        set: function(a) {
            this._refractionFactor = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterialWater.prototype, "wavesSpeed", {
        get: function() {
            return this._wavesSpeed
        },
        set: function(a) {
            this._wavesSpeed = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterialWater.prototype, "wavesScale", {
        get: function() {
            return this._wavesScale
        },
        set: function(a) {
            this._wavesScale = a;
            this.setUniforms();
            this._updated()
        }
    });
    Object.defineProperty(WALK.StandardMaterialWater.prototype, "hideFromLightProbes", {
        get: function() {
            return 1 !== this.opacity && 0 !== this.refractionFactor
        }
    });
    Object.defineProperty(WALK.StandardMaterialWater.prototype, "isAnimated", {
        get: function() {
            return !0
        }
    });
    Object.defineProperty(WALK.StandardMaterialWater.prototype, "isPlaying", {
        get: function() {
            return !this._isSleeping && this._isPlaying && 0 < this.wavesSpeed
        }
    });
    WALK.StandardMaterialWater.prototype.play = function() {
        this._isPlaying = !0
    }
    ;
    WALK.StandardMaterialWater.prototype.pause = function() {
        this._isPlaying = !1
    }
    ;
    WALK.StandardMaterialWater.prototype.sleepAnimation = function() {
        this._isSleeping = !0
    }
    ;
    WALK.StandardMaterialWater.prototype.wakeAnimation = function() {
        this._isSleeping = !1
    }
    ;
    WALK.StandardMaterialWater.prototype.update = function(a) {
        this.uniforms.time.value += a * this.wavesSpeed * .1
    }
    ;
    WALK.StandardMaterialWater.prototype.serialize = function() {
        return {
            name: this.name,
            type: this.type,
            baseColor: this.baseColor.roundChannels().toArray(),
            baseColorTexture: null,
            opacity: this.opacity,
            normalTexture: this.normalTexture ? this.normalTexture.serialize() : null,
            wavesSpeed: this.wavesSpeed,
            wavesScale: this.wavesScale,
            refractionFactor: this.refractionFactor,
            doNotImport: this.doNotImport
        }
    }
    ;
    var Bf = WALK.getShader("standard_material_vertex.glsl")
      , Cf = WALK.getShader("luma_fragment.glsl")
      , Df = new t.Color(16777215);
    WALK.LumaMaterial = function(a) {
        WALK.BaseMaterial.call(this, Bf, Cf);
        this.computeIncidentLuma = a;
        this.setUniform("lightMap", "t", null);
        this.setUniform("lightMapSize", "v2", new t.Vector2);
        this.color = new t.Color(Df);
        this.setUniform("color", "c", this.color);
        this.addDefine("USE_LIGHTMAP")
    }
    ;
    WALK.LumaMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.LumaMaterial.prototype.constructor = WALK.LumaMaterial;
    WALK.LumaMaterial.prototype.refreshPerObjectUniforms = function(a, b) {
        var c = a.lightMap
          , d = !1;
        b.lightMap.value !== c && (b.lightMap.value = c,
        b.lightMapSize.value.x = c.width,
        b.lightMapSize.value.y = c.height,
        d = !0);
        a = this.computeIncidentLuma ? Df : a.material.baseColor;
        a.equals(this.color) || (this.color.copy(a),
        d = !0);
        return d
    }
    ;
    WALK.DebugMaterial = function() {
        WALK.StandardMaterial.call(this);
        this.noSharedBuffers = new t.Color(16777215);
        this.sharedBuffersMaster = new t.Color(255);
        this.sharedBuffersCopy = new t.Color(65280);
        this.headLight = !0;
        this.setUniforms();
        this.defaultAttributeValues = Object.assign({}, this.defaultAttributeValues);
        this.defaultAttributeValues.sphericalNormal = [0, 0]
    }
    ;
    WALK.DebugMaterial.prototype = Object.create(WALK.StandardMaterial.prototype);
    WALK.DebugMaterial.prototype.refreshPerObjectUniforms = function(a, b) {
        b.baseColor.value = 0 === a.sharedBuffersDebug ? this.noSharedBuffers : 1 === a.sharedBuffersDebug ? this.sharedBuffersMaster : this.sharedBuffersCopy;
        return !0
    }
    ;
    var Ef = WALK.getShader("equirect_sky_vertex.glsl")
      , Ff = WALK.getShader("equirect_sky_fragment.glsl");
    WALK.EquirectSkyMaterial = function() {
        WALK.BaseMaterial.call(this, Ef, Ff);
        this.depthWrite = !1;
        this.side = t.FrontSide;
        this.uniforms = {
            map: {
                type: "t",
                value: null
            }
        };
        this.toneMappingSupported = this.exposureAndGammaSupported = this.colorMapSupported = this.hdrOutputSupported = this.fogSupported = !0
    }
    ;
    WALK.EquirectSkyMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.EquirectSkyMaterial.prototype.constructor = WALK.EquirectSkyMaterial;
    Object.defineProperty(WALK.EquirectSkyMaterial.prototype, "map", {
        get: function() {
            return this.uniforms.map.value
        },
        set: function(a) {
            this.uniforms.map.value = a;
            this.condDefine(this.map.isRgbm, "USE_RGBM_MAP")
        }
    });
    WALK.ProceduralSkyMaterial = function() {
        WALK.BaseMaterial.call(this, WALK.getShader("procedural_sky_vertex.glsl"), WALK.getShader("procedural_sky_fragment.glsl"));
        this.depthWrite = !1;
        this.side = t.BackSide;
        this.uniforms = {
            topColor: {
                type: "c",
                value: new t.Color(15135487)
            },
            bottomColor: {
                type: "c",
                value: new t.Color(16777215)
            },
            sinBottomAngle: {
                type: "f",
                value: Math.sin(t.Math.degToRad(-30))
            },
            exponent: {
                type: "f",
                value: .9
            }
        };
        this.toneMappingSupported = this.exposureAndGammaSupported = this.colorMapSupported = this.hdrOutputSupported = this.fogSupported = !0
    }
    ;
    WALK.ProceduralSkyMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.ProceduralSkyMaterial.prototype.constructor = WALK.ProceduralSkyMaterial;
    var Gf = WALK.getShader("object_distance_vertex.glsl")
      , Hf = WALK.getShader("object_id_fragment.glsl")
      , If = WALK.getShader("object_id_distance_fragment.glsl");
    WALK.ObjectDistanceMaterial = function(a) {
        WALK.BaseMaterial.call(this, Gf, a ? Hf : If);
        this.doNotOverrideSide = !0;
        this.uniforms = {
            objectId: {
                type: "i",
                value: null
            }
        }
    }
    ;
    WALK.ObjectDistanceMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.ObjectDistanceMaterial.prototype.constructor = WALK.ObjectDistanceMaterial;
    WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms = function(a, b) {
        b.objectId.value = a.visibilityId;
        return !0
    }
    ;
    var Jf = WALK.getShader("wireframe_vertex.glsl")
      , Kf = WALK.getShader("wireframe_fragment.glsl");
    WALK.WireframeMaterial = function(a) {
        WALK.BaseMaterial.call(this, Jf, Kf);
        this.lineColor = a;
        this.setUniform("lineColor", "c", a);
        this.setUniform("lineMaxAlpha", "f", .65);
        this.setUniform("highlight", "c", WALK.EDITOR_SELECTION_COLOR);
        this.setUniform("highlightMix", "f", 0);
        this.customLightmapResolutionLineColor = new t.Color(170);
        this.autoLightmapResolutionLineColor = new t.Color(43690);
        this.meshSelectedLineColor = new t.Color(47872);
        this.meshSelectedSecondaryLineColor = new t.Color(13404160);
        this.transparent = !0;
        this.blending = t.NormalBlending;
        this.depthWrite = this.depthTest = !1;
        this.attributes = this.attributes.concat(["order"]);
        this.enableStandardDerivativesExtension()
    }
    ;
    WALK.WireframeMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.WireframeMaterial.prototype.constructor = WALK.WireframeMaterial;
    WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");
    WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");
    WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");
    WALK.WireframeMaterial.prototype.refreshPerObjectUniforms = function(a, b) {
        var c = !1;
        null !== a.highlightMix && void 0 !== a.highlightMix && a.highlightMix !== b.highlightMix.value && (b.highlightMix.value = a.highlightMix,
        c = !0);
        return null !== a.selected && void 0 !== a.selected && (a = !0 === a.selected ? this.meshSelectedLineColor : !0 === a.selectedSecondary ? this.meshSelectedSecondaryLineColor : null !== a.node.lightmapResolution ? this.customLightmapResolutionLineColor : 0 <= a.autoLightmapResolution ? this.autoLightmapResolutionLineColor : this.lineColor,
        b.lineColor.value !== a) ? (b.lineColor.value = a,
        !0) : c
    }
    ;
    var Lf = new t.Vector3;
    function Mf(a, b, c, d) {
        for (var e = [], f = 0; 6 > f; f += 1) {
            var g = d ? new t.OrthographicCamera(-1,1,1,-1,a,b) : new t.PerspectiveCamera(90,1,a,b);
            c.add(g);
            e.push(g)
        }
        e[0].up.set(0, -1, 0);
        Lf.set(1, 0, 0);
        e[0].lookAt(Lf);
        e[1].up.set(0, -1, 0);
        Lf.set(-1, 0, 0);
        e[1].lookAt(Lf);
        e[2].up.set(0, 0, 1);
        Lf.set(0, 1, 0);
        e[2].lookAt(Lf);
        e[3].up.set(0, 0, -1);
        Lf.set(0, -1, 0);
        e[3].lookAt(Lf);
        e[4].up.set(0, -1, 0);
        Lf.set(0, 0, 1);
        e[4].lookAt(Lf);
        e[5].up.set(0, -1, 0);
        Lf.set(0, 0, -1);
        e[5].lookAt(Lf);
        return e
    }
    function Nf(a, b) {
        t.Object3D.call(this);
        this.sideCameras = Mf(a, b, this, !1)
    }
    Nf.prototype = Object.create(t.Object3D.prototype);
    Nf.prototype.constructor = Nf;
    function Of(a, b) {
        t.Object3D.call(this);
        this.sideCameras = Mf(a, b, this, !0)
    }
    Of.prototype = Object.create(t.Object3D.prototype);
    Of.prototype.constructor = Of;
    function Pf(a, b, c) {
        var d = new WALK.ObjectDistanceMaterial(!0)
          , e = new Nf(WALK.CAMERA_WALK_NEAR,c)
          , f = WALK.OBJECT_VISIBILITY_TARGET_SIZE
          , g = a.createRenderTarget(f, f, {
            format: GLC.RGBA,
            magFilter: GLC.NEAREST,
            minFilter: GLC.NEAREST,
            depthBuffer: !0,
            stencilBuffer: !1,
            generateMipmaps: !1
        })
          , h = new Uint8Array(4 * f * f)
          , l = new xc(a)
          , m = new yc(a)
          , n = new t.Color(16777215);
        this.findVisibleObjects = function(c) {
            var p = new Set
              , r = [];
            e.position.copy(c);
            e.updateMatrixWorld();
            for (c = 0; c < b.length; c += 1) {
                var u = b[c];
                console.assert(!u.visibilityId);
                u.visibilityId = c;
                r.push(u)
            }
            l.set(!0, !0, !1);
            m.set(n);
            for (c = 0; 6 > c; c += 1) {
                a.renderMeshes(r, d, e.sideCameras[c], g);
                a.readPixels(f, f, h);
                u = h;
                for (var v = u.length, w = 0; w < v; w += 4) {
                    var x = Math.round(65536 * u[w] + 256 * u[w + 1] + u[w + 2]);
                    16777215 !== x && p.add(x)
                }
            }
            m.restore();
            l.restore();
            r = [];
            p = k.makeIterator(p);
            for (c = p.next(); !c.done; c = p.next())
                r.push(b[c.value]);
            for (p = 0; p < b.length; p += 1)
                b[p].visibilityId = null;
            return r
        }
        ;
        this.dispose = function() {
            d.dispose();
            g.dispose();
            h = g = null
        }
    }
    ;var Qf = WALK.getShader("aabb_query_vertex.glsl")
      , Rf = WALK.getShader("aabb_query_fragment.glsl");
    WALK.AabbQueryMaterial = function() {
        WALK.BaseMaterial.call(this, Qf, Rf);
        this.side = t.DoubleSide;
        this.uniforms = {
            axis: {
                type: "i",
                value: 0
            }
        }
    }
    ;
    WALK.AabbQueryMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.AabbQueryMaterial.prototype.constructor = WALK.AabbQueryMaterial;
    Object.defineProperty(WALK.AabbQueryMaterial.prototype, "axis", {
        get: function() {
            return this.uniforms.axis.value
        },
        set: function(a) {
            console.assert(0 === a || 1 === a || 2 === a);
            this.uniforms.axis.value = a
        }
    });
    var Sf = WALK.getShader("gaze_pointer_vertex.glsl")
      , Tf = WALK.getShader("gaze_pointer_fragment.glsl");
    WALK.GazePointerMaterial = function() {
        WALK.BaseMaterial.call(this, Sf, Tf);
        this.blending = t.NormalBlending;
        this.transparent = !0;
        this.transparentRenderOrder = 2;
        this.setUniform("circleSpan", "f", 0)
    }
    ;
    WALK.GazePointerMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.GazePointerMaterial.prototype.constructor = WALK.GazePointerMaterial;
    Object.defineProperty(WALK.GazePointerMaterial.prototype, "circleSpan", {
        set: function(a) {
            console.assert(1 >= a);
            this.uniforms.circleSpan.value = 2 * Math.PI * a - Math.PI
        }
    });
    var Uf = WALK.getShader("editor_light_vertex.glsl")
      , Vf = WALK.getShader("editor_light_fragment.glsl");
    WALK.LightMaterial = function(a) {
        WALK.BaseMaterial.call(this, Uf, Vf);
        this.setUniform("color", "c", a.color);
        this.setUniform("highlight", "c", WALK.EDITOR_SELECTION_COLOR);
        this.setUniform("highlightMix", "f", 0)
    }
    ;
    WALK.LightMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.LightMaterial.prototype.propertyFromUniform("highlightMix");
    WALK.MirrorMaterial = function(a, b) {
        WALK.BaseMaterial.call(this, WALK.getShader("mirror_vertex.glsl"), WALK.getShader("mirror_fragment.glsl"));
        this.hideFromLightProbes = !0;
        this.uniforms = {
            mirrorColor: {
                type: "c",
                value: a
            },
            mirrorSampler: {
                type: "t",
                value: null
            },
            textureMatrix: {
                type: "m4",
                value: b
            }
        };
        this.hdrOutputSupported = !0
    }
    ;
    WALK.MirrorMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.MirrorMaterial.prototype.constructor = WALK.MirrorMaterial;
    Object.defineProperty(WALK.MirrorMaterial.prototype, "mirrorSampler", {
        get: function() {
            return this.uniforms.mirrorSampler.value
        },
        set: function(a) {
            this.uniforms.mirrorSampler.value = a
        }
    });
    var Wf = WALK.getShader("cap_vertex.glsl")
      , Xf = WALK.getShader("cap_fragment.glsl");
    WALK.CapMaterial = function(a) {
        WALK.BaseMaterial.call(this, Wf, Xf);
        this.side = t.DoubleSide;
        this.uniforms = {
            color: {
                type: "c",
                value: a
            }
        }
    }
    ;
    WALK.CapMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.CapMaterial.prototype.constructor = WALK.CapMaterial;
    var Yf = WALK.getShader("outline_vertex.glsl")
      , Zf = WALK.getShader("outline_fragment.glsl");
    WALK.OutlineMaterial = function(a, b) {
        WALK.BaseMaterial.call(this, Yf, Zf);
        this.side = t.DoubleSide;
        this.uniforms = {
            color: {
                type: "c",
                value: a
            },
            thickness: {
                type: "f",
                value: b
            }
        }
    }
    ;
    WALK.OutlineMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.OutlineMaterial.prototype.constructor = WALK.OutlineMaterial;
    WALK.createBoundingBoxMaterial = function() {
        var a = new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);
        a.depthTest = !0;
        a.depthWrite = !1;
        a.side = t.DoubleSide;
        a.hideFromLightProbes = !0;
        return a
    }
    ;
    var $f = WALK.getShader("anchor_vertex.glsl");
    WALK.AnchorMaterial = function() {
        WALK.StandardMaterial.call(this);
        this._vertexShaderBody = $f;
        this._metallic = .1;
        this._roughness = .5;
        this._bumpScale = .01;
        this.hideFromLightProbes = !0
    }
    ;
    WALK.AnchorMaterial.prototype = Object.create(WALK.StandardMaterial.prototype);
    var ag = WALK.getShader("sprite_vertex.glsl");
    WALK.SpriteMaterial = function() {
        WALK.StandardMaterial.call(this);
        this._vertexShaderBody = ag;
        this.hideFromLightProbes = !0;
        this.setUniform("offset", "v3", new t.Vector3(0,0,0))
    }
    ;
    WALK.SpriteMaterial.prototype = Object.create(WALK.StandardMaterial.prototype);
    Object.defineProperty(WALK.SpriteMaterial.prototype, "offset", {
        set: function(a) {
            this.uniforms.offset.value = a
        }
    });
    var bg = WALK.getShader("rotate_gizmo_material_vertex.glsl")
      , cg = WALK.getShader("rotate_gizmo_material_fragment.glsl");
    WALK.RotateGizmoMaterial = function(a, b) {
        WALK.BaseMaterial.call(this, bg, cg);
        this.blending = t.NormalBlending;
        this.depthWrite = this.depthTest = !1;
        this.transparent = !0;
        this.transparentRenderOrder = 1E3;
        this.hideFromLightProbes = !0;
        this.uniforms = {
            opacity: {
                type: "f",
                value: 1
            },
            color: {
                type: "c",
                value: a
            },
            gizmoPosition: {
                type: "v3",
                value: new t.Vector3(0,0,0)
            },
            sphereRadius: {
                type: "f",
                value: 1
            }
        };
        Object.defineProperty(this, "color", {
            get: function() {
                return this.uniforms.color.value
            }
        });
        Object.defineProperty(this, "opacity", {
            get: function() {
                return this.uniforms.opacity.value
            },
            set: function(a) {
                this.uniforms.opacity.value = a
            }
        });
        Object.defineProperty(this, "gizmoPosition", {
            get: function() {
                return this.uniforms.gizmoPosition.value
            }
        });
        Object.defineProperty(this, "sphereRadius", {
            get: function() {
                return this.uniforms.sphereRadius.value
            },
            set: function(a) {
                this.uniforms.sphereRadius.value = a
            }
        });
        this.opacity = b;
        this.setUniforms = function() {}
    }
    ;
    WALK.RotateGizmoMaterial.prototype = Object.create(WALK.BaseMaterial.prototype);
    WALK.RotateGizmoMaterial.prototype.constructor = WALK.RotatoGizmoMaterial;
    WALK.LightInstance = function(a, b, c) {
        this.light = a;
        this.position = b;
        this.rotation = c;
        this._directionW = new t.Vector3
    }
    ;
    WALK.LightInstance.prototype = {
        constructor: WALK.LightInstance,
        directionW: function() {
            this._directionW.set(0, 1, 0);
            this._directionW.applyEuler(this.rotation);
            return this._directionW
        },
        get index() {
            var a = this.light.instances.indexOf(this);
            console.assert(-1 !== a, "Light instance not found");
            return a
        },
        setPosition: function(a, b, c) {
            this.position.set(a, b, c);
            this.light._updated()
        },
        setRotation: function(a, b, c) {
            this.rotation.yaw = WALK.normalizeRotation(a);
            this.rotation.pitch = WALK.normalizeRotation(b);
            this.rotation.roll = WALK.normalizeRotation(c);
            this.light._updated()
        },
        setRotationDeg: function(a, b, c) {
            a = t.Math.degToRad(a);
            b = t.Math.degToRad(b);
            c = void 0 === c ? this.rotation.roll : t.Math.degToRad(c);
            this.setRotation(a, b, c)
        },
        serialize: function() {
            return {
                position: this.position.toArray(),
                rotation: this.rotation.toDegTriple()
            }
        }
    };
    var dg = "angle color height photometricProfile strength size type width".split(" ");
    WALK.Light = function(a) {
        this._name = a.name;
        this._type = a.type || "spot";
        if (void 0 !== a.strength)
            var b = a.strength;
        else
            a: {
                switch (this._type) {
                case "point":
                case "spot":
                case "area":
                    b = 25;
                    break a;
                case "sun":
                    b = 8;
                    break a;
                default:
                    console.assert(!1)
                }
                b = void 0
            }
        this._strength = b;
        if (void 0 !== a.color)
            b = (new t.Color).fromArray(a.color);
        else
            a: {
                switch (this._type) {
                case "point":
                case "spot":
                case "area":
                    b = new t.Color(1,.88,.799);
                    break a;
                case "sun":
                    b = new t.Color(1,.799,.658);
                    break a;
                default:
                    console.assert(!1)
                }
                b = void 0
            }
        this._color = b;
        if (void 0 !== a.size)
            b = a.size;
        else
            a: {
                switch (this._type) {
                case "point":
                case "spot":
                case "area":
                    b = .1;
                    break a;
                case "sun":
                    b = .02;
                    break a;
                default:
                    console.assert(!1)
                }
                b = void 0
            }
        this._size = b;
        this._width = void 0 !== a.width ? a.width : .2;
        this._height = void 0 !== a.height ? a.height : .2;
        this._angle = void 0 !== a.angle ? a.angle : 140;
        this._photometricProfile = void 0 !== a.photometricProfile ? a.photometricProfile : null;
        !0 === a.doNotImport ? this.doNotImport = !0 : (this.doNotImport = {},
        a.doNotImport && WALK.copyProperties(a.doNotImport, dg, this.doNotImport));
        this.instances = []
    }
    ;
    WALK.Light.prototype = {
        constructor: WALK.Light,
        forEachLightInstance: function(a) {
            for (var b = 0; b < this.instances.length; b += 1)
                a(this.instances[b])
        },
        get name() {
            return this._name
        },
        set name(a) {
            this._name = a;
            this._updated()
        },
        get type() {
            return this._type
        },
        set type(a) {
            this._type = a;
            this._updated()
        },
        get size() {
            return this._size
        },
        set size(a) {
            this._size = a;
            this._updated()
        },
        get width() {
            return this._width
        },
        set width(a) {
            this._width = a;
            this._updated()
        },
        get height() {
            return this._height
        },
        set height(a) {
            this._height = a;
            this._updated()
        },
        get angle() {
            return this._angle
        },
        set angle(a) {
            this._angle = a;
            this._updated()
        },
        get color() {
            return this._color
        },
        setColorRGB: function(a, b, c) {
            this._color.setRGB(a, b, c);
            this._updated()
        },
        get strength() {
            return this._strength
        },
        set strength(a) {
            this._strength = a;
            this._updated()
        },
        get photometricProfile() {
            return this._photometricProfile
        },
        set photometricProfile(a) {
            this._photometricProfile = a;
            this._updated()
        },
        setDoNotImport: function(a, b) {
            this.doNotImport[a] = b;
            this._updated()
        },
        addInstance: function(a, b) {
            b = void 0 === b ? [0, -90, 0] : b;
            a = (new t.Vector3).fromArray(a);
            b = (new WALK.Euler).setFromDegTriple(b);
            b = new WALK.LightInstance(this,a,b);
            this.instances.push(b);
            this.dispatchEvent({
                type: "instanceAdded",
                instance: b,
                target: this
            })
        },
        removeInstance: function(a) {
            WALK.removeFromArray(a, this.instances);
            this.dispatchEvent({
                type: "instanceRemoved",
                instance: a,
                target: this
            })
        },
        serialize: function() {
            return {
                name: this.name,
                type: this.type,
                angle: this.angle,
                strength: this.strength,
                photometricProfile: this.photometricProfile,
                size: this.size,
                width: this.width,
                height: this.height,
                color: this.color.roundChannels().toArray(),
                doNotImport: this.doNotImport,
                instances: this.instances.map(function(a) {
                    return a.serialize()
                })
            }
        },
        _updated: function() {
            this.dispatchEvent({
                type: "updated",
                target: this
            })
        }
    };
    t.EventDispatcher.prototype.apply(WALK.Light.prototype);
    WALK.Light.iterateLightInstances = function(a, b) {
        for (var c = 1, d = 0; d < a.length; d += 1)
            for (var e = a[d], f = 0; f < e.instances.length; f += 1,
            c += 1)
                b(e, e.instances[f], c)
    }
    ;
    WALK.LightProbe = function(a) {
        this.id = a.id;
        this.position = new t.Vector3;
        a.position && this.position.fromArray(a.position);
        this._filteredCubeTexture = null;
        this._filteredCubeTextureNoLod = {};
        this._mirrorCubeTexture = null;
        this._boxEnabled = a.box ? !("enabled"in a.box) || a.box.enabled : !1;
        this.boxMin = new t.Vector3;
        this.boxMax = new t.Vector3;
        a.box && (this.boxMin.fromArray(a.box.min),
        this._setClampedBoxMax(a.box.max[0], a.box.max[1], a.box.max[2]))
    }
    ;
    WALK.LightProbe.prototype = {
        constructor: WALK.LightProbe,
        setFilteredTexture: function(a) {
            this._filteredCubeTexture && this._filteredCubeTexture.dispose();
            this._filteredCubeTexture = a
        },
        setFilteredTextureNoLod: function(a, b) {
            this._filteredCubeTextureNoLod[b] && this._filteredCubeTextureNoLod[b].dispose();
            this._filteredCubeTextureNoLod[b] = a
        },
        isBoundingBoxInitialized: function() {
            return !this.boxMin.equals(this.boxMax)
        },
        resetBoundingBox: function() {
            this.boxMin.set(0, 0, 0);
            this.boxMax.set(0, 0, 0)
        },
        isBoundingBoxEnabled: function() {
            return this._boxEnabled
        },
        disableBoundingBox: function() {
            this._boxEnabled = !1;
            this.dispatchEvent({
                type: "boundsUpdated",
                target: this
            })
        },
        enableBoundingBox: function() {
            this._boxEnabled = !0;
            this.isBoundingBoxInitialized() || this.dispatchEvent({
                type: "boundsInit",
                target: this
            });
            this.dispatchEvent({
                type: "boundsUpdated",
                target: this
            })
        },
        getFilteredTexture: function() {
            return this._filteredCubeTexture
        },
        getFilteredTextureNoLod: function(a) {
            return this._filteredCubeTextureNoLod[a]
        },
        setMirrorTexture: function(a) {
            this._mirrorCubeTexture && this._mirrorCubeTexture.dispose();
            this._mirrorCubeTexture = a
        },
        setPosition: function(a, b, c) {
            this.position.set(a, b, c);
            this.dispatchEvent({
                type: "positionUpdated",
                target: this
            })
        },
        texturesReady: function() {
            return this._mirrorCubeTexture || this._filteredCubeTexture || this._filteredCubeTextureNoLod[0]
        },
        getMirrorTexture: function() {
            return this._mirrorCubeTexture || this._filteredCubeTexture || this._filteredCubeTextureNoLod[0]
        },
        _setClampedBoxMin: function(a, b, c) {
            a > this.boxMax.x - .1 && (a = this.boxMax.x - .1);
            b > this.boxMax.y - .1 && (b = this.boxMax.y - .1);
            c > this.boxMax.z - .1 && (c = this.boxMax.z - .1);
            this.boxMin.set(a, b, c)
        },
        setBoxMin: function(a, b, c) {
            this._setClampedBoxMin(a, b, c);
            this.dispatchEvent({
                type: "boundsUpdated",
                target: this
            })
        },
        _setClampedBoxMax: function(a, b, c) {
            a < this.boxMin.x + .1 && (a = this.boxMin.x + .1);
            b < this.boxMin.y + .1 && (b = this.boxMin.y + .1);
            c < this.boxMin.z + .1 && (c = this.boxMin.z + .1);
            this.boxMax.set(a, b, c)
        },
        setBoxMax: function(a, b, c) {
            this._setClampedBoxMax(a, b, c);
            this.dispatchEvent({
                type: "boundsUpdated",
                target: this
            })
        },
        serialize: function() {
            var a = {
                id: this.id,
                position: this.position.toArray()
            };
            this.isBoundingBoxInitialized() && (a.box = {
                enabled: this._boxEnabled,
                min: this.boxMin.toArray(),
                max: this.boxMax.toArray()
            });
            return a
        },
        dispose: function() {
            this._filteredCubeTexture && (this._filteredCubeTexture.dispose(),
            this._filteredCubeTexture = null);
            for (var a in this._filteredCubeTextureNoLod)
                this._filteredCubeTextureNoLod.hasOwnProperty(a) && this._filteredCubeTextureNoLod[a].dispose();
            this._filteredCubeTextureNoLod = {};
            this._mirrorCubeTexture && (this._mirrorCubeTexture.dispose(),
            this._mirrorCubeTexture = null)
        }
    };
    t.EventDispatcher.prototype.apply(WALK.LightProbe.prototype);
    function eg(a) {
        return null !== a && void 0 !== a
    }
    WALK.NodeConfig = function(a) {
        var b = this;
        this.name = a.name;
        this._editable = a.editable || !1;
        this._setsDisableCollisions = eg(a.disableCollisions);
        this._disableCollisions = a.disableCollisions || !1;
        this._setsHideInViews = eg(a.hideInViews);
        this.hideInViews = null;
        a.hideInViews && (this.hideInViews = a.hideInViews,
        this.hideInViews.sort());
        this._lightmapResolution = (this._setsLightmapResolution = eg(a.lightmapResolution)) ? a.lightmapResolution : null;
        this._ground = eg(a.ground) ? a.ground : !1;
        this._faceCamera = a.faceCamera || null;
        this._rotate = a.rotate || !1;
        this._rotationSpeed = a.rotationSpeed || .1;
        this._isolateShadows = eg(a.isolateShadows) ? a.isolateShadows : !1;
        this.nodes = [];
        var c = {
            type: "updated",
            target: this
        };
        this._updated = function() {
            return b.dispatchEvent(c)
        }
    }
    ;
    WALK.NodeConfig.prototype.constructor = WALK.NodeConfig;
    t.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);
    function fg(a) {
        a.configure()
    }
    function gg(a) {
        a.visitSubtree(fg)
    }
    WALK.NodeConfig.prototype._configUpdated = function() {
        this.nodes.forEach(gg);
        this._updated()
    }
    ;
    WALK.NodeConfig.prototype.addNode = function(a) {
        this.nodes.push(a)
    }
    ;
    WALK.NodeConfig.prototype.isOnHideInViews = function(a) {
        return -1 !== this.hideInViews.indexOf(a)
    }
    ;
    WALK.NodeConfig.prototype.addToHideInViews = function(a) {
        for (var b = [], c = 0; c < arguments.length; ++c)
            b[c - 0] = arguments[c];
        console.assert(this.setsHideInViews);
        b = k.makeIterator(b);
        for (c = b.next(); !c.done; c = b.next())
            c = c.value,
            console.assert(!this.isOnHideInViews(c)),
            this.hideInViews.push(c);
        this._updated()
    }
    ;
    WALK.NodeConfig.prototype.removeFromHideInViews = function(a) {
        if (this.hideInViews)
            for (var b = 0; b < this.hideInViews.length; )
                this.hideInViews[b] === a ? this.hideInViews.splice(b, 1) : b += 1;
        this._updated()
    }
    ;
    WALK.NodeConfig.prototype.serialize = function() {
        return {
            name: this.name,
            disableCollisions: this.setsDisableCollisions ? this.disableCollisions : null,
            hideInViews: this.setsHideInViews ? this.hideInViews : null,
            lightmapResolution: this.setsLightmapResolution ? this.lightmapResolution : null,
            ground: this.ground ? !0 : null,
            faceCamera: this.faceCamera,
            rotate: this.rotate ? !0 : null,
            rotationSpeed: this.rotate ? this.rotationSpeed : null,
            isolateShadows: this.isolateShadows ? !0 : null
        }
    }
    ;
    Object.defineProperty(WALK.NodeConfig.prototype, "setsDisableCollisions", {
        get: function() {
            return this._setsDisableCollisions
        },
        set: function(a) {
            this._setsDisableCollisions = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "disableCollisions", {
        get: function() {
            return this._disableCollisions
        },
        set: function(a) {
            console.assert(this._setsDisableCollisions);
            this._disableCollisions = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "editable", {
        get: function() {
            return this._editable || this.faceCamera || this.rotate
        },
        set: function(a) {
            this._editable = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "ground", {
        get: function() {
            return this._ground
        },
        set: function(a) {
            this._ground = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "faceCamera", {
        get: function() {
            return this._faceCamera
        },
        set: function(a) {
            this._faceCamera = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "rotate", {
        get: function() {
            return this._rotate
        },
        set: function(a) {
            this._rotate = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "rotationSpeed", {
        get: function() {
            return this._rotationSpeed
        },
        set: function(a) {
            0 === a && (a = .01);
            this._rotationSpeed = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "setsLightmapResolution", {
        get: function() {
            return this._setsLightmapResolution
        },
        set: function(a) {
            this._setsLightmapResolution = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "lightmapResolution", {
        get: function() {
            return this._lightmapResolution
        },
        set: function(a) {
            console.assert(this._setsLightmapResolution);
            this._lightmapResolution = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "isolateShadows", {
        get: function() {
            return this._isolateShadows
        },
        set: function(a) {
            this._isolateShadows = a;
            this._configUpdated()
        }
    });
    Object.defineProperty(WALK.NodeConfig.prototype, "setsHideInViews", {
        get: function() {
            return this._setsHideInViews
        },
        set: function(a) {
            this._setsHideInViews = a;
            null === this.hideInViews && (this.hideInViews = []);
            this._configUpdated()
        }
    });
    function hg(a) {
        function b() {
            e = new t.Vector3;
            var b = new t.Box3;
            a.visitSubtree(function(a) {
                (a = a.mesh) && b.union(a.geometry.boundingBox)
            });
            b.center(e);
            d.elements[12] = -e.x;
            d.elements[13] = -e.y;
            d.elements[14] = -e.z
        }
        var c = new t.Matrix4, d = new t.Matrix4, e, f = new t.Vector3, g = new WALK.Euler;
        return function(h, l) {
            e || b();
            if (a.config.faceCamera)
                return f.copy(l).sub(e).normalize(),
                g.setFromDirection(f),
                "yaw" === a.config.faceCamera && (g.pitch = 0),
                c.makeRotationFromEuler(g),
                a.animationMatrix.identity().setPosition(e).multiply(c).multiply(d),
                !1;
            console.assert(a.config.rotate);
            g.yaw = WALK.normalizeRotation(g.yaw + 2 * Math.PI * a.config.rotationSpeed * h);
            c.makeRotationFromEuler(g);
            a.animationMatrix.identity().setPosition(e).multiply(c).multiply(d);
            return !0
        }
    }
    WALK.Node = function(a, b, c) {
        this.id = c.id;
        this.initialLightProbeId = void 0 === c.lightProbeId ? null : c.lightProbeId;
        this.parent = a;
        this.config = b;
        this.children = [];
        this.shadowsIsolatedWithin = this.lightmapResolution = this.hideInViews = this.animationMatrix = this.ground = this.disableCollisions = this._facesCnt = this.mesh = null;
        this.editable = !1;
        this.editableRoot = null;
        b.addNode(this);
        this.configure()
    }
    ;
    WALK.Node.prototype.constructor = WALK.Node;
    WALK.Node.prototype.configure = function() {
        this.ground = (this.disableCollisions = this.config.setsDisableCollisions ? this.config.disableCollisions : this.parent ? this.parent.disableCollisions : !1) ? !1 : this.config.ground;
        this.isAnimatedRoot ? (this.animationMatrix = new t.Matrix4,
        this.update = hg(this)) : this.animationMatrix = this.parent ? this.parent.animationMatrix : null;
        this.hideInViews = this.config.setsHideInViews ? this.config.hideInViews : this.parent ? this.parent.hideInViews : null;
        this.lightmapResolution = this.config.setsLightmapResolution ? this.config.lightmapResolution : this.parent ? this.parent.lightmapResolution : null;
        this.shadowsIsolatedWithin = this.config.isolateShadows ? this.config.name : this.parent && this.parent.shadowsIsolatedWithin ? this.parent.shadowsIsolatedWithin : null;
        this.editableRoot = (this.editable = this.config.editable) ? this : this.parent ? this.parent.editableRoot : null
    }
    ;
    WALK.Node.prototype.visitSubtree = function(a) {
        a(this);
        var b = this.children;
        if (b)
            for (var c = 0; c < b.length; c += 1)
                b[c].visitSubtree(a)
    }
    ;
    WALK.Node.prototype.facesInSubtree = function() {
        var a = this;
        null === a._facesCnt && (a._facesCnt = 0,
        a.visitSubtree(function(b) {
            b.mesh && (a._facesCnt += b.mesh.geometry.vertexCnt / 3)
        }));
        return a._facesCnt
    }
    ;
    WALK.Node.prototype.hide = function() {
        this.visitSubtree(function(a) {
            a.mesh && (a.mesh.visible = !1)
        })
    }
    ;
    WALK.Node.prototype.show = function() {
        this.visitSubtree(function(a) {
            a.mesh && (a.mesh.visible = !0)
        })
    }
    ;
    Object.defineProperty(WALK.Node.prototype, "isAnimatedRoot", {
        get: function() {
            return this.config.faceCamera || this.config.rotate
        }
    });
    WALK.Node.prototype.serialize = function() {
        var a = {
            id: this.id,
            children: this.children.map(function(a) {
                return a.serialize()
            })
        }
          , b = this.mesh;
        b && (a.lightProbeId = b.lightProbe ? b.lightProbe.id : null,
        a.mesh = !0);
        return a
    }
    ;
    Object.defineProperty(WALK.Node.prototype, "type", {
        get: function() {
            return this.config.name
        }
    });
    Object.defineProperty(WALK.Node.prototype, "highlightMix", {
        set: function(a) {
            this.visitSubtree(function(b) {
                b.mesh && (b.mesh.highlightMix = a)
            })
        }
    });
    Object.defineProperty(WALK.Node.prototype, "selected", {
        set: function(a) {
            this.visitSubtree(function(b) {
                b.mesh && (b.mesh.selected = a)
            })
        }
    });
    Object.defineProperty(WALK.Node.prototype, "selectedSecondary", {
        set: function(a) {
            this.visitSubtree(function(b) {
                b.mesh && (b.mesh.selectedSecondary = a)
            })
        }
    });
    WALK.Mesh = function(a, b, c) {
        this._visible = !0;
        t.Mesh.call(this, b, c);
        this.node = a;
        this.useFaces16 = !1;
        this.quantUv0Max = this.quantUv0Range = this.quantVertexMax = this.quantVertexRange = this.transformByteOffset = this.uv1CoordVOffset = this.uv1CoordUOffset = this.uv1CoordVScale = this.uv1CoordUScale = this.lightMapIdx = this.uv1ByteOffset = this.uv0ByteOffset = this.normalByteOffset = this.vertexCnt = this.vertexByteOffset = this.faceCnt = this.faceByteOffset = 0;
        this.lightMap = null;
        this.autoLightmapResolution = -1;
        this.lightProbe = null;
        this.matrixAutoUpdate = this.rotationAutoUpdate = !1;
        this.selected = this.highlightMix = null;
        this.selectedSecondary = !1;
        this.visibilityId = null;
        this.cameraDistance = 0;
        var d = this.matrix = this.matrixWorld = null;
        Object.defineProperty(this, "matrixWorld", {
            get: function() {
                return d || this.node.animationMatrix
            },
            set: function(a) {
                d = a
            }
        });
        this.sharedBuffersDebug = 0;
        this._mergedMesh = null
    }
    ;
    WALK.Mesh.prototype = Object.create(t.Mesh.prototype);
    WALK.Mesh.prototype.constructor = WALK.Mesh;
    WALK.Mesh.prototype.clone = void 0;
    WALK.Mesh.prototype.updateMatrixWorld = function() {}
    ;
    WALK.Mesh.prototype.uv0InBuffers = function() {
        return -1 !== this.uv0ByteOffset
    }
    ;
    WALK.Mesh.prototype.uv1InBuffers = function() {
        return -1 !== this.uv1ByteOffset
    }
    ;
    WALK.Mesh.prototype.quantVertexFactor = function() {
        return this.quantVertexRange / this.quantVertexMax
    }
    ;
    WALK.Mesh.prototype.quantUv0Disabled = function() {
        return 0 === this.quantUv0Max
    }
    ;
    WALK.Mesh.prototype.quantUv0Factor = function() {
        return this.quantUv0Range / this.quantUv0Max
    }
    ;
    Object.defineProperty(WALK.Mesh.prototype, "hideInViews", {
        get: function() {
            return this.node.hideInViews
        },
        set: function() {
            console.assert(!1)
        }
    });
    Object.defineProperty(WALK.Mesh.prototype, "visible", {
        get: function() {
            return this._visible
        },
        set: function(a) {
            a !== this._visible && (this._visible = a,
            this._mergedMesh && !WALK.EDIT_MODE && (this._mergedMesh.visible = a))
        }
    });
    WALK.MergedMesh = function(a, b) {
        this._visible = !0;
        t.Mesh.call(this, a, b);
        this.anyLogicalMeshHasUvs = !1;
        this.lightProbe = this.lightMap = null;
        this.matrixAutoUpdate = this.rotationAutoUpdate = !1;
        this.hideInViews = null;
        this.matrixAutoUpdate = this.rotationAutoUpdate = !1;
        this.center = null;
        this.cameraDistance = 0;
        this.editableRootNode = this.matrix = this.matrixWorld = null;
        Object.defineProperty(this, "matrixWorld", {
            get: function() {
                return this.editableRootNode ? this.editableRootNode.mesh ? this.editableRootNode.mesh.matrixWorld : this.editableRootNode.animationMatrix : null
            },
            set: function() {
                console.assert("Cannot set matrixWorld for a merged mesh. The mesh needs to be marked as editable to prevent merging.")
            }
        });
        this.logicalMeshes = []
    }
    ;
    WALK.MergedMesh.prototype = Object.create(t.Mesh.prototype);
    WALK.MergedMesh.prototype.constructor = WALK.MergedMesh;
    WALK.MergedMesh.prototype.clone = void 0;
    WALK.MergedMesh.prototype.updateMatrixWorld = function() {}
    ;
    WALK.MergedMesh.prototype.addLogicalMesh = function(a) {
        this.logicalMeshes.push(a);
        a._mergedMesh = this
    }
    ;
    Object.defineProperty(WALK.MergedMesh.prototype, "visible", {
        get: function() {
            return this._visible
        },
        set: function(a) {
            if (a !== this._visible) {
                this._visible = a;
                for (var b = 0; b < this.logicalMeshes.length; b += 1)
                    this.logicalMeshes[b]._visible = a
            }
        }
    });
    WALK.SkyMesh = function(a, b, c, d) {
        var e = this;
        t.Mesh.call(this, b, c);
        d && this.position.fromArray(d);
        this.autoPosition = !d;
        this.name = a;
        this.fog = null;
        var f = {
            type: "updated",
            target: this
        };
        this._updated = function() {
            return e.dispatchEvent(f)
        }
    }
    ;
    WALK.SkyMesh.prototype = Object.create(t.Mesh.prototype);
    WALK.SkyMesh.prototype.constructor = WALK.SkyMesh;
    WALK.SkyMesh.prototype.clone = void 0;
    WALK.SkyMesh.prototype.serialize = function() {
        var a = {
            name: this.name
        };
        this.autoPosition || (a.center = this.position.toArray());
        this.isEquirect ? (a.type = "equirect",
        a.yawRotation = this.yawRotationDeg,
        a.texture = this.material.map ? this.material.map.serialize() : null) : a.type = "procedural";
        this.fog.enabled() && (a.fog = this.fog.serialize());
        return a
    }
    ;
    Object.defineProperty(WALK.SkyMesh.prototype, "yawRotationDeg", {
        get: function() {
            return t.Math.radToDeg(this.rotation.y)
        },
        set: function(a) {
            a = t.Math.degToRad(a);
            this.rotation.y = a;
            this.updateMatrixWorld();
            this._updated()
        }
    });
    Object.defineProperty(WALK.SkyMesh.prototype, "isEquirect", {
        get: function() {
            return this.material instanceof WALK.EquirectSkyMaterial
        }
    });
    Object.defineProperty(WALK.SkyMesh.prototype, "radius", {
        get: function() {
            return this.scale.x
        },
        set: function(a) {
            this.scale.set(a, a, a);
            this.updateMatrixWorld(!0);
            this._updated()
        }
    });
    var ig = 1E3
      , jg = {
        internal: !1,
        position: [0, 0, 0],
        rotation: [0, 0],
        hideFromMenu: !0,
        sky: WALK.EDITOR_CONTROLLED_SKY_NAME
    };
    WALK.View = function(a) {
        var b = this;
        void 0 === a && (a = jg);
        this.id = void 0 !== a.id ? a.id : ig++;
        this.name = a.name || "view" + this.id;
        this.internal = a.internal || !1;
        a.position && (this.position = new t.Vector3(a.position[0],a.position[1],a.position[2]));
        a.rotation && (this.rotation = new WALK.Euler(WALK.normalizeRotation(t.Math.degToRad(a.rotation[0])),WALK.normalizeRotation(t.Math.degToRad(a.rotation[1])),0));
        this.hideFromMenu = a.hideFromMenu || !1;
        this.sky = a.sky || WALK.EDITOR_CONTROLLED_SKY_NAME;
        this.mode = a.mode || "fps";
        this.distance = a.distance;
        this.panPrimary = a.panPrimary;
        this.noRotate = a.noRotate;
        this.noPitchRotate = a.noPitchRotate;
        this.noPan = void 0 === a.noPan ? !1 : a.noPan;
        this.minDistance = void 0 === a.minDistance ? 1 : a.minDistance;
        this.maxDistance = void 0 === a.maxDistance ? 100 : a.maxDistance;
        this.minUpAngle = void 0 === a.minUpAngle ? -Math.PI / 2 : a.minUpAngle;
        this.maxUpAngle = void 0 === a.maxUpAngle ? Math.PI / 2 : a.maxUpAngle;
        this.minSideAngle = void 0 === a.minSideAngle ? -Math.PI : a.minSideAngle;
        this.maxSideAngle = void 0 === a.maxSideAngle ? Math.PI : a.maxSideAngle;
        a.target && (this.target = new t.Vector3(a.target[0],a.target[1],a.target[2]));
        this.fov = a.fov;
        var c = {
            type: "updated",
            target: this
        };
        this._updated = function() {
            return b.dispatchEvent(c)
        }
    }
    ;
    WALK.View.prototype = {
        constructor: WALK.View,
        isTop: function() {
            return "orbit" === this.mode && this.panPrimary && this.noPitchRotate
        },
        isOrbit: function() {
            return "orbit" === this.mode && !this.isTop()
        },
        usesDefaultSky: function() {
            return this.sky === WALK.DEFAULT_SKY_NAME
        },
        switchSky: function() {
            this.usesDefaultSky() ? this.sky = WALK.EDITOR_CONTROLLED_SKY_NAME : this.sky = WALK.DEFAULT_SKY_NAME;
            this._updated()
        },
        setName: function(a) {
            this.name = a;
            this._updated()
        },
        setPosition: function(a, b, c) {
            this.position.set(a, b, c);
            this._updated()
        },
        setYaw: function(a) {
            this.rotation.yaw = a;
            this._updated()
        },
        setMinUpAngle: function(a) {
            a !== this.minUpAngle && (this.minUpAngle = a,
            this._updated())
        },
        setMaxUpAngle: function(a) {
            a !== this.maxUpAngle && (this.maxUpAngle = a,
            this._updated())
        },
        setMinSideAngle: function(a) {
            a !== this.minSideAngle && (this.minSideAngle = a,
            this._updated())
        },
        setMaxSideAngle: function(a) {
            a !== this.maxSideAngle && (this.maxSideAngle = a,
            this._updated())
        },
        setHideFromMenu: function(a) {
            a !== this.hideFromMenu && (this.hideFromMenu = a,
            this._updated())
        },
        setMinDistance: function(a) {
            a !== this.minDistance && (this.minDistance = a,
            this._updated())
        },
        setMaxDistance: function(a) {
            a !== this.maxDistance && (this.maxDistance = a,
            this._updated())
        },
        setNoPan: function(a) {
            a !== this.noPan && (this.noPan = a,
            this._updated())
        },
        serialize: function() {
            var a = this
              , b = {
                id: this.id,
                name: this.name,
                mode: this.mode,
                rotation: this.rotation.toDegTriple().slice(0, 2),
                hideFromMenu: this.hideFromMenu || !1,
                sky: this.sky
            };
            this.position && (b.position = this.position.toArray());
            this.target && (b.target = this.target.toArray());
            -Infinity !== this.minSideAngle && (b.minSideAngle = this.minSideAngle);
            Infinity !== this.maxSideAngle && (b.maxSideAngle = this.maxSideAngle);
            "distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(c) {
                void 0 !== a[c] && (b[c] = a[c])
            });
            return b
        }
    };
    t.EventDispatcher.prototype.apply(WALK.View.prototype);
    WALK.Mirror = function(a, b, c) {
        t.Object3D.call(this);
        this.name = "mirror_" + this.id;
        this.scene = a;
        this.mirrorCamera = b.clone();
        this.renderTargetParams = {
            minFilter: GLC.LINEAR,
            magFilter: GLC.LINEAR,
            format: GLC.RGBA,
            stencilBuffer: !1,
            generateMipmaps: !0
        };
        this.texture = null;
        c = c || {};
        this.matrixNeedsUpdate = !0;
        this.clipBias = void 0 !== c.clipBias ? c.clipBias : 0;
        a = void 0 !== c.color ? new t.Color(c.color) : new t.Color(8355711);
        this.textureMatrix = new t.Matrix4;
        this.mirrorWorldPosition = new t.Vector3;
        this.mirrorRotationMatrix = new t.Matrix4;
        this.mirrorNormal = new t.Vector3;
        this.cameraWorldPosition = new t.Vector3;
        this.cameraRotationMatrix = new t.Matrix4;
        this.mirrorToCamera = new t.Vector3;
        this.cameraFrustum = null;
        this.material = new WALK.MirrorMaterial(a,this.textureMatrix)
    }
    ;
    WALK.Mirror.prototype = Object.create(t.Object3D.prototype);
    WALK.Mirror.prototype.renderWithMirror = function(a) {
        this.updateTextureMatrix();
        this.matrixNeedsUpdate = !1;
        var b = a.camera;
        a.camera = this.mirrorCamera;
        a.renderTemp();
        a.material.uniforms.mirrorSampler.value = a.tempTexture;
        this.render();
        this.matrixNeedsUpdate = !0;
        a.material.uniforms.mirrorSampler.value = a.texture;
        a.camera = b;
        a.updateTextureMatrix()
    }
    ;
    WALK.Mirror.prototype.updateMatrixWorld = function(a) {
        t.Object3D.prototype.updateMatrixWorld.call(this, a);
        this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);
        this.mirrorRotationMatrix.extractRotation(this.matrixWorld);
        this.mirrorNormal.set(0, 0, 1);
        this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)
    }
    ;
    WALK.Mirror.prototype.updateCameraPosition = function(a, b) {
        this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);
        this.cameraRotationMatrix.extractRotation(a.matrixWorld);
        this.matrixNeedsUpdate = !0;
        this.cameraFrustum = b
    }
    ;
    WALK.Mirror.prototype.inFrustum = function() {
        this.mirrorToCamera.subVectors(this.cameraWorldPosition, this.mirrorWorldPosition);
        return this.mirrorToCamera.angleTo(this.mirrorNormal) < Math.PI / 2 && this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)
    }
    ;
    WALK.Mirror.prototype.updateTextureMatrix = function() {
        var a = new t.Vector3
          , b = new t.Vector3
          , c = new t.Vector3
          , d = new t.Vector4
          , e = new t.Plane
          , f = new t.Vector4;
        return function() {
            a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);
            c.set(0, 0, -1);
            c.applyMatrix4(this.cameraRotationMatrix);
            c.add(this.cameraWorldPosition);
            b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);
            this.up.set(0, -1, 0);
            this.up.applyMatrix4(this.cameraRotationMatrix);
            this.up.reflect(this.mirrorNormal).negate();
            this.mirrorCamera.position.copy(a);
            this.mirrorCamera.up = this.up;
            this.mirrorCamera.lookAt(b);
            this.mirrorCamera.updateProjectionMatrix();
            this.mirrorCamera.updateMatrixWorld();
            this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);
            this.textureMatrix.set(.5, 0, 0, .5, 0, .5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1);
            this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);
            this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);
            e.setFromNormalAndCoplanarPoint(this.mirrorNormal, this.mirrorWorldPosition);
            e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);
            d.set(e.normal.x, e.normal.y, e.normal.z, e.constant);
            var g = this.mirrorCamera.projectionMatrix;
            f.x = (Math.sign(d.x) + g.elements[8]) / g.elements[0];
            f.y = (Math.sign(d.y) + g.elements[9]) / g.elements[5];
            f.z = -1;
            f.w = (1 + g.elements[10]) / g.elements[14];
            d.multiplyScalar(2 / d.dot(f));
            g.elements[2] = d.x;
            g.elements[6] = d.y;
            g.elements[10] = d.z + 1 - this.clipBias;
            g.elements[14] = d.w
        }
    }();
    WALK.Mirror.prototype.configure = function(a, b, c, d) {
        this.mirrorCamera.aspect = c;
        this.mirrorCamera.fov = d;
        this.mirrorCamera.updateProjectionMatrix();
        null !== this.texture && this.texture.dispose();
        this.material.mirrorSampler = this.texture
    }
    ;
    WALK.Mirror.prototype.render = function(a) {
        this.material.visible && (this.matrixNeedsUpdate && (this.updateTextureMatrix(),
        this.matrixNeedsUpdate = !1),
        this.material.visible = !1,
        a.render(this.scene, this.mirrorCamera, this.texture, !0),
        this.material.visible = !0)
    }
    ;
    WALK.Mirror.prototype.renderTemp = function(a) {
        this.matrixNeedsUpdate && this.updateTextureMatrix();
        a.render(this.scene, this.mirrorCamera, this.tempTexture, !0)
    }
    ;
    function kg(a) {
        t.EventDispatcher.call(this);
        var b = this;
        this._fog = null;
        this._hdrOutput = !1;
        this._camera = a;
        this._updated = function() {
            return b.dispatchEvent({
                type: "updated",
                target: b
            })
        }
        ;
        a.addEventListener("toneMappingUpdated", this._updated);
        a.addEventListener("colorMapUpdated", this._updated);
        a.addEventListener("exposureUpdated", this._updated);
        a.addEventListener("gammaUpdated", this._updated)
    }
    k.inherits(kg, t.EventDispatcher);
    k.global.Object.defineProperties(kg.prototype, {
        fog: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._fog
            },
            set: function(a) {
                this._fog = a;
                this._fog.addEventListener("updated", this._updated);
                this._updated()
            }
        },
        hdrOutput: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._hdrOutput
            },
            set: function(a) {
                this._hdrOutput != a && (this._hdrOutput = a,
                this._updated())
            }
        },
        toneMapping: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._camera.toneMapping
            }
        },
        colorMap: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._camera.colorMapReady() ? this._camera.colorMap : null
            }
        },
        colorMapIntensity: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._camera.colorMapIntensity
            }
        },
        cameraExposure: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._camera.exposure
            }
        },
        cameraGamma: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._camera.gamma
            }
        }
    });
    var lg = 0;
    function mg(a, b, c) {
        a = new WALK.Mirror(a,b,{
            clipBias: 0,
            color: 8355711,
            debugMode: !1
        });
        a.material.name = c.material.name;
        c = c.geometry;
        console.assert(c.boundingBox);
        b = c.boundingBox;
        var d = Math.sqrt(Math.pow(b.max.x - b.min.x, 2) + Math.pow(b.max.z - b.min.z, 2))
          , e = b.max.y - b.min.y;
        d && e ? (d = new t.Mesh(new t.PlaneBufferGeometry(d,e),a.material),
        d.rotation.y = Math.atan2(c.normals[0], c.normals[2]),
        b.center(d.position),
        d.geometry.boundingBox = b,
        d.add(a),
        a = d) : (WALK.log("mirror with 0 dimension"),
        a = null);
        return a
    }
    function ng(a, b, c) {
        c = c || "id";
        for (var d = 0; d < a.length; d += 1)
            if (a[d].hasOwnProperty(c) && a[d][c] === b)
                return !1;
        return !0
    }
    function og(a, b, c) {
        c = c || "id";
        for (var d = 0; d < a.length; d += 1)
            if (a[d][c] === b)
                return a[d];
        return null
    }
    function pg(a, b) {
        a = a.name.toUpperCase();
        b = b.name.toUpperCase();
        return a < b ? -1 : a > b ? 1 : 0
    }
    WALK.Scene = function(a) {
        function b() {
            f.dispatchEvent(g)
        }
        function c() {
            f.dispatchEvent(h);
            b()
        }
        function d(a) {
            a = a.target;
            var c = f._mainAnimatedMaterials.has(a);
            a.isAnimated && !c ? f._mainAnimatedMaterials.add(a) : !a.isAnimated && c && f._mainAnimatedMaterials.delete(a);
            b()
        }
        function e() {
            f._animatedRootNodes.length = 0;
            f.visitAllNodes(function(a) {
                a.isAnimatedRoot && f._animatedRootNodes.push(a)
            });
            b()
        }
        var f = this
          , g = {
            type: "updated",
            target: this
        }
          , h = {
            type: "anyViewUpdated",
            target: this
        };
        this.id = lg++;
        this._headLight = !1;
        this.threeScene = new t.Scene;
        this.autoAddLightProbes = !0;
        this.autoTour = {
            disabled: !1,
            startOnLoad: !1
        };
        this.canStartAutoTour = function() {
            return !this.autoTour.disabled && 1 < this.visibleViews().length
        }
        ;
        this.startAutoTourOnLoad = function() {
            return this.canStartAutoTour() && this.autoTour.startOnLoad
        }
        ;
        this.interactionPrompt = this.disableProgressiveLoader = !1;
        this.camera = a;
        this.materials = [];
        this._mainAnimatedMaterials = new Set;
        this._disabledMaterials = [];
        this._sortedMaterials = null;
        this.nodeConfigs = [];
        this._nodeConfigsLookup = {};
        this.nodes = [];
        this._animatedRootNodes = [];
        this._nodeLookup = {};
        this.gpuMeshes = [];
        this.mirrors = [];
        this._animatableAuxiliaryObjects = new Set;
        this.boundingBox = new t.Box3;
        this.collisionBoundingBox = new t.Box3;
        this._sumLogicalMeshCenter = new t.Vector3;
        this._logicalNonemptyMeshCount = 0;
        this._center = new t.Vector3;
        this.skyMeshes = [];
        this.hideViewsMenu = !1;
        this.views = [];
        this.lights = [];
        this.lightProbes = [];
        this.cameraVolumes = [];
        this.minimapConfig = null;
        this.sharedMaterialState = new kg(a);
        this.serialize = function() {
            return {
                disableProgressiveLoader: this.disableProgressiveLoader,
                interactionPrompt: this.interactionPrompt,
                autoTour: this.autoTour,
                camera: this.camera.serialize(),
                materials: this.materials.map(function(a) {
                    return a.serialize()
                }),
                nodeConfigs: this.nodeConfigs.map(function(a) {
                    return a.serialize()
                }),
                nodes: this.nodes.map(function(a) {
                    return a.serialize()
                }),
                lights: this.lights.map(function(a) {
                    return a.serialize()
                }),
                lightProbes: this.lightProbes.map(function(a) {
                    return a.serialize()
                }),
                cameraVolumes: this.cameraVolumes.map(function(a) {
                    return a.serialize()
                }),
                autoAddLightProbes: !1,
                views: this.views.filter(function(a) {
                    return !a.internal
                }).map(function(a) {
                    return a.serialize()
                }),
                skies: this.skyMeshes.filter(function(a) {
                    return a.name !== WALK.DEFAULT_SKY_NAME
                }).map(function(a) {
                    return a.serialize()
                }),
                minimap: this.minimapConfig.serialize()
            }
        }
        ;
        this.addMaterial = function(a) {
            this.materials.push(a);
            a.addEventListener("updated", d);
            a.sharedMaterialState = this.sharedMaterialState;
            a.isAnimated && this._mainAnimatedMaterials.add(a);
            void 0 !== a.headLight && (a.headLight = this.headLight)
        }
        ;
        this.replaceMaterial = function(a, c) {
            var e = this.materials.indexOf(a);
            void 0 === this._disabledMaterials[e] && (this._disabledMaterials[e] = new Map);
            this._disabledMaterials[e].set(a.type, a);
            var f = this._disabledMaterials[e].get(c);
            f || (f = WALK.createMaterialOfType(c),
            f.addEventListener("updated", d),
            f.name = a.name,
            0 === this.lightProbes.length && (f.disableLightProbeTmp = !0));
            this.materials[e] = f;
            b();
            for (c = 0; c < this.gpuMeshes.length; c += 1)
                this.gpuMeshes[c].material === a && (this.gpuMeshes[c].material = f);
            a.isAnimated && this._mainAnimatedMaterials.delete(a);
            f.isAnimated && this._mainAnimatedMaterials.add(f);
            this._sortedMaterials = null;
            f.setUniforms();
            return f
        }
        ;
        this.addNodeConfig = function(a) {
            this.nodeConfigs.push(a);
            this._nodeConfigsLookup[a.name] = a;
            a.addEventListener("updated", e)
        }
        ;
        this.findNodeConfig = function(a) {
            return this._nodeConfigsLookup.hasOwnProperty(a) ? this._nodeConfigsLookup[a] : null
        }
        ;
        this.addNode = function(a) {
            var b = this;
            this.nodes.push(a);
            a.visitSubtree(function(a) {
                b._nodeLookup[a.id] = a;
                a.isAnimatedRoot && b._animatedRootNodes.push(a)
            })
        }
        ;
        this.findNode = function(a) {
            return this._nodeLookup[a]
        }
        ;
        this.visitAllNodes = function(a) {
            for (var b = 0; b < this.nodes.length; b += 1)
                this.nodes[b].visitSubtree(a)
        }
        ;
        this.visitMeshesWithMaterial = function(a, b) {
            this.visitAllNodes(function(c) {
                (c = c.mesh) && c.material === a && b(c)
            })
        }
        ;
        this.sortedMaterials = function() {
            null === this._sortedMaterials && (this._sortedMaterials = this.materials.slice(0).sort(pg));
            return this._sortedMaterials
        }
        ;
        this._updateSceneCenterWithGpuMesh = function() {
            var a = new t.Vector3;
            return function(b) {
                if (b.logicalMeshes)
                    for (var c = 0; c < b.logicalMeshes.length; c += 1) {
                        var d = b.logicalMeshes[c].geometry.boundingBox;
                        d.empty() || (d.center(a),
                        this._sumLogicalMeshCenter.add(a),
                        ++this._logicalNonemptyMeshCount)
                    }
                else
                    b = b.geometry.boundingBox,
                    b.empty() || (b.center(a),
                    this._sumLogicalMeshCenter.add(a),
                    ++this._logicalNonemptyMeshCount);
                this._logicalNonemptyMeshCount && this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)
            }
        }();
        this.addGpuMesh = function(a) {
            var b = this;
            if (a.material.planarReflector) {
                var c = mg(this.threeScene, this.camera, a);
                this.mirrors.push(c.children[0]);
                this.addAuxiliaryObject(c)
            } else
                this.addAuxiliaryObject(a);
            this.gpuMeshes.push(a);
            this.boundingBox.union(a.geometry.boundingBox);
            (a.logicalMeshes || [a]).forEach(function(a) {
                a.node.disableCollisions || b.collisionBoundingBox.union(a.geometry.boundingBox)
            });
            this._updateSceneCenterWithGpuMesh(a)
        }
        ;
        this.addAuxiliaryObject = function(a, c) {
            var d = this;
            c = void 0 === c ? !1 : c;
            this.threeScene.add(a);
            a.traverse(function(a) {
                (a = a.material) && null === a.sharedMaterialState && (a.sharedMaterialState = d.sharedMaterialState)
            });
            c && this._animatableAuxiliaryObjects.add(a);
            b()
        }
        ;
        this.removeAuxiliaryObject = function(a) {
            this.threeScene.remove(a);
            this._animatableAuxiliaryObjects.delete(a);
            b()
        }
        ;
        this.addFog = function(a) {
            console.assert(null === this.sharedMaterialState.fog);
            this.sharedMaterialState.fog = a
        }
        ;
        this.addSkyMesh = function(a) {
            this.skyMeshes.push(a);
            a.addEventListener("updated", b);
            this.dispatchEvent({
                type: "skyMeshAdded",
                skyMesh: a,
                target: this
            })
        }
        ;
        this.removeSkyMesh = function(a) {
            WALK.removeFromArray(a, this.skyMeshes);
            this.dispatchEvent({
                type: "skyMeshRemoved",
                skyMesh: a,
                target: this
            });
            a.geometry.dispose();
            a.material.map && a.material.map.dispose();
            a.material.dispose()
        }
        ;
        this.findSkyMesh = function(a) {
            return og(this.skyMeshes, a, "name")
        }
        ;
        this.addLight = function(a) {
            console.assert(ng(this.lights, a.name, "name"));
            this.lights.push(a);
            a.addEventListener("updated", b);
            a.addEventListener("instanceAdded", b);
            a.addEventListener("instanceRemoved", b);
            b();
            this.dispatchEvent({
                type: "lightAdded",
                light: a,
                target: this
            })
        }
        ;
        this.removeLight = function(a) {
            WALK.removeFromArray(a, this.lights);
            b();
            this.dispatchEvent({
                type: "lightRemoved",
                light: a,
                target: this
            })
        }
        ;
        this.addLightProbe = function(a) {
            console.assert(ng(this.lightProbes, a.id));
            this.lightProbes.push(a);
            a.addEventListener("positionUpdated", b);
            a.addEventListener("boundsUpdated", b);
            b();
            this.dispatchEvent({
                type: "lightProbeAdded",
                lightProbe: a,
                target: this
            })
        }
        ;
        this.removeLightProbe = function(a) {
            WALK.removeFromArray(a, this.lightProbes);
            for (var c = 0; c < this.gpuMeshes.length; c += 1)
                this.gpuMeshes[c].lightProbe === a && (this.gpuMeshes[c].lightProbe = null);
            b();
            this.dispatchEvent({
                type: "lightProbeRemoved",
                lightProbe: a,
                target: this
            });
            a.dispose()
        }
        ;
        this.findLightProbe = function(a) {
            return og(this.lightProbes, a)
        }
        ;
        this.closestLightProbe = function(a) {
            for (var b = null, c = Infinity, d = k.makeIterator(this.lightProbes), e = d.next(); !e.done; e = d.next()) {
                e = e.value;
                var f = a.distanceTo(e.position);
                f < c && (c = f,
                b = e)
            }
            return b
        }
        ;
        this.addCameraVolume = function(a) {
            console.assert(ng(this.cameraVolumes, a.id));
            this.cameraVolumes.push(a);
            a.addEventListener("updated", b);
            b();
            this.dispatchEvent({
                type: "cameraVolumeAdded",
                cameraVolume: a,
                target: this
            })
        }
        ;
        this.removeCameraVolume = function(a) {
            WALK.removeFromArray(a, this.cameraVolumes);
            b();
            this.dispatchEvent({
                type: "cameraVolumeRemoved",
                cameraVolume: a,
                target: this
            });
            a.dispose()
        }
        ;
        this.findCameraVolume = function(a) {
            return og(this.cameraVolumes, a)
        }
        ;
        this.shiftCameraVolume = function(a, b) {
            WALK.shiftItem(this.cameraVolumes, a, b);
            this.dispatchEvent({
                type: "cameraVolumeShifted",
                cameraVolume: a,
                target: this
            })
        }
        ;
        this.findView = function(a) {
            return og(this.views, a)
        }
        ;
        this.findViewByName = function(a) {
            return og(this.views, a, "name")
        }
        ;
        this.visibleViews = function() {
            return WALK.filter(this.views, function(a) {
                return !a.hideFromMenu
            })
        }
        ;
        this.addView = function(a) {
            console.assert(ng(this.views, a.id));
            this.views.push(a);
            a.addEventListener("updated", c);
            b();
            this.dispatchEvent({
                type: "viewAdded",
                view: a,
                target: this
            })
        }
        ;
        this.removeView = function(a) {
            WALK.removeFromArray(a, this.views);
            this.nodeConfigs.forEach(function(b) {
                b.removeFromHideInViews(a.id)
            });
            b();
            this.dispatchEvent({
                type: "viewRemoved",
                view: a,
                target: this
            })
        }
        ;
        this.shiftView = function(a, b) {
            WALK.shiftItem(this.views, a, b);
            this.dispatchEvent({
                type: "viewShifted",
                view: a,
                target: this
            })
        }
        ;
        this.hasLightMap = function() {
            return void 0 !== WALK.find(this.materials, function(a) {
                return a.lightMapped
            })
        }
        ;
        this.adjustSkiesAndCameraFarToSpanWholeScene = function() {
            function a(a, b) {
                var c = 0;
                a.forEach(function(a) {
                    if ("orbit" === a.mode) {
                        var d = void 0 === a.maxDistance ? a.distance : a.maxDistance;
                        d = a.target && d ? a.target.distanceTo(b) + d : void 0
                    } else
                        "fps" === a.mode && (d = a.position ? a.position.distanceTo(b) : void 0);
                    d && d > c && (c = d)
                });
                return c
            }
            function b(a, b) {
                var c = Math.max(Math.abs(a.min.x - b.x), Math.abs(a.max.x - b.x))
                  , d = Math.max(Math.abs(a.min.y - b.y), Math.abs(a.max.y - b.y));
                a = Math.max(Math.abs(a.min.z - b.z), Math.abs(a.max.z - b.z));
                return Math.sqrt(c * c + d * d + a * a)
            }
            for (var c = 0, d = 0; d < this.skyMeshes.length; d += 1) {
                var e = this.skyMeshes[d];
                e.autoPosition && e.position.copy(this.center);
                var f = void 0;
                if (this.boundingBox.empty())
                    f = 0;
                else {
                    f = b(this.boundingBox, e.position);
                    var g = a(this.views, e.position);
                    f = Math.max(f, g)
                }
                f += WALK.SKY_DISTANCE_TO_SCENE;
                e.radius = f;
                c = Math.max(c, f)
            }
            this.camera.setFar(Math.max(this.camera.far, 2 * c));
            WALK.log("Camera far set to " + this.camera.far)
        }
        ;
        a.addEventListener("updated", b);
        this.disableLightProbesForMaterials = function() {
            for (var a = 0; a < this.materials.length; a += 1)
                this.materials[a].disableLightProbeTmp = !0,
                this.materials[a].setUniforms()
        }
        ;
        this.enableLightProbesForMaterials = function() {
            for (var a = 0; a < this.materials.length; a += 1)
                this.materials[a].disableLightProbeTmp = !1,
                this.materials[a].setUniforms()
        }
        ;
        this.getAnimatedMaterials = function() {
            var a = !1
              , b = new Map;
            return function() {
                function c(a) {
                    a instanceof t.Mesh && a.material.isAnimated && b.set(a.material, d)
                }
                for (var d = !a, e = k.makeIterator(f._mainAnimatedMaterials), g = e.next(); !g.done; g = e.next())
                    b.set(g.value, d);
                e = k.makeIterator(f._animatableAuxiliaryObjects);
                for (g = e.next(); !g.done; g = e.next())
                    g.value.traverse(c);
                e = k.makeIterator(b);
                for (g = e.next(); !g.done; g = e.next()) {
                    g = k.makeIterator(g.value);
                    var h = g.next().value;
                    g.next().value === a && b.delete(h)
                }
                a = d;
                return b.keys()
            }
        }();
        this.getAnimatedRootNodes = function() {
            return this._animatedRootNodes
        }
    }
    ;
    WALK.Scene.prototype = {
        constructor: WALK.Scene,
        get center() {
            return this._center
        },
        get headLight() {
            return this._headLight
        },
        set headLight(a) {
            a !== this._headLight && (this._headLight = a,
            this.materials.forEach(function(b) {
                b.headLight = a;
                b.setUniforms()
            }))
        }
    };
    t.EventDispatcher.prototype.apply(WALK.Scene.prototype);
    WALK.createMaterialOfType = function(a) {
        return "water" === a ? new WALK.StandardMaterialWater : new WALK.StandardMaterial
    }
    ;
    function qg(a, b) {
        b = void 0 === b ? !1 : b;
        new t.Object3D;
        for (var c = 0; c < a.gpuMeshes.length; c += 1) {
            var d = a.gpuMeshes[c];
            if (d instanceof t.Mesh && (!b || d.material.transparent)) {
                d = d.geometry;
                d.boundingBox || d.computeBoundingBox();
                d = d.boundingBox;
                var e = new WALK.WireframeMaterial(new t.Color(16777215 * Math.random()))
                  , f = new t.BoxBufferGeometry(d.max.x - d.min.x,d.max.y - d.min.y,d.max.z - d.min.z);
                f.addTriangleOrderAttribute();
                e = new t.Mesh(f,e);
                d.center(e.position);
                e.updateMatrixWorld();
                a.addAuxiliaryObject(e)
            }
        }
    }
    ;WALK.BufferAttribute = function(a, b, c) {
        t.BufferAttribute.call(this, a, b);
        this._length = a.length;
        this.releaseOnLoadedToGpu = !0;
        this.divisor = c || 0;
        this.glType = this.buffer = null
    }
    ;
    WALK.BufferAttribute.prototype = {
        constructor: WALK.BufferAttribute,
        get length() {
            return this._length
        }
    };
    t.BufferGeometry.prototype.addTriangleOrderAttribute = function() {
        if (void 0 === this.getAttribute("order")) {
            for (var a = this.getAttribute("position").length / 3, b = new Float32Array(a), c = 0; c < a; c += 1)
                b[c] = c % 3;
            this.addAttribute("order", new WALK.BufferAttribute(b,1))
        }
    }
    ;
    t.BufferGeometry.prototype.convertNormalsToSpherical = function() {
        console.assert(void 0 === this.getAttribute("sphericalNormal"));
        var a = this.getAttribute("normal");
        console.assert(!a.buffer);
        a = a.array;
        for (var b = a.length / 3, c = WALK.DETECTOR.ios ? new Int16Array(2 * b) : new Int8Array(2 * b), d = 0; d < b; d += 1) {
            var e = 3 * d
              , f = 2 * d
              , g = Math.atan2(a[e + 1], a[e]) / Math.PI;
            c[f] = WALK.Math.toSnorm8(2 * (Math.acos(a[e + 2]) / Math.PI - .5));
            c[f + 1] = WALK.Math.toSnorm8(g)
        }
        delete this.attributes.normal;
        this.addAttribute("sphericalNormal", new WALK.BufferAttribute(c,2))
    }
    ;
    t.BufferGeometry.prototype.changePosition = function(a) {
        var b = this.getAttribute("position")
          , c = b.length / 3;
        b = b.array;
        for (var d = 0; d < 3 * c; d += 3)
            b[d] += a.x,
            b[d + 1] += a.y,
            b[d + 2] += a.z
    }
    ;
    t.BufferGeometry.prototype.clone = function() {
        console.error("WALK.BufferGeometry cloning not supported")
    }
    ;
    function rg(a, b, c, d, e) {
        c = new WALK.BufferAttribute(c,d,e || 0);
        a.addAttribute(b, c)
    }
    WALK.Geometry = function() {
        t.BufferGeometry.call(this);
        this.isInstanced = !1;
        this.instanceCount = 0;
        this.index = null;
        this.indexUint = !0;
        this.uvs0 = this.normals = this.vertices = null;
        this.isUvs0Repeating = !1;
        this.uvs1 = null;
        this.vertexOffset = this.vertexCnt = this.indexOffset = this.indexCnt = 0;
        this.boundingBox = new t.Box3;
        this.boundingSphere = new t.Sphere;
        this.gpuSize = 0
    }
    ;
    WALK.Geometry.prototype = Object.create(t.BufferGeometry.prototype);
    WALK.Geometry.prototype.constructor = WALK.Geometry;
    WALK.Geometry.prototype.allocateCoreBuffers = function(a) {
        console.assert(!this.vertices);
        a && (65536 >= this.vertexCnt ? (this.indexUint = !1,
        this.index = new Uint16Array(this.indexCnt),
        this.gpuSize += 2 * this.indexCnt) : (this.indexUint = !0,
        this.index = new Uint32Array(this.indexCnt),
        this.gpuSize += 4 * this.indexCnt));
        this.vertices = new Float32Array(3 * this.vertexCnt);
        this.gpuSize += 12 * this.vertexCnt;
        this.normals = WALK.DETECTOR.ios ? new Int16Array(2 * this.vertexCnt) : new Int8Array(2 * this.vertexCnt);
        this.gpuSize += 2 * this.vertexCnt
    }
    ;
    WALK.Geometry.prototype.addCoreAttributes = function() {
        this.index && (rg(this, "index", this.index, 1),
        this.index = null);
        rg(this, "position", this.vertices, 3);
        this.vertices = null;
        rg(this, "sphericalNormal", this.normals, 2);
        this.normals = null
    }
    ;
    WALK.Geometry.prototype.allocateUv0 = function() {
        console.assert(!this.uvs0);
        this.uvs0 = new Float32Array(2 * this.vertexCnt);
        this.gpuSize += 8 * this.vertexCnt
    }
    ;
    WALK.Geometry.prototype.addUv0Attribute = function() {
        rg(this, "uv", this.uvs0, 2);
        this.uvs0 = null
    }
    ;
    WALK.Geometry.prototype.allocateUv1 = function() {
        console.assert(!this.uvs1);
        this.uvs1 = new Uint16Array(2 * this.vertexCnt);
        this.gpuSize += 4 * this.vertexCnt
    }
    ;
    WALK.Geometry.prototype.addUv1Attribute = function() {
        rg(this, "uv2", this.uvs1, 2);
        this.uvs1 = null
    }
    ;
    WALK.Geometry.prototype.computeBoundingBox = void 0;
    WALK.Geometry.prototype.computeBoundingSphere = void 0;
    WALK.InstancedGeometry = function(a, b) {
        t.BufferGeometry.call(this);
        this.parent = a;
        this.ownsGpuBuffers = b;
        this.isInstanced = !0;
        this.instanceCount = 0;
        this.transforms2 = this.transforms1 = this.transforms0 = this.uvs1Mod = null;
        this.vertexOffset = this.indexOffset = 0;
        this.boundingBox = new t.Box3;
        this.boundingSphere = new t.Sphere;
        this._gpuSize = 0
    }
    ;
    WALK.InstancedGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    WALK.InstancedGeometry.prototype.constructor = WALK.InstancedGeometry;
    WALK.InstancedGeometry.prototype.allocateCoreBuffers = function(a) {
        console.assert(!this.transforms0);
        this.parent.vertices || this.parent.allocateCoreBuffers(a);
        a = 4 * this.instanceCount;
        this.transforms0 = new Float32Array(a);
        this.transforms1 = new Float32Array(a);
        this.transforms2 = new Float32Array(a);
        this._gpuSize += 12 * a
    }
    ;
    WALK.InstancedGeometry.prototype.addCoreAttributes = function() {
        this.parent.attributes.position || this.parent.addCoreAttributes();
        for (var a = k.makeIterator(Object.keys(this.parent.attributes)), b = a.next(); !b.done; b = a.next())
            b = b.value,
            this.addAttribute(b, this.parent.attributes[b]);
        rg(this, "t0", this.transforms0, 4, 1);
        rg(this, "t1", this.transforms1, 4, 1);
        rg(this, "t2", this.transforms2, 4, 1);
        this.transforms2 = this.transforms1 = this.transforms0 = null
    }
    ;
    WALK.InstancedGeometry.prototype.allocateUv0 = function() {
        this.parent.uvs0 || this.parent.allocateUv0()
    }
    ;
    WALK.InstancedGeometry.prototype.addUv0Attribute = function() {
        this.parent.attributes.uv || this.parent.addUv0Attribute();
        this.addAttribute("uv", this.parent.attributes.uv)
    }
    ;
    WALK.InstancedGeometry.prototype.allocateUv1 = function() {
        console.assert(!this.uvs1Mod);
        this.parent.uvs1 || this.parent.allocateUv1();
        this.uvs1Mod = new Float32Array(4 * this.instanceCount);
        this._gpuSize += 16 * this.instanceCount
    }
    ;
    WALK.InstancedGeometry.prototype.addUv1Attribute = function() {
        this.parent.attributes.uv2 || this.parent.addUv1Attribute();
        this.addAttribute("uv2", this.parent.attributes.uv2);
        rg(this, "uv2Mod", this.uvs1Mod, 4, 1);
        this.uvs1Mod = null
    }
    ;
    WALK.InstancedGeometry.prototype.computeBoundingBox = void 0;
    WALK.InstancedGeometry.prototype.computeBoundingSphere = void 0;
    Object.defineProperty(WALK.InstancedGeometry.prototype, "index", {
        get: function() {
            return this.parent.index
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "vertices", {
        get: function() {
            return this.parent.vertices
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "normals", {
        get: function() {
            return this.parent.normals
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "uvs0", {
        get: function() {
            return this.parent.uvs0
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "uvs1", {
        get: function() {
            return this.parent.uvs1
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "indexUint", {
        get: function() {
            return this.parent.indexUint
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "vertexCnt", {
        get: function() {
            return this.parent.vertexCnt
        },
        set: function(a) {
            this.parent.vertexCnt = a
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "indexCnt", {
        get: function() {
            return this.parent.indexCnt
        },
        set: function(a) {
            this.parent.indexCnt = a
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "gpuSize", {
        get: function() {
            return this.ownsGpuBuffers ? this._gpuSize + this.parent.gpuSize : this._gpuSize
        }
    });
    Object.defineProperty(WALK.InstancedGeometry.prototype, "isUvs0Repeating", {
        get: function() {
            return this.parent.isUvs0Repeating
        },
        set: function(a) {
            this.parent.isUvs0Repeating = a
        }
    });
    WALK.SubGeometry = function(a, b, c, d, e, f, g) {
        t.BufferGeometry.call(this);
        this.indexCnt = a;
        this.vertexCnt = b;
        this.parent = c;
        this.vertexOffset = e;
        this.indexOffset = d;
        this.boundingBox = f;
        this.boundingSphere = g;
        this.isInstanced = c.isInstanced;
        this.instanceId = 0;
        this.instanceCount = 1
    }
    ;
    WALK.SubGeometry.prototype = Object.create(t.BufferGeometry.prototype);
    WALK.SubGeometry.prototype.constructor = WALK.SubGeometry;
    Object.defineProperty(WALK.SubGeometry.prototype, "attributes", {
        get: function() {
            return this.parent.attributes
        }
    });
    Object.defineProperty(WALK.SubGeometry.prototype, "attributesKeys", {
        get: function() {
            return this.parent.attributesKeys
        }
    });
    Object.defineProperty(WALK.SubGeometry.prototype, "indexUint", {
        get: function() {
            return this.parent.indexUint
        }
    });
    Object.defineProperty(WALK.SubGeometry.prototype, "isUvs0Repeating", {
        get: function() {
            return this.parent.isUvs0Repeating
        }
    });
    WALK.SubGeometry.prototype.computeBoundingBox = void 0;
    WALK.SubGeometry.prototype.computeBoundingSphere = void 0;
    WALK.SubGeometry.prototype.addTriangleOrderAttribute = function() {
        this.parent.addTriangleOrderAttribute()
    }
    ;
    var sg = null
      , tg = null
      , ug = new t.Vector3
      , vg = new t.Quaternion;
    WALK.CameraVolume = function(a) {
        this.id = a.id;
        this.name = a.name;
        this._type = a.type;
        console.assert(0 <= WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));
        this.position = (new t.Vector3).fromArray(a.position);
        this.rotation = (new WALK.Euler).setFromDegTriple(a.rotation);
        this.scale = (new t.Vector3).fromArray(a.scale);
        this.exposure = a.exposure;
        this.gamma = a.gamma;
        this._inverse = new t.Matrix4;
        this._inverseDirty = !0
    }
    ;
    function wg(a) {
        a.dispatchEvent({
            type: "updated",
            target: a
        })
    }
    WALK.CameraVolume.CameraVolumeTypes = ["cube", "sphere"];
    WALK.CameraVolume.prototype = {
        constructor: WALK.CameraVolume,
        getVolumeGeometry: function() {
            sg || (sg = new t.BoxBufferGeometry(2,2,2),
            sg.addTriangleOrderAttribute(),
            sg.convertNormalsToSpherical(),
            tg = new t.IcosahedronBufferGeometry(1,2),
            tg.addTriangleOrderAttribute(),
            tg.convertNormalsToSpherical());
            return "sphere" === this._type ? tg : sg
        },
        setName: function(a) {
            this.name = a;
            wg(this)
        },
        setPosition: function(a, b, c) {
            this.position.set(a, b, c);
            this._inverseDirty = !0;
            wg(this)
        },
        setRotation: function(a, b, c) {
            this.rotation.yaw = WALK.normalizeRotation(a);
            this.rotation.pitch = WALK.normalizeRotation(b);
            this.rotation.roll = WALK.normalizeRotation(c);
            this._inverseDirty = !0;
            wg(this)
        },
        setRotationDeg: function(a, b, c) {
            a = t.Math.degToRad(a);
            b = t.Math.degToRad(b);
            c = t.Math.degToRad(c);
            this.setRotation(a, b, c)
        },
        setScale: function(a, b, c) {
            this.scale.set(a, b, c);
            this._inverseDirty = !0;
            wg(this)
        },
        setExposure: function(a) {
            this.exposure = a;
            wg(this)
        },
        setGamma: function(a) {
            this.gamma = a;
            wg(this)
        },
        worldCoordinatesInside: function(a) {
            this._inverseDirty && (this._inverseDirty = !1,
            this._inverse.compose(this.position, vg.setFromEuler(this.rotation), this.scale),
            this._inverse.getInverse(this._inverse));
            ug.copy(a).applyMatrix4(this._inverse);
            return "sphere" === this._type ? 1 >= ug.lengthSq() : 1 >= Math.abs(ug.x) && 1 >= Math.abs(ug.y) && 1 >= Math.abs(ug.z)
        },
        serialize: function() {
            return {
                id: this.id,
                name: this.name,
                type: this._type,
                position: this.position.toArray(),
                rotation: this.rotation.toDegTriple(),
                scale: this.scale.toArray(),
                exposure: this.exposure,
                gamma: this.gamma
            }
        },
        dispose: function() {}
    };
    t.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype);
    var xg = 512 - 2 * Math.floor(512 * (.5 - .5 * Math.sin(70 / 180 * Math.PI / 2))), yg = null, zg, Ag, Bg = null, Cg;
    function Dg(a) {
        yg && Bg === a.id || (yg = new t.SphereBufferGeometry(1,32,16),
        yg.convertNormalsToSpherical(),
        zg = new t.PlaneBufferGeometry(1,1),
        zg.convertNormalsToSpherical(),
        Ag = new t.CylinderBufferGeometry(.5,.5,1,16,1),
        Cg || (Cg = new t.Matrix4,
        Cg.makeRotationX(Math.PI / 2)),
        Ag.applyMatrix(Cg),
        Ag.convertNormalsToSpherical(),
        Bg = a.id)
    }
    var Eg = new t.Color;
    function Fg(a, b, c, d) {
        var e = WALK.SPRITE_ANCHOR_FONT_SIZE
          , f = a.getContext("2d");
        f.font = "400 " + e + "px " + c;
        for (var g = b, h = b.length - 1, l; ; ) {
            l = f.measureText(g).width;
            l += 2 * d;
            if (2048 >= l)
                break;
            g = b.substring(0, h) + "...";
            --h
        }
        a.width = l;
        a.height = 1.5 * e;
        f = a.getContext("2d");
        f.font = "400 " + e + "px " + c;
        return [f, g]
    }
    function Gg(a, b, c) {
        var d = a.getContext("2d");
        d.fillStyle = b;
        c ? (b = a.width,
        a = a.height,
        c = .5 * c * Math.min(b, a),
        d.beginPath(),
        d.moveTo(0 + c, 0),
        d.lineTo(0 + b - c, 0),
        d.quadraticCurveTo(0 + b, 0, 0 + b, 0 + c),
        d.lineTo(0 + b, 0 + a - c),
        d.quadraticCurveTo(0 + b, 0 + a, 0 + b - c, 0 + a),
        d.lineTo(0 + c, 0 + a),
        d.quadraticCurveTo(0, 0 + a, 0, 0 + a - c),
        d.lineTo(0, 0 + c),
        d.quadraticCurveTo(0, 0, 0 + c, 0),
        d.closePath(),
        d.fill()) : d.fillRect(0, 0, a.width, a.height)
    }
    function Hg(a, b, c, d, e) {
        function f(a) {
            var b = d ? 512 : 2048
              , c = a.naturalWidth;
            a = a.naturalHeight;
            c >= a && c > b ? (a = a / c * b,
            c = b) : a > c && a > b && (c = c / a * b,
            a = b);
            return [Math.round(c), Math.round(a)]
        }
        var g = this;
        ob.call(this);
        this.hasAlpha = e;
        WALK.queueImageGet(WALK.LOAD_PRIORITY.CORE_RESOURCE, a, function(a) {
            var d = k.makeIterator(f(a));
            g.width = d.next().value;
            g.height = d.next().value;
            t.Math.isPowerOfTwo(g.width) && t.Math.isPowerOfTwo(g.height) || (g.minFilter = GLC.LINEAR);
            d = g.width;
            var e = g.height
              , h = document.createElement("canvas");
            h.width = d;
            h.height = e;
            Gg(h, b, c);
            h.getContext("2d").drawImage(a, 0, 0, d, e);
            g.image = h;
            g.needsUpdate = !0;
            g.notifyLoaded()
        }, function() {
            console.log("Failed to load trigger image: " + a)
        })
    }
    Hg.prototype = Object.create(ob.prototype);
    Hg.prototype.constructor = Hg;
    Hg.prototype.serialize = function() {
        console.assert("Anchor texture serialize is not suported")
    }
    ;
    Hg.prototype.clone = function() {
        console.assert("Anchor texture clone is not supported")
    }
    ;
    var Ig = new Map;
    function Jg(a) {
        var b = a.icon && WALK.ICONS[a.icon]
          , c = b ? b.value : a.text
          , d = a.image || ""
          , e = b ? b.fontFamily : "Open Sans"
          , f = a.color || "#4c9ed9";
        var g = a.opacity;
        void 0 === g || 1 <= g ? g = f : (Eg.setStyle(f),
        g = "rgba(" + (255 * Eg.r | 0) + "," + (255 * Eg.g | 0) + "," + (255 * Eg.b | 0) + "," + g + ")");
        var h = g;
        g = a.textColor || "#ffffff";
        var l = void 0 !== a.opacity && 1 > a.opacity
          , m = "sphere" === a.type;
        b = [b || "", c || "", d, e, h, g, m, 20, a.borderRadius || 0, l].join("_");
        var n = Ig.get(b);
        if (n)
            return n.usedTimes++,
            [f, g, b, n.texture];
        d ? (e = WALK.getExtraAssetUrl(a.image),
        l = new Hg(e,h,a.borderRadius,m,l)) : (d = a.borderRadius,
        a = document.createElement("canvas"),
        m ? (n = c,
        a.width = 512,
        a.height = 512,
        m = a.getContext("2d"),
        m.font = "400 128px " + e,
        n = m.measureText(n).width,
        n = Math.floor(xg / n * 128),
        n = Math.min(n, xg),
        m.font = "400 " + n + "px " + e,
        e = m) : (m = k.makeIterator(Fg(a, c, e, 20)),
        e = m.next().value,
        c = m.next().value),
        Gg(a, h, d),
        e.fillStyle = g,
        e.textAlign = "center",
        e.textBaseline = "middle",
        e.shadowColor = "black",
        e.shadowBlur = 16,
        e.fillText(c, a.width / 2, a.height / 2),
        h = new ob(a),
        h.width = a.width,
        h.height = a.height,
        h.hasAlpha = l,
        h.minFilter = GLC.LINEAR,
        h.loaded = !0,
        h.needsUpdate = !0,
        l = h);
        Ig.set(b, {
            usedTimes: 1,
            texture: l
        });
        return [f, g, b, l]
    }
    WALK.Anchor = function(a, b) {
        var c = this;
        Dg(a);
        var d = new t.Vector3;
        d.fromArray(b.position);
        var e = k.makeIterator(Jg(b))
          , f = e.next().value
          , g = e.next().value
          , h = e.next().value;
        e = e.next().value;
        this._textureSignature = h;
        var l = new t.Color;
        l.setStyle(f);
        l.convertGammaToLinear();
        Object.defineProperty(this, "color", {
            get: function() {
                return l
            }
        });
        var m = new t.Color;
        m.setStyle(g);
        m.convertGammaToLinear();
        Object.defineProperty(this, "textColor", {
            get: function() {
                return m
            }
        });
        var n;
        if ("sphere" === b.type) {
            f = yg;
            var p = new WALK.AnchorMaterial;
            a = a.closestLightProbe(d);
            b.image || (p.bumpTexture = e);
            p.disableLightProbe = null === a || !a.texturesReady();
            p.headLight = !0
        } else {
            f = zg;
            p = new WALK.SpriteMaterial;
            a = null;
            p.disableLightProbe = !0;
            p.headLight = !1;
            p.specularOff = 1;
            var q = new t.Mesh(Ag,null)
        }
        p.baseColor = l;
        p.baseColorTexture = e;
        p.configureTransparency();
        p.setUniforms();
        t.Mesh.call(this, f, p);
        this.visible = !1;
        this.position.copy(d);
        this.lightProbe = a;
        q ? (q.position.copy(d),
        this.colliderMesh = q,
        this.colliderMesh.visible = !1) : this.colliderMesh = this;
        this.colliderMesh.visibilityId = null;
        this.colliderMesh.anchor = this;
        e.addLoadedListener(function() {
            n = "sphere" === b.type ? [b.radius, b.radius, b.radius] : [p.baseColorTexture.width / p.baseColorTexture.height * b.height, b.height, 1];
            c.scale.fromArray(n);
            c.updateMatrixWorld(!0);
            if (q) {
                var a = Math.max(n[0], n[1]);
                q.scale.fromArray([a, a, b.height]);
                q.updateMatrixWorld(!0);
                q.visible = !0
            }
            c.visible = !0;
            WALK.getViewer().requestFrame()
        });
        this.extension = null
    }
    ;
    WALK.Anchor.prototype = Object.create(t.Mesh.prototype);
    WALK.Anchor.prototype.dispose = function() {
        var a = this.material;
        a.dispose();
        var b = this._textureSignature
          , c = Ig.get(b)
          , d = c.texture;
        console.assert(a.baseColorTexture === d);
        setTimeout(function() {
            c.usedTimes--;
            0 === c.usedTimes && (d.dispose(),
            Ig.delete(b))
        }, 5E3)
    }
    ;
    WALK.Anchor.prototype.enableLightProbe = function() {
        if (this.lightProbe) {
            console.assert(this.lightProbe.texturesReady());
            var a = this.material;
            a.disableLightProbe = !1;
            a.setUniforms()
        }
    }
    ;
    var Kg = null
      , Lg = !1
      , Mg = [{
        name: "mainMaterial",
        baseColor: [.5, .5, .5],
        roughness: .7,
        metallic: 1
    }, {
        name: "displayMaterial",
        baseColor: [0, 0, 0],
        roughness: .001,
        metallic: 0
    }]
      , Ng = {
        sphere: null,
        cylinder: null,
        head: [],
        torso: [],
        displayPortrait: [],
        displayLandscape: []
    }
      , Og = {};
    function Pg(a) {
        Ng.plane && Kg === a.id || (Ng.sphere = new t.SphereBufferGeometry(.08,32,16),
        Ng.sphere.convertNormalsToSpherical(),
        Ng.cylinder = new t.CylinderBufferGeometry(.005,.005,1,3),
        Ng.cylinder.convertNormalsToSpherical(),
        Kg = a.id)
    }
    function Qg(a, b, c) {
        var d = new t.Box3;
        Ng.head.forEach(function(a) {
            d.union(a.geometry.boundingBox)
        });
        return new WALK.Anchor(a,{
            type: "sprite",
            position: [0, 0, .1 + (d.max.z - d.min.z) / 2],
            height: .1,
            text: b,
            textColor: c,
            opacity: 0
        })
    }
    function Rg(a) {
        a = new t.Mesh(Ng.sphere,a);
        a.scale.set(.4, .4, .4);
        a.visible = !1;
        return a
    }
    function Sg(a) {
        var b = new WALK.StandardMaterial;
        b.headLight = !1;
        b.baseColor.setStyle(a).convertGammaToLinear();
        b.transparent = !0;
        b.opacity = .5;
        b.emissive = !0;
        b.disableLightProbe = !0;
        b.setUniforms();
        a = new t.Mesh(Ng.cylinder,b);
        a.visible = !1;
        return a
    }
    function Tg(a) {
        var b = new WALK.StandardMaterial;
        b.baseColor.fromArray(a.baseColor);
        b.roughness = a.roughness || 1;
        b.metallic = a.metallic || 0;
        b.opacity = a.opacity || 1;
        b.highlight = new t.Color(16777215);
        b.highlightMix = 0;
        b.baseColorTexture = a.baseColorTexture || null;
        b.disableLightProbe = a.disableLightProbe || !1;
        b.headLight = a.headLight || !1;
        b.setUniforms();
        return b
    }
    function Ug(a, b) {
        a && Mg.push.apply(Mg, k.arrayFromIterable(a));
        Mg.forEach(function(a) {
            if (a.baseColorTexture) {
                var c = new Image;
                c.src = b + a.baseColorTexture.file;
                a.baseColorTexture = WALK.getViewer().createTextureFromHtmlImage(c)
            }
            Og[a.name] = Tg(a)
        })
    }
    WALK.setAvatarModel = function(a, b, c) {
        Lg = b.displayLookAtCamera || !1;
        var d = b.meshes;
        d.length !== c.size && console.warn("Mismatch between avatar meshes count and geometries map size");
        d = k.makeIterator(d);
        for (var e = d.next(); !e.done; e = d.next()) {
            e = e.value;
            c.has(e.geometryName) || console.assert(!1, 'Avatar "' + e.geometryName + '" mesh is missing');
            var f = {
                materialName: e.materialName ? e.materialName : "mainMaterial",
                geometry: c.get(e.geometryName)
            };
            Ng[e.group].push(f)
        }
        Ug(b.materials, a)
    }
    ;
    WALK.Avatar = function(a, b, c) {
        function d(a, b) {
            Ng[b].forEach(function(b) {
                a: {
                    var c = b.materialName;
                    switch (c) {
                    case "mainMaterial":
                        c = e.mainMaterial;
                        break a;
                    case "displayMaterial":
                        c = e.displayMaterial;
                        break a;
                    default:
                        c = Og[c]
                    }
                }
                b = new t.Mesh(b.geometry,c);
                a.add(b);
                b.visibilityId = null;
                e.colliders.push(b)
            })
        }
        var e = this;
        t.Object3D.call(this);
        this.uuid = b;
        this.displayName = c.displayName;
        this._scene = a;
        this._lastLightProbeCheckPosition = new t.Vector3(0,0,0);
        this.colliders = [];
        Pg(a);
        this._haveLightProbe = 0 < this._scene.lightProbes.length;
        b = k.makeIterator(Object.values(Og));
        for (var f = b.next(); !f.done; f = b.next())
            f = f.value,
            f.disableLightProbe = !this._haveLightProbe,
            f.headLight = this._haveLightProbe,
            f.setUniforms();
        this.mainMaterial = Tg(Og.mainMaterial);
        Lg ? (this.displayMaterial = new WALK.SpriteMaterial,
        this.displayMaterial.specularOff = 1) : this.displayMaterial = Tg(Og.displayMaterial);
        this.mainMaterial.baseColor.setStyle(c.color).convertGammaToLinear();
        this._body = new t.Object3D;
        this._head = new t.Object3D;
        this._head.rotation.order = "ZXY";
        this._torso = new t.Object3D;
        this._displayLandscape = new t.Object3D;
        this._displayPortrait = new t.Object3D;
        d(this._head, "head");
        d(this._torso, "torso");
        d(this._displayLandscape, "displayLandscape");
        d(this._displayPortrait, "displayPortrait");
        this._pointer = Rg(this.mainMaterial);
        this._pointerLeaderStartOffset = new t.Vector3(0,.3,-.35);
        this._pointerLeader = Sg(c.color);
        this._displayNameAnchor = Qg(a, c.displayName, c.color);
        this._body.add(this._torso);
        this._body.add(this._head);
        Lg ? (this.add(this._displayLandscape),
        this.add(this._displayPortrait)) : (this._head.add(this._displayLandscape),
        this._head.add(this._displayPortrait));
        this.add(this._body);
        this.add(this._displayNameAnchor);
        this.add(this._pointerLeader);
        this.add(this._pointer);
        c.position && this.position.fromArray(c.position);
        this.updateMatrixWorld(!0);
        this._setClosestLightProbe();
        if (Lg) {
            var g = new t.Box3;
            this._displayLandscape.children.forEach(function(a) {
                g.union(a.geometry.boundingBox)
            });
            this.displayMaterial.offset = g.center()
        }
        this._videoTexture1 = this._videoTexture0 = null;
        this._landscape = !0;
        this._displayLandscape.visible = !Lg;
        this._displayPortrait.visible = !1;
        this._soundThreshold = 140;
        this._maxHighlight = .5;
        this._highlightStepDown = .05
    }
    ;
    WALK.Avatar.prototype = Object.create(t.Object3D.prototype);
    WALK.Avatar.prototype.constructor = WALK.Avatar;
    WALK.Avatar.prototype.switchToPortrait = function() {
        this._landscape && (this._landscape = !1,
        this._displayLandscape.visible = !1,
        this._displayPortrait.visible = !0,
        Lg || (this._head.rotation.y = Math.PI / 2,
        this._torso.position.z -= .05))
    }
    ;
    WALK.Avatar.prototype.switchToLandscape = function() {
        this._landscape || (this._landscape = !0,
        this._displayLandscape.visible = !0,
        this._displayPortrait.visible = !1,
        Lg || (this._head.rotation.y = 0,
        this._torso.position.z += .05))
    }
    ;
    WALK.Avatar.prototype.hideBody = function() {
        this.traverse(function(a) {
            return a.visible = !1
        });
        this.visible = !0;
        this._pointer.visible = !0;
        this._pointerLeader.visible = !0
    }
    ;
    WALK.Avatar.prototype._updated = function() {
        this.dispatchEvent({
            type: "avatarUpdated",
            target: this
        })
    }
    ;
    WALK.Avatar.prototype.rotate = function(a, b) {
        this._body.rotation.z = a;
        this._head.rotation.x = b
    }
    ;
    WALK.Avatar.prototype.setOrientation = function() {
        this._videoTexture0.width < this._videoTexture0.height ? this.switchToPortrait() : this.switchToLandscape()
    }
    ;
    WALK.Avatar.prototype.onVideoStreamStart = function() {
        Lg && (this._displayLandscape.visible = !0,
        this._displayPortrait.visible = !1)
    }
    ;
    WALK.Avatar.prototype.onVideoStreamStop = function() {
        Lg ? (this._displayLandscape.visible = !1,
        this._displayPortrait.visible = !1) : this.switchToLandscape()
    }
    ;
    WALK.Avatar.prototype.setVideoTexture0 = function(a) {
        var b = this;
        this._videoTexture0 && (this._videoTexture0.dispose(),
        this._videoTexture0 = null);
        this._haveLightProbe && (this.displayMaterial.disableLightProbe = !1);
        this.displayMaterial.baseColorTexture = null;
        this._updated();
        a ? (this.onVideoStreamStart(),
        a.addLoadedListener(function() {
            b._videoTexture0 = a;
            b.setOrientation();
            b.displayMaterial.disableLightProbe = !0;
            b.displayMaterial.baseColorTexture = a;
            a.addResizedListener(function() {
                b.setOrientation();
                b._updated()
            });
            b._updated()
        })) : (this.onVideoStreamStop(),
        this._updated())
    }
    ;
    WALK.Avatar.prototype.getVideoTexture0 = function() {
        return this._videoTexture0
    }
    ;
    WALK.Avatar.prototype.setVideoTexture1 = function(a) {
        var b = this;
        this._videoTexture1 && (this._videoTexture1.dispose(),
        this._videoTexture1 = null,
        this._updated());
        a && a.addLoadedListener(function() {
            b._videoTexture1 = a;
            b._updated()
        })
    }
    ;
    WALK.Avatar.prototype.getVideoTexture1 = function() {
        return this._videoTexture1
    }
    ;
    WALK.Avatar.prototype.getMainMaterial = function() {
        return this.mainMaterial
    }
    ;
    WALK.Avatar.prototype._setClosestLightProbe = function() {
        var a = this._scene.closestLightProbe(this.position);
        if (a !== this._head.children[0].lightProbe) {
            for (var b = k.makeIterator([this._head, this._torso, this._displayPortrait, this._displayLandscape]), c = b.next(); !c.done; c = b.next())
                c.value.children.forEach(function(b) {
                    b.lightProbe = a
                });
            this._pointer.lightProbe = a;
            this._pointerLeader.lightProbe = a
        }
    }
    ;
    WALK.Avatar.prototype.setPositionFromArray = function(a) {
        this.position.fromArray(a);
        .5 < this._lastLightProbeCheckPosition.distanceTo(this.position) && (this._lastLightProbeCheckPosition.copy(this.position),
        this._setClosestLightProbe(this.position))
    }
    ;
    WALK.Avatar.prototype.placePointer = function() {
        var a = new t.Matrix4
          , b = new t.Vector3
          , c = new t.Vector3
          , d = new t.Vector3
          , e = new t.Vector3
          , f = new t.Matrix4
          , g = new t.Matrix4;
        g.set(1, 0, 0, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 0, 0, 1);
        var h = new t.Matrix4;
        return function(l, m, n) {
            this._pointer.position.set(l - this.position.x, m - this.position.y, n - this.position.z);
            this._pointer.visible = !0;
            a.makeRotationZ(this._body.rotation.z);
            b.set(this._pointerLeaderStartOffset.x, this._pointerLeaderStartOffset.y, this._pointerLeaderStartOffset.z);
            b.applyMatrix4(a);
            c.set(this.position.x, this.position.y, this.position.z).add(b);
            d.set(l, m, n);
            e.set(l, m, n).sub(c);
            h.makeScale(1, e.length(), 1);
            f.lookAt(c, d, t.Object3D.DefaultUp);
            f.multiply(g);
            h.multiplyMatrices(f, h);
            e.divideScalar(2).add(b);
            h.setPosition(e);
            this._pointerLeader.matrix.identity();
            this._pointerLeader.applyMatrix(h);
            this._pointerLeader.visible = !0
        }
    }();
    WALK.Avatar.prototype.hidePointer = function() {
        this._pointerLeader.visible = !1;
        this._pointer.visible = !1
    }
    ;
    WALK.Avatar.prototype.onSoundVolumeUpdated = function(a) {
        null !== a && (a = this._computeHighlighMix(a),
        this.getMainMaterial().highlightMix !== a && (this.getMainMaterial().highlightMix = a,
        WALK.getViewer().requestFrame()))
    }
    ;
    WALK.Avatar.prototype.onSoundSwitchedOff = function() {
        0 < this.getMainMaterial().highlightMix && (this.getMainMaterial().highlightMix = 0,
        WALK.getViewer().requestFrame())
    }
    ;
    WALK.Avatar.prototype._computeHighlighMix = function(a) {
        var b = this.getMainMaterial().highlightMix;
        if (a < this._soundThreshold)
            return 0 < b ? Math.max(0, b - this._highlightStepDown) : 0;
        a = (a - this._soundThreshold) / (255 - this._soundThreshold) * this._maxHighlight;
        return a > b ? a : Math.max(a, b - this._highlightStepDown)
    }
    ;
    WALK.Avatar.prototype.dispose = function() {
        this.mainMaterial.dispose();
        this.displayMaterial.dispose();
        this._videoTexture0 && this._videoTexture0.dispose();
        this._videoTexture1 && this._videoTexture1.dispose();
        this._displayNameAnchor.dispose();
        this.dispatchEvent({
            type: "dispose"
        })
    }
    ;
    var Vg, Wg, Xg, Yg;
    function kh(a, b, c, d, e) {
        c = new t.SphereBufferGeometry(c,32,16);
        c.changePosition(d);
        c.computeBoundingSphere();
        c.convertNormalsToSpherical();
        d = new WALK.Mesh(null,c,b);
        b.lightMapped && (d.lightMap = e);
        a.camera.getWorldPosition(Yg);
        d.lightProbe = a.closestLightProbe(Yg);
        d.frustumCulled = !1;
        d.userData.hideFromLightProbes = !0;
        return d
    }
    var lh = new t.Matrix4
      , mh = new t.Vector2;
    function nh(a) {
        Vg.setRGB(a, a, a);
        a = WALK.ColorUtils.hdrEncode(Vg, Wg);
        var b = new Uint8Array(4);
        b[0] = Math.round(255 * Wg.r);
        b[1] = Math.round(255 * Wg.g);
        b[2] = Math.round(255 * Wg.b);
        b[3] = Math.round(255 * a);
        a = new qb(b,1,1);
        a.magFilter = GLC.NEAREST;
        a.minFilter = GLC.NEAREST;
        a.anisotropy = WALK.NO_ANISOTROPY;
        a.hasAlpha = !0;
        a.isRgbm = !0;
        a.loaded = !0;
        a.needsUpdate = !0;
        return a
    }
    WALK.MaterialPicker = function(a, b, c, d, e, f, g) {
        function h() {
            return m(!1)
        }
        function l() {
            return m(!0)
        }
        function m(a) {
            p.forEach(function(b) {
                return b(a)
            })
        }
        var n = this;
        this.lightMap = null;
        this.meshes = [];
        var p = []
          , q = Math.max(2 * d.camera.near, .1);
        Vg || (Vg = new t.Color,
        Wg = new t.Color,
        Yg = new t.Vector3,
        Xg = new t.Vector3,
        Yg = new t.Vector3);
        var r = d.camera.aspect
          , u = Math.tan(t.Math.degToRad(d.camera.fov / 2)) * q
          , v = -u;
        r = Math.abs(r * u - r * v);
        u = Math.abs(u - v);
        var w = .01 * r
          , x = (r - a.length * w - w) / (2 * a.length);
        x = Math.min(x, WALK.MATERIAL_PICKER_BALL_MAX_SIZE / 2 * r);
        var y = a.length / 2 * -(2 * x + w) + x + w;
        v = document.getElementById("menu-bar").getBoundingClientRect().top;
        var z = -u / 2 + (window.innerHeight - v) / window.innerHeight * u + x + w;
        a.some(function(a) {
            return a.lightMapped
        }) && (f = f.measureIncidentLuma(),
        0 > f && (f = 1),
        this.lightMap = nh(f));
        a.forEach(function(a, f) {
            if (a) {
                Xg.set(y, z, -q);
                var g = kh(d, a, x, Xg, n.lightMap);
                y += 2 * x + w;
                var h = null;
                b && (h = new t.Matrix4,
                h.multiply(lh.makeTranslation(b.x, b.y, b.z)),
                a = e.cameraWorldPosition(),
                mh.x = a.x - b.x,
                mh.y = a.y - b.y,
                h.multiply(lh.makeRotationZ(Math.abs(mh.y) > Math.abs(mh.x) ? 0 < mh.x ? 0 : -Math.PI : 0 < mh.y ? Math.PI / 2 : -Math.PI / 2)),
                h.multiply(lh.makeRotationX(-Math.PI / 2)),
                h.multiply(lh.makeScale(c, c, c)),
                h.multiply(lh.makeTranslation(2.1 * (f + 1), 0, 0)),
                h.multiply(lh.makeScale(1 / x, 1 / x, 1 / x)),
                h.multiply(lh.makeTranslation(-Xg.x, -Xg.y, -Xg.z)));
                n.meshes.push(g);
                p.push(function(a) {
                    a && h ? (g.matrix = h,
                    g.matrixWorld = h) : (g.matrix = d.camera.matrix,
                    g.matrixWorld = d.camera.matrixWorld)
                })
            }
        });
        g.addEventListener("modeEnabled", l);
        g.addEventListener("modeDisabled", h);
        this.dispose = function() {
            p.length = 0;
            g.removeEventListener("modeEnabled", l);
            g.removeEventListener("modeDisabled", h);
            this.meshes.forEach(function(a) {
                return a.geometry.dispose()
            });
            this.meshes = null;
            this.lightMap && (this.lightMap.dispose(),
            this.lightMap = null)
        }
        ;
        m(g.modeIsEnabled())
    }
    ;
    function oh(a, b, c) {
        function d() {
            p.set({
                x: b.min.x,
                y: b.min.y
            }, {
                x: b.max.x,
                y: b.max.y
            })
        }
        function e() {
            var a = p.center()
              , b = Math.abs(Math.sin(m))
              , c = Math.abs(Math.cos(m))
              , d = Math.abs(p.max.x - p.min.x)
              , e = Math.abs(p.max.y - p.min.y)
              , f = d * c + e * b;
            b = d * b + e * c;
            r.set({
                x: a.x - f / 2,
                y: a.y + b / 2
            }, {
                x: a.x + f / 2,
                y: a.y - b / 2
            })
        }
        function f() {
            var a = Math.abs(b.min.x - b.max.x)
              , c = Math.abs(b.min.y - b.max.y);
            a = p.size().x / a;
            c = p.size().y / c;
            a > c ? q.set(1, c / a) : q.set(a / c, 1)
        }
        var g = a.name || "level"
          , h = a.slicePlaneHeight
          , l = a.farPlaneHeight
          , m = a.rotation || 0
          , n = !!a.cropRange
          , p = a.cropRange ? new t.Box2((new t.Vector2).fromArray(a.cropRange.min),(new t.Vector2).fromArray(a.cropRange.max)) : new t.Box2
          , q = new t.Vector2(1,1)
          , r = new t.Box2;
        n && f();
        this.setRange = function(a, b, d) {
            a > p.max[d] && (a = p.max[d]);
            b < p.min[d] && (b = p.min[d]);
            p.min[d] = a;
            p.max[d] = b;
            e();
            f();
            c()
        }
        ;
        this.serialize = function() {
            var a = n ? {
                min: p.min.toArray(),
                max: p.max.toArray()
            } : null;
            return {
                name: g,
                slicePlaneHeight: h,
                farPlaneHeight: l,
                cropRange: a,
                rotation: m
            }
        }
        ;
        Object.defineProperty(this, "name", {
            get: function() {
                return g
            },
            set: function(a) {
                g = a ? a.trim() || "level" : "level";
                c()
            }
        });
        Object.defineProperty(this, "slicePlaneHeight", {
            get: function() {
                return h
            },
            set: function(a) {
                a >= l && (h = a,
                c())
            }
        });
        Object.defineProperty(this, "farPlaneHeight", {
            get: function() {
                return l
            },
            set: function(a) {
                a <= h && (l = a,
                c())
            }
        });
        Object.defineProperty(this, "crop", {
            get: function() {
                return n
            },
            set: function(a) {
                (n = a) || d();
                e();
                f();
                c()
            }
        });
        Object.defineProperty(this, "cropRange", {
            get: function() {
                p.empty() && d();
                return p
            }
        });
        Object.defineProperty(this, "visibleRange", {
            get: function() {
                r.empty() && e();
                return r
            }
        });
        Object.defineProperty(this, "ratio", {
            get: function() {
                0 !== q.x && 0 !== q.y && isNaN(q.x) && isNaN(q.y) || f();
                return q
            }
        });
        Object.defineProperty(this, "rotation", {
            get: function() {
                return m
            },
            set: function(a) {
                m = a;
                n || d();
                e();
                f();
                c()
            }
        });
        Object.defineProperty(this, "rotationDeg", {
            get: function() {
                return t.Math.radToDeg(this.rotation)
            },
            set: function(a) {
                this.rotation = t.Math.degToRad(a)
            }
        })
    }
    WALK.MinimapConfig = function(a, b, c) {
        function d() {
            return h.dispatchEvent(l)
        }
        function e() {
            return new oh({
                name: "level0",
                slicePlaneHeight: c ? c : b.min.z + WALK.FALLBACK_CAMERA_HEIGHT,
                farPlaneHeight: b.min.z
            },b,d)
        }
        function f(a, c) {
            var e = "level" + a
              , f = r[a - 1];
            a = f.slicePlaneHeight + (b.max.z - f.slicePlaneHeight) / 2;
            var g = f.farPlaneHeight;
            f = f.rotation;
            c = c.crop ? {
                min: c.cropRange.min.toArray(),
                max: c.cropRange.max.toArray()
            } : null;
            return new oh({
                name: e,
                slicePlaneHeight: a,
                farPlaneHeight: g,
                cropRange: c,
                rotation: f
            },b,d)
        }
        function g() {
            return r.map(function(a) {
                return a.serialize()
            })
        }
        var h = this;
        a = void 0 !== a ? a : {
            enabled: !1,
            outlineColor: [0, 0, 0],
            outlineThickness: 1,
            fillEnabled: !0,
            levels: []
        };
        var l = {
            type: "updated",
            target: this
        }
          , m = a.enabled
          , n = (new t.Color).fromArray(a.outlineColor)
          , p = a.outlineThickness
          , q = a.fillEnabled
          , r = a.levels.map(function(a) {
            return new oh(a,b,d)
        });
        this.addLevel = function(a) {
            var b = r.length;
            0 === b ? r.push(e()) : r.push(f(b, a));
            d()
        }
        ;
        this.removeLevel = function(a) {
            WALK.removeFromArray(a, r);
            0 === r.length && r.push(e());
            d()
        }
        ;
        this.shiftLevel = function(a, b) {
            WALK.shiftItem(r, a, b);
            d()
        }
        ;
        this.setOutlineColorRGB = function(a, b, c) {
            n.setRGB(a, b, c);
            d()
        }
        ;
        this.serialize = function() {
            return {
                enabled: this.enabled,
                outlineColor: this.outlineColor.toArray(),
                outlineThickness: this.outlineThickness,
                fillEnabled: this.fillEnabled,
                levels: g()
            }
        }
        ;
        Object.defineProperty(this, "enabled", {
            get: function() {
                return m
            },
            set: function(a) {
                a && 0 === r.length && this.addLevel();
                m = a;
                d()
            }
        });
        Object.defineProperty(this, "outlineColor", {
            get: function() {
                return n
            }
        });
        Object.defineProperty(this, "outlineThickness", {
            get: function() {
                return p
            },
            set: function(a) {
                p = a;
                d()
            }
        });
        Object.defineProperty(this, "fillEnabled", {
            get: function() {
                return q
            },
            set: function(a) {
                q = a;
                d()
            }
        });
        Object.defineProperty(this, "levels", {
            get: function() {
                return r
            }
        })
    }
    ;
    t.EventDispatcher.prototype.apply(WALK.MinimapConfig.prototype);
    function ph() {
        var a = new Set
          , b = [];
        this.add = function(c) {
            c instanceof RegExp ? b.push(c) : a.add(c)
        }
        ;
        this.matchesAny = function(c) {
            return a.has(c) ? !0 : b.some(function(a) {
                return a.test(c)
            })
        }
    }
    ;function qh() {
        function a(a, b, c) {
            return (0 <= a ? a - 1 : a + b / c) * c
        }
        var b = this
          , c = new t.Vector3
          , d = new t.Vector3
          , e = new t.Vector3
          , f = new t.Vector3
          , g = new t.Vector3;
        this.objects = [];
        var h = null;
        this.vertices = [];
        this.normals = [];
        this.uvs = [];
        this.startObject = function(a) {
            h = {
                name: a || "",
                vertices: [],
                normals: [],
                uvs: [],
                hasUvs: !1
            };
            this.objects.push(h)
        }
        ;
        this.addFace = function(l, m, n, p, q, r, u, v, w) {
            var x = this.vertices.length;
            l = a(l, x, 3);
            m = a(m, x, 3);
            n = a(n, x, 3);
            x = b.vertices;
            var y = h.vertices;
            y.push(x[l + 0], x[l + 1], x[l + 2]);
            y.push(x[m + 0], x[m + 1], x[m + 2]);
            y.push(x[n + 0], x[n + 1], x[n + 2]);
            void 0 !== u ? (l = this.normals.length,
            u = a(u, l, 3),
            v = a(v, l, 3),
            w = a(w, l, 3),
            l = b.normals,
            m = h.normals,
            m.push(l[u + 0], l[u + 1], l[u + 2]),
            m.push(l[v + 0], l[v + 1], l[v + 2]),
            m.push(l[w + 0], l[w + 1], l[w + 2])) : (w = b.vertices,
            v = h.normals,
            c.fromArray(w, l),
            d.fromArray(w, m),
            e.fromArray(w, n),
            g.subVectors(e, d),
            f.subVectors(c, d),
            g.cross(f),
            g.normalize(),
            v.push(g.x, g.y, g.z),
            v.push(g.x, g.y, g.z),
            v.push(g.x, g.y, g.z));
            void 0 !== p ? (w = this.uvs.length,
            p = a(p, w, 2),
            q = a(q, w, 2),
            r = a(r, w, 2),
            w = b.uvs,
            v = h.uvs,
            v.push(w[p + 0], w[p + 1]),
            v.push(w[q + 0], w[q + 1]),
            v.push(w[r + 0], w[r + 1]),
            h.hasUvs = !0) : (r = h.uvs,
            r.push(0, 0),
            r.push(0, 0),
            r.push(0, 0))
        }
    }
    function rh(a) {
        if (void 0 !== a && "" !== a)
            return parseInt(a, 10)
    }
    ;var sh = "doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" ")
      , th = "bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" ")
      , uh = "baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");
    function vh(a, b, c) {
        for (var d = 0; d < b.length; d += 1) {
            var e = b[d]
              , f = a[e];
            void 0 !== f && (c["_" + e] = f)
        }
    }
    function wh(a, b, c) {
        var d = WALK.DETECTOR;
        this.load = function(e, f) {
            for (var g = new Map, h = 0, l = 0; l < e.length; l += 1) {
                var m, n = e[l];
                var p = WALK.createMaterialOfType(n.type);
                if ("water" === p.type)
                    p.name = n.name,
                    n.normalTexture && (p.normalTexture = a.load(WALK.LOAD_PRIORITY.SPECULARITY, n.normalTexture, !0, !1, WALK.DEFAULT_ANISOTROPY)),
                    n.baseColor && p.baseColor.fromArray(n.baseColor),
                    void 0 !== n.opacity && (p.opacity = n.opacity),
                    vh(n, ["wavesSpeed", "wavesScale", "refractionFactor"], p),
                    p.setUniforms();
                else {
                    WALK.copyProperties(n, sh, p);
                    vh(n, th, p);
                    n.baseColor && (p.baseColor.fromArray(n.baseColor),
                    p.baseColor.roundChannels());
                    if (m = n.baseColorTextureCorrection)
                        p._baseColorTextureCorrection = !0,
                        void 0 !== m.contrast && (p._baseColorTextureContrast = m.contrast),
                        p.baseColorTextureHslOffset.h = m.hslOffset[0],
                        p.baseColorTextureHslOffset.s = m.hslOffset[1],
                        p.baseColorTextureHslOffset.l = m.hslOffset[2];
                    if (m = n.baseColorTexture) {
                        if (m.atlasId) {
                            var q = b[m.atlasId].getAtlasEntry(m.id, m.name, m.atlasOffset[0], m.atlasOffset[1], m.atlasScale[0], m.atlasScale[1]);
                            null !== q.rawExt && q.rawExt !== m.rawExt && console.warn("Atlas entries with not matching rawExt " + m.name);
                            q.rawExt = m.rawExt;
                            null !== q.stdExt && q.stdExt !== m.stdExt && console.warn("Atlas entries with not matching stdExt " + m.name);
                            q.stdExt = m.stdExt;
                            !1 === m.importGpuCompress && (q.importGpuCompress = !1);
                            !1 === m.importAutoScale && (q.importAutoScale = !1);
                            m = q
                        } else
                            m = a.load(WALK.LOAD_PRIORITY.DIFFUSE, m, !0, !0, WALK.DEFAULT_ANISOTROPY);
                        m.isCutout = null;
                        p.baseColorTexture = m
                    }
                    n.roughnessTexture && (p.roughnessTexture = a.load(WALK.LOAD_PRIORITY.SPECULARITY, n.roughnessTexture, !0, !0, WALK.DEFAULT_ANISOTROPY));
                    n.metallicTexture && (p.metallicTexture = a.load(WALK.LOAD_PRIORITY.SPECULARITY, n.metallicTexture, !0, !0, WALK.DEFAULT_ANISOTROPY));
                    n.bumpTexture && d.gl.standardDerivatives && (p.bumpTexture = a.load(WALK.LOAD_PRIORITY.SPECULARITY, n.bumpTexture, !0, !0, WALK.DEFAULT_ANISOTROPY));
                    n.doNotImport && WALK.copyProperties(n.doNotImport, uh, p.doNotImport);
                    n.chromaKeyColor && (p.chromaKeyColor.fromArray(n.chromaKeyColor),
                    p.chromaKeyColor.roundChannels());
                    n.chromaKeyDelta && p._chromaKeyDelta.fromArray(n.chromaKeyDelta);
                    n.uvOffsetScale && (n = n.uvOffsetScale,
                    p.setUvOffsetAndScale(n[0], n[1], n[2], n[3]))
                }
                if (!c.isMaterialEditable(p.name)) {
                    n = p.hash();
                    m = g.get(n) || [];
                    q = k.makeIterator(m);
                    for (var r = q.next(); !r.done; r = q.next())
                        if (r = r.value,
                        r.canMerge(p)) {
                            h += 1;
                            r.merged = !0;
                            p = r;
                            break
                        }
                    p.merged || (m.push(p),
                    g.set(n, m))
                }
                f.addMaterial(p);
                p.merged || p.setUniforms()
            }
            WALK.log("Have " + e.length + " materials and " + (e.length - h) + " merged materials.")
        }
    }
    ;function xh(a, b, c) {
        function d() {
            --f;
            if (0 === f)
                e.onComplete()
        }
        var e = this
          , f = b;
        this.lightmaps = [];
        this.onComplete = null;
        this.load = function() {
            var e;
            if (e = WALK.DETECTOR.webp)
                e = void 0 !== c && void 0 !== c.formats ? 0 <= c.formats.indexOf("webp") : !1;
            e = {
                id: null,
                name: null,
                stdExt: e ? "webp" : "png",
                webFormats: ["large/std"],
                alpha: !0,
                rgbm: !0
            };
            for (var f = 0; f < b; f += 1) {
                e.id = e.name = "lightmap-rgbm" + f;
                var l = a.load(WALK.LOAD_PRIORITY.LIGHTMAP, e, !1, !1, WALK.NO_ANISOTROPY);
                l.magFilter = GLC.NEAREST;
                l.minFilter = GLC.NEAREST;
                l.addLoadedListener(d);
                this.lightmaps.push(l)
            }
        }
    }
    ;function yh(a, b) {
        this.atlases = {};
        this.load = function(c) {
            for (var d = 0; d < c.length; ++d) {
                var e = a.load(WALK.LOAD_PRIORITY.DIFFUSE, c[d], !1, !0, WALK.DEFAULT_ANISOTROPY);
                e.flipY = !1;
                e.enableAtlas(b);
                this.atlases[c[d].id] = e
            }
        }
    }
    ;function zh(a, b) {
        var c = {};
        this.onHaveBuffer = this.onFailure = this.onProgress = null;
        this._buffersDone = {};
        this.buffers = {
            meshes: null,
            transforms: null,
            bounds: null,
            faces16: null,
            faces: null,
            vertices: null,
            normals: null,
            uvs0: null,
            uvs1: null
        };
        this.haveAllBuffers = function() {
            for (var a in this.buffers)
                if (this.buffers.hasOwnProperty(a) && null === this.buffers[a])
                    return !1;
            return !0
        }
        ;
        this.haveCoreBuffers = function() {
            var a = this.buffers;
            return a.faces16 && a.faces && a.vertices && a.normals && a.transforms
        }
        ;
        this.releaseCoreBuffers = function() {
            var a = this.buffers;
            a.faces16 = a.faces = a.vertices = a.normals = null
        }
        ;
        this.load = function() {
            function d(a) {
                return function(b) {
                    f.buffers[a] = b;
                    f.onHaveBuffer()
                }
            }
            function e(a) {
                return function(b) {
                    c[a] = b.loaded;
                    f.onProgress()
                }
            }
            var f = this
              , g = WALK.LOAD_PRIORITY.CORE_RESOURCE
              , h = {
                meshes: g,
                transforms: g,
                bounds: g,
                faces16: g,
                faces: g,
                vertices: g,
                normals: g,
                uvs0: b ? g : WALK.LOAD_PRIORITY.UV0,
                uvs1: b ? g : WALK.LOAD_PRIORITY.LIGHTMAP
            };
            (function() {
                for (var b in f.buffers)
                    if (f.buffers.hasOwnProperty(b)) {
                        var c = h[b];
                        console.assert(void 0 !== c);
                        WALK.queueAjaxGet(c, a + b + ".buf", !0, d(b), f.onFailure, e(b), !0)
                    }
            }
            )()
        }
        ;
        this.totalDone = function() {
            var a = 0, b;
            for (b in c)
                c.hasOwnProperty(b) && (a += c[b]);
            return a
        }
    }
    ;function Ah(a, b, c, d, e, f) {
        this.meshPropsSet = new Set;
        this.meshPropsSet.add(a);
        this.material = b;
        this.lightMap = c;
        this.lightProbe = d;
        this.hideInViews = e;
        this.editableRootNode = f;
        this.anyLogicalMeshHasUvs = -1 !== a.uv0ByteOffset;
        this.sharedGeometryId = a.useInstances ? a.vertexByteOffset : null
    }
    Ah.prototype.canUseLightMap = function(a) {
        return null === this.lightMap || null === a || this.lightMap === a
    }
    ;
    function Bh(a, b, c) {
        var d = new Int32Array(a);
        a = new Float32Array(a);
        var e = new Float32Array(b)
          , f = {}
          , g = d[0]
          , h = d[1]
          , l = 2;
        for (b = 0; l < d.length; ) {
            var m = {
                nodeId: d[l],
                materialIdx: d[l + 1],
                useFaces16: 1 === d[l + 2],
                faceByteOffset: d[l + 3],
                faceCnt: d[l + 4],
                vertexByteOffset: d[l + 5],
                vertexCnt: d[l + 6],
                normalByteOffset: d[l + 7],
                uv0ByteOffset: d[l + 8],
                uv1ByteOffset: d[l + 9],
                lightMapIdx: d[l + 10],
                uv1CoordUScale: a[l + 11],
                uv1CoordVScale: a[l + 12],
                uv1CoordUOffset: d[l + 13],
                uv1CoordVOffset: d[l + 14],
                transformByteOffset: d[l + 15],
                boundsByteOffset: d[l + 16],
                quantVertexRange: a[l + 17],
                quantVertexMax: d[l + 18],
                quantUv0Range: a[l + 19],
                quantUv0Max: d[l + 20],
                autoLightmapResolution: 2 <= g ? d[l + 21] : -1,
                useInstances: !1,
                hasCopies: !1,
                isMasterCopy: !1
            };
            m.boundingBox = new t.Box3;
            m.boundingSphere = new t.Sphere;
            a: {
                for (var n = m.boundingBox, p = m.boundingSphere, q = m.boundsByteOffset / 4, r = 0; 6 > r; ++r)
                    if (!isFinite(e[q + r]))
                        break a;
                n.max.x = e[q];
                n.max.y = e[q + 1];
                n.max.z = e[q + 2];
                n.min.x = e[q + 3];
                n.min.y = e[q + 4];
                n.min.z = e[q + 5];
                n.center(p.center);
                p.radius = e[q + 6]
            }
            b = Math.max(b, m.lightMapIdx + 1);
            WALK.DETECTOR.gl.instances && (n = m.vertexByteOffset,
            f.hasOwnProperty(n) ? (n = f[n],
            p = n[0],
            p.isMasterCopy = !0,
            p.hasCopies = !0,
            m.hasCopies = !0,
            n.push(m)) : f[n] = [m]);
            c.push(m);
            l += h
        }
        c = k.makeIterator(Object.values(f));
        for (d = c.next(); !d.done; d = c.next())
            if (d = d.value,
            a = d.length,
            1 < a && 500 < a * d[0].faceCnt)
                for (d = k.makeIterator(d),
                a = d.next(); !a.done; a = d.next())
                    a.value.useInstances = !0;
        return b
    }
    function Ch(a, b, c, d) {
        function e(b) {
            var c = []
              , d = new Map;
            g.forEach(function(e) {
                var f = a.findNode(e.nodeId)
                  , g = a.materials[e.materialIdx]
                  , h = null;
                null !== f.initialLightProbeId && (h = a.findLightProbe(f.initialLightProbeId));
                var l = null;
                -1 !== e.lightMapIdx && (l = b[e.lightMapIdx]);
                var m = f.hideInViews || []
                  , n = f.editableRoot;
                if (f.editable || 1 !== g.opacity)
                    c.push(new Ah(e,g,l,h,m,n));
                else {
                    var p = e.useInstances ? e.vertexByteOffset : null;
                    f = d.get(g) || [];
                    for (var r = k.makeIterator(f), q = r.next(); !q.done; q = r.next()) {
                        q = q.value;
                        var u;
                        if (u = q.lightProbe === h && q.editableRootNode === n && q.canUseLightMap(l) && q.sharedGeometryId === p)
                            a: if (u = q.hideInViews,
                            u.length !== m.length)
                                u = !1;
                            else {
                                for (var G = 0; G < u.length; G += 1)
                                    if (u[G] !== m[G]) {
                                        u = !1;
                                        break a
                                    }
                                u = !0
                            }
                        if (u) {
                            null !== l && (q.lightMap = l);
                            q.anyLogicalMeshHasUvs = q.anyLogicalMeshHasUvs || -1 !== e.uv0ByteOffset;
                            q.meshPropsSet.add(e);
                            return
                        }
                    }
                    e = new Ah(e,g,l,h,m,n);
                    f.push(e);
                    d.set(g, f);
                    c.push(e)
                }
            });
            return c
        }
        var f = this
          , g = []
          , h = b.byteLength
          , l = 0
          , m = 0
          , n = 0;
        this.mergedMeshes = [];
        this.lightmapCount = this.geometryDownloadSize = this.coreGeometryDownloadSize = 0;
        this.createMeshes = function(b) {
            var c = b ? b[0] : null
              , f = e(b);
            b = {};
            f = k.makeIterator(f);
            for (var g = f.next(); !g.done; g = f.next()) {
                var h = g.value;
                g = h.sharedGeometryId;
                if (null !== g) {
                    var m = b[g]
                      , n = !1;
                    m || (m = new WALK.Geometry,
                    n = !0,
                    b[g] = m);
                    g = new WALK.InstancedGeometry(m,n)
                } else
                    g = new WALK.Geometry;
                m = new WALK.MergedMesh(g,h.material);
                m.lightProbe = h.lightProbe;
                m.lightMap = h.lightMap || c;
                m.hideInViews = h.hideInViews;
                m.anyLogicalMeshHasUvs = h.anyLogicalMeshHasUvs;
                m.editableRootNode = h.editableRootNode;
                this.mergedMeshes.push(m);
                h = k.makeIterator(h.meshPropsSet);
                for (n = h.next(); !n.done; n = h.next()) {
                    n = n.value;
                    var p, z = g;
                    if (d) {
                        var A = 3 * n.faceCnt;
                        var B = n.vertexCnt
                    } else
                        A = 0,
                        B = 3 * n.faceCnt;
                    if (z.isInstanced)
                        var H = p = 0;
                    else
                        p = z.indexCnt,
                        H = z.vertexCnt;
                    H = new WALK.SubGeometry(A,B,z,p,H,n.boundingBox,n.boundingSphere);
                    z.boundingBox.union(n.boundingBox);
                    WALK.Math.spheresUnion(n.boundingSphere, z.boundingSphere);
                    z.isInstanced ? (H.instanceId = z.instanceCount,
                    z.instanceCount += 1,
                    z.indexCnt = A,
                    z.vertexCnt = B) : (z.indexCnt += A,
                    z.vertexCnt += B);
                    A = H;
                    B = a.findNode(n.nodeId);
                    A = new WALK.Mesh(B,A,m.material);
                    A.lightMap = m.lightMap;
                    A.lightProbe = m.lightProbe;
                    A.autoLightmapResolution = n.autoLightmapResolution;
                    A.useFaces16 = n.useFaces16;
                    A.faceByteOffset = n.faceByteOffset;
                    A.faceCnt = n.faceCnt;
                    A.vertexByteOffset = n.vertexByteOffset;
                    A.vertexCnt = n.vertexCnt;
                    A.normalByteOffset = n.normalByteOffset;
                    A.uv0ByteOffset = n.uv0ByteOffset;
                    A.uv1ByteOffset = n.uv1ByteOffset;
                    A.lightMapIdx = n.lightMapIdx;
                    A.uv1CoordUScale = n.uv1CoordUScale;
                    A.uv1CoordVScale = n.uv1CoordVScale;
                    A.uv1CoordUOffset = n.uv1CoordUOffset;
                    A.uv1CoordVOffset = n.uv1CoordVOffset;
                    A.transformByteOffset = n.transformByteOffset;
                    A.quantVertexRange = n.quantVertexRange;
                    A.quantVertexMax = n.quantVertexMax;
                    A.quantUv0Range = n.quantUv0Range;
                    A.quantUv0Max = n.quantUv0Max;
                    n.hasCopies && (A.sharedBuffersDebug = n.isMasterCopy ? 1 : 2);
                    l += 1;
                    m.addLogicalMesh(A);
                    B.mesh = A
                }
            }
            WALK.log("Have " + l + " meshes and " + this.mergedMeshes.length + " merged meshes.")
        }
        ;
        this.lightmapCount = Bh(b, c, g);
        b = c = null;
        (function() {
            for (var a = 0, b = 0, c = 0, d = 0, e = 0, l = 0, x = 0, y = k.makeIterator(g), z = y.next(); !z.done; z = y.next()) {
                z = z.value;
                var A = z.vertexCnt;
                m += A;
                n += z.faceCnt;
                a = Math.max(a, z.faceByteOffset + 3 * z.faceCnt * (z.useFaces16 ? 2 : 4));
                b = Math.max(b, z.vertexByteOffset + 3 * A * WALK.Math.minBytesToHold(z.quantVertexMax) + 3 & -4);
                c = Math.max(c, z.normalByteOffset + 2 * A);
                d = Math.max(d, z.transformByteOffset + 64);
                e = Math.max(e, z.boundsByteOffset + 28);
                -1 !== z.uv0ByteOffset && (l = Math.max(l, z.uv0ByteOffset + 2 * A * WALK.Math.minBytesToHold(z.quantVertexMax) + 3 & -4));
                -1 !== z.uv1ByteOffset && (x = Math.max(x, z.uv1ByteOffset + 4 * A))
            }
            f.coreGeometryDownloadSize = h + a + b + c + d + e;
            f.geometryDownloadSize += f.coreGeometryDownloadSize + l + x
        }
        )();
        WALK.log("Have " + m + " vertices, " + n + " faces and " + this.lightmapCount + " lightmaps.")
    }
    ;var Dh = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]);
    function Eh(a) {
        this.minVerticesUntilTimeCall = a;
        this.verticesCount = 0;
        this.timer = new WALK.Timer
    }
    Eh.prototype.shouldInterrupt = function(a) {
        this.verticesCount += a;
        return this.verticesCount > this.minVerticesUntilTimeCall && 10 < this.timer.elapsedMSec() ? (this.verticesCount = 0,
        this.timer.reset(),
        !0) : !1
    }
    ;
    function Fh(a, b, c, d, e, f, g) {
        var h = 0;
        for (c *= 3; h < c; h += 3) {
            var l = a[h + b] * e
              , m = a[h + b + 1] * e
              , n = a[h + b + 2] * e;
            f[g + h] = d[0] * l + d[1] * m + d[2] * n + d[3];
            f[g + h + 1] = d[4] * l + d[5] * m + d[6] * n + d[7];
            f[g + h + 2] = d[8] * l + d[9] * m + d[10] * n + d[11]
        }
    }
    function Gh(a, b, c, d, e, f) {
        var g = 0;
        for (c *= 2; g < c; g += 2) {
            var h = (a[g + b] / 254 + .5) * Math.PI
              , l = Math.PI / 127 * a[g + b + 1]
              , m = Math.sin(h)
              , n = m * Math.cos(l);
            l = m * Math.sin(l);
            h = Math.cos(h);
            m = d[0] * n + d[1] * l + d[2] * h;
            var p = d[4] * n + d[5] * l + d[6] * h;
            h = 2 * (Math.acos(d[8] * n + d[9] * l + d[10] * h) / Math.PI - .5);
            l = Math.atan2(p, m) / Math.PI;
            e[f + g] = WALK.Math.toSnorm8(h);
            e[f + g + 1] = WALK.Math.toSnorm8(l)
        }
    }
    function Hh(a) {
        return 0 !== a.instanceId || !1 === a.parent.ownsGpuBuffers
    }
    function Ih(a, b, c, d, e, f) {
        var g = !1
          , h = 0;
        for (c *= 2; h < c; h += 1) {
            var l = a[h + b] * d;
            e[f + h] = l;
            if (0 > l || 1 < l)
                g = !0
        }
        return g
    }
    function Jh(a, b, c, d, e) {
        var f = !1
          , g = 0;
        for (c *= 2; g < c; g += 1) {
            var h = a[g + b];
            d[e + g] = h;
            if (0 > h || 1 < h)
                f = !0
        }
        return f
    }
    function Kh(a, b, c, d, e, f, g, h, l) {
        var m = 0;
        for (c *= 2; m < c; m += 2) {
            var n = a[m + b]
              , p = a[m + b + 1];
            0 !== n || 0 !== p ? (h[l + m] = Math.round(n * d) + f,
            h[l + m + 1] = Math.round(p * e) + g) : (h[l + m] = 0,
            h[l + m + 1] = 0)
        }
    }
    function Lh(a, b, c, d, e) {
        function f() {
            for (; h < a.length; ) {
                var m = a[h];
                if (0 !== l || b(m)) {
                    for (; l < m.logicalMeshes.length; ) {
                        var n = m.logicalMeshes[l];
                        c(n);
                        l += 1;
                        if (g.shouldInterrupt(n.vertexCnt)) {
                            setTimeout(f, 0);
                            return
                        }
                    }
                    d(m);
                    h += 1;
                    l = 0
                } else
                    h += 1
            }
            e()
        }
        var g = new Eh(5E4)
          , h = 0
          , l = 0;
        f()
    }
    function Mh(a, b) {
        b.geometry.allocateCoreBuffers(a);
        return !0
    }
    function Nh(a) {
        return a.anyLogicalMeshHasUvs ? (a.geometry.allocateUv0(),
        !0) : !1
    }
    function Oh(a) {
        return a.lightMap ? (a.geometry.allocateUv1(),
        !0) : !1
    }
    function Ph(a, b, c, d) {
        var e = new Uint16Array(a)
          , f = new Float32Array(a);
        Lh(b, Nh, function(a) {
            if (a.uv0InBuffers()) {
                var b = a.geometry;
                if (!Hh(b)) {
                    var c = b.vertexOffset;
                    b = b.parent;
                    if (a.quantUv0Disabled() ? Jh(f, a.uv0ByteOffset / 4, a.vertexCnt, b.uvs0, 2 * c) : Ih(e, a.uv0ByteOffset / 2, a.vertexCnt, a.quantUv0Factor(), b.uvs0, 2 * c))
                        b.isUvs0Repeating = !0
                }
            }
        }, c, d)
    }
    function Qh(a, b, c, d, e) {
        var f = 4 * e.instanceId;
        e = e.parent.uvs1Mod;
        e[f] = c / 65535;
        e[f + 1] = d / 65535;
        e[f + 2] = a / 65535;
        e[f + 3] = b / 65535
    }
    function Rh(a, b, c, d) {
        var e = new Uint16Array(a);
        Lh(b, Oh, function(a) {
            if (a.uv1InBuffers()) {
                var b = a.uv1CoordUScale
                  , c = a.uv1CoordVScale
                  , d = a.uv1CoordUOffset
                  , f = a.uv1CoordVOffset
                  , n = a.geometry;
                if (n.isInstanced) {
                    Qh(b, c, d, f, n);
                    if (Hh(n))
                        return;
                    b = c = 1;
                    d = f = 0
                }
                Kh(e, a.uv1ByteOffset / 2, a.vertexCnt, b, c, d, f, n.parent.uvs1, 2 * n.vertexOffset)
            }
        }, c, d)
    }
    function Sh(a, b) {
        var c = b.parent;
        b = 4 * b.instanceId;
        var d = c.transforms0;
        d[b] = a[0];
        d[b + 1] = a[1];
        d[b + 2] = a[2];
        d[b + 3] = a[3];
        d = c.transforms1;
        d[b] = a[4];
        d[b + 1] = a[5];
        d[b + 2] = a[6];
        d[b + 3] = a[7];
        c = c.transforms2;
        c[b] = a[8];
        c[b + 1] = a[9];
        c[b + 2] = a[10];
        c[b + 3] = a[11]
    }
    function Th(a, b, c, d) {
        var e = a.faces16 ? new Uint16Array(a.faces16) : null
          , f = a.faces ? new Uint32Array(a.faces) : null
          , g = new Int8Array(a.vertices)
          , h = new Int16Array(a.vertices)
          , l = new Int32Array(a.vertices)
          , m = new Int8Array(a.normals);
        Lh(b, Mh.bind(null, !0), function(b) {
            var c = b.geometry
              , d = c.parent
              , n = new Float32Array(a.transforms,b.transformByteOffset,16);
            if (c.isInstanced) {
                Sh(n, c);
                if (Hh(c))
                    return;
                n = Dh
            }
            switch (WALK.Math.minBytesToHold(b.quantVertexMax)) {
            case 1:
                var u = g;
                var v = b.vertexByteOffset;
                break;
            case 2:
                u = h;
                v = b.vertexByteOffset / 2;
                break;
            case 4:
                u = l,
                v = b.vertexByteOffset / 4
            }
            var w = c.vertexOffset;
            Fh(u, v, b.vertexCnt, n, b.quantVertexFactor(), d.vertices, 3 * w);
            Gh(m, b.normalByteOffset, b.vertexCnt, n, d.normals, 2 * w);
            d = d.index;
            c = c.indexOffset;
            b.useFaces16 ? (v = b.faceByteOffset / 2,
            n = e) : (v = b.faceByteOffset / 4,
            n = f);
            u = v;
            for (b = v + 3 * b.faceCnt; u < b; u += 1,
            c += 1)
                d[c] = n[u] + w
        }, c, d)
    }
    function Uh(a, b, c, d) {
        var e = a.faces16 ? new Uint16Array(a.faces16) : null
          , f = a.faces ? new Uint32Array(a.faces) : null
          , g = new Int8Array(a.vertices)
          , h = new Int16Array(a.vertices)
          , l = new Int32Array(a.vertices)
          , m = new Int8Array(a.normals)
          , n = new Uint16Array(a.uvs0)
          , p = new Float32Array(a.uvs0)
          , q = a.uvs1 ? new Uint16Array(a.uvs1) : null;
        Lh(b, function(a) {
            Mh(!1, a);
            Nh(a);
            Oh(a);
            return !0
        }, function(b) {
            var c = b.geometry
              , d = b.geometry.parent
              , r = new Float32Array(a.transforms,b.transformByteOffset,16);
            if (b.uv0InBuffers() && d.uvs0)
                var x = d.uvs0;
            if (b.uv1InBuffers() && d.uvs1) {
                var y = d.uvs1;
                var z = b.uv1CoordUScale;
                var A = b.uv1CoordVScale;
                var B = b.uv1CoordUOffset;
                var H = b.uv1CoordVOffset
            }
            if (c.isInstanced) {
                Sh(r, c);
                y && Qh(z, A, B, H, c);
                if (Hh(c))
                    return;
                r = Dh;
                z = A = 1;
                B = H = 0
            }
            if (b.useFaces16) {
                c = e;
                var C = b.faceByteOffset / 2
            } else
                c = f,
                C = b.faceByteOffset / 4;
            switch (WALK.Math.minBytesToHold(b.quantVertexMax)) {
            case 1:
                var L = g;
                var G = b.vertexByteOffset;
                break;
            case 2:
                L = h;
                G = b.vertexByteOffset / 2;
                break;
            case 4:
                L = l,
                G = b.vertexByteOffset / 4
            }
            var I = b.quantUv0Disabled();
            if (I)
                var M = b.uv0ByteOffset / 4;
            else {
                var O = b.quantUv0Factor();
                M = b.uv0ByteOffset / 2
            }
            var K = 3 * b.geometry.vertexOffset
              , F = 2 * b.geometry.vertexOffset
              , D = b.quantVertexFactor()
              , E = d.vertices
              , S = d.normals
              , Z = b.normalByteOffset
              , R = b.uv1ByteOffset / 2
              , da = C;
            for (b = C + 3 * b.faceCnt; da < b; da += 1,
            K += 3,
            F += 2) {
                C = c[da];
                Fh(L, G + 3 * C, 1, r, D, E, K);
                Gh(m, Z + 2 * C, 1, r, S, F);
                if (x) {
                    var ha = M + 2 * C;
                    if (I ? Jh(p, ha, 1, x, F) : Ih(n, ha, 1, O, x, F))
                        d.isUvs0Repeating = !0
                }
                y && Kh(q, R + 2 * C, 1, z, A, B, H, y, F)
            }
        }, c, d)
    }
    ;function Vh(a, b) {
        a.forEach(function(a) {
            b.addView(new WALK.View(a))
        })
    }
    function Wh(a) {
        if (0 !== a.length && a[0].position)
            return a[0].position[2]
    }
    function Xh(a, b, c) {
        a.forEach(function(a) {
            c.isNodeTypeEditable(a.name) && (a.editable = !0);
            b.addNodeConfig(new WALK.NodeConfig(a))
        })
    }
    function Yh(a, b) {
        a.forEach(function(a) {
            var c = new WALK.Light(a);
            a = a.instances;
            for (var e = 0; e < a.length; e += 1) {
                var f = a[e];
                c.addInstance(f.position, f.rotation)
            }
            b.addLight(c)
        })
    }
    function Zh(a, b) {
        a.forEach(function(a) {
            b.addLightProbe(new WALK.LightProbe(a))
        })
    }
    function $h(a, b, c) {
        c = c.camera;
        a && (a.fov && (c.defaultFov = a.fov),
        a.exposure && (c.defaultExposure = a.exposure),
        a.gamma && (c.defaultGamma = a.gamma),
        a.lutTexture && (b = b.load(WALK.LOAD_PRIORITY.COLORMAP, a.lutTexture, !1, !1, WALK.NO_ANISOTROPY),
        b.flipY = !1,
        c.colorMap = b),
        void 0 !== a.lutIntensity && (c.colorMapIntensity = a.lutIntensity),
        a.toneMapping && (c.toneMapping = a.toneMapping),
        c.autoPath = !!a.autoPath,
        c.autoClimb = !!a.autoClimb,
        c.autoExposure = !!a.autoExposure,
        c.fixedHeight = a.fixedHeight,
        void 0 !== a.autoExposureDarkness && (c.autoExposureDarkness = a.autoExposureDarkness),
        void 0 !== a.moveMaxSpeed && (c.moveMaxSpeed = a.moveMaxSpeed),
        c.updateProjectionMatrix())
    }
    function ai(a, b) {
        function c(a, e) {
            var d = b.findNodeConfig(e.config)
              , g = new WALK.Node(a,d,e);
            void 0 !== e.children && (g.children = e.children.map(function(a) {
                return c(g, a)
            }));
            return g
        }
        a.forEach(function(a) {
            b.addNode(c(null, a))
        })
    }
    function bi() {
        var a = null;
        WALK.DETECTOR.whatsApp ? a = "WhatsApp" : WALK.DETECTOR.facebookApp && (a = "Facebook app");
        null === a ? Ba.error("Scene failed to load. Reload the page to retry.") : Ba.error("Scene failed to load. Open the scene outside of " + a + ' by copying the link to the native web browser: <div class="message-scrollable-line"><a href="' + (window.location + '" taget="_blank">' + window.location + "</a></div>"))
    }
    function ci(a, b, c, d, e) {
        var f = !c && WALK.DETECTOR.gl.indexUint
          , g = !c && !WALK.DEBUG_SHARED_BUFFERS
          , h = new WALK.Timer;
        this.onComplete = this.onReadyToDisplay = this.onTextureLoaded = this.onMeshBuffersLoaded = this.onProgress = null;
        this.panoramas = [];
        this.load = function() {
            function l() {
                if (void 0 !== Z.total)
                    C.onProgress(Z)
            }
            function m() {
                O || (O = !0,
                C.onReadyToDisplay(a))
            }
            function n(a) {
                0 === a.name.indexOf("lightmap-rgbm") ? Z.texturesDone += 12582912 : Z.texturesDone += 524288;
                l();
                C.onTextureLoaded(a);
                R()
            }
            function p() {
                console.warn("Failed to load video texture");
                R()
            }
            function q() {
                if (0 === L.texturesToLoad && F) {
                    L.clearCache();
                    for (var b = 0, c = k.makeIterator(I.mergedMeshes), d = c.next(); !d.done; d = c.next())
                        b += d.value.geometry.gpuSize;
                    WALK.log("Total GPU geometry buffers size " + b + " bytes");
                    L = G = I = null;
                    WALK.defer(function() {
                        m();
                        C.onComplete(a)
                    })
                }
            }
            function r() {
                D && K && M && (R = q,
                S && a.materials.forEach(function(a) {
                    a.lightMapped || (a.lightMapped = !0,
                    a.setUniforms())
                }),
                R())
            }
            function u(a) {
                a.geometry.addUv1Attribute();
                C.onMeshBuffersLoaded(a)
            }
            function v() {
                G.buffers.uvs1 && (R = r,
                Rh(G.buffers.uvs1, I.mergedMeshes, u, function() {
                    G.buffers.uvs1 = null;
                    D = !0;
                    R()
                }))
            }
            function w(a) {
                a.geometry.isUvs0Repeating && a.material.ensureTexturesRepeatable();
                a.geometry.addUv0Attribute();
                C.onMeshBuffersLoaded(a)
            }
            function x() {
                G.buffers.uvs0 && (R = v,
                Ph(G.buffers.uvs0, I.mergedMeshes, w, function() {
                    G.buffers.uvs0 = null;
                    F = !0;
                    R()
                }))
            }
            function y() {
                M = !0;
                0 === a.views.length && a.addView(new WALK.View({
                    id: 0,
                    name: "Start place",
                    hideFromMenu: !0,
                    position: a.center.toArray(),
                    rotation: [0, 0],
                    internal: !0,
                    sky: WALK.EDITOR_CONTROLLED_SKY_NAME
                }));
                if (!c && !a.disableProgressiveLoader) {
                    var b = 1E3 * WALK.PROGRESSIVE_LOADER_AFTER_SEC - h.elapsedMSec();
                    0 >= b ? m() : setTimeout(m, b)
                }
                R()
            }
            function z(b) {
                a.addGpuMesh(b)
            }
            function A(a) {
                a.geometry.addCoreAttributes();
                var b = a.logicalMeshes;
                console.assert(!b[0].node.editable || 1 === b.length);
                b[0].node.editable || !g ? b.forEach(z) : z(a);
                C.onMeshBuffersLoaded(a)
            }
            function B(a) {
                a.geometry.isUvs0Repeating && a.material.ensureTexturesRepeatable();
                a.geometry.uvs0 && a.geometry.addUv0Attribute();
                a.geometry.uvs1 && a.geometry.addUv1Attribute();
                A(a)
            }
            function H() {
                if (f) {
                    if (!G.haveCoreBuffers())
                        return;
                    WALK.log("Using indexed geometry");
                    R = x;
                    Th(G.buffers, I.mergedMeshes, A, y)
                } else {
                    if (!G.haveAllBuffers())
                        return;
                    R = r;
                    Uh(G.buffers, I.mergedMeshes, B, function() {
                        D = F = !0;
                        y()
                    })
                }
                G && G.releaseCoreBuffers()
            }
            var C = this
              , L = null
              , G = null
              , I = null
              , M = !1
              , O = !1
              , K = !1
              , F = !1
              , D = !1
              , E = null
              , S = !1
              , Z = {
                total: void 0,
                texturesDone: 0,
                totalDone: function() {
                    return this.texturesDone + G.totalDone()
                }
            };
            h.reset();
            var R = function() {
                if (E && G.buffers.meshes && G.buffers.bounds) {
                    R = H;
                    void 0 !== E.autoAddLightProbes && (a.autoAddLightProbes = E.autoAddLightProbes);
                    a.disableProgressiveLoader = E.disableProgressiveLoader || !1;
                    E.interactionPrompt && (a.interactionPrompt = E.interactionPrompt);
                    void 0 !== E.autoTour && (a.autoTour.disabled = E.autoTour.disabled || !1,
                    a.autoTour.startOnLoad = E.autoTour.startOnLoad || !1);
                    Yh(E.lights, a);
                    Zh(E.lightProbes || [], a);
                    E.cameraVolumes && E.cameraVolumes.forEach(function(b) {
                        return a.addCameraVolume(new WALK.CameraVolume(b))
                    });
                    L = new gd(b,WALK.DETECTOR,n,bi,p,!1,!0);
                    $h(E.camera, L, a);
                    var c = new yh(L,e);
                    c.load(E.atlases || []);
                    (new wh(L,c.atlases,d)).load(E.materials || [], a);
                    (new Rc(L)).load(E.skies || [], a);
                    null === a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME) && console.error("A sky with name " + WALK.EDITOR_CONTROLLED_SKY_NAME + " is missing.");
                    Vh(E.views || [], a);
                    E.hideViewsMenu && (a.hideViewsMenu = !0);
                    Xh(E.nodeConfigs, a, d);
                    ai(E.nodes, a);
                    I = new Ch(a,G.buffers.meshes,G.buffers.bounds,f);
                    c = null;
                    if (0 !== I.lightmapCount) {
                        S = !0;
                        var g = new xh(L,I.lightmapCount,E.lightmap);
                        g.onComplete = function() {
                            K = !0;
                            R()
                        }
                        ;
                        g.load();
                        c = g.lightmaps;
                        g = null
                    } else
                        K = !0;
                    I.createMeshes(c);
                    Z.total = I.geometryDownloadSize + 524288 * (L.texturesToLoad - I.lightmapCount) + 12582912 * I.lightmapCount;
                    E.panoramas && (C.panoramas = E.panoramas);
                    a.minimapConfig = new WALK.MinimapConfig(E.minimap,a.boundingBox,Wh(E.views || []));
                    E = null;
                    R()
                }
            };
            WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE, b + "scene.json", !1, function(a) {
                E = a;
                R()
            }, bi);
            G = new zh(b,!f);
            G.onProgress = l;
            G.onFailure = bi;
            G.onHaveBuffer = function() {
                R()
            }
            ;
            G.load()
        }
        ;
        this.elapsedLoadTimeSec = function() {
            return h.elapsedSec()
        }
    }
    ;/*
 Copyright (C) 2015-present Shapespark
*/
    var di = {
        uniforms: {
            gloss: {
                type: "f",
                value: .9
            },
            face: {
                type: "f",
                value: 0
            },
            mipSize: {
                type: "f",
                value: 128
            },
            envMap: {
                type: "t",
                value: null
            }
        },
        vertexShader: WALK.getShader("cubemap_filter_vertex.glsl"),
        fragmentShader: WALK.getShader("cubemap_filter_fragment.glsl")
    };
    function ei(a, b, c) {
        for (var d = !0; d; ) {
            a.readPixels(b, b, c);
            for (var e = 0; e < b * b * 4; e += 4)
                if (0 !== c[e] || 0 !== c[e + 1] || 0 !== c[e + 2]) {
                    d = !1;
                    break
                }
            if (d) {
                console.warn("Cube face has all pixels black.");
                break
            }
        }
    }
    var fi = function() {
        var a = null;
        return function(b, c) {
            var d = null
              , e = 0;
            c *= c;
            console.assert(c < Math.pow(2, 16));
            null === a && (a = new Uint16Array(65536));
            for (var f = 0; f < 4 * c; f += 4)
                a[256 * b[f] + b[f + 1]] += 1;
            a[0] > .7 * c && (e = a[0]);
            a[0] = 0;
            for (b = 1; b < a.length; b += 1)
                a[b] > e && (e = a[b],
                d = Math.floor(b / 256) + b % 256 / 255),
                a[b] = 0;
            return d
        }
    }();
    function gi(a, b) {
        var c = new Set;
        a.sharedMaterialState.hdrOutput = !0;
        a.threeScene.traverse(function(a) {
            if (a instanceof t.Mesh && a.visible) {
                var d = a.material;
                a.userData.hideFromLightProbes || d.hideFromLightProbes ? (b.add(a),
                a.visible = !1) : c.has(d) || (c.add(d),
                d.configureTransparency && (d.transparent = !1,
                d.blending = t.NoBlending,
                d.depthWrite = !0),
                void 0 !== d.specularOff && (d.specularOff += 1))
            }
        });
        c = null
    }
    function hi(a, b) {
        var c = new Set;
        a.sharedMaterialState.hdrOutput = !1;
        a.threeScene.traverse(function(a) {
            if (a instanceof t.Mesh) {
                var d = a.material;
                d.forceObjectUniformsRefresh && d.forceObjectUniformsRefresh();
                a.visible ? c.has(d) || (c.add(d),
                d.configureTransparency && d.configureTransparency(),
                void 0 !== d.specularOff && --d.specularOff) : b.has(a) && (a.visible = !0)
            }
        });
        c = null
    }
    var ii = function() {
        var a = null;
        return function(b, c, d) {
            var e = b.renderer
              , f = b.aabbQueryMaterial
              , g = b.pixelBuf
              , h = b.targetCubeRaw;
            null === a && (a = new Of(.01,255));
            a.position.copy(c.position);
            a.updateMatrixWorld();
            var l;
            for (l = 0; 6 > l; l += 1) {
                h.activeCubeFace = l;
                f.axis = Math.floor(l / 2);
                e.renderMeshes(b.scene.gpuMeshes, f, a.sideCameras[l], h);
                ei(e, h.width, g);
                var m = fi(g, h.width);
                if (null === m) {
                    WALK.log("failed to find light probe bound");
                    break
                }
                switch (l) {
                case 0:
                    d.boxMax.x = c.position.x + m;
                    break;
                case 1:
                    d.boxMin.x = c.position.x - m;
                    break;
                case 2:
                    d.boxMax.y = c.position.y + m;
                    break;
                case 3:
                    d.boxMin.y = c.position.y - m;
                    break;
                case 4:
                    d.boxMax.z = c.position.z + m;
                    break;
                case 5:
                    d.boxMin.z = c.position.z - m
                }
            }
            6 !== l && (WALK.log("Light probe bounds: X[" + d.boxMin.x.toFixed(2) + ":" + d.boxMax.x.toFixed(2) + "] Y[" + d.boxMin.y.toFixed(2) + ":" + d.boxMax.y.toFixed(2) + "] Z[" + d.boxMin.z.toFixed(2) + ":" + d.boxMax.z.toFixed(2) + "]"),
            d.resetBoundingBox())
        }
    }();
    function ji(a, b) {
        var c = {
            format: GLC.RGBA,
            magFilter: GLC.LINEAR,
            minFilter: GLC.LINEAR,
            stencilBuffer: !1,
            generateMipmaps: !1
        };
        this.renderer = a;
        this.scene = b;
        this.threeScene = b.threeScene;
        this.aabbQueryMaterial = new WALK.AabbQueryMaterial;
        this.filterPass = new t.ShaderPass(di,"envMap");
        b = WALK.LIGHT_PROBE_MAX_MIP_SIZE;
        this.pixelBuf = new Uint8Array(b * b * 4);
        this.targetCubeRaw = a.createRenderTargetCube(b, b, c);
        c.depthBuffer = !1;
        this.targetFiltered = a.createRenderTarget(b, b, c);
        this.autoClearAlter = new xc(a);
        this.dispose = function() {
            this.targetCubeRaw.dispose();
            this.targetFiltered.dispose();
            this.aabbQueryMaterial.dispose();
            this.filterPass.material.dispose();
            this.pixelBuf = null
        }
    }
    ji.prototype.constructor = ji;
    function ki(a, b) {
        var c = b.geometry.boundingSphere.center;
        if (null === b.lightProbe || c.distanceTo(a.position) < c.distanceTo(b.lightProbe.position))
            b.lightProbe = a
    }
    function li(a, b) {
        for (var c = 0; c < b.length; c += 1)
            ki(a, b[c])
    }
    function mi(a, b) {
        WALK.log("No visible light probe found for " + b.length + " objects. Assigning the closest ones.");
        for (var c = 0; c < b.length; c += 1)
            for (var d = 0; d < a.length; d += 1)
                ki(a[d], b[c])
    }
    function ni(a, b, c, d, e) {
        function f(b, f) {
            m.position.copy(b.position);
            m.updateMatrixWorld();
            var g;
            if ((g = d) && !(g = e))
                a: {
                    g = a.gpuMeshes;
                    for (var n = 0; n < g.length; n += 1) {
                        var p = g[n];
                        if (p.lightProbe === b && p.material.envMapMirror) {
                            g = !0;
                            break a
                        }
                    }
                    g = !1
                }
            (n = g) && WALK.log("Mirror texture needed for the light probe.");
            l.reset();
            g = h.renderer;
            h.autoClearAlter.set(!0, !0, !1);
            if (n) {
                var v = h.renderer;
                n = WALK.LIGHT_PROBE_MIRROR_SIZE;
                n = v.createRenderTargetCube(n, n, {
                    format: GLC.RGBA,
                    magFilter: GLC.LINEAR,
                    minFilter: GLC.LINEAR,
                    stencilBuffer: !1,
                    generateMipmaps: !1
                });
                for (p = 0; 6 > p; p += 1)
                    n.activeCubeFace = p,
                    v.render(h.threeScene, m.sideCameras[p], n);
                v.deallocateRenderTargetRenderingBuffers(n);
                v = n;
                b.setMirrorTexture(v)
            }
            f && ii(h, m, b);
            f = h.renderer;
            n = h.targetCubeRaw;
            for (p = 0; 6 > p; p += 1)
                n.activeCubeFace = p,
                f.render(h.threeScene, m.sideCameras[p], n);
            h.autoClearAlter.restore();
            g.enableScissorTest(!0);
            h.autoClearAlter.set(!1, !1, !1);
            c && (v = g.createCubeTexture(h.targetFiltered.width, !0),
            b.setFilteredTexture(v));
            for (f = 0; f < WALK.LIGHT_PROBE_MIPS_COUNT; f += 1) {
                n = f;
                n = Math.pow(2, WALK.log2(h.targetFiltered.width) - n);
                g.setScissor(0, 0, n, n);
                h.filterPass.uniforms.mipSize.value = n;
                h.filterPass.uniforms.gloss.value = WALK.LIGHT_PROBE_GLOSS_FOR_MIP[f];
                c || (v = g.createCubeTexture(n, !1),
                b.setFilteredTextureNoLod(v, f));
                p = h.filterPass;
                var w = h.targetCubeRaw
                  , x = h.targetFiltered
                  , y = h.pixelBuf
                  , z = c ? f : 0
                  , A = v;
                if (WALK.DEBUG_LIGHT_PROBE_MIPS)
                    for (var B = y, H = 255 * z / WALK.LIGHT_PROBE_MIPS_COUNT, C = 0; C < 4 * n * n; C += 4)
                        B[C] = H,
                        B[C + 1] = H,
                        B[C + 2] = H,
                        B[C + 3] = 31.875;
                for (B = 0; 6 > B; B += 1)
                    WALK.DEBUG_LIGHT_PROBE_MIPS || (p.uniforms.face.value = B,
                    p.render(g, x, w),
                    ei(g, n, y)),
                    g.copyBufferToCubeFaceMip(z, n, B, y, A)
            }
            g.enableScissorTest(!1);
            h.autoClearAlter.restore();
            WALK.log("Cube generation time " + l.elapsedSec())
        }
        var g, h = new ji(b,a), l = new WALK.Timer, m = new Nf(.15,a.camera.far);
        this.assignLightProbesToObjects = function() {
            l.reset();
            void 0 === g && (g = new Pf(b,a.gpuMeshes,a.camera.far));
            for (var c = 0; c < a.gpuMeshes.length; c += 1)
                a.gpuMeshes[c].lightProbe = null;
            for (c = 0; c < a.lightProbes.length; c += 1) {
                var d = a.lightProbes[c]
                  , e = g.findVisibleObjects(d.position);
                WALK.log("Have visible objects " + e.length);
                li(d, e)
            }
            WALK.log("Light probe assigment time " + l.elapsedSec());
            mi(a.lightProbes, WALK.filter(a.gpuMeshes, function(a) {
                return null === a.lightProbe
            }))
        }
        ;
        this.findBounds = function(a) {
            m.position.copy(a.position);
            m.updateMatrixWorld();
            h.autoClearAlter.set(!0, !0, !1);
            ii(h, m, a);
            h.autoClearAlter.restore()
        }
        ;
        this.createLightProbeTexture = function(b, c) {
            var d = new Set;
            gi(a, d);
            f(b, c);
            hi(a, d)
        }
        ;
        this.createAllLightProbeTextures = function() {
            var b = new Set;
            gi(a, b);
            for (var c = 0; c < a.lightProbes.length; c += 1)
                f(a.lightProbes[c], !1);
            hi(a, b)
        }
        ;
        this.dispose = function() {
            h.dispose();
            g && g.dispose()
        }
    }
    ;var oi;
    function pi(a) {
        if (a.empty())
            return 0;
        a.size(oi);
        return oi.x * oi.y * oi.z
    }
    function qi(a) {
        if (a.empty())
            return 0;
        a.size(oi);
        a = oi.x * oi.y;
        return 1 > oi.x || 1 > oi.y || 1.9 > oi.z || 1.5 > a ? 0 : a * oi.z
    }
    function ri(a) {
        var b = []
          , c = [];
        b.push(a);
        this.addFilledBox = function(a) {
            c.push(a)
        }
        ;
        this.findBestFilledBoxes = function() {
            function a(a) {
                return a[1]
            }
            function b(a) {
                a = a[0];
                a = a.max.x < m.min.x + .2 || a.min.x > m.max.x - .2 || a.max.y < m.min.y + .2 || a.min.y > m.max.y - .2 || a.max.z < m.min.z + .2 || a.min.z > m.max.z - .2 ? !1 : !0;
                return !a
            }
            var d = []
              , h = [];
            for (c.forEach(function(a) {
                h.push([a, pi(a)])
            }); 0 < h.length && 10 > d.length; ) {
                var l = WALK.indexOfMax(h, a);
                var m = h[l][0];
                d.push(m);
                h = h.filter(b)
            }
            return d
        }
        ;
        this.isEnclosedInFilledBox = function(a) {
            return WALK.any(c, function(b) {
                b = b.min.x - .1 <= a.min.x && a.max.x <= b.max.x + .1 && b.min.y - .1 <= a.min.y && a.max.y <= b.max.y + .1 && b.min.z - .1 <= a.min.z && a.max.z <= b.max.z + .1 ? !0 : !1;
                return b
            })
        }
        ;
        this.findLargestEmptyBox = function() {
            var a = WALK.indexOfMax(b, pi);
            return null !== a ? b[a] : null
        }
        ;
        var d = function() {
            var a = [];
            a[0] = new t.Box3;
            a[1] = new t.Box3;
            a[2] = new t.Box3;
            a[3] = new t.Box3;
            a[4] = new t.Box3;
            a[5] = new t.Box3;
            return function(b, c, e) {
                a[0].max.copy(b.max);
                a[0].min.copy(b.min);
                a[0].min.z = c.max.z;
                a[1].max.copy(b.max);
                a[1].max.z = c.min.z;
                a[1].min.copy(b.min);
                a[2].max.copy(b.max);
                a[2].min.copy(b.min);
                a[2].min.x = c.max.x;
                a[3].max.copy(b.max);
                a[3].max.x = c.min.x;
                a[3].min.copy(b.min);
                a[4].max.copy(b.max);
                a[4].min.copy(b.min);
                a[4].min.y = c.max.y;
                a[5].max.copy(b.max);
                a[5].max.y = c.min.y;
                a[5].min.copy(b.min);
                var f = WALK.indexOfMax(a, qi);
                0 !== qi(a[f]) && (e.push(a[f].clone()),
                0 === f ? b.max.z = c.max.z : 1 === f ? b.min.z = c.min.z : 2 === f ? b.max.x = c.max.x : 3 === f ? b.min.x = c.min.x : 4 === f ? b.max.y = c.max.y : 5 === f && (b.min.y = c.min.y),
                d(b, c, e))
            }
        }();
        this.split = function(a) {
            for (var c = [], e = 0; e < b.length; e += 1) {
                var h = b[e];
                h.isIntersectionBox(a) ? d(h, a, c) : c.push(h)
            }
            b = c
        }
    }
    function si(a, b, c) {
        function d(b) {
            var c = new WALK.LightProbe({
                id: a.lightProbes.length
            });
            b.center(c.position);
            c.position.z = b.min.z + 1.3;
            c.enableBoundingBox();
            c.boxMin.copy(b.min);
            c.boxMax.copy(b.max);
            a.lightProbes.push(c)
        }
        var e = new ri(a.boundingBox.clone())
          , f = new t.Box3
          , g = new t.Box3
          , h = new t.Vector3
          , l = new WALK.Timer;
        oi = new t.Vector3;
        for (var m = new WALK.LightProbe({
            id: 0
        }), n = 0; 200 > n; n += 1) {
            var p = e.findLargestEmptyBox();
            if (null === p)
                break;
            p.center(m.position);
            m.position.z = p.min.z + 1.3;
            m.enableBoundingBox();
            g.makeEmpty();
            for (var q = 0; 5 > q; q += 1) {
                b.findBounds(m);
                if (!m.isBoundingBoxInitialized())
                    break;
                f.set(m.boxMin, m.boxMax);
                var r = qi(f);
                if (0 === r)
                    break;
                if (e.isEnclosedInFilledBox(f))
                    break;
                f.center(h);
                h.z = f.min.z + 1.3;
                var u = m.position.distanceToSquared(h);
                pi(g) < r && .25 > u && g.set(f.min, f.max);
                if (.04 > u)
                    break;
                m.position.copy(h)
            }
            g.empty() ? (p.center(f.min),
            p.center(f.max),
            e.split(f)) : (e.addFilledBox(g.clone()),
            e.split(g))
        }
        WALK.log("Light probes arrangement time " + l.elapsedSec());
        b = e.findBestFilledBoxes();
        (b.reduce(function(a, b) {
            return a + pi(b)
        }, 0) > .2 * pi(a.boundingBox) || c) && b.forEach(d);
        0 === a.lightProbes.length && c && d(a.boundingBox)
    }
    ;function ti() {
        var a = this;
        WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/stats.min.js"), function() {
            var b = new Stats
              , c = new WALK.Perf;
            c.log = !0;
            b.showPanel(0);
            var d = b.addPanel(new Stats.Panel("MS95pc","#ff8","#221"));
            document.body.appendChild(b.dom);
            a.begin = function() {
                c.begin();
                b.begin()
            }
            ;
            a.end = function() {
                c.end();
                b.end();
                d.update(1E3 * c.percentile95, 1E3 * c.max)
            }
        });
        this.begin = this.end = function() {}
    }
    ;function ui(a, b) {
        a = document.getElementsByClassName(a);
        for (var c = 0; c < a.length; c += 1)
            b(a[c])
    }
    function vi(a) {
        var b = [];
        ui(a, function(a) {
            b.push(a)
        });
        for (var c = 0; c < b.length; c += 1)
            b[c].classList.remove(a)
    }
    function wi(a, b) {
        a.style.display = b ? "" : "none"
    }
    function xi(a, b) {
        wi(Cc(a), b)
    }
    function yi(a, b) {
        ui(a, function(a) {
            wi(a, b)
        })
    }
    function zi(a) {
        wi(a, !0);
        a.style.opacity = 0;
        WALK.defer(function() {
            a.style.opacity = 1
        })
    }
    function Ai() {
        var a = document.getElementById("qr-code-canvas");
        a ? a.remove() : (a = document.createElement("canvas"),
        a.setAttribute("id", "qr-code-canvas"),
        document.body.appendChild(a),
        QRCode.toCanvas(a, window.location.toString()))
    }
    function Bi(a) {
        a.style.opacity = 0;
        var b = window.getComputedStyle(a).transitionDuration;
        if (b) {
            var c = parseFloat(b);
            -1 === b.indexOf("ms") && (c *= 1E3);
            setTimeout(function() {
                wi(a, !1);
                a.style.opacity = 1
            }, c)
        } else
            wi(a, !1),
            a.style.opacity = 1
    }
    function Ci(a, b, c, d, e) {
        function f(a) {
            if (a) {
                var b = null === D ? [] : D.visibleViews(), c;
                for (c = 0; c < b.length && b[c] !== a; c += 1)
                    ;
                a = Cc("view-list-items").children;
                if (c < a.length)
                    return a[c]
            }
            return null
        }
        function g(a) {
            return function() {
                a.classList.remove("active-view");
                a.classList.remove("next-active-view")
            }
        }
        function h() {
            for (var a = Cc("view-list-items").children, b = 0; b < a.length; b += 1)
                a[b].classList.remove("active-view"),
                a[b].classList.remove("next-active-view")
        }
        function l() {
            Cc("tour-button").classList.add("tour-on")
        }
        function m() {
            Cc("tour-button").classList.remove("tour-on");
            h()
        }
        function n() {
            S.isRunning() ? S.stop() : S.start()
        }
        function p() {
            return S.isRunning() ? (S.stop(),
            !0) : !1
        }
        function q(a) {
            h();
            (a = f(a.view)) && a.classList.add("next-active-view")
        }
        function r(a) {
            if (a = f(a.view))
                a.classList.remove("next-active-view"),
                a.classList.add("active-view"),
                setTimeout(g(a), WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)
        }
        function u(a) {
            return Jc(function() {
                var b = p();
                E.switchToView(a, b ? 0 : void 0)
            })
        }
        function v() {
            var a = Cc("info-bar")
              , b = Cc("info-bar-slide")
              , c = Cc("view-list")
              , d = Cc("view-list-slide")
              , e = Cc("menu-bar")
              , f = Cc("menu-bar-slide")
              , h = Cc("menu-bar-folder");
            wi(h, D && !ia);
            if (K.visible) {
                a.style.pointerEvents = null;
                b.style.left = 0;
                c.style.pointerEvents = null;
                d.style.top = 0;
                e.style.pointerEvents = null;
                f.style.right = 0;
                h.style.pointerEvents = null;
                h.children[0].style.transform = "";
                if (null !== K.cover) {
                    e = K.cover.title;
                    d = K.cover.author;
                    f = K.cover.authorHref;
                    c = K.cover.engineLogoOn;
                    a = K.cover.engineLogoText;
                    b = K.cover.engineLogoUrl;
                    h = K.cover.authorLogoUrl;
                    K.cover.authorLogo && (h = WALK.getExtraAssetUrl(K.cover.authorLogo.path));
                    var l = Cc("author-logo")
                      , m = l.firstElementChild;
                    h ? (f && (l.href = f),
                    m.src = h) : (wi(l, !1),
                    m.removeAttribute("src"));
                    h = null === D || null !== W;
                    xi("info-text", h && (e || d));
                    h && (WALK.setTextContent(Cc("info-title"), e),
                    WALK.setTextContent(Cc("info-author"), d),
                    f && (Cc("info-author").href = f));
                    e = e ? e : "3D scene";
                    d && (e += " by " + d);
                    document.title = e;
                    d = Cc("engine-logo");
                    wi(d, c);
                    c && (a && (c = Cc("engine-logo-text"),
                    wi(c, !0),
                    WALK.setTextContent(c, a)),
                    b && (d.href = b))
                }
                a = null === D ? [] : D.visibleViews();
                b = Cc("view-list-items");
                xi("view-list", 0 < a.length && !ia);
                if (0 < a.length) {
                    c = b.children[0];
                    for (g(c)(); 1 !== b.children.length; )
                        b.removeChild(b.children[b.children.length - 1]);
                    for (d = 0; d < a.length; d += 1)
                        e = a[d],
                        e.hideFromMenu || (WALK.setTextContent(c, e.name),
                        c.onclick = u(e),
                        b.appendChild(c),
                        c = c.cloneNode(!0))
                }
                xi("menu-buttons", D && !ia);
                D && D.canStartAutoTour() && !Y ? xi("tour-button", !0) : (S && S.isRunning() && S.stop(),
                xi("tour-button", !1))
            } else
                l = Cc("menu-bar-content"),
                a.style.pointerEvents = "none",
                b.style.left = -b.offsetWidth + "px",
                c.style.pointerEvents = "none",
                d.style.top = -d.offsetHeight + "px",
                e.style.pointerEvents = "none",
                h.style.pointerEvents = "auto",
                f.style.right = -l.offsetWidth + "px",
                h.children[0].style.transform = "rotate(180deg)";
            a = K.helpVisible;
            WALK.DETECTOR.mobile ? xi("mobile-help", a) : (xi("desktop-help", a),
            a && (a = Cc("desktop-help-switch"),
            b = Cc("desktop-help-content"),
            c = ba ? 1 : 0,
            a.children[c].classList.add("selected"),
            wi(b.children[c], !0),
            a.children[1 - c].classList.remove("selected"),
            wi(b.children[1 - c], !1)))
        }
        function w() {
            K.visible = !N
        }
        function x() {
            K.helpVisible = !U
        }
        function y() {
            ba = !1;
            v()
        }
        function z() {
            ba = !0;
            v()
        }
        function A() {
            var a = p();
            E.switchToPreviousVisibleView(a ? 0 : void 0)
        }
        function B() {
            var a = p();
            E.switchToNextVisibleView(a ? 0 : void 0)
        }
        function H() {
            var a = Cc("interaction-prompt");
            a && (ka = !0,
            zi(a))
        }
        function C() {
            ka && (ka = !1,
            Bi(Cc("interaction-prompt")))
        }
        function L(a) {
            C();
            if (!(a.ctrlKey || a.altKey || a.metaKey)) {
                var b = a.target || a.srcElement;
                b = b.nodeType === Node.ELEMENT_NODE ? b.nodeName.toUpperCase() : "";
                if (!/INPUT|SELECT|TEXTAREA/.test(b))
                    if (67 === a.keyCode && WALK.DEBUG)
                        a.shiftKey ? WALK.DETECTOR.gl.extension("WEBGL_lose_context").restoreContext() : WALK.DETECTOR.gl.extension("WEBGL_lose_context").loseContext();
                    else if (null !== D) {
                        switch (a.keyCode) {
                        case 27:
                            p();
                            break;
                        case 70:
                            da && d();
                            break;
                        case 76:
                            ha && e();
                            break;
                        case 72:
                            x();
                            break;
                        case 77:
                            w();
                            break;
                        case 86:
                            R && c();
                            break;
                        case 80:
                            WALK.NO_SCREENSHOTS || (a.shiftKey ? Z.monoScreenToLocalImage(!0, 4E3, 2E3) : Z.monoScreenToLocalImage(!1, window.innerWidth, window.innerHeight));
                            break;
                        case 85:
                            WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/qrcode.js"), Ai);
                            break;
                        case 219:
                            A();
                            break;
                        case 221:
                            B()
                        }
                        b = a.keyCode - 48;
                        if (1 <= b && 9 >= b) {
                            --b;
                            var f = null === D ? [] : D.visibleViews();
                            b = f.length > b ? f[b] : null;
                            null !== b && u(b)(a)
                        }
                    }
            }
        }
        function G() {
            C()
        }
        function I() {
            C()
        }
        function M() {
            C()
        }
        function O(a) {
            C();
            switch (a.action) {
            case WALK.GAMEPAD_ACTION.PREVIOUS:
                A();
                break;
            case WALK.GAMEPAD_ACTION.NEXT:
                B()
            }
        }
        var K = this
          , F = {
            type: "visibilityChanged"
        }
          , D = null
          , E = null
          , S = null
          , Z = null
          , R = !1
          , da = !1
          , ha = !1
          , ia = !1
          , Y = !1
          , N = !0
          , U = !1
          , ba = !1
          , W = null
          , ka = !1;
        this.cover = null;
        Object.defineProperty(this, "visible", {
            get: function() {
                var a = Y && WALK.DETECTOR.mobile;
                return N && !a
            },
            set: function(a) {
                var b = this.visible;
                N = a;
                b !== this.visible && this.dispatchEvent(F);
                v()
            }
        });
        Object.defineProperty(this, "helpVisible", {
            get: function() {
                var a = Y && WALK.DETECTOR.mobile;
                return U && !a && !ia
            },
            set: function(a) {
                U = a;
                v()
            }
        });
        this.updateCover = function(a) {
            this.cover = a;
            null !== W && clearTimeout(W);
            W = setTimeout(function() {
                W = null;
                v()
            }, 5E3);
            v()
        }
        ;
        this.refresh = function() {
            v()
        }
        ;
        this.onFullScreenChange = function() {}
        ;
        this.onPointerLockChange = function(a) {
            ia = a;
            v()
        }
        ;
        this.onVrChange = function(a) {
            var b = this.visible;
            Y = a;
            b !== this.visible && this.dispatchEvent(F);
            v()
        }
        ;
        this.onResize = function() {
            if (!this.visible) {
                var a = Cc("info-bar-slide")
                  , b = Cc("menu-bar-slide")
                  , c = Cc("view-list-slide");
                a.style.transition = "none";
                b.style.transition = "none";
                c.style.transition = "none";
                v();
                a.style.transition = "";
                b.style.transition = "";
                c.style.transition = ""
            }
        }
        ;
        this.enablePlayButton = function(a) {
            var b = Cc("play-button");
            b.addEventListener("click", a);
            wi(b, !0)
        }
        ;
        this.setVrSupported = function(a) {
            R = a;
            yi("vr-specific", a)
        }
        ;
        this.setFullScreenSupported = function() {
            (da = !a) && yi("fullscreen-specific", !0)
        }
        ;
        this.setPointerLockSupported = function() {
            ha = !a
        }
        ;
        this.addExtraButton = function(a) {
            var b = Cc("tour-button")
              , c = document.createElement("img");
            c.src = a;
            a = document.createElement("div");
            a.className = "menu-button menu-item ui-hoverable ui-panel";
            a.appendChild(c);
            b.parentNode.insertBefore(a, b);
            return a
        }
        ;
        this.removeExtraButton = function(a) {
            a.remove()
        }
        ;
        this.getExtraButonIcon = function(a) {
            return a.firstElementChild
        }
        ;
        this.sceneLoadStarted = function() {
            xi("play-button", !1);
            xi("primary-progress", !0)
        }
        ;
        this.loadProgress = function(a) {
            a = a.totalDone() / a.total;
            if (null === D) {
                var b = Math.max(314.159 * (1 - a), 0);
                Cc("primary-progress-done").style.strokeDashoffset = b
            }
            a = Math.floor(100 * a);
            Cc("secondary-progress-done").style.width = a + "%"
        }
        ;
        this.sceneReadyToDisplay = function(a, b, c, d) {
            D = a;
            E = b;
            E.addEventListener("teleportStarted", q);
            E.addEventListener("teleportDone", r);
            S = c;
            S.addEventListener("tourStarted", l);
            S.addEventListener("tourStopped", m);
            Z = d;
            Bi(Cc("cover-image"));
            Bi(Cc("primary-progress"));
            zi(Cc("secondary-progress"));
            a = WALK.getViewer();
            !D.interactionPrompt || U || WALK.EDIT_MODE || (a._isMeeting() ? a._onMeetingJoined(function() {
                return H()
            }) : H());
            D.addEventListener("viewAdded", v);
            D.addEventListener("viewRemoved", v);
            D.addEventListener("viewShifted", v);
            document.body.style.backgroundImage = "none";
            document.body.style.backgroundColor = "#000";
            v()
        }
        ;
        this.sceneLoadComplete = function() {
            xi("secondary-progress", !1)
        }
        ;
        this.init = function() {
            a && (yi("viewer-specific", !1),
            yi("editor-specific", !0));
            ui("ui-panel", function(a) {
                Mc(a)
            });
            WALK.DETECTOR.mobile && vi("ui-hoverable");
            var e = Cc("author-logo")
              , f = e.firstElementChild;
            f.onload = function() {
                wi(e, !0)
            }
            ;
            f.onerror = function() {
                wi(e, !1)
            }
            ;
            document.addEventListener("keydown", L, !1);
            document.addEventListener("mousedown", G, !1);
            document.addEventListener("wheel", I, !1);
            document.addEventListener("touchstart", M, !1);
            Lc("help-button", x);
            Lc("fullscreen-button", d);
            Lc("vr-button", c);
            Lc("tour-button", n);
            Lc("menu-bar-folder", w);
            Lc("view-list-folder", w);
            Lc("basic-desktop-help-option", y);
            Lc("advanced-desktop-help-option", z);
            Lc("close-desktop-help-button", x);
            Lc("close-mobile-help-button", x);
            b.addEventListener("actionActivated", O);
            v()
        }
        ;
        this.contextLost = function() {
            D = E = S = Z = null;
            v()
        }
    }
    t.EventDispatcher.prototype.apply(Ci.prototype);
    function Di(a, b) {
        return Math.abs(a.x - b.x) < Number.EPSILON && Math.abs(a.y - b.y) < Number.EPSILON && Math.abs(a.z - b.z) < Number.EPSILON
    }
    function Ei(a, b, c) {
        var d = Math.sin(b);
        b = Math.cos(b);
        a.set((a.x - c.x) * b - (a.y - c.y) * d + c.x, (a.x - c.x) * d + (a.y - c.y) * b + c.y, a.z)
    }
    function Fi(a) {
        var b = document.createElement("canvas");
        b.width = a;
        b.height = a;
        var c = 60 * Math.PI / 180
          , d = -c / 2 - Math.PI / 2;
        c = c / 2 - Math.PI / 2;
        var e = b.getContext("2d");
        e.beginPath();
        e.arc(a / 2, a / 2, 4, 0, 2 * Math.PI);
        e.fillStyle = "rgb(0, 220, 255)";
        e.fill();
        e.moveTo(a / 2, a / 2);
        e.arc(a / 2, a / 2, 12, d, c, !0);
        e.lineTo(a / 2, a / 2);
        e.arc(a / 2, a / 2, 90, d, c);
        e.lineTo(a / 2, a / 2);
        e.fillStyle = "rgba(0, 220, 255, 0.5)";
        e.fill();
        return b
    }
    function Gi(a, b) {
        var c = document.createElement("div")
          , d = Fi(200);
        c.style.width = "200px";
        c.style.height = "200px";
        c.style.position = "absolute";
        c.style.pointerEvents = "none";
        c.style.zIndex = "2";
        c.style.opacity = "1";
        c.style.transition = "opacity 0.5s";
        c.id = "minimap-camera";
        c.appendChild(d);
        this.update = function(d, f) {
            c.style.left = d.x / a * 100 + "%";
            c.style.top = d.y / b * 100 + "%";
            c.style.transform = "translate(-100px, -100px) rotate(" + f + "rad)"
        }
        ;
        this.show = function() {
            c.style.opacity = "1"
        }
        ;
        this.hide = function() {
            c.style.opacity = "0"
        }
        ;
        this.getContainer = function() {
            return c
        }
    }
    function Hi(a, b) {
        function c() {
            e = !0;
            var a = d.width
              , m = d.height;
            g !== a || h !== m ? (g = a,
            h = m,
            b(),
            window.requestAnimationFrame(c)) : 0 < f ? (--f,
            window.requestAnimationFrame(c)) : e = !1
        }
        if ("ResizeObserver"in window)
            (new ResizeObserver(b)).observe(a);
        else {
            var d = window.getComputedStyle(a), e, f, g, h;
            (new MutationObserver(function() {
                f = 60;
                e || c()
            }
            )).observe(a, {
                attributes: !0
            });
            window.addEventListener("resize", function() {
                f = 60;
                e || c()
            })
        }
    }
    function Ii(a, b, c, d) {
        function e() {
            l.style.transform = "translate(" + g.x + "," + g.y + ")"
        }
        function f() {
            l.style.width = m.width;
            l.style.height = m.height
        }
        var g = {
            x: 0,
            y: 0
        }
          , h = document.createElement("canvas");
        h.width = 3 * a;
        h.height = 3 * b;
        h.style.position = "absolute";
        h.style.maxWidth = "100%";
        h.style.maxHeight = "100%";
        var l = document.createElement("div");
        l.classList.add("minimap-content-controller");
        var m = window.getComputedStyle(h);
        d.appendChild(h);
        d.appendChild(l);
        Hi(c, f);
        this.add = function(a) {
            l.appendChild(a)
        }
        ;
        this.clear = function() {
            l.innerHTML = ""
        }
        ;
        this.updateOffset = function(c) {
            g.x = 50 - c.x / a * 100 + "%";
            g.y = 50 - c.y / b * 100 + "%";
            e()
        }
        ;
        this.addOffset = function() {
            e()
        }
        ;
        this.removeOffset = function() {
            l.style.transform = ""
        }
        ;
        this.updateRatio = function(c) {
            window.requestAnimationFrame(function() {
                var d = Math.abs(Math.sin(c.rotation))
                  , e = Math.abs(Math.cos(c.rotation));
                h.width = 3 * (a * c.ratio.x * e + b * c.ratio.y * d);
                h.height = 3 * (a * c.ratio.x * d + b * c.ratio.y * e);
                f()
            })
        }
    }
    function Ji(a, b, c, d) {
        function e() {
            F = b.minimapConfig.levels.map(function(a) {
                return {
                    level: a,
                    canvas: null,
                    tab: null
                }
            })
        }
        function f() {
            F.forEach(function(a) {
                a.tab = document.createElement("div");
                a.tab.classList.add("minimap-tab");
                a.tab.innerText = a.level.name;
                a.tab.addEventListener("click", function() {
                    C.selectLevel(a.level);
                    Dc()
                });
                ka.appendChild(a.tab)
            })
        }
        function g(a) {
            K = a;
            M.show();
            F.forEach(function(b) {
                b.level === a ? b.tab.classList.add("minimap-tab-current") : b.tab.classList.remove("minimap-tab-current")
            })
        }
        function h(a) {
            F.forEach(function(b) {
                b.canvas && (b.canvas.style.opacity = b.level === a ? "1" : "0",
                b.canvas.style.zIndex = b.level === a ? "1" : "0");
                b.level === a ? b.tab.classList.add("minimap-tab-active") : b.tab.classList.remove("minimap-tab-active")
            })
        }
        function l() {
            var a = F.find(function(a) {
                return a.level === K
            }) ? K : F[F.length - 1].level;
            C.selectLevel(a, !0)
        }
        function m(a) {
            var b = F.filter(function(b) {
                return b.level.slicePlaneHeight < a.slicePlaneHeight
            }).sort(function(a, b) {
                return b.level.slicePlaneHeight - a.level.slicePlaneHeight
            })[0]
              , c = F.filter(function(b) {
                return b.level.slicePlaneHeight > a.slicePlaneHeight
            }).sort(function(a, b) {
                return a.level.slicePlaneHeight - b.level.slicePlaneHeight
            })[0];
            E = b ? a.slicePlaneHeight - (a.slicePlaneHeight - b.level.slicePlaneHeight) / 2 : -Infinity;
            S = c ? a.slicePlaneHeight - (a.slicePlaneHeight - c.level.slicePlaneHeight) / 2 : Infinity
        }
        function n(a) {
            return F.reduce(function(b, c) {
                return Math.abs(c.level.slicePlaneHeight - a.z) < Math.abs(b.level.slicePlaneHeight - a.z) ? c : b
            }).level
        }
        function p(a, b) {
            K && (a || b || (a = d.getCameraPosition(),
            b = d.getCameraRotation()),
            ya.set(a.x, a.y),
            Ei(ya, K.rotation, K.cropRange.center()),
            V.set(t.Math.mapLinear(ya.x, K.visibleRange.max.x, K.visibleRange.min.x, Ga.max, Ga.min), t.Math.mapLinear(ya.y, K.visibleRange.max.y, K.visibleRange.min.y, Ha.max, Ha.min)),
            M.update(V, -1 * b.z + -1 * K.rotation),
            I && O.updateOffset(V))
        }
        function q() {
            I = !0;
            U.classList.add("minimap-container-minimized");
            ba.classList.add("minimap-wrapper-minimized");
            O.addOffset();
            p()
        }
        function r() {
            I = !1;
            U.classList.remove("minimap-container-minimized");
            ba.classList.remove("minimap-wrapper-minimized");
            O.removeOffset()
        }
        function u() {
            L = !0;
            ba.style.transform = "translate(-101%, 0)"
        }
        function v() {
            d.menuVisible ? I && (640 > window.innerWidth || 640 > window.innerHeight) ? (r(),
            L = !1,
            ba.style.transform = "") : L ? (L = !1,
            ba.style.transform = "") : u() : u()
        }
        function w() {
            L && d.menuVisible && (640 > window.innerWidth || 640 > window.innerHeight) || v()
        }
        function x(a, b, d) {
            var e = new t.Vector3;
            b.addEventListener("click", function(f) {
                var h = b.getBoundingClientRect()
                  , l = (f.clientX - h.left) / h.width;
                f = (f.clientY - h.top) / h.height;
                0 !== a.data[4 * (Math.round(l * R) + Math.round(f * da) * R) + 3] && (e.set(t.Math.mapLinear(l, 0, 1, d.visibleRange.min.x, d.visibleRange.max.x), t.Math.mapLinear(f, 0, 1, d.visibleRange.min.y, d.visibleRange.max.y), d.slicePlaneHeight),
                Ei(e, -1 * d.rotation, d.cropRange.center()),
                l = new WALK.View({
                    position: [e.x, e.y, e.z]
                }),
                c.switchToView(l),
                d !== K && g(d));
                Dc()
            })
        }
        function y() {
            O.add(M.getContainer());
            N.style.display = "";
            U.style.display = "";
            1 < F.length && (ka.style.display = "",
            ba.classList.add("minimap-wrapper-tabs"))
        }
        function z() {
            O.clear();
            ka.innerHTML = "";
            ka.style.display = "none";
            U.style.display = "none";
            N.style.display = "none";
            ba.classList.remove("minimap-wrapper-tabs")
        }
        function A(c) {
            var d = document.createElement("canvas");
            d.width = R;
            d.height = da;
            d.style.transition = "opacity 0.5s";
            var e = a.createMinimapImageDataComponents(b.minimapConfig, c, R, da)
              , f = e.minimapImageData;
            e = e.walkableImageData;
            d.getContext("2d").putImageData(f, 0, 0);
            x(e, d, c);
            O.add(d);
            return d
        }
        function B() {
            if (!(ha && ia && Y && N && U && ba && W))
                return !0
        }
        function H() {
            B() || (O = new Ii(R,da,ba,W),
            M = new Gi(R,da),
            640 > window.innerWidth || 640 > window.innerHeight ? u() : q(),
            Kc(ha, q),
            Kc(ia, r),
            Kc(Y, u),
            Kc(N, v),
            d.onMenuVisibilityChanged(w),
            G = !0,
            e(),
            f(),
            l(),
            y())
        }
        var C = this
          , L = !1
          , G = !1
          , I = !1
          , M = null
          , O = null
          , K = null
          , F = []
          , D = !1
          , E = -Infinity
          , S = Infinity;
        d.onViewSwitchStarted(function() {
            return D = !0
        });
        d.onViewSwitchDone(function() {
            return D = !1
        });
        var Z = a.calculateRenderSize(700, b.boundingBox)
          , R = Z.width
          , da = Z.height
          , ha = document.getElementById("minimap-button-minimize")
          , ia = document.getElementById("minimap-button-maximize")
          , Y = document.getElementById("minimap-button-close")
          , N = document.getElementById("minimap-button-toggle")
          , U = document.getElementById("minimap-container")
          , ba = document.getElementById("minimap-wrapper")
          , W = document.getElementById("minimap-content")
          , ka = document.getElementById("minimap-tabs")
          , ca = new t.Vector3(0,0,0)
          , la = new t.Vector3(0,0,0)
          , ya = new t.Vector2
          , V = new t.Vector2
          , Ga = {
            min: 0,
            max: R
        }
          , Ha = {
            min: 0,
            max: da
        }
          , Qa = {
            type: "minimapLevelSelected",
            target: this,
            level: null
        };
        t.EventDispatcher.prototype.apply(Ji.prototype);
        this.selectLevel = function(a, b) {
            b = void 0 === b ? !1 : b;
            var c = F.filter(function(b) {
                return b.level === a
            })[0];
            b && g(a);
            c.canvas || (c.canvas = A(a));
            a === K ? M.show() : M.hide();
            h(a);
            m(a);
            p();
            O.updateRatio(a);
            Qa.level = a;
            this.dispatchEvent(Qa)
        }
        ;
        this.update = function() {
            if (!B()) {
                var a = d.getCameraPosition()
                  , b = d.getCameraRotation();
                if (!1 === Di(ca, a) || !1 === Di(la, b)) {
                    p(a, b);
                    if (!D && (a.z > S || a.z < E)) {
                        var c = n(a);
                        m(c);
                        C.selectLevel(c, !0)
                    }
                    ca.set(a.x, a.y, a.z);
                    la.set(b.x, b.y, b.z)
                }
            }
        }
        ;
        b.minimapConfig.enabled && H();
        b.minimapConfig.addEventListener("updated", function() {
            G ? b.minimapConfig.enabled ? (z(),
            e(),
            f(),
            l(),
            y()) : z() : H()
        });
        d._onMeetingJoined(u)
    }
    ;WALK.Timer = function() {
        this.clock = performance || Date;
        this.reset()
    }
    ;
    WALK.Timer.prototype = {
        constructor: WALK.Timer,
        reset: function() {
            this.startMS = this.clock.now()
        },
        elapsedMSec: function() {
            return this.clock.now() - this.startMS
        },
        elapsedSec: function() {
            return .001 * this.elapsedMSec()
        }
    };
    WALK.Timeout = function(a, b) {
        var c = null;
        this.start = function() {
            null !== c && clearTimeout(c);
            c = setTimeout(function() {
                c = null;
                b && b()
            }, a)
        }
        ;
        this.isRunning = function() {
            return null !== c
        }
    }
    ;
    WALK.Perf = function() {
        var a = new WALK.Timer
          , b = [];
        this.percentile95 = this.median = this.max = this.last = 0;
        this.log = !1;
        this.begin = function() {
            a.reset()
        }
        ;
        this.end = function() {
            this.last = a.elapsedSec();
            this.last > this.max && (this.max = this.last);
            b.push(this.last);
            if (0 === b.length % 100) {
                var c = Array.from(b);
                c.sort();
                this.median = c[Math.floor(.5 * c.length)];
                this.percentile95 = c[Math.floor(.95 * c.length)];
                this.log && console.log("Median " + this.median + " 95 " + this.percentile95);
                3600 < b.length && b.splice(0, 100)
            }
        }
    }
    ;
    WALK.DeferringExecutorOnce = function(a, b) {
        function c() {
            d = null;
            a()
        }
        var d = null;
        this.deferRun = function() {
            null !== d && clearTimeout(d);
            d = setTimeout(c, b)
        }
    }
    ;
    WALK.DeferringExecutorInterval = function(a, b) {
        function c() {
            a()
        }
        var d = null;
        this.deferRun = function() {
            null !== d && clearInterval(d);
            d = setInterval(c, b)
        }
    }
    ;
    WALK.AnimationController = function(a, b, c) {
        function d() {
            m || (l || h.getDelta(),
            m = !0,
            a.vrEnabled() ? a.requestAnimationFrame(e) : requestAnimationFrame(f))
        }
        function e() {
            r(a.vrEnabled())
        }
        function f() {
            r(!1)
        }
        var g = this
          , h = new t.Clock
          , l = !1
          , m = !1
          , n = !1
          , p = 0
          , q = !1;
        var r = function(a) {
            q && (m = !1,
            n ? (console.assert(!a),
            c(h.getDelta(), p) ? (p += 1,
            d()) : n = !1) : (l = !0,
            b(h.getDelta(), a),
            WALK.ALWAYS_RENDER && g.requestFrame(),
            l = !1,
            m || (n = !0,
            p = 0,
            d())))
        };
        this.requestFrame = function() {
            q && (n = !1,
            d())
        }
        ;
        this.disable = function() {
            q = !1
        }
        ;
        this.enable = function() {
            q = !0;
            m = !1;
            this.requestFrame()
        }
        ;
        this.isEnabled = function() {
            return q
        }
    }
    ;
    function Ki(a, b, c) {
        function d(a) {
            m = a;
            g = a - e.exposure;
            l = Math.sign(g);
            g = Math.abs(g);
            h = g / 1
        }
        var e = a.camera, f = !1, g = 0, h, l, m, n = new WALK.Timer;
        this.adaptExposure = function() {
            if (f && e.autoExposure) {
                n.reset();
                var a = c.measureReflectedLuma();
                0 > a ? g = 0 : (d(Math.log2(e.autoExposureDarkness / a)),
                .3 > g && (g = 0))
            }
        }
        ;
        this.exposureNeedsUpdate = function() {
            return 0 < g
        }
        ;
        var p = new t.Vector3(Infinity,Infinity,Infinity)
          , q = function() {
            return function() {
                if (!f || !e.autoExposure) {
                    for (var b = a.cameraVolumes.length - 1; 0 <= b; --b) {
                        var c = a.cameraVolumes[b];
                        if (c.worldCoordinatesInside(p)) {
                            d(c.exposure);
                            e.setGamma(c.gamma);
                            return
                        }
                    }
                    d(e.defaultExposure);
                    e.setGamma(e.defaultGamma)
                }
            }
        }();
        a.addEventListener("cameraVolumeAdded", function(a) {
            a.cameraVolume.addEventListener("updated", q);
            q()
        });
        a.addEventListener("cameraVolumeShifted", q);
        a.addEventListener("cameraVolumeRemoved", function(a) {
            a.cameraVolume.removeEventListener("cameraVolumeUpdated", q);
            q()
        });
        e.addEventListener("updated", q);
        this.update = function(a) {
            var c = b.cameraWorldPosition();
            p.equals(c) || (p.copy(c),
            q());
            this.exposureNeedsUpdate() && (a = Math.min(h * a, g),
            g -= a,
            1E-5 > g ? (g = 0,
            e.exposure = m) : e.exposure += a * l)
        }
        ;
        this.updateWithoutDelay = function() {
            this.update(1)
        }
        ;
        this.enableAutoExposure = function() {
            f = !0;
            g = 0
        }
        ;
        this.disableAutoExposure = function() {
            f = !1;
            q()
        }
    }
    ;function Li(a, b) {
        for (var c = 0, d = 0, e = 0; 65536 > e; ++e) {
            var f = 4 * e;
            f = a[f] + 255 * a[f + 1];
            0 !== f && (d += 1,
            b[f] += 1,
            c = Math.max(c, f))
        }
        if (256 > d)
            return -1;
        e = a = 0;
        for (f = 1; f <= c; ++f)
            if (b[f] + a < .3 * d)
                a += b[f],
                b[f] = 0;
            else
                break;
        for (f = c; 0 <= f; --f)
            if (b[f] + e < .1 * d)
                e += b[f],
                b[f] = 0;
            else
                break;
        f = 0;
        for (var g = 1; g <= c; ++g)
            f += b[g] * Math.log(g / 255),
            b[g] = 0;
        return Math.exp(f / (d - a - e))
    }
    function Mi(a, b) {
        function c(c) {
            e || (console.assert(!e),
            e = a.createRenderTarget(256, 256, {
                minFilter: GLC.NEAREST,
                magFilter: GLC.NEAREST,
                format: GLC.RGBA,
                stencilBuffer: !1,
                generateMipmaps: !1
            }),
            f = new xc(a),
            g = new Uint8Array(262144),
            h = new Uint32Array(65280),
            l = new WALK.LumaMaterial(!0),
            m = new WALK.LumaMaterial(!1));
            c = c ? l : m;
            f.set(!0, !0, !1);
            var n = b.gpuMeshes.filter(function(a) {
                return !a.material.transparent
            });
            a.renderMeshes(n, c, d, e);
            a.readPixels(256, 256, g);
            a.setRenderTarget(null);
            f.restore();
            return Li(g, h)
        }
        var d = b.camera, e, f, g, h, l, m;
        this.measureIncidentLuma = function() {
            return c(!0)
        }
        ;
        this.measureReflectedLuma = function() {
            return c(!1)
        }
    }
    ;function Ni(a, b, c, d, e) {
        return a.createRenderTarget(b, c, {
            format: GLC.RGBA,
            magFilter: d,
            minFilter: d,
            depthBuffer: e,
            stencilBuffer: !1,
            generateMipmaps: !1
        })
    }
    function Oi(a, b, c) {
        var d = []
          , e = []
          , f = [{
            totalFovFraction: .25,
            count: 2
        }, {
            totalFovFraction: .25,
            count: 16
        }, {
            totalFovFraction: .375,
            count: 48
        }, {
            totalFovFraction: .125,
            count: 8
        }];
        (function() {
            for (var g = 0, h = 0, l = 0, m = 0; m < f.length; m++) {
                var n = f[m]
                  , p = n.totalFovFraction * a / n.count;
                console.assert(p === Math.floor(p), "Height (" + p + ")must be an integer");
                var q = n.totalFovFraction * Math.PI / 2 / n.count
                  , r = Ni(c, 4 * b, 4 * p, GLC.LINEAR, !0);
                e.push(r);
                for (var u = 0; u < n.count; u++)
                    d.push({
                        fov: q,
                        fovOffset: g + (u + .5) * q,
                        height: p,
                        yOffset: h + u * p,
                        renderTarget: r
                    });
                g += n.count * q;
                h += n.count * p;
                l += n.totalFovFraction
            }
            console.assert(1 === l, "Invalid fractions sum");
            console.assert(g === Math.PI / 2, "Invalid fov definition for rectangles");
            console.assert(h === a, "Invalid rectangles height")
        }
        )();
        this.getRectangleHeight = function(a) {
            return d[a].height
        }
        ;
        this.getRectangleOffset = function(a) {
            return d[a].yOffset
        }
        ;
        this.getRectangleFov = function(a) {
            return d[a].fov
        }
        ;
        this.getRectangleFovOffset = function(a) {
            return d[a].fovOffset
        }
        ;
        this.getRectangleRenderTarget = function(a) {
            return d[a].renderTarget
        }
        ;
        this.dispose = function() {
            e.forEach(function(a) {
                a.dispose()
            });
            d.length = 0;
            e.length = 0
        }
        ;
        this.getRectangleCount = function() {
            return d.length
        }
    }
    function Pi(a, b, c) {
        function d() {
            var a = (document.body.offsetWidth - document.body.offsetHeight * l) / 2
              , b = a + "px";
            a = Math.max(a, 0) + "px";
            m.style.width = a;
            n.style.width = a;
            p.style.left = b;
            p.style.right = b
        }
        function e(c, d, e, f, g, h) {
            function l(c, d) {
                for (var g = ka[c].hemisphere, r = ka[c].eyeOffset, q = ka[c].parallaxOffset, w = ka[c].targetYOffset, v = 0; v < ha; v++) {
                    p(g, d, v, r);
                    var y = da.getRectangleRenderTarget(v);
                    a.render(b.threeScene, R, y);
                    var B = da.getRectangleHeight(v)
                      , z = da.getRectangleOffset(v);
                    ba.y = g === E ? w + M + z : w + M - z - B;
                    ba.x = (d * x + q + e) % e;
                    ba.height = B;
                    W.render(a, ba, y)
                }
                h() ? n(null) : (g = k.makeIterator(m(c, d)),
                c = g.next().value,
                d = g.next().value,
                -1 === c ? (g = new Uint8Array(2 * e * u * 4),
                a.readPixels(e, 2 * u, g),
                n(g)) : (0 === d % la && f({
                    done: 512 * c + d,
                    total: ca
                }),
                setTimeout(function() {
                    return l(c, d)
                }, 0)))
            }
            function m(a, b) {
                b++;
                if (512 === b) {
                    a++;
                    if (a === ka.length)
                        return [-1, -1];
                    b = 0
                }
                return [a, b]
            }
            function n(a) {
                ba.dispose();
                da.dispose();
                W.dispose();
                g(a)
            }
            function p(a, b, d, e) {
                b = -(b * v - S);
                a = a === E ? -da.getRectangleFovOffset(d) : da.getRectangleFovOffset(d);
                ia.set(e, 0, 0).applyMatrix4(U.makeRotationZ(b));
                R.position.copy(c).add(ia);
                Y.copy(w).applyMatrix4(U.makeRotationX(a)).applyMatrix4(U.makeRotationZ(b));
                N.copy(R.position).add(Y);
                R.lookAt(N);
                d = r * Math.tan(da.getRectangleFov(d) / 2);
                e = Z * Math.cos(a);
                R.projectionMatrix.makeFrustum(-e, e, -d, d, r, q);
                R.updateMatrix();
                R.updateMatrixWorld()
            }
            var r = b.camera.near
              , q = b.camera.far;
            console.assert(0 === e % 512, "Invalid width for stereo panorama");
            var u = e / 2
              , w = new t.Vector3(0,-1,0)
              , M = u / 2
              , v = 2 * Math.PI / 512
              , x = e / 512
              , y = -x;
            k.initSymbol();
            k.initSymbol();
            var D = Symbol("Bottom")
              , E = Symbol("Top")
              , S = Math.floor(d / v) * v
              , Z = r * Math.tan(v / 2)
              , R = new t.PerspectiveCamera;
            R.up.set(0, 0, 1);
            var da = new Oi(M,x,a)
              , ha = da.getRectangleCount()
              , ia = new t.Vector3
              , Y = new t.Vector3
              , N = new t.Vector3
              , U = new t.Matrix4
              , ba = Ni(a, e, 2 * u, GLC.NEAREST, !1);
            ba.width = x;
            var W = new Nd
              , ka = [{
                hemisphere: E,
                eyeOffset: .03,
                parallaxOffset: y,
                targetYOffset: u
            }, {
                hemisphere: D,
                eyeOffset: .03,
                parallaxOffset: y,
                targetYOffset: u
            }, {
                hemisphere: E,
                eyeOffset: -.03,
                parallaxOffset: x,
                targetYOffset: 0
            }, {
                hemisphere: D,
                eyeOffset: -.03,
                parallaxOffset: x,
                targetYOffset: 0
            }]
              , ca = 512 * ka.length
              , la = Math.ceil(ca / 100);
            l(0, 0)
        }
        function f(c, d, e, f) {
            var g = new Nf(b.camera.near,b.camera.far);
            g.rotateZ(d);
            g.position.copy(c);
            g.updateMatrixWorld();
            c = a.createRenderTargetCube(4096, 4096, {
                format: GLC.RGBA,
                magFilter: GLC.LINEAR,
                minFilter: GLC.LINEAR,
                stencilBuffer: !1,
                generateMipmaps: !1
            });
            for (d = 0; 6 > d; d += 1)
                c.activeCubeFace = d,
                a.render(b.threeScene, g.sideCameras[d], c);
            g = Ni(a, e, f, GLC.NEAREST, !0);
            d = {
                uniforms: {
                    panoramaCube: {
                        type: "t",
                        value: null
                    }
                },
                vertexShader: WALK.getShader("cube_to_equirect_vertex.glsl"),
                fragmentShader: WALK.getShader("cube_to_equirect_fragment.glsl")
            };
            d = new t.ShaderPass(d,"panoramaCube");
            d.render(a, g, c);
            d.dispose();
            c.dispose();
            c = new Uint8Array(e * f * 4);
            a.readPixels(e, f, c);
            g.dispose();
            return c
        }
        function g(c, d) {
            var e = Ni(a, c, d, GLC.NEAREST, !0);
            c = Ni(a, c, d, GLC.NEAREST, !1);
            d = new Rd(a,b);
            d.setTargets(e, c);
            d.renderAllSamples();
            var f = d.copyAccumulatedSamplesToBuffer();
            e.dispose();
            c.dispose();
            d.dispose();
            return f
        }
        function h(a, b) {
            var c = Math.min(WALK.MAX_PANORAMA_SIZE, WALK.DETECTOR.gl.maxRenderBufferSize);
            if (a <= c && b <= c)
                return [a, b];
            var d = a / b;
            return a > b ? [c, Math.floor(c / d)] : [Math.floor(c * d), c]
        }
        var l = null
          , m = null
          , n = null
          , p = null
          , q = new t.Vector3;
        this.markArea = function(a) {
            function b(a, b) {
                a.style.zIndex = 1;
                a.style.pointerEvents = "none";
                a.style.position = "absolute";
                a.style.top = 0;
                a.style.bottom = 0;
                a.style[b] = 0;
                a.style.backgroundColor = "rgba(0, 0, 0, 0.5)"
            }
            function c(a) {
                a.style.zIndex = 1;
                a.style.pointerEvents = "none";
                a.style.position = "absolute";
                a.style.boxSizing = "border-box";
                a.style.top = 0;
                a.style.bottom = 0;
                a.style.border = "4px solid rgba(35, 181, 233, 0.5)"
            }
            p || (m = document.createElement("div"),
            b(m, "left"),
            n = document.createElement("div"),
            b(n, "right"),
            p = document.createElement("div"),
            c(p),
            document.body.appendChild(m),
            document.body.appendChild(n),
            document.body.appendChild(p),
            window.addEventListener("resize", d));
            l = a;
            d()
        }
        ;
        this.unmarkArea = function() {
            p && (m.remove(),
            n.remove(),
            p.remove(),
            window.removeEventListener("resize", d),
            p = n = m = l = null)
        }
        ;
        this.monoScreenToBuffer = function(a, b, d) {
            return a ? f(c.cameraWorldPosition(), c.getYawAngle(), b, d) : g(b, d)
        }
        ;
        this.stereoPanoramaToBuffer = function(a, b, d, f) {
            e(c.cameraWorldPosition(), c.getYawAngle(), a, b, d, f)
        }
        ;
        this.monoScreenToDataUrl = function(a, b, c) {
            a = this.monoScreenToBuffer(a, b, c);
            for (var d = 0; d < c; ++d)
                for (var e = 0; e < b; ++e) {
                    var f = 4 * (d * b + e);
                    if (d < c / 2)
                        for (var g = 4 * ((c - d - 1) * b + e), h = 0; 3 > h; ++h) {
                            var l = a[f + h];
                            a[f + h] = a[g + h];
                            a[g + h] = l
                        }
                    a[f + 3] = 255
                }
            a = new Uint8ClampedArray(a);
            a = new ImageData(a,b,c);
            d = document.createElement("canvas");
            d.width = b;
            d.height = c;
            d.getContext("2d").putImageData(a, 0, 0);
            return d.toDataURL("image/jpeg")
        }
        ;
        this.monoScreenToLocalImage = function(a, b, c) {
            a = this.monoScreenToDataUrl(a, b, c);
            navigator.msSaveOrOpenBlob ? fetch(a).then(function(a) {
                return a.blob()
            }).then(function(a) {
                return navigator.msSaveOrOpenBlob(a, "screen.jpg")
            }) : (b = document.createElement("a"),
            document.body.appendChild(b),
            b.style.cssText = "display: none",
            b.href = a,
            b.download = "screenshot",
            b.click(),
            window.URL.revokeObjectURL(a),
            b.parentNode.removeChild(b))
        }
        ;
        this.coverToServer = function(a, b) {
            var c = g(a, b);
            WALK.ajaxPost("screenshot?width=" + a + "&height=" + b, "application/binary", c)
        }
        ;
        this.monoPanoramaToServer = function(a, b) {
            a.position ? q.fromArray(a.position) : q.copy(c.cameraWorldPosition());
            var d = void 0 !== a.width ? a.width : 8E3
              , e = void 0 !== a.height ? a.height : 4E3;
            e = k.makeIterator(h(d, e));
            d = e.next().value;
            e = e.next().value;
            var g = void 0 !== a.rotation ? t.Math.degToRad(a.rotation) : 0;
            g = f(q, g, d, e);
            WALK.ajaxPost("panorama?width=" + d + "&height=" + e + "&name=" + a.name, "application/binary", g, b, b)
        }
    }
    ;function Qi(a) {
        var b = new WALK.OutlineMaterial(new t.Color(0,0,0),1)
          , c = new WALK.StandardMaterial;
        a.hasLightMap() ? c.lightMapped = !0 : c.specularOff = !0;
        c.setUniforms();
        return {
            outlineMaterial: b,
            planMaterial: c
        }
    }
    function Ri(a, b, c) {
        for (var d = 0; d < c; ++d)
            for (var e = 0; e < b; ++e) {
                var f = 4 * (d * b + e);
                if (d < c / 2)
                    for (var g = 4 * ((c - d - 1) * b + e), h = 0; 4 > h; ++h) {
                        var l = a[f + h];
                        a[f + h] = a[g + h];
                        a[g + h] = l
                    }
            }
    }
    function Si(a, b) {
        console.assert(0 === b % 4, "id passed does not point to alpha channel");
        return 0 !== a[b + 3]
    }
    function Ti(a, b) {
        console.assert(0 === b % 4, "id passed does not point to alpha channel");
        return 255 > a[b + 3]
    }
    function Ui(a, b, c) {
        return 255 > a[c + 3] && a[c + 3] >= a[b + 3]
    }
    function Vi(a, b, c) {
        return a.createRenderTarget(b, c, {
            format: GLC.RGBA,
            magFilter: GLC.NEAREST,
            minFilter: GLC.NEAREST,
            stencilBuffer: !1,
            generateMipmaps: !1
        })
    }
    function Wi(a, b) {
        var c = {
            uniforms: {
                tColor: {
                    type: "t",
                    value: null
                },
                tAlpha: {
                    type: "t",
                    value: null
                },
                colorFill: {
                    type: "c",
                    value: null
                }
            },
            vertexShader: WALK.getShader("minimap_add_alpha_vertex.glsl"),
            fragmentShader: WALK.getShader("minimap_add_alpha_fragment.glsl")
        };
        c = new t.ShaderPass(c,"tColor");
        c.uniforms.tAlpha.value = a;
        b && (c.material.condDefine(!0, "USE_ALPHA_FROM_COLOR"),
        c.uniforms.colorFill.value = b);
        return c
    }
    function Xi(a, b) {
        function c(c, d, e, f, n, p, q) {
            var g = new Uint8Array(d.width * d.height * 4)
              , h = new xc(a);
            h.set(!0, !0, !1);
            var l = [];
            b.gpuMeshes.forEach(function(a) {
                (a.logicalMeshes || [a]).forEach(function(a) {
                    var b = n ? !a.node.disableCollisions : !0;
                    (f ? !a.material.transparent : 1) && b && l.push(a)
                })
            });
            if (p) {
                p = Vi(a, d.width, d.height);
                var m = Vi(a, d.width, d.height);
                c = new Rd(a,b,c);
                c.setTargets(p, m);
                c.renderAllSamples(l, e);
                e = Wi(p, q);
                h.restore();
                h.set(!0, !0, !1);
                e.render(a, d, m);
                h.restore();
                a.readPixels(d.width, d.height, g);
                p.dispose();
                m.dispose();
                c.dispose()
            } else
                a.renderMeshes(l, e, c, d),
                h.restore(),
                a.readPixels(d.width, d.height, g);
            Ri(g, d.width, d.height);
            return g
        }
        function d(a, b, c, d, e) {
            d = Math.max(d, e);
            c = Math.max(c.size().x, c.size().y);
            f.outlineMaterial.setUniform("thickness", "f", a / (d / c * .1));
            f.outlineMaterial.setUniform("color", "c", b)
        }
        var e = new t.Color(1,1,1)
          , f = Qi(b);
        this.createMinimapImageDataComponents = function(g, h, l, m) {
            d(g.outlineThickness, e, b.boundingBox, l, m);
            var n = h.cropRange.center()
              , p = Vi(a, l, m)
              , q = new t.OrthographicCamera(h.visibleRange.min.x - n.x,h.visibleRange.max.x - n.x,h.visibleRange.min.y - n.y,h.visibleRange.max.y - n.y,0,10);
            q.rotation.set(0, 0, -1 * h.rotation);
            q.position.set(n.x, n.y, h.slicePlaneHeight);
            q.updateMatrixWorld(!0);
            h = h.slicePlaneHeight - h.farPlaneHeight;
            q.near = 0;
            q.far = h;
            q.updateProjectionMatrix();
            h = c(q, p, f.planMaterial, !0, !0, !0);
            if (0 < b.minimapConfig.outlineThickness) {
                q.near = 0;
                q.far = .1;
                q.updateProjectionMatrix();
                var r = c(q, p, f.outlineMaterial, !0, !0, !0, g.outlineColor);
                if (b.minimapConfig.fillEnabled) {
                    q = r;
                    g = g.outlineColor;
                    var u = void 0;
                    u = void 0 === u ? .02 : u;
                    n = new Uint8Array(q.length);
                    u *= q.length / 4;
                    for (var v = [-4, 4, 4 * -l, 4 * l], w = 0; w < q.length; w += 4)
                        if (0 === n[w] && Ti(q, w)) {
                            var x = q
                              , y = []
                              , z = []
                              , A = w
                              , B = z;
                            n[A] = 1;
                            for (B.push(A); z.length; ) {
                                A = z.pop();
                                y.push(A);
                                B = x;
                                for (var H = z, C = 0; C < v.length; ++C) {
                                    var L = A + v[C];
                                    if (L = 0 === n[L] && Ui(B, A, L)) {
                                        L = A + v[C];
                                        var G = H;
                                        n[L] = 1;
                                        G.push(L)
                                    }
                                }
                            }
                            x = y;
                            if (x.length < u)
                                for (y = g,
                                z = q,
                                A = 0; A < x.length; ++A)
                                    z[x[A]] = 255 * y.r,
                                    z[x[A] + 1] = 255 * y.g,
                                    z[x[A] + 2] = 255 * y.b,
                                    z[x[A] + 3] = 255
                        }
                }
                q = r;
                for (g = 0; g < h.length; g += 4)
                    if (Si(q, g)) {
                        n = q[g + 3] / 255;
                        for (u = 0; 3 > u; ++u)
                            h[g + u] = h[g + u] * (1 - n) + q[g + u] * n;
                        h[g + 3] = 255
                    }
            }
            p.dispose();
            p = new Uint8Array(h.length);
            for (q = 0; q < h.length; q += 4)
                if (Si(h, q) && (!r || Ti(r, q)))
                    for (g = 0; 4 > g; ++g)
                        p[q + g] = 255;
            h = new Uint8ClampedArray(h.buffer);
            h = new ImageData(h,l,m);
            p = new Uint8ClampedArray(p.buffer);
            l = new ImageData(p,l,m);
            return {
                minimapImageData: h,
                walkableImageData: l
            }
        }
        ;
        this.getCollisionData = function(e, h, l) {
            var g = {
                x: {
                    min: 0,
                    max: h
                },
                y: {
                    min: 0,
                    max: l
                }
            }
              , n = {
                x: {
                    min: b.collisionBoundingBox.min.x,
                    max: b.collisionBoundingBox.max.x
                },
                y: {
                    min: b.collisionBoundingBox.max.y,
                    max: b.collisionBoundingBox.min.y
                }
            };
            d(e.outlineThickness, e.outlineColor, b.collisionBoundingBox, h, l);
            var p = a.createRenderTarget(h, l, {
                format: GLC.RGBA,
                magFilter: GLC.NEAREST,
                minFilter: GLC.NEAREST,
                stencilBuffer: !1,
                generateMipmaps: !1
            })
              , q = new t.OrthographicCamera(b.collisionBoundingBox.min.x,b.collisionBoundingBox.max.x,b.collisionBoundingBox.max.y,b.collisionBoundingBox.min.y,0,10);
            q.position.set(0, 0, e.slicePlaneHeight);
            q.updateMatrixWorld(!0);
            q.near = 0;
            q.far = .1;
            q.updateProjectionMatrix();
            e = c(q, p, f.outlineMaterial, !1, !0);
            p.dispose();
            p = new Uint8ClampedArray(e.buffer);
            return {
                collisionImageData: new ImageData(p,h,l),
                canvasRange: g,
                collisionRange: n
            }
        }
        ;
        this.calculateRenderSize = function(a, b) {
            b = b.size().y / b.size().x;
            return {
                width: 1 > b ? a : Math.round(1 / b * a),
                height: 1 > b ? Math.round(a * b) : a
            }
        }
    }
    ;function Yi(a, b, c, d, e, f, g, h) {
        function l(a, b) {
            a = a ? e : d;
            for (var c = 0; c < a.length; c += 1)
                if (a[c](b.object, b.point, b.distance))
                    return !0;
            return !1
        }
        function m() {
            return b.findIntersectionAtPosition(0, 0, !0, v)
        }
        function n() {
            l(!1, v)
        }
        function p(a, c, d) {
            h && h.reset();
            return b.findIntersectionAtPosition(a, c, !0, y) ? l(d, y) : !1
        }
        function q(a) {
            h && h.reset();
            a.action === WALK.GAMEPAD_ACTION.TRIGGER && p(0, 0, !1)
        }
        function r(a, b) {
            for (var c = 0; c < f.length && !f[c](a, b); c += 1)
                ;
        }
        var u = !1
          , v = new Ac
          , w = null;
        h && h.setGazeHandlers(m, n);
        var x = new wc(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);
        a = x.callbacks;
        var y = new Ac
          , z = null
          , A = null;
        a.onPointerMove = function(a, b) {
            console.assert(u);
            0 !== f.length && (z = a,
            A = b,
            c());
            return !1
        }
        ;
        a.onClick = function(a, b) {
            return p(a, b, !1)
        }
        ;
        a.onDoubleClick = function(a, b) {
            return p(a, b, !0)
        }
        ;
        g.addEventListener("actionActivated", q);
        this.handleHover = function() {
            if (u && 0 !== f.length) {
                var a = b.findObstacleMeshAtPosition(z, A, !0);
                null === a ? w && (r(w, !1),
                w = null) : a !== w && (w && r(w, !1),
                r(a, !0),
                w = a)
            }
        }
        ;
        this.enable = function() {
            u = !0;
            x.enable();
            console.assert(null === w)
        }
        ;
        this.disable = function() {
            u = !1;
            null !== w && (r(w, !1),
            w = null);
            x.disable()
        }
        ;
        this.dispose = function() {
            this.disable();
            g.removeEventListener("actionActivated", q)
        }
        ;
        this.enable()
    }
    ;var Zi = document.getElementById("walk-canvas"), $i = WALK.EDIT_MODE, aj, bj, cj, dj, ej, fj, gj, hj, ij, jj, kj, lj, mj, nj, oj, pj, qj, rj, sj, tj, uj, vj, wj, xj, yj, zj, Aj = null, Bj = null, Cj = null, Dj, Ej, Fj, Gj = 0, Hj = !1, Ij = !1, Jj, Kj = new gf;
    function Lj(a, b) {
        return pj.renderIdle(a, b)
    }
    function Mj(a, b) {
        Bj && Bj.begin();
        b && hj.update();
        vj.update(a);
        Ej && oj.minimapConfig.enabled && Ej.update();
        jj.enableCollisions && !b && qj.handleCollisions(a);
        tj && tj.handleHover();
        uj.update(a);
        gj.update(a);
        rj && rj.updateCameraHeight(a);
        sj && sj.updateCameraHeight();
        b && !vj.teleportingToPoint && (bj.update(),
        ij.requestFrame());
        wj && (b && !hj.hasGamepads() ? wj.update(a) : wj.reset());
        for (var c = !1, d = k.makeIterator(oj.getAnimatedRootNodes()), e = d.next(); !e.done; e = d.next())
            e.value.update(a, gj.cameraWorldPosition()) && (c = !0);
        d = k.makeIterator(oj.getAnimatedMaterials());
        for (e = d.next(); !e.done; e = d.next())
            e = e.value,
            e.isPlaying && (e.update(a),
            c = !0);
        c && ij.requestFrame();
        zj && zj.update(a);
        ej._update(a);
        pj.renderToScreen(a, b);
        Bj && Bj.end()
    }
    function Nj(a) {
        a.view && (rj && rj.disable(),
        tj && tj.disable())
    }
    function Oj(a) {
        !rj || rj.isEnabled() || bj.vrEnabled() || rj.enable();
        if (sj && bj.vrEnabled())
            sj.onTeleportDone();
        a.view && tj && tj.enable();
        bj.vrEnabled() && gj.hmdReset()
    }
    function Pj() {
        if ("hidden" === document.visibilityState) {
            if (oj)
                for (var a = k.makeIterator(oj.getAnimatedMaterials()), b = a.next(); !b.done; b = a.next())
                    b.value.sleepAnimation()
        } else if ("visible" === document.visibilityState && oj) {
            a = k.makeIterator(oj.getAnimatedMaterials());
            for (b = a.next(); !b.done; b = a.next())
                b.value.wakeAnimation();
            ij.requestFrame()
        }
    }
    function Qj() {
        WALK.DETECTOR.ios && (document.documentElement.style.height = window.innerHeight + "px",
        0 !== document.body.scrollTop && window.scrollTo(0, 0));
        pj.resize(bj.vrEnabled());
        ij.requestFrame();
        cj.onResize()
    }
    function Rj() {
        return document.pointerLockElement === Zi || document.mozPointerLockElement === Zi || document.webkitPointerLockElement === Zi
    }
    function Sj() {
        return document.fullscreenElement || document.mozFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || document.webkitFullscreenElement
    }
    function Tj() {
        if (Rj()) {
            gj.mousePressLook = !1;
            cj.onPointerLockChange(!0);
            var a = WALK.GAZE_IN_POINTER_LOCK;
            a ? Kj.enableMode() : Kj.disableMode();
            ej.anchorsVisible = a
        } else
            gj.mousePressLook = !0,
            cj.onPointerLockChange(!1),
            Kj.disableMode(),
            ej.anchorsVisible = !0
    }
    function Uj() {
        if (Sj())
            cj.onFullScreenChange(!0),
            screen.orientation && screen.orientation.lock && screen.orientation.lock("landscape-primary");
        else
            cj.onFullScreenChange(!1)
    }
    function Vj() {
        var a = document.body;
        return void 0 !== document.fullscreenEnabled || void 0 !== document.webkitFullscreenEnabled || void 0 !== document.mozFullScreenEnabled || void 0 !== document.msFullscreenEnabled ? !!(document.fullscreenEnabled || document.webkitFullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled) : void 0 !== a.mozRequestFullScreen || void 0 !== a.webkitRequestFullscreen || void 0 !== a.msRequestFullscreen || void 0 !== a.requestFullscreen
    }
    function Wj(a) {
        aj.uploadNewBuffers(a);
        ij && ij.requestFrame()
    }
    function Xj(a) {
        aj.uploadTexture(a);
        a.isAtlas() ? a.forEachAtlasEntry(function(a) {
            console.assert(null === a.isCutout);
            Cj.isCutoutTexture(a)
        }) : null === a.isCutout && Cj.isCutoutTexture(a);
        ij && ij.requestFrame()
    }
    function Yj() {
        var a = []
          , b = []
          , c = [];
        a.push(ej._clickListener.bind(ej));
        var d = ej._createHoverListener();
        d && c.push(d);
        uj = new Ae(oj,qj,gj,vj);
        b.push(uj.onMeshClicked);
        $i || a.push(uj.onMeshClicked);
        tj = new Yi(kj,qj,function() {
            ij.requestFrame()
        }
        ,a,b,c,hj,wj)
    }
    function Zj() {
        rj && rj.disable();
        sj && sj.enable();
        gj.mouseControlsPitch = !1;
        gj.hmdReset();
        vj.onVrChange(!0);
        Kj.enableMode();
        cj.onVrChange(!0);
        ej._vrChange(!0);
        Qj()
    }
    function ak(a) {
        ij.isEnabled() && (a ? Zj() : (gj.resetRollAngle(),
        gj.resetPitchAngle(),
        gj.mouseControlsPitch = !0,
        console.assert(!bj.vrEnabled()),
        sj && sj.disable(),
        rj && rj.enable(),
        vj.onVrChange(!1),
        Kj.disableMode(),
        cj.onVrChange(!1),
        ej._vrChange(!1),
        Qj(),
        setTimeout(Qj, 1E3)))
    }
    function bk(a) {
        $i || WALK.DETECTOR.mobile && !WALK.ALLOW_MOBILE_VR || (WALK.DETECTOR.ios || WALK.DETECTOR.mobile && WALK.DETECTOR.firefox) && WALK.DETECTOR.inCrossOriginIframe || cj.setVrSupported(a)
    }
    function ck(a, b) {
        if (sj && null !== b)
            sj.onHmdPositionUpdate(b);
        gj.onHmdUpdate(a, b)
    }
    function dk(a, b) {
        a && gj.cameraWorldPosition().set(a[0], a[1], a[2]);
        b && (a = new WALK.Euler,
        a.setFromDegTriple(b),
        gj.setYawAngle(a.yaw),
        gj.setPitchAngle(a.pitch))
    }
    function ek(a) {
        for (var b = 0; b < a.length; b += 1)
            if (!a[b].lightProbe)
                return !1;
        return !0
    }
    function fk(a, b, c) {
        qj = new ue(a,b,c);
        b.visitAllNodes(function(a) {
            a.mesh && qj.addStaticObstacle(a.mesh)
        })
    }
    function gk() {
        var a = t.Scene.prototype.add;
        t.Object3D.prototype.add = function(b) {
            b instanceof t.Mesh && aj.uploadNewBuffers(b);
            a.call(this, b)
        }
    }
    function hk(a) {
        var b = WALK.urlHashGetArgument("view")
          , c = null;
        b && (c = a.findViewByName(b));
        return c || a.views[0]
    }
    function ik(a) {
        function b() {
            ij.requestFrame()
        }
        oj = a;
        oj.adjustSkiesAndCameraFarToSpanWholeScene();
        oj.headLight = WALK.HEAD_LIGHT;
        oj.addEventListener("updated", function() {
            return ij.requestFrame()
        });
        oj.addEventListener("anyViewUpdated", function() {
            return cj.refresh()
        });
        oj.disableLightProbesForMaterials();
        gj.enable();
        oj.threeScene.updateMatrixWorld(!0);
        bj.setCameraFar(oj.camera.far);
        pj = new je(aj,bj,oj,mj);
        Fj = new Xi(aj,oj);
        kj = new sd(aj.domElement,$i);
        if ((a = jj.enableCollisions) || $i)
            fk(aj, oj, gj),
            gj.orbit.collider = qj;
        vj = new Ye(oj,gj,qj,ij,Fj);
        vj.addEventListener("teleportStarted", Nj);
        vj.addEventListener("teleportDone", Oj);
        yj = new Ze(vj);
        a && oj.camera.autoClimb && (rj = new Be(qj,gj,ij));
        a && (sj = new Ce(gj,qj));
        vj.switchToView(hk(oj), 0);
        mj.updateWithoutDelay();
        xj = new uf(oj,vj);
        Dj = new Pi(aj,oj,gj);
        a && !0 !== WALK.NO_GAZE_TELEPORT && (wj = new tf(oj,gj,b,Kj));
        ej._sceneReadyToDisplay(aj, oj, gj, vj, yj, qj, Dj, lj, bj, Kj, kj, ij, fj);
        Yj(a);
        document.addEventListener("visibilitychange", Pj);
        window.addEventListener("resize", function() {
            WALK.DETECTOR.ios ? setTimeout(Qj, 1E3) : Qj()
        }, !1);
        Vj() && cj.setFullScreenSupported();
        WALK.DETECTOR.mobile || WALK.DETECTOR.opera || void 0 === document.pointerLockElement && void 0 === document.mozPointerLockElement && void 0 === document.webkitPointerLockElement || cj.setPointerLockSupported();
        cj.sceneReadyToDisplay(oj, vj, yj, Dj);
        Qj();
        WALK.DEBUG && (Bj = new ti);
        Dc();
        WALK.DEBUG_SHARED_BUFFERS && (oj.threeScene.overrideMaterial = new WALK.DebugMaterial);
        WALK.DEBUG_GEOMETRY_MERGING && qg(oj, !1);
        oj.startAutoTourOnLoad() && yj.start();
        ij.enable();
        bj.vrEnabled() && Zj();
        Jj = Aj.elapsedLoadTimeSec()
    }
    function jk(a) {
        $i || WALK.urlHashContains("nostats") || 0 !== Gj || cj.cover.sendStats && WALK.ajaxPost("./stats/" + a, null, null)
    }
    function kk(a, b) {
        function c(c) {
            function d() {
                f.delete(e);
                null !== a.findLightProbe(e.id) && (b.assignLightProbesToObjects(),
                b.createLightProbeTexture(e, !1),
                ij.requestFrame())
            }
            var e = c.target;
            c = f.get(e);
            void 0 === c && (c = new WALK.DeferringExecutorOnce(d,1E3),
            f.set(e, c));
            c.deferRun()
        }
        function d(a) {
            a = a.target;
            b.createLightProbeTexture(a, !0);
            if (!a.isBoundingBoxInitialized()) {
                var c = a.boxMax;
                a.boxMin.copy(a.position).addScalar(-1);
                c.copy(a.position).addScalar(1);
                a.enableBoundingBox()
            }
        }
        function e() {
            for (var b = 0; b < a.materials.length; b += 1)
                a.materials[b].forceObjectUniformsRefresh()
        }
        var f = new Map;
        a.addEventListener("lightProbeAdded", function(a) {
            a = a.lightProbe;
            b.assignLightProbesToObjects();
            b.createLightProbeTexture(a, !0);
            a.isBoundingBoxInitialized() || a.disableBoundingBox();
            a.addEventListener("boundsInit", d);
            a.addEventListener("positionUpdated", c);
            a.addEventListener("boundsUpdated", e)
        });
        a.addEventListener("lightProbeRemoved", function() {
            b.assignLightProbesToObjects()
        });
        for (var g = 0; g < a.lightProbes.length; g += 1)
            a.lightProbes[g].addEventListener("positionUpdated", c),
            a.lightProbes[g].addEventListener("boundsInit", d),
            a.lightProbes[g].addEventListener("boundsUpdated", e)
    }
    function lk(a, b, c) {
        function d(f) {
            if (f === a.length)
                c();
            else {
                var g = a[f]
                  , h = g.name;
                e.has(h) ? d(f + 1) : (e.add(h),
                b.monoPanoramaToServer(g, function() {
                    return d(f + 1)
                }))
            }
        }
        var e = new Set;
        d(0)
    }
    function mk(a) {
        function b() {
            if (jj.onSceneLoaded)
                jj.onSceneLoaded(new WALK.EditorHooks(a,cj,gj,vj,zj,fj,Dj,ij,Ej,Cj,yj));
            cj.sceneLoadComplete();
            for (var b = k.makeIterator(a.getAnimatedMaterials()), c = b.next(); !c.done; c = b.next())
                c.value.play();
            ej._sceneLoadComplete();
            ij.requestFrame();
            b = Aj.elapsedLoadTimeSec();
            jk("loaded?readyToDisplayTime=" + Jj.toFixed(1) + "&loadTime=" + b.toFixed(1));
            Aj = null
        }
        var c = WALK.urlHashContains("headless");
        null === jj.onSceneLoaded && Cj.dispose();
        if (0 < a.lightProbes.length || $i) {
            var d = new ni(a,aj,WALK.DETECTOR.gl.textureLod,WALK.DETECTOR.gl.mirrorCubeMaps,$i);
            0 === a.lightProbes.length && $i && a.autoAddLightProbes && si(a, d, c);
            if (0 < a.lightProbes.length) {
                ek(a.gpuMeshes) || (console.warn("Some objects do not have light probes assigned, this is not optimal."),
                d.assignLightProbesToObjects());
                var e;
                for (e = 0; e < a.views.length && "orbit" === a.views[e].mode; e += 1)
                    ;
                e === a.views.length && (e = 0);
                vj.executeWithViewVisibilitySettings(a.views[e], function() {
                    d.createAllLightProbeTextures()
                });
                a.enableLightProbesForMaterials()
            }
        }
        a.hasLightMap() && pj.enableAutoExposure();
        if ($i) {
            d ? kk(a, d) : console.warn("Cube maps support is required in the edit mode");
            e = new WALK.LightControls(a,ij);
            var f = new WALK.LightProbeControls(a,ij)
              , g = new WALK.CameraVolumeControls(a,ij);
            zj = new WALK.EditorSelector(kj,a,aj,qj,e,f,g,ij,gj);
            jj.sendCoverToServer && Dj.coverToServer(WALK.EDITOR_COVER_WIDTH, WALK.EDITOR_COVER_HEIGHT);
            dk(jj.forcedInitialCameraPosition, jj.forcedInitialCameraRotation)
        } else
            d && (d.dispose(),
            d = null);
        Ej = new Ji(Fj,a,vj,ej);
        $i && c ? lk(Aj.panoramas, Dj, b) : b()
    }
    function nk() {
        Hj && (Hj = !1,
        Aj.load(),
        cj.sceneLoadStarted(),
        WALK.SHOW_HELP_ON_LOAD && (cj.helpVisible = !0),
        jk("play"))
    }
    function ok(a) {
        cj.updateCover(a);
        fj.updateConfig(a.extensions || []);
        WALK.DETECTOR.canForceBrotliBuffers = !0 === a.canForceBrotliBuffers;
        1 === a.webwalkLogMode ? (WALK.logInfoMessages(),
        WALK.initLoggingToServer(!0)) : 2 === a.webwalkLogMode && WALK.initLoggingToServer(!1);
        $i || fj.startExtensions();
        ej._viewerConfigLoaded(a);
        if (a.language) {
            var b = WALK.STRINGS[a.language];
            b ? WALK.updateViewerStrings(b) : console.log("Unknown language: " + a.language)
        }
        Cj = new yb(aj);
        nj = new zb(aj);
        Hj = !0;
        a = new WALK.Scene(gj.camera());
        void 0 !== jj.assetsUrl && null !== jj.assetsUrl && (WALK.ASSETS_URL = jj.assetsUrl);
        Aj = new ci(a,WALK.ASSETS_URL,$i,dj,nj);
        lj = new Mi(aj,a);
        mj = new Ki(a,gj,lj);
        Aj.onProgress = cj.loadProgress;
        Aj.onTextureLoaded = Xj;
        Aj.onMeshBuffersLoaded = Wj;
        Aj.onReadyToDisplay = ik;
        Aj.onComplete = mk;
        WALK.AUTO_PLAY || Ij || 0 < Gj ? nk() : WALK.HIDE_PLAY || cj.enablePlayButton(nk)
    }
    function pk(a) {
        a.preventDefault();
        Gj += 1;
        ij.disable();
        !$i && null === Aj && Gj <= WALK.CONTEXT_LOST_RESTORE_LIMIT ? (fj.stopExtensions(),
        ej._contextLost(),
        xj.dispose(),
        xj = null,
        tj.dispose(),
        tj = null,
        uj && (uj.dispose(),
        uj = null),
        cj.contextLost()) : Ba.error("Graphics context lost, reload to retry.")
    }
    function qk(a) {
        a.preventDefault();
        !$i && null === Aj && Gj <= WALK.CONTEXT_LOST_RESTORE_LIMIT && (Ba.info("Graphics context switched, reloading the scene to use the new context.", 5E3),
        WALK.DETECTOR.resetGlDetector(aj.context),
        WALK.DETECTOR.gl.reportToConsole(),
        aj.webGLContextRestored(),
        ok(cj.cover))
    }
    function rk() {
        WALK.ajaxGet(WALK.COVER_JSON_URL, !1, function(a) {
            WALK.DETECTOR.onAsyncPropertiesDetected(function() {
                ok(a)
            })
        }, function(a, b) {
            var c = "Failed to initialize the scene.";
            401 == a && void 0 !== b && (c = b);
            Ba.error(c)
        })
    }
    function sk(a) {
        gk();
        jj = a;
        if (aj = ie(Zi))
            if (WALK.DETECTOR.gl.missingCapabilities)
                Ba.error(WALK.DETECTOR.gl.missingCapabilities);
            else {
                Zi.addEventListener("webglcontextlost", pk, !1);
                Zi.addEventListener("webglcontextrestored", qk, !1);
                cj.init();
                fj = new WALK.ExtensionManager;
                a = null;
                try {
                    WALK.VR_LO ? WebXRConfig.cardboardConfig.BUFFER_SCALE *= .5 : WALK.VR_HI && (WebXRConfig.cardboardConfig.BUFFER_SCALE *= 1.5),
                    a = new WebXRPolyfill(WebXRConfig)
                } catch (b) {
                    WALK.log("Failed to initialize WebXR polyfill")
                }
                bj = new se(aj,hj,a,bk,ck,function(a) {
                    a ? ij.disable() : ij.enable()
                }
                ,ak);
                ij = new WALK.AnimationController(bj,Mj,Lj);
                ij.disable();
                a = new WALK.Camera;
                gj = new we(a,Zi,hj,ij);
                gj.mousePressLook = !0;
                WALK.FLIP_MOUSE && (gj.flipMouseLook = !0);
                gj.disable();
                rk();
                WALK.getExtraAssetUrl = function(a) {
                    return a.startsWith("extra-assets/") ? WALK.ASSETS_URL + a : WALK.ASSETS_URL + "extra-assets/" + a
                }
            }
        else
            Ba.error(window.WebGLRenderingContext ? 'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>' : 'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')
    }
    hj = new ff;
    cj = new Ci($i,hj,function() {
        bj.vrEnabled() ? bj.disableVr() : (yj.isRunning() && yj.stop(),
        bj.enableVr(aj.context))
    }
    ,function() {
        if (Sj())
            Sj() && (document.exitFullScreen = document.exitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen || document.webkitExitFullscreen,
            document.exitFullScreen && document.exitFullScreen());
        else {
            var a = document.body;
            (a.mozRequestFullScreen || a.webkitRequestFullscreen || a.msRequestFullscreen || a.requestFullscreen).call(a);
            document.addEventListener("fullscreenchange", Uj, !1);
            document.addEventListener("mozfullscreenchange", Uj, !1);
            document.addEventListener("webkitfullscreenchange", Uj, !1);
            document.addEventListener("MSFullscreenChange", Uj, !1)
        }
    }
    ,function() {
        Rj() ? Rj() && (document.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock || document.webkitExitPointerLock,
        document.exitPointerLock && document.exitPointerLock()) : (Zi.requestPointerLock = Zi.requestPointerLock || Zi.mozRequestPointerLock || Zi.webkitRequestPointerLock,
        Zi.requestPointerLock(),
        document.addEventListener("pointerlockchange", Tj, !1),
        document.addEventListener("mozpointerlockchange", Tj, !1),
        document.addEventListener("webkitpointerlockchange", Tj, !1))
    }
    );
    dj = new function() {
        this._editableNodeTypes = new ph;
        this._editableMaterialNames = new ph;
        this._allMaterialsEditable = !1;
        this.setNodeTypeEditable = function(a) {
            this._editableNodeTypes.add(a)
        }
        ;
        this.setMaterialEditable = function(a) {
            this._editableMaterialNames.add(a)
        }
        ;
        this.setAllMaterialsEditable = function() {
            this._allMaterialsEditable = !0
        }
        ;
        this.isMaterialEditable = function(a) {
            return this._allMaterialsEditable || this._editableMaterialNames.matchesAny(a)
        }
        ;
        this.isNodeTypeEditable = function(a) {
            return this._editableNodeTypes.matchesAny(a)
        }
    }
    ;
    $i && dj.setAllMaterialsEditable();
    ej = new WALK.Viewer($i,cj,dj);
    var tk = {
        FontAwesomeSolid: "\uf2b9",
        FontAwesomeRegular: "\uf2b9",
        FontAwesomeBrands: "\uf293"
    };
    WALK.loadFontFamilies = function(a, b, c) {
        function d(d) {
            d ? ++f : ++g;
            f + g === a.length && (0 === g ? b() : c && c())
        }
        if (0 === a.length)
            b();
        else {
            var e = {};
            a.forEach(function(a) {
                console.assert(tk[a], "Font " + JSON.stringify(a) + " is not supported.");
                e[a] = tk[a]
            });
            var f = 0
              , g = 0;
            WebFont.load({
                custom: {
                    families: a,
                    testStrings: e
                },
                timeout: 1E4,
                fontactive: function() {
                    d(!0)
                },
                fontinactive: function(a) {
                    console.error("Cannot load font: " + a);
                    d(!1)
                }
            })
        }
    }
    ;
    WALK.getViewerAssetUrl = function() {
        var a = function() {
            for (var a = document.getElementsByTagName("script"), c = 0; c < a.length; ++c) {
                var d = a[c].src.match(/^(.*\/)walk(\.min)?\.js$/);
                if (d)
                    return d[1]
            }
            console.error("Cannot determine webwalk URL.");
            return "/webwalk/"
        }();
        return function(b) {
            return a + b
        }
    }();
    WALK.initEditMode = function(a) {
        var b = document.createElement("base");
        b.target = "_blank";
        document.head.appendChild(b);
        WALK.loadFontFamilies(Object.keys(tk), function() {
            sk(a)
        })
    }
    ;
    WALK.init = function(a) {
        $i || sk(a)
    }
    ;
    WALK.play = function() {
        Hj ? nk() : Ij = !0
    }
    ;
    WALK.getViewer = function() {
        return ej
    }
    ;
    WALK.Extensions = {};
    WALK.STRINGS.English = {
        help: {
            basic: "BASIC",
            advanced: "ADVANCED",
            mouse: "Mouse",
            or: "or",
            keyboard: "Keyboard",
            vrTeleport: "VR teleport",
            holdLeftButton: "Hold the left button",
            clickLeftButton: "Click the left button",
            lookAround: "Look around",
            walkToClickedPlace: "Walk to the clicked place",
            selectMaterialLightObject: "Select material, light, object",
            scroll: "Scroll",
            walkStraight: "Walk straight",
            walkStraightAndLookAround: "Walk straight and look around",
            walkStraightAndSideways: "Walk straight and sideways",
            changeHeight: "Change height",
            switchView: "Switch view",
            screenshot: "Screenshot",
            illuminationPreview: "Illumination preview",
            hideShowMenu: "Hide/show menu",
            hideShowMousePointer: "Hide/show mouse pointer",
            vrMode: "VR Mode",
            gazeAtFixedPlace: "Gaze at a fixed place",
            clickControllerButton: "Click a controller button",
            teleport: "Teleport",
            touch: "Touch",
            interactiveDesktop: "Click and drag to look around",
            interactiveMobile: "Drag to look around"
        }
    };
    WALK.STRINGS.Chinese = {
        help: {
            basic: "\u57fa\u672c",
            advanced: "\u9ad8\u7ea7",
            mouse: "\u6ed1\u9f20",
            or: "\u6216",
            keyboard: "\u952e\u76d8",
            vrTeleport: "VR \u4f20\u9001",
            holdLeftButton: "\u6309\u4f4f\u5de6\u952e",
            clickLeftButton: "\u5355\u6309\u5de6\u952e",
            lookAround: "\u8c03\u6574\u89c6\u89d2",
            walkToClickedPlace: "\u8d70\u53bb\u6307\u5b9a\u5730\u70b9",
            selectMaterialLightObject: "\u9009\u62e9\u6750\u8d28\uff0c\u706f\u5149\uff0c\u7269\u4f53",
            scroll: "\u6ed1\u8f6e",
            walkStraight: "\u76f4\u8d70",
            walkStraightAndLookAround: "\u8c03\u6574\u89c6\u89d2",
            walkStraightAndSideways: "\u79fb\u52a8",
            changeHeight: "\u8c03\u6574\u9ad8\u5ea6",
            switchView: "\u79fb\u52a8\u81f3\u6307\u5b9a\u89c6\u89d2",
            screenshot: "\u622a\u56fe",
            illuminationPreview: "\u7167\u660e\u9884\u89c8",
            hideShowMenu: "\u9690\u85cf/\u663e\u793a\u83dc\u5355",
            hideShowMousePointer: "\u9690\u85cf/\u663e\u793a\u9f20\u6807",
            vrMode: "VR \u6a21\u5f0f",
            gazeAtFixedPlace: "\u51dd\u89c6\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u65b9",
            clickControllerButton: "\u5355\u51fb\u63a7\u5236\u5668\u6309\u94ae",
            teleport: "\u4f20\u9001",
            touch: "\u89e6\u78b0"
        }
    };
    WALK.STRINGS.French = {
        help: {
            basic: "BASIQUES",
            advanced: "AVANC\u00c9S",
            mouse: "Souris",
            or: "ou",
            keyboard: "Clavier",
            vrTeleport: "T\u00e9l\u00e9portation VR",
            holdLeftButton: "Maintenez le bouton gauche",
            clickLeftButton: "Cliquez sur le bouton gauche",
            lookAround: "Regardez autour",
            walkToClickedPlace: "D\u00e9placez-vous jusqu\u2019\u00e0 l\u2019endroit cliqu\u00e9",
            selectMaterialLightObject: "S\u00e9lectionnez le mat\u00e9riel, la lumi\u00e8re, l\u2019objet",
            scroll: "D\u00e9filement",
            walkStraight: "Allez tout droit",
            walkStraightAndLookAround: "Allez tout droit et regardez autour",
            walkStraightAndSideways: "Allez tout droit et de c\u00f4t\u00e9",
            changeHeight: "Changez la hauteur",
            switchView: "Changez de vue",
            screenshot: "Capture d\u2019\u00e9cran",
            illuminationPreview: "Aper\u00e7u de l\u2019\u00e9clairage",
            hideShowMenu: "Masquer / Afficher le menu",
            hideShowMousePointer: "Masquer / Afficher le pointeur de la souris",
            vrMode: "Mode RV",
            gazeAtFixedPlace: "Fixez un endroit pr\u00e9cis",
            clickControllerButton: "Appuyez sur un bouton du contr\u00f4leur",
            teleport: "T\u00e9l\u00e9portation",
            touch: "Touchez"
        }
    };
    WALK.STRINGS.German = {
        help: {
            basic: "GRUNDLAGEN",
            advanced: "ERWEITERT",
            mouse: "Maus",
            or: "oder",
            keyboard: "Tastatur",
            vrTeleport: "VR-Teleport",
            holdLeftButton: "Linke Maustaste gedr\u00fcckt halten",
            clickLeftButton: "Klick auf die linke Maustaste",
            lookAround: "Umschauen",
            walkToClickedPlace: "Zum angeklickten Punkt bewegen",
            selectMaterialLightObject: "Material, Licht, Objekt ausw\u00e4hlen",
            scroll: "Mausrad",
            walkStraight: "Geradeaus gehen",
            walkStraightAndLookAround: "Geradeaus gehen und umsehen",
            walkStraightAndSideways: "Geradeaus und seitw\u00e4rts gehen",
            changeHeight: "H\u00f6he \u00e4ndern",
            switchView: "Ansicht wechseln",
            screenshot: "Bildschirmfoto",
            illuminationPreview: "Beleuchtungsvorschau",
            hideShowMenu: "Men\u00fc aus- / einblenden",
            hideShowMousePointer: "Mauszeiger aus-/einblenden",
            vrMode: "VR-Modus",
            gazeAtFixedPlace: "Blick auf einem Punkt fixieren",
            clickControllerButton: "Controller Taste dr\u00fccken",
            teleport: "Teleportieren",
            touch: "Tippen"
        }
    };
    WALK.STRINGS.Spanish = {
        help: {
            basic: "B\u00c1SICO",
            advanced: "AVANZADO",
            mouse: "Rat\u00f3n",
            or: "o",
            keyboard: "Teclado",
            vrTeleport: "Teletransporte VR",
            holdLeftButton: "Mant\u00e9n presionado el bot\u00f3n izquierdo",
            clickLeftButton: "Haz clic en el bot\u00f3n izquierdo",
            lookAround: "Mira a tu alrededor",
            walkToClickedPlace: "Camina hasta el lugar donde hiciste clic",
            selectMaterialLightObject: "Selecciona material, luz, objeto",
            scroll: "Despl\u00e1zate",
            walkStraight: "Camina en l\u00ednea recta",
            walkStraightAndLookAround: "Camina en l\u00ednea recta y mira a tu alrededor",
            walkStraightAndSideways: "Camina recto y de lado",
            changeHeight: "Cambiar altura",
            switchView: "Cambiar vista",
            screenshot: "Captura de pantalla",
            illuminationPreview: "Vista previa de iluminaci\u00f3n",
            hideShowMenu: "Ocultar / mostrar men\u00fa",
            hideShowMousePointer: "Ocultar / mostrar el puntero del rat\u00f3n",
            vrMode: "Modo VR",
            gazeAtFixedPlace: "Mira a un punto fijo",
            clickControllerButton: "Pulsa un bot\u00f3n del mando",
            teleport: "Teletransporte",
            touch: "Tocar"
        }
    };
    WALK.STRINGS.Korean = {
        help: {
            basic: "\uae30\ubcf8 \uc870\uc791\ubc95",
            advanced: "\uc0c1\uc138 \uc870\uc791\ubc95",
            mouse: "\ub9c8\uc6b0\uc2a4",
            or: "\ud639\uc740",
            keyboard: "\ud0a4\ubcf4\ub4dc",
            vrTeleport: "VR \uc774\ub3d9",
            holdLeftButton: "\uc88c\uce21 \ubc84\ud2bc \ub4dc\ub798\uadf8",
            clickLeftButton: "\uc88c\uce21 \ubc84\ud2bc \ud074\ub9ad",
            lookAround: "\uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",
            walkToClickedPlace: "\ud074\ub9ad\ud55c \uacf3\uc73c\ub85c \uc774\ub3d9",
            selectMaterialLightObject: "\uc7ac\uc9c8, \uc870\uba85, \uc0ac\ubb3c \uc120\ud0dd",
            scroll: "\uc2a4\ud06c\ub864",
            walkStraight: "\uc9c1\uc9c4 \uc774\ub3d9",
            walkStraightAndLookAround: "\uc9c1\uc9c4 \uc774\ub3d9 / \uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",
            walkStraightAndSideways: "\uc9c1\uc9c4 \uc774\ub3d9 / \uc606\uc73c\ub85c \uc774\ub3d9",
            changeHeight: "\ub192\uc774 \uc870\uc808",
            switchView: "\ubdf0 \uc120\ud0dd",
            screenshot: "\uc2a4\ud06c\ub9b0\uc0f7",
            illuminationPreview: "\uc77c\ub8e8\ubbf8\ub124\uc774\uc158 \ud504\ub9ac\ubdf0",
            hideShowMenu: "\uba54\ub274 On/Off",
            hideShowMousePointer: "\ub9c8\uc6b0\uc2a4 \ud3ec\uc778\ud130 On/Off",
            vrMode: "VR \ubaa8\ub4dc",
            gazeAtFixedPlace: "\ud2b9\uc815 \uc7a5\uc18c \ubc14\ub77c\ubcf4\uae30",
            clickControllerButton: "\ucee8\ud2b8\ub864\ub7ec \ubc84\ud2bc \ud074\ub9ad",
            teleport: "\ud154\ub808\ud3ec\ud2b8",
            touch: "\ud130\uce58"
        }
    };
    WALK.STRINGS.Polish = {
        help: {
            basic: "PODSTAWOWE",
            advanced: "ZAAWANSOWANE",
            mouse: "Myszka",
            or: "lub",
            keyboard: "Klawiatura",
            vrTeleport: "Teleportacja VR",
            holdLeftButton: "Przytrzymaj lewy przycisk",
            clickLeftButton: "Naci\u015bnij lewy przycisk",
            lookAround: "Rozgl\u0105daj si\u0119",
            walkToClickedPlace: "Id\u017a do naci\u015bni\u0119tego miejsca",
            selectMaterialLightObject: "Wybierz materia\u0142, \u015bwiat\u0142o, obiekt",
            scroll: "Przewi\u0144",
            walkStraight: "Id\u017a prosto",
            walkStraightAndLookAround: "Id\u017a prosto i rozgl\u0105daj si\u0119",
            walkStraightAndSideways: "Id\u017a prosto i na boki",
            changeHeight: "Zmie\u0144 wysoko\u015b\u0107",
            switchView: "Zmie\u0144 widok",
            screenshot: "Zrzut ekranu",
            illuminationPreview: "Podgl\u0105d o\u015bwietlenia",
            hideShowMenu: "Schowaj/poka\u017c menu",
            hideShowMousePointer: "Schowaj/poka\u017c kursor myszki",
            vrMode: "Tryb VR",
            gazeAtFixedPlace: "Patrz w ustalone miejsce",
            clickControllerButton: "Naci\u015bnij przycisk kontrolera",
            teleport: "Teleportacja",
            touch: "Dotyk",
            interactiveDesktop: "Klikaj i przeci\u0105gaj, aby si\u0119 rozgl\u0105da\u0107",
            interactiveMobile: "Przeci\u0105gaj, aby si\u0119 rozgl\u0105da\u0107"
        }
    };
    WALK.STRINGS.Portuguese = {
        help: {
            basic: "B\u00c1SICO",
            advanced: "AVAN\u00c7ADO",
            mouse: "Mouse",
            or: "ou",
            keyboard: "Teclado",
            vrTeleport: "Teletransporte VR",
            holdLeftButton: "Mantenha pressionado o bot\u00e3o esquerdo",
            clickLeftButton: "Clique com o bot\u00e3o esquerdo",
            lookAround: "Olhe ao redor",
            walkToClickedPlace: "Ande at\u00e9 o lugar que foi clicado",
            selectMaterialLightObject: "Selecione material, luz, objeto",
            scroll: "Rolagem",
            walkStraight: "Ande em frente",
            walkStraightAndLookAround: "Ande em frente e olhe ao redor",
            walkStraightAndSideways: "Ande em frente e para os lados",
            changeHeight: "Variar altura",
            switchView: "Alternar entre cenas",
            screenshot: "Captura de imagem",
            illuminationPreview: "Visualiza\u00e7\u00e3o de ilumina\u00e7\u00e3o",
            hideShowMenu: "Ocultar/mostrar menu",
            hideShowMousePointer: "Ocultar/mostrar a seta do mouse",
            vrMode: "Modo VR",
            gazeAtFixedPlace: "Olhe para um lugar fixo",
            clickControllerButton: "Clique num bot\u00e3o controlador",
            teleport: "Teletransporte",
            touch: "Toque",
            interactiveDesktop: "Clique e arraste para olhar ao redor",
            interactiveMobile: "Arraste para olhar ao redor"
        }
    };
    WALK.STRINGS.Turkish = {
        help: {
            basic: "Basit",
            advanced: "\u0130leri D\u00fczey",
            mouse: "Fare",
            or: "veya",
            keyboard: "Klavye",
            vrTeleport: "VR I\u015f\u0131nlanma",
            holdLeftButton: "Sol tu\u015fa bas\u0131l\u0131 tut",
            clickLeftButton: "Sol tu\u015fa t\u0131kla",
            lookAround: "\u00c7evrene bak",
            walkToClickedPlace: "T\u0131klad\u0131\u011f\u0131n alana y\u00fcr\u00fc",
            selectMaterialLightObject: "Materyal, \u0131\u015f\u0131k veya obje se\u00e7",
            scroll: "A\u015fa\u011f\u0131 kayd\u0131r",
            walkStraight: "D\u00fcz y\u00fcr\u00fc",
            walkStraightAndLookAround: "D\u00fcz y\u00fcr\u00fc ve \u00e7evrene bak\u0131n",
            walkStraightAndSideways: "D\u00fcz ve yanlana do\u011fru y\u00fcr\u00fc",
            changeHeight: "Y\u00fckseklik de\u011fi\u015ftir",
            switchView: "G\u00f6r\u00fcn\u00fcm de\u011fi\u015ftir",
            screenshot: "Ekran G\u00f6r\u00fcnt\u00fcs\u00fc",
            illuminationPreview: "Ayd\u0131nlatma \u00f6nizlemesi",
            hideShowMenu: "Men\u00fcy\u00fc g\u00f6ster/gizle",
            hideShowMousePointer: "\u0130mleci g\u00f6ster/gizle",
            vrMode: "VR Modu",
            gazeAtFixedPlace: "Bir noktaya kitlenerek bak",
            clickControllerButton: "Kumanda butonuna t\u0131kla",
            teleport: "I\u015f\u0131nlan",
            touch: "Dokun"
        }
    };
    WALK.STRINGS.Japanese = {
        help: {
            basic: "\u57fa\u672c\u64cd\u4f5c",
            advanced: "\u8a73\u7d30\u64cd\u4f5c",
            mouse: "\u30de\u30a6\u30b9",
            or: "or",
            keyboard: "\u30ad\u30fc\u30dc\u30fc\u30c9",
            vrTeleport: "VR \u30c6\u30ec\u30dd\u30fc\u30c8",
            holdLeftButton: "\u5de6\u30dc\u30bf\u30f3\u3092\u9577\u62bc\u3057",
            lookAround: "\u898b\u56de\u3059",
            clickLeftButton: "\u5de6\u30dc\u30bf\u30f3",
            walkToClickedPlace: "\u30af\u30ea\u30c3\u30af\u3057\u305f\u5834\u6240\u306b\u79fb\u52d5\u3059\u308b",
            selectMaterialLightObject: "\u30de\u30c6\u30ea\u30a2\u30eb\u3001\u30e9\u30a4\u30c8\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e",
            scroll: "\u30b9\u30af\u30ed\u30fc\u30eb",
            walkStraight: "\u524d\u5f8c\u79fb\u52d5",
            walkStraightAndLookAround: "\u524d\u5f8c\u79fb\u52d5\u3057\u3066\u898b\u56de\u3059",
            walkStraightAndSideways: "\u524d\u5f8c\u5de6\u53f3\u79fb\u52d5",
            changeHeight: "\u9ad8\u3055\u8abf\u6574",
            switchView: "\u30d3\u30e5\u30fc\u5207\u308a\u66ff\u3048",
            screenshot: "\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8",
            illuminationPreview: "\u30a4\u30eb\u30df\u30cd\u30fc\u30b7\u30e7\u30f3\u30d7\u30ec\u30d3\u30e5\u30fc",
            hideShowMenu: "\u30e1\u30cb\u30e5\u30fc \u8868\u793a/\u975e\u8868\u793a",
            hideShowMousePointer: "\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb \u8868\u793a/\u975e\u8868\u793a",
            vrMode: "VR \u30e2\u30fc\u30c9",
            gazeAtFixedPlace: "\u7279\u5b9a\u306e\u5834\u6240\u3092\u898b\u308b",
            clickControllerButton: "\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b",
            teleport: "\u30c6\u30ec\u30dd\u30fc\u30c8",
            touch: "\u89e6\u308b",
            interactiveDesktop: "\u30af\u30ea\u30c3\u30af\uff06\u30c9\u30e9\u30c3\u30b0\u3057\u3066\u898b\u56de\u3059",
            interactiveMobile: "\u30c9\u30e9\u30c3\u30b0\u3057\u3066\u898b\u56de\u3059"
        }
    };
    var uk = WALK.cloneObject(WALK.STRINGS[WALK.DEFAULT_LANGUAGE]);
    function vk() {
        for (var a = document.querySelectorAll("[data-strings]"), b = 0; b < a.length; ++b) {
            var c = a.item(b);
            a: {
                var d = c.getAttribute("data-strings").split(".");
                for (var e = uk, f = 0; f < d.length; f++)
                    if (e = e[d[f]],
                    !e) {
                        d = null;
                        break a
                    }
                d = "string" === typeof e ? e : null
            }
            c.textContent = d
        }
    }
    WALK.updateViewerStrings = function(a) {
        function b(a, d, e) {
            Object.keys(d).forEach(function(c) {
                var f = "" === e ? c : e + "." + c;
                if (void 0 === a[c])
                    console.warn("Viewer string " + f + " doesn\u2019t exist");
                else if (typeof a[c] !== typeof d[c])
                    console.error(f + " should be " + typeof a[c]);
                else
                    switch (typeof d[c]) {
                    case "string":
                        a[c] = d[c];
                        break;
                    case "object":
                        b(a[c], d[c], f)
                    }
            })
        }
        b(uk, a, "");
        vk()
    }
    ;
    WALK.getViewerStrings = function() {
        return WALK.readOnlyCopy(uk)
    }
    ;
    vk();
    WALK.ExtensionManager = function() {
        this.extensionTypes = WALK.Extensions
    }
    ;
    WALK.ExtensionManager.getExtensionDefinition = function(a) {
        return WALK.Extensions[a].definition
    }
    ;
    WALK.ExtensionManager.prototype = {
        constructor: WALK.ExtensionManager,
        updateConfig: function(a) {
            this.extensions = [];
            a = k.makeIterator(a);
            for (var b = a.next(); !b.done; b = a.next())
                this._createExtensionFromConfig(b.value)
        },
        _createExtensionFromConfig: function(a) {
            function b(b, c) {
                return b.some(function(b) {
                    return b.name === c && b.config.type === a.type
                })
            }
            var c = this;
            a.name = a.name.toString();
            for (var d = a.name, e = 2; b(this.extensions, a.name); )
                a.name = d + e.toString(),
                e += 1;
            var f = new this.extensionTypes[a.type](a);
            if (f.isTriggerExclusive()) {
                console.assert(f.isTriggerable());
                var g = f.trigger;
                f.trigger = function(a) {
                    !1 !== a && c.extensions.forEach(function(a) {
                        a !== f && a.isTriggerExclusive() && a.trigger(!1)
                    });
                    g.call(f, a)
                }
            }
            this.extensions.push(f);
            return f
        },
        startExtensions: function() {
            var a = this;
            this._loadFontAwesomeIfNeeded(function() {
                for (var b = 0; b < a.extensions.length; b += 1)
                    a.extensions[b].start()
            })
        },
        _loadFontAwesomeIfNeeded: function(a) {
            var b = this
              , c = this.extensions.map(function(a) {
                return b._getFonts(a.config)
            }).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(a, b) {
                return a.concat(b)
            }, []).filter(function(a, b, c) {
                return b === c.indexOf(a)
            });
            0 < c.length && !WALK.EDIT_MODE ? WALK.loadFontFamilies(c, a, a) : a()
        },
        _getFonts: function(a) {
            for (var b = [], c = k.makeIterator(this.extensionTypes[a.type].definition.properties), d = c.next(); !d.done; d = c.next())
                if (d = d.value,
                "trigger" === d.type && a[d.id])
                    d = a[d.id],
                    (d = d.icon && WALK.ICONS[d.icon].fontFamily) && b.push(d);
                else if ("list" === d.type && "trigger" === d.elementType && a[d.id]) {
                    d = k.makeIterator(a[d.id]);
                    for (var e = d.next(); !e.done; e = d.next())
                        e = e.value,
                        (e = e.icon && WALK.ICONS[e.icon].fontFamily) && b.push(e)
                }
            return b
        },
        stopExtensions: function() {
            for (var a = 0; a < this.extensions.length; a += 1)
                this.extensions[a].stop()
        },
        getEditableExtensionDefinitions: function() {
            for (var a = [], b = k.makeIterator(Object.entries(this.extensionTypes || {})), c = b.next(); !c.done; c = b.next()) {
                var d = k.makeIterator(c.value);
                c = d.next().value;
                d = d.next().value;
                d.definition.hideFromEditor || a.push({
                    type: c,
                    definition: d.definition
                })
            }
            return a
        },
        getEditableExtensions: function() {
            for (var a = [], b = k.makeIterator(this.extensions), c = b.next(); !c.done; c = b.next())
                c = c.value,
                c.definition.hideFromEditor || a.push(c);
            return a
        },
        getEditableTriggerImagePaths: function() {
            function a(a) {
                return a.properties.filter(function(a) {
                    return "trigger" === a.type
                }).map(function(a) {
                    return a.id
                })
            }
            for (var b = new Set, c = {}, d = k.makeIterator(this.getEditableExtensions()), e = d.next(); !e.done; c = {
                $jscomp$loop$prop$extension$183: c.$jscomp$loop$prop$extension$183
            },
            e = d.next())
                c.$jscomp$loop$prop$extension$183 = e.value,
                a(c.$jscomp$loop$prop$extension$183.definition).forEach(function(a) {
                    return function(c) {
                        a.$jscomp$loop$prop$extension$183.config[c] && a.$jscomp$loop$prop$extension$183.config[c].image && b.add(a.$jscomp$loop$prop$extension$183.config[c].image)
                    }
                }(c));
            return Array.from(b)
        },
        addExtension: function(a) {
            a = this._createExtensionFromConfig(a);
            a.start();
            return a
        },
        removeExtension: function(a) {
            a.stop();
            for (var b = 0; b < this.extensions.length; b += 1)
                if (this.extensions[b] === a) {
                    this.extensions.splice(b, 1);
                    break
                }
        },
        getConfig: function() {
            return this.extensions.map(function(a) {
                return a.config
            })
        },
        getExtension: function(a, b) {
            for (var c = k.makeIterator(this.extensions), d = c.next(); !d.done; d = c.next())
                if (d = d.value,
                d.type === a && d.name === b)
                    return d;
            console.error("Unrecognized extension " + a + " " + b + ", supported types: " + Object.keys(this.extensionTypes))
        }
    };
    var wk = WALK.EDIT_MODE;
    function xk() {}
    var yk = {
        "\uf2b9": "address-book",
        "\uf2bb": "address-card",
        "\uf1fe": "area-chart",
        "\uf047": "arrows",
        "\uf062": "arrow-up",
        "\uf063": "arrow-down",
        "\uf2a2": "assistive-listening-systems",
        "\uf069": "asterisk",
        "\uf29e": "audio-description",
        "\uf1fa": "at",
        "\uf0c9": "bars",
        "\uf0f3": "bell",
        "\uf02d": "book",
        "\uf02e": "bookmark",
        "\uf0a1": "bullhorn",
        "\uf1ec": "calculator",
        "\uf030": "camera",
        "\uf080": "chart-bar",
        "\uf200": "chart-pie",
        "\uf0c2": "cloud",
        "\uf013": "cog",
        "\uf075": "comment",
        "\uf14e": "compass",
        "\uf09d": "credit-card",
        "\uf05b": "crosshairs",
        "\uf019": "download",
        "\uf0e0": "envelope",
        "\uf08e": "external-link",
        "\uf06e": "eye",
        "\uf1fb": "eye-dropper",
        "\uf008": "film",
        "\uf024": "flag",
        "\uf07b": "folder",
        "\uf06b": "gift",
        "\uf025": "headphones",
        "\uf015": "home",
        "\uf03e": "image",
        "\uf090": "sign-in",
        "\uf129": "info",
        "\uf0eb": "lightbulb",
        "\uf0d0": "magic",
        "\uf076": "magnet",
        "\uf041": "map-marker",
        "\uf276": "map-pin",
        "\uf277": "map-signs",
        "\uf1fc": "paint-brush",
        "\uf040": "pencil",
        "\uf095": "phone",
        "\uf128": "question",
        "\uf064": "share",
        "\uf1e0": "share-alt",
        "\uf07a": "shopping-cart",
        "\uf1de": "sliders",
        "\uf005": "star",
        "\uf0e4": "tachometer",
        "\uf02b": "tag",
        "\uf03d": "video",
        "\uf0ad": "wrench",
        "\uf04b": "play",
        "\uf16a": "youtube",
        "\uf27d": "vimeo",
        "\uf09a": "facebook",
        "\uf099": "twitter",
        "\uf16d": "instagram"
    };
    function zk() {
        console.error("This extension cannot be triggered on/off")
    }
    var Ak = new function() {
        var a = new Map;
        this.onNodeTypeClicked = function(b, c) {
            function d(b) {
                return function(c, d, e) {
                    var f = a.get(b);
                    console.assert(f, "listenerMulti not found for " + b);
                    f.listeners.forEach(function(a) {
                        try {
                            a(c, d, e)
                        } catch (p) {
                            console.error(p)
                        }
                    });
                    return !0
                }
            }
            var e = a.get(b);
            e ? e.listeners.push(c) : (e = d(b),
            a.set(b, {
                listenerMulti: e,
                listeners: [c]
            }),
            WALK.getViewer().onNodeTypeClicked(b, e))
        }
        ;
        this.removeOnNodeTypeClicked = function(b, c) {
            var d = a.get(b);
            console.assert(d, "listenerMulti not registered for " + b);
            c = d.listeners.indexOf(c);
            console.assert(0 <= c, "listener not registered for " + b);
            d.listeners.splice(c, 1);
            0 === d.listeners.length && (WALK.getViewer().removeOnNodeTypeClicked(b, d.listenerMulti),
            a.delete(b))
        }
    }
    ;
    WALK.Extension = function(a) {
        function b(a) {
            return c.definition.properties.some(function(b) {
                return b.id === a
            })
        }
        var c = this;
        this.triggers = [];
        var d = [];
        this.definition = this.constructor.definition;
        this.viewerApi = WALK.getViewer();
        this.running = !1;
        var e = [];
        this.config = WALK.readOnlyCopy(function(a) {
            a = WALK.cloneObject(a);
            if (void 0 !== a.anchor && void 0 === a.trigger && !b("anchor") && b("trigger")) {
                var d = a.anchor;
                d.icon && d.icon.font && (d.icon = yk[d.icon.value]);
                a.trigger = d;
                a.anchor = void 0
            }
            d = k.makeIterator(c.definition.properties);
            for (var e = d.next(); !e.done; e = d.next())
                e = e.value,
                void 0 === a[e.id] && void 0 !== e.defaultValue && (a[e.id] = e.defaultValue);
            return a
        }(a));
        Object.defineProperty(this, "name", {
            get: function() {
                return this.config.name
            }
        });
        Object.defineProperty(this, "type", {
            get: function() {
                return this.config.type
            }
        });
        Object.defineProperty(this, "vrCompatible", {
            get: function() {
                return this.definition.vrCompatible
            },
            configurable: !0
        });
        this.cloneConfig = function() {
            return WALK.cloneObject(this.config)
        }
        ;
        this.updateConfig = function(a) {
            this.stop();
            this.config = WALK.readOnlyCopy(a);
            this.start()
        }
        ;
        this.doStop = this.doStart = xk;
        this.trigger = zk;
        this.start = function() {
            this.running || (this.doStart(),
            this.running = !0)
        }
        ;
        this.stop = function() {
            if (this.running) {
                this.doStop();
                for (var a = k.makeIterator(d), b = a.next(); !b.done; b = a.next())
                    this.viewerApi.removeAnchor(b.value);
                a = k.makeIterator(e);
                for (b = a.next(); !b.done; b = a.next())
                    b = b.value,
                    Ak.removeOnNodeTypeClicked(b[0], b[1]);
                e.length = 0;
                this.triggers.length = 0;
                d.length = 0;
                this.running = !1
            }
        }
        ;
        this._vrChanged = function(a) {
            a && !this.vrCompatible ? this.stop() : a || this.vrCompatible || this.start()
        }
        ;
        this.addTrigger = function(a, b) {
            "node" === a.type ? (a = a.nodeType,
            e.push([a, b]),
            Ak.onNodeTypeClicked(a, b),
            this.triggers.push.apply(this.triggers, k.arrayFromIterable(this.viewerApi.findNodesOfType(a)))) : (b = this.viewerApi.addAnchor(a, b),
            b.extension = this,
            d.push(b),
            this.triggers.push(b))
        }
        ;
        this.isTriggerable = function() {
            return this.trigger !== zk
        }
        ;
        this.isTriggerExclusive = function() {
            return !!this.config.triggerExclusive
        }
        ;
        this.viewerApi.onVrChange(this._vrChanged.bind(this))
    }
    ;
    WALK.Extensions.HtmlLabel = function(a) {
        function b() {
            f = null;
            WALK.Extensions.HtmlLabel._activeLabel === e && (WALK.Extensions.HtmlLabel._activeLabel = null,
            d())
        }
        function c(a) {
            if (a instanceof HTMLVideoElement || a instanceof HTMLIFrameElement)
                return !0;
            a = k.makeIterator(a.children);
            for (var b = a.next(); !b.done; b = a.next())
                if (c(b.value))
                    return !0;
            return !1
        }
        function d() {
            WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping && (e.viewerApi.wakeAnimatedMaterials(),
            WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping = !1)
        }
        var e = this;
        WALK.Extension.call(this, a);
        var f = null;
        this.trigger = function(a) {
            var g = WALK.Extensions.HtmlLabel._activeLabel === this;
            !0 === a && g || !1 === a && !g || (g ? (console.assert(null !== f),
            f.close()) : (WALK.Extensions.HtmlLabel._activeLabel = this,
            f = this.viewerApi.openPopup(this.config.content, this.config, b),
            a = document.createElement("div"),
            a.innerHTML = this.config.content,
            c(a) ? WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping || (e.viewerApi.sleepAnimatedMaterials(),
            WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping = !0) : d()))
        }
        ;
        this.doStart = function() {
            var a = this;
            a.viewerApi.onSceneReadyToDisplay(function() {
                a.config.trigger && a.addTrigger(a.config.trigger, function() {
                    return a.trigger()
                })
            })
        }
        ;
        this.doStop = function() {
            null !== f && f.close()
        }
    }
    ;
    WALK.Extensions.HtmlLabel.definition = {
        name: "HTML label",
        properties: [{
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }, {
            id: "content",
            type: "textArea",
            label: "Content",
            optional: !0,
            defaultValue: "Content to display..."
        }, {
            id: "centerHorizontally",
            type: "bool",
            label: "Center horizontally",
            defaultValue: !1
        }, {
            id: "centerVertically",
            type: "bool",
            label: "Center vertically",
            defaultValue: !1
        }, {
            id: "padding",
            type: "bool",
            label: "Padding",
            defaultValue: !0
        }],
        vrCompatible: !1
    };
    WALK.Extensions.HtmlLabel._activeLabel = null;
    WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping = !1;
    WALK.Extensions.Audio = function(a) {
        function b() {
            d.trigger()
        }
        function c() {
            var a = d.config;
            a.trigger && d.addTrigger(a.trigger, b);
            a.menuButton && (l = e.addMenuButton(g.src),
            l.addEventListener("click", b),
            m = e.getMenuButtonIcon(l));
            if (a.autoplay)
                d.viewerApi.onNextPageInteraction(function() {
                    b()
                })
        }
        a.url && !a.file && (a.file = {
            file: a.url.split("/").pop(),
            url: a.url
        },
        delete a.url);
        a.file.path && a.file.url && delete a.file.url;
        WALK.Extension.call(this, a);
        var d = this
          , e = this.viewerApi
          , f = null
          , g = null
          , h = null
          , l = null
          , m = null
          , n = !1;
        this.trigger = function(a) {
            !0 === a && n || !1 === a && !n || (n ? h.pause() : (d.config.playRewinds && (h.currentTime = 0),
            h.play()))
        }
        ;
        this.doStart = function() {
            WALK.log("Audio start");
            this.config.menuButton && !f && (f = WALK.preloadImage(e.getViewerAssetUrl("img/audio-on.svg")),
            g = WALK.preloadImage(e.getViewerAssetUrl("img/audio-off.svg")));
            h = document.createElement("audio");
            this.config.file && (this.config.file.path ? h.src = WALK.getExtraAssetUrl(this.config.file.path) : this.config.file.url && (h.src = this.config.file.url));
            h.src && (h.loop = this.config.loop,
            h.addEventListener("play", function() {
                n = !0;
                m && (m.src = f.src)
            }),
            h.addEventListener("pause", function() {
                n = !1;
                m && (m.src = g.src)
            }),
            document.body.appendChild(h),
            e.onSceneReadyToDisplay(c))
        }
        ;
        this.doStop = function() {
            WALK.log("Audio stop");
            n = !1;
            l && (this.viewerApi.removeMenuButton(l),
            m = l = null);
            h.pause();
            h.remove();
            h = null
        }
    }
    ;
    WALK.Extensions.Audio.definition = {
        name: "Audio",
        properties: [{
            id: "file",
            type: "file",
            label: "File",
            fileType: "audio"
        }, {
            id: "autoplay",
            type: "bool",
            label: "Autoplay",
            defaultValue: !1
        }, {
            id: "triggerExclusive",
            type: "bool",
            label: "Exclusive",
            defaultValue: !1
        }, {
            id: "playRewinds",
            type: "bool",
            label: "Play rewinds",
            defaultValue: !1
        }, {
            id: "loop",
            type: "bool",
            label: "Loop",
            defaultValue: !0
        }, {
            id: "menuButton",
            type: "bool",
            label: "Show menu button",
            defaultValue: !0
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }],
        vrCompatible: !0
    };
    function Bk(a, b) {
        var c = new t.Vector3
          , d = new t.Vector3;
        if (b && "node" !== b.type) {
            c.fromArray(b.position);
            var e = b.radius
        } else
            e = WALK.Extensions.MaterialPicker.VR_RADIUS;
        this.getPosition = function(f) {
            b && "node" !== b.type || (d.copy(a.getCameraPosition()),
            d.sub(f),
            d.normalize().multiplyScalar(e),
            c.copy(f).add(d));
            return c
        }
        ;
        this.getRadius = function() {
            return e
        }
    }
    WALK.Extensions.MaterialPicker = function(a) {
        function b() {
            return (h.config.toReplace ? [h.config.toReplace] : []).concat(h.config.toPick || [])
        }
        function c() {
            return b().map(function(a) {
                return h.viewerApi.findMaterial(a)
            }).filter(function(a) {
                return a
            })
        }
        function d(a) {
            h.viewerApi.apiUserChangeState(n, a.name)
        }
        function e(a, b) {
            console.assert(a === n);
            if (a = h.viewerApi.findMaterial(b))
                for (b = 0; b < l.length; b += 1)
                    h.viewerApi.setMaterialForMesh(a, l[b])
        }
        function f(a, b) {
            h.triggerAtPosition(void 0, b)
        }
        function g() {
            h.config.trigger && h.addTrigger(h.config.trigger, f);
            l = h.viewerApi.findMeshesWithMaterial(h.config.toReplace || [])
        }
        WALK.Extension.call(this, a);
        var h = this
          , l = []
          , m = new Bk(h.viewerApi,h.config.trigger)
          , n = "MaterialPicker:" + this.name;
        this.config.materials && (a = WALK.cloneObject(this.config),
        0 < a.materials.length && (a.toReplace = a.materials[0],
        a.toPick = a.materials.slice(1)),
        a.materials = void 0,
        this.config = WALK.readOnlyCopy(a));
        h.viewerApi.isSceneReadyToDisplay() || b().map(function(a) {
            h.viewerApi.setMaterialEditable(a)
        });
        this.trigger = function(a) {
            !1 !== a && h.viewerApi.openMaterialPicker(c(), d)
        }
        ;
        this.triggerAtPosition = function(a, b) {
            !1 !== a && h.viewerApi.openMaterialPicker(c(), d, null, m.getPosition(b), m.getRadius())
        }
        ;
        this.doStart = function() {
            this.viewerApi.onSceneReadyToDisplay(g);
            this.viewerApi.onApiUserStateChanged(n, e)
        }
        ;
        this.doStop = function() {
            var a = h.viewerApi.findMaterial(h.config.toReplace);
            a && d(a);
            this.viewerApi.removeOnApiUserStateChanged(n, e)
        }
    }
    ;
    WALK.Extensions.MaterialPicker.VR_RADIUS = .07;
    WALK.Extensions.MaterialPicker.definition = {
        name: "Material picker",
        properties: [{
            id: "toReplace",
            type: "material",
            label: "Material to replace"
        }, {
            id: "toPick",
            type: "list",
            elementType: "material",
            label: "Materials to pick"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }],
        vrCompatible: !0
    };
    WALK.Extensions.MaterialComboPicker = function(a) {
        function b() {
            for (var a = new Set, b = k.makeIterator(z), c = b.next(); !c.done; c = b.next()) {
                c = k.makeIterator(c.value);
                for (var d = c.next(); !d.done; d = c.next())
                    d = d.value,
                    a.add(d.toReplace),
                    a.add(d.toUse)
            }
            return a
        }
        function c() {
            for (var a = [z[0][0].toReplace], b = k.makeIterator(z), c = b.next(); !c.done; c = b.next())
                a.push(c.value[0].toUse);
            return a
        }
        function d() {
            return c().map(function(a) {
                return y.findMaterial(a)
            })
        }
        function e() {
            if (-1 !== A)
                for (var a = 0; a < z[A].length; ++a) {
                    var b = z[A][a]
                      , c = y.findMaterial(b.toUse);
                    b = y.findMaterial(b.toReplace);
                    c.setUvOffsetAndScale(v[c]);
                    c.setUniforms();
                    c = k.makeIterator(r[A][a]);
                    for (var d = c.next(); !d.done; d = c.next())
                        y.setMaterialForMesh(b, d.value)
                }
        }
        function f(a, b) {
            y.apiUserChangeState(x, b)
        }
        function g(a, b) {
            console.assert(a === x);
            e();
            if (0 !== b)
                for (A = b - 1,
                a = 0; a < z[A].length; ++a) {
                    var c = z[A][a];
                    b = y.findMaterial(c.toUse);
                    var d = v[b];
                    b.setUvOffsetAndScale(d.x, d.y, d.z * (c.uvScale ? c.uvScale[0] : u[0]), d.w * (c.uvScale ? c.uvScale[1] : u[1]));
                    b.setUniforms();
                    c = k.makeIterator(r[A][a]);
                    for (d = c.next(); !d.done; d = c.next())
                        y.setMaterialForMesh(b, d.value)
                }
        }
        function h() {
            WALK.Extensions.MaterialComboPicker._menuPopup.close();
            WALK.Extensions.MaterialComboPicker._menuPopup = null
        }
        function l() {
            WALK.Extensions.MaterialComboPicker._pickerOpened = !1
        }
        function m(a, b) {
            WALK.Extensions.MaterialComboPicker._menuPopup && h();
            a = d();
            y.openMaterialPicker(a, f, l, w.getPosition(b), w.getRadius());
            WALK.Extensions.MaterialComboPicker._pickerOpened = !0
        }
        function n() {
            for (var a = k.makeIterator(q.config.triggers), b = a.next(); !b.done; b = a.next())
                q.addTrigger(b.value, m);
            for (a = 0; a < z.length; ++a) {
                r[a] = [];
                b = k.makeIterator(z[a]);
                for (var c = b.next(); !c.done; c = b.next()) {
                    c = c.value;
                    var d = c.toUse;
                    r[a].push(y.findMeshesWithMaterial(c.toReplace));
                    c = y.findMaterial(d);
                    v.has(c) || (d = new t.Vector4,
                    v[c] = c.getUvOffsetAndScale(d))
                }
            }
        }
        function p() {
            var a = WALK.Extensions.MaterialComboPicker._startedPickers;
            console.assert(0 < a.length);
            WALK.Extensions.MaterialComboPicker._pickerOpened && y.closeMaterialPicker();
            if (WALK.Extensions.MaterialComboPicker._menuPopup)
                h();
            else {
                var b = document.createElement("div");
                b.innerHTML = '\n        <div class="ext-material-combo-picker-menu-title">\n          <img src="' + y.getViewerAssetUrl("img/sliders-horizontal.svg") + '">\n        </div>\n        <ul class="ext-material-combo-picker-menu-list">\n          <li class="ext-material-combo-picker-menu-item"></li>\n        </ul>';
                for (var c = b.getElementsByClassName("ext-material-combo-picker-menu-list")[0], d = c.getElementsByClassName("ext-material-combo-picker-menu-item")[0], e = {}, f = 0; f < a.length; e = {
                    $jscomp$loop$prop$picker$185: e.$jscomp$loop$prop$picker$185
                },
                ++f)
                    0 < f && (d = d.cloneNode(!0),
                    c.appendChild(d)),
                    e.$jscomp$loop$prop$picker$185 = a[f],
                    WALK.setTextContent(d, e.$jscomp$loop$prop$picker$185.name),
                    d.addEventListener("click", function(a) {
                        return function() {
                            a.$jscomp$loop$prop$picker$185._openFromMenu()
                        }
                    }(e));
                WALK.Extensions.MaterialComboPicker._menuPopup = y.openPopup(b, {
                    centerHorizontally: !0,
                    centerVertically: !0
                }, function() {
                    WALK.Extensions.MaterialComboPicker._menuPopup = null
                })
            }
        }
        WALK.Extension.call(this, a);
        var q = this
          , r = []
          , u = [1, 1]
          , v = new Map
          , w = new Bk(q.viewerApi)
          , x = "MaterialComboPicker:" + this.name
          , y = this.viewerApi
          , z = q.config.options
          , A = -1;
        y.isSceneReadyToDisplay() || b().forEach(function(a) {
            y.setMaterialEditable(a)
        });
        this._openFromMenu = function() {
            h();
            var a = d();
            y.openMaterialPicker(a, f);
            WALK.Extensions.MaterialComboPicker._pickerOpened = !0
        }
        ;
        this.doStart = function() {
            y.onSceneReadyToDisplay(n);
            y.onApiUserStateChanged(x, g);
            var a = WALK.Extensions.MaterialComboPicker._startedPickers;
            a.push(this);
            1 === a.length && (a = y.addMenuButton(y.getViewerAssetUrl("img/sliders-horizontal.svg")),
            a.addEventListener("click", p),
            WALK.Extensions.MaterialComboPicker._menuButton = a)
        }
        ;
        this.doStop = function() {
            e();
            this.viewerApi.removeOnApiUserStateChanged(x, g);
            var a = WALK.Extensions.MaterialComboPicker._startedPickers;
            a.splice(a.indexOf(this), 1);
            0 === a.length && (y.removeMenuButton(WALK.Extensions.MaterialComboPicker._menuButton),
            WALK.Extensions.MaterialComboPicker._menuButton = null)
        }
    }
    ;
    WALK.Extensions.MaterialComboPicker.definition = {
        name: "Material combo picker",
        hideFromEditor: !0,
        properties: [{
            id: "triggers",
            type: "list",
            label: "Triggers",
            elementType: "trigger"
        }, {
            id: "options",
            type: "list",
            label: "Options",
            elementType: {
                type: "list",
                label: "option",
                elementType: [{
                    id: "toReplace",
                    type: "material",
                    label: "Material to replace"
                }, {
                    id: "toUse",
                    type: "material",
                    label: "Material to use"
                }, {
                    id: "uvScale",
                    type: "list",
                    label: "UV Scale",
                    elementType: "float"
                }]
            }
        }],
        vrCompatible: !0
    };
    WALK.Extensions.MaterialComboPicker._startedPickers = [];
    WALK.Extensions.MaterialComboPicker._menuButton = null;
    WALK.Extensions.MaterialComboPicker._menuPopup = null;
    WALK.Extensions.MaterialComboPicker._pickerOpened = !1;
    WALK.Extensions.VideoTextureControl = function(a) {
        function b() {
            var a = e.baseColorTexture
              , b = d.config;
            a.loop = b.loop;
            if (!b.autoplay)
                e.pause(),
                a.muted = b.muted;
            else if (!b.muted)
                d.viewerApi.onNextPageInteraction(function() {
                    a.muted = !1
                });
            b.trigger && d.addTrigger(b.trigger, function() {
                return d.trigger()
            })
        }
        function c() {
            var a = d.config;
            (e = d.viewerApi.findMaterial(a.material)) ? e.baseColorTexture && void 0 !== e.baseColorTexture.video ? e.baseColorTexture.addLoadedListener(b) : (console.error("Material '" + a.material + "' for video texture control '" + (a.name + "' does not have a video texture")),
            e = null) : console.error("Material '" + a.material + "' for video texture control '" + (a.name + "' does not exist"))
        }
        WALK.Extension.call(this, a);
        var d = this
          , e = null;
        this.viewerApi.isSceneReadyToDisplay() || this.viewerApi.setMaterialEditable(this.config.material);
        this.trigger = function(a) {
            !0 === a && e.isPlaying || !1 === a && !e.isPlaying || (e.isPlaying ? e.pause() : (d.config.playRewinds && e.rewind(),
            e.play()))
        }
        ;
        this.doStart = function() {
            this.viewerApi.onSceneLoadComplete(c)
        }
        ;
        this.doStop = function() {
            e && (e.baseColorTexture.muted = !0,
            e.pause(),
            e = null)
        }
    }
    ;
    WALK.Extensions.VideoTextureControl.definition = {
        name: "Video texture control",
        properties: [{
            id: "material",
            type: "material",
            label: "Material with video"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }, {
            id: "autoplay",
            type: "bool",
            label: "Autoplay",
            defaultValue: !0
        }, {
            id: "triggerExclusive",
            type: "bool",
            label: "Exclusive",
            defaultValue: !1
        }, {
            id: "playRewinds",
            type: "bool",
            label: "Play rewinds",
            defaultValue: !1
        }, {
            id: "loop",
            type: "bool",
            label: "Loop",
            defaultValue: !0
        }, {
            id: "muted",
            type: "bool",
            label: "Muted",
            defaultValue: !0
        }],
        vrCompatible: !0
    };
    WALK.Extensions.OpenWebsite = function(a) {
        WALK.Extension.call(this, a);
        var b = this;
        this.trigger = function() {
            b.viewerApi.openUrl(b.config.url, b.config.newWindow)
        }
        ;
        this.doStart = function() {
            this.viewerApi.onSceneReadyToDisplay(function() {
                b.config.trigger && b.addTrigger(b.config.trigger, function() {
                    return b.trigger()
                })
            })
        }
    }
    ;
    WALK.Extensions.OpenWebsite.definition = {
        name: "Open URL",
        properties: [{
            id: "url",
            type: "text",
            label: "URL"
        }, {
            id: "newWindow",
            type: "bool",
            label: "New window",
            defaultValue: !0
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }],
        vrCompatible: !0
    };
    WALK.Extensions.ChangeView = function(a) {
        WALK.Extension.call(this, a);
        var b = this
          , c = 0;
        this.trigger = function() {
            b.viewerApi.switchToView(b.config.views[c], void 0, b.config.doNotMoveCamera);
            c = (c + 1) % b.config.views.length
        }
        ;
        this.doStart = function() {
            var a = this.viewerApi;
            c = 0;
            a.onSceneReadyToDisplay(function() {
                b.config.trigger && b.addTrigger(b.config.trigger, function() {
                    return b.trigger()
                })
            })
        }
    }
    ;
    WALK.Extensions.ChangeView.definition = {
        name: "Change view",
        properties: [{
            id: "views",
            type: "list",
            elementType: "view",
            label: "Views to toggle"
        }, {
            id: "doNotMoveCamera",
            type: "bool",
            label: "Do not move camera",
            defaultValue: !1
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }],
        vrCompatible: !0
    };
    WALK.Extensions.HideAnchors = function(a) {
        function b(a) {
            h.src = a ? e.src : f.src
        }
        WALK.Extension.call(this, a);
        var c = this
          , d = c.viewerApi
          , e = WALK.preloadImage(d.getViewerAssetUrl("img/anchors-on.svg"))
          , f = WALK.preloadImage(d.getViewerAssetUrl("img/anchors-off.svg"))
          , g = null
          , h = null;
        this.trigger = function(a) {
            !0 === a && d.anchorsVisible || !1 === a && !d.anchorsVisible || (d.anchorsVisible = !d.anchorsVisible)
        }
        ;
        this.doStart = function() {
            d = c.viewerApi;
            d.onAnchorsVisibilityChanged(b);
            g = d.addMenuButton(e.src);
            h = d.getMenuButtonIcon(g);
            g.addEventListener("click", function() {
                return c.trigger()
            });
            var a = c.config;
            d.onSceneReadyToDisplay(function() {
                return d.anchorsVisible = a.visibleOnStart
            })
        }
        ;
        this.doStop = function() {
            d.removeAnchorsVisibilityChangedListener(b);
            d.removeMenuButton(g);
            h = g = null;
            d.anchorsVisible = !0
        }
    }
    ;
    WALK.Extensions.HideAnchors.definition = {
        name: "Hide triggers",
        properties: [{
            id: "visibleOnStart",
            type: "bool",
            label: "Visible on start",
            defaultValue: !0
        }],
        vrCompatible: !0
    };
    WALK.Extensions.Script = function(a) {
        function b() {
            c.trigger()
        }
        WALK.Extension.call(this, a);
        var c = this;
        this.trigger = function() {
            try {
                (new Function('"use strict"; ' + c.config.code))()
            } catch (d) {
                console.error("Script extension error: " + d)
            }
        }
        ;
        this.doStart = function() {
            var a = this;
            if (this.config.trigger)
                this.viewerApi.onSceneReadyToDisplay(function() {
                    return a.addTrigger(a.config.trigger, b)
                });
            else
                b()
        }
    }
    ;
    WALK.Extensions.Script.definition = {
        name: "Script",
        properties: [{
            id: "code",
            type: "textArea",
            label: "Code",
            defaultValue: "\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }],
        vrCompatible: !0
    };
    WALK.Extensions.ProjectionScreen = function(a) {
        function b() {
            return "node" === n.config.trigger.type
        }
        function c() {
            console.assert(!b());
            return n.triggers[0].material
        }
        function d() {
            var a = v.getVideoTexture1();
            r.baseColorTexture = a ? a : u
        }
        function e() {
            WALK.log("Presentation stop");
            v && (v.uuid === q.myUuid && q.stopShareScreen(),
            v.removeEventListener("dispose", e),
            v.removeEventListener("avatarUpdated", d));
            v = null;
            r.baseColorTexture = u;
            b() || (c().highlightMix = 0)
        }
        function f() {
            w ? w.close() : w = n.viewerApi.openPopup("In a 3D meeting this trigger will start a screen sharing on the " + (n.config.material + " material. Outside of a 3D meeting the trigger will be hidden."), {
                padding: !0,
                centerVertically: !0,
                centerHorizontally: !0
            }, function() {
                w = null
            })
        }
        function g() {
            var a = q.myUuid;
            v && v.getVideoTexture1() ? v.uuid === a && (WALK.log("Requesting presentation stop"),
            n.viewerApi.apiUserChangeState(p, null)) : (WALK.log("Requesting screen share " + a),
            q.startShareScreen(function() {
                n.viewerApi.apiUserChangeState(p, a)
            }, function() {
                n.viewerApi.apiUserChangeState(p, null)
            }, function() {}))
        }
        function h(a, f) {
            console.assert(a === p);
            f ? (v && v.uuid !== f && (WALK.log("Changing presenting user"),
            e()),
            v || (WALK.log("New presenting user " + f),
            (v = n.viewerApi.findAvatar(f) || null) ? (v.addEventListener("dispose", e),
            v.addEventListener("avatarUpdated", d),
            b() || (a = c(),
            a.highlight = v.getMainMaterial().baseColor,
            a.setUniforms(),
            a.highlightMix = .7),
            d()) : console.log("Cannot attach presentation stream of a user " + f + " The user was not found."))) : e()
        }
        function l() {
            h(p, n.viewerApi.getApiUserState(p))
        }
        function m(a) {
            var b = n.config;
            (r = n.viewerApi.findMaterial(b.material)) ? (q = a,
            u = r.baseColorTexture,
            n.addTrigger(b.trigger, g),
            n.viewerApi.onApiUserStateChanged(p, h),
            n.viewerApi._onAvatarListChanged(l)) : (console.error("Material for a projection screen is missing"),
            r = null)
        }
        WALK.Extension.call(this, a);
        var n = this
          , p = "ProjectionScreen:" + this.name
          , q = null
          , r = null
          , u = null
          , v = null
          , w = null;
        this.viewerApi.isSceneReadyToDisplay() || this.viewerApi.setMaterialEditable(this.config.material);
        this.doStart = function() {
            wk ? n.addTrigger(n.config.trigger, f) : this.viewerApi._onMeetingJoined(m)
        }
        ;
        this.doStop = function() {
            wk || (this.viewerApi._removeOnMeetingJoined(m),
            q && (this.viewerApi.removeOnApiUserStateChanged(p, h),
            this.viewerApi._removeOnAvatarListChanged(l)),
            r = q = null)
        }
    }
    ;
    WALK.Extensions.ProjectionScreen.definition = {
        name: "Meeting projection screen",
        properties: [{
            id: "material",
            type: "material",
            label: "Material to project on"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger"
        }],
        vrCompatible: !0
    };
    WALK.Extensions.SwitchObjects = function(a) {
        function b() {
            h.forEach(function(a) {
                return a.hide()
            });
            -1 === g ? h.length = 0 : (h = e.findNodesOfType(d.config.nodeTypes[g]),
            h.forEach(function(a) {
                return a.show()
            }));
            e.requestFrame()
        }
        function c(a, c) {
            console.assert(a === f);
            g = c;
            b()
        }
        WALK.Extension.call(this, a);
        var d = this, e = this.viewerApi, f = "SwitchObjects:" + this.name, g, h = [];
        if (!e.isSceneReadyToDisplay()) {
            a = k.makeIterator(this.config.nodeTypes);
            for (var l = a.next(); !l.done; l = a.next())
                e.setNodeTypeEditable(l.value)
        }
        this.trigger = function() {
            0 !== d.config.nodeTypes.length && (g += 1,
            g === d.config.nodeTypes.length && (g = d.config.hideAllAfterLast ? -1 : 0),
            e.apiUserChangeState(f, g))
        }
        ;
        this.doStart = function() {
            var a = this;
            e.onSceneReadyToDisplay(function() {
                for (var c = 0; c < a.config.nodeTypes.length; ++c)
                    if (0 < c || a.config.hideAllOnStart) {
                        var f = e.findNodesOfType(a.config.nodeTypes[c]);
                        f = k.makeIterator(f);
                        for (var h = f.next(); !h.done; h = f.next())
                            h.value.hide()
                    }
                g = 0 < a.config.nodeTypes.length && !a.config.hideAllOnStart ? 0 : -1;
                b();
                a.config.trigger && a.addTrigger(a.config.trigger, function() {
                    return d.trigger()
                })
            });
            this.viewerApi.onApiUserStateChanged(f, c)
        }
        ;
        this.doStop = function() {
            for (var a = 0; a < this.config.nodeTypes.length; ++a)
                if (a !== g) {
                    var b = e.findNodesOfType(this.config.nodeTypes[a]);
                    b = k.makeIterator(b);
                    for (var c = b.next(); !c.done; c = b.next())
                        c.value.show()
                }
            e.requestFrame()
        }
    }
    ;
    WALK.Extensions.SwitchObjects.definition = {
        name: "Switch objects",
        properties: [{
            id: "nodeTypes",
            type: "list",
            elementType: "nodeType",
            label: "Objects to switch"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }, {
            id: "hideAllOnStart",
            type: "bool",
            label: "Hide all on start",
            defaultValue: !1
        }, {
            id: "hideAllAfterLast",
            type: "bool",
            label: " Hide all after last",
            defaultValue: !1
        }],
        vrCompatible: !0
    };
    WALK.Extensions.VideoStream = function(a) {
        function b() {
            function a(a) {
                var b = document.createElement("video");
                b.classList.add("video-js");
                b.autoplay = !0;
                b.muted = !0;
                b.type = "application/x-mpegURL";
                if (Hls.isSupported()) {
                    var c = new Hls;
                    c.loadSource(a);
                    c.attachMedia(b)
                } else
                    b.canPlayType("application/vnd.apple.mpegurl") ? b.src = a : console.log("No Hls support");
                return h.createStreamTextureFromHtmlVideo(b)
            }
            (function() {
                var b = a(l.config.streamUrl);
                b.addLoadedListener(function() {
                    g = !1;
                    l.running && (console.log(b),
                    d = e.baseColorTexture,
                    e.baseColorTexture = b,
                    l.viewerApi.onNextPageInteraction(function() {
                        b.muted = !1
                    }),
                    f = !0)
                });
                g = !0;
                b.play();
                return !0
            }
            )()
        }
        function c() {
            var a = l.config;
            (e = h.findMaterial(a.material)) ? e.baseColorTexture ? WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/Hls.js"), function() {
                a.trigger && l.addTrigger(a.trigger, function() {
                    return l.trigger()
                });
                !a.autoplay && a.trigger || l.trigger()
            }, function() {
                return Ba.error("Cannot load required library")
            }) : (console.error("Material '" + a.material + "' for stream texture control '" + (a.name + "' does not have a stream texture")),
            e = null) : console.error("Material '" + a.material + "' for stream texture control '" + (a.name + "' does not exist"))
        }
        WALK.Extension.call(this, a);
        var d = null
          , e = null
          , f = !1
          , g = !1
          , h = WALK.getViewer()
          , l = this;
        this.viewerApi.isSceneReadyToDisplay() || this.viewerApi.setMaterialEditable(this.config.material);
        this.trigger = function(a) {
            g || (f || g ? !0 === a && e.isPlaying || !1 === a && !e.isPlaying || (e.isPlaying ? e.pause() : (l.config.playRewinds && e.rewind(),
            e.play())) : !1 !== a && b())
        }
        ;
        this.doStart = function() {
            this.viewerApi.onSceneLoadComplete(c)
        }
        ;
        this.doStop = function() {
            if (e) {
                if (f) {
                    f = !1;
                    var a = e.baseColorTexture;
                    e.baseColorTexture = d;
                    a.dispose();
                    d = null
                }
                e = null
            }
        }
    }
    ;
    WALK.Extensions.VideoStream.definition = {
        name: "Video Stream",
        properties: [{
            id: "material",
            type: "material",
            label: "Material with stream"
        }, {
            id: "streamUrl",
            type: "text",
            label: "Stream URL"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }, {
            id: "autoplay",
            type: "bool",
            label: "Autoplay",
            defaultValue: !0
        }, {
            id: "triggerExclusive",
            type: "bool",
            label: "Exclusive",
            defaultValue: !1
        }, {
            id: "playRewinds",
            type: "bool",
            label: "Play rewinds",
            defaultValue: !1
        }],
        vrCompatible: !0
    };
    function Ck(a) {
        var b = k.makeIterator(a.split(":"));
        a = b.next().value;
        b = b.next().value;
        return [a, b]
    }
    WALK.Extensions.MultiTrigger = function(a) {
        function b() {
            return e.config.extensions.map(function(a) {
                var b = k.makeIterator(Ck(a));
                a = b.next().value;
                b = b.next().value;
                return f.getExtension(a, b)
            }).filter(function(a) {
                return a
            })
        }
        function c(a, c) {
            a = k.makeIterator(b());
            for (var d = a.next(); !d.done; d = a.next()) {
                d = d.value;
                try {
                    d.triggerAtPosition ? d.triggerAtPosition(g, c) : d.trigger(g)
                } catch (n) {
                    console.error("Failed to trigger an extension " + n)
                }
            }
            g = !g
        }
        function d() {
            var a = e.config;
            a.trigger && e.addTrigger(a.trigger, c)
        }
        WALK.Extension.call(this, a);
        var e = this
          , f = this.viewerApi
          , g = !0;
        Object.defineProperty(this, "vrCompatible", {
            get: function() {
                for (var a = k.makeIterator(b()), c = a.next(); !c.done; c = a.next())
                    if (!c.value.vrCompatible)
                        return !1;
                return !0
            }
        });
        this.doStart = function() {
            f.onSceneReadyToDisplay(d);
            g = !0
        }
    }
    ;
    WALK.Extensions.MultiTrigger.definition = {
        name: "Multi trigger",
        getListElementsToAdd: function(a, b, c) {
            console.assert("extensions" === a);
            var d = new Set(b.map(function(a) {
                return Ck(a)[0]
            }));
            return c.getEditableExtensions().filter(function(a) {
                return a.isTriggerable() && ("VideoTextureControl" === a.type || "SwitchObjects" === a.type || !d.has(a.type))
            }).map(function(a) {
                return a.type + ":" + a.name
            })
        },
        formatListElement: function(a) {
            var b = k.makeIterator(Ck(a));
            a = b.next().value;
            b = b.next().value;
            return WALK.ExtensionManager.getExtensionDefinition(a).name + ": " + b
        },
        properties: [{
            id: "extensions",
            type: "list",
            elementType: "string",
            label: "Extensions to trigger",
            elementLabel: "extension"
        }, {
            id: "trigger",
            type: "trigger",
            label: "Trigger",
            optional: !0
        }]
    };
    var Dk = {};
    function Ek(a) {
        a.style.display = ""
    }
    function Fk(a) {
        a.style.display = "none"
    }
    function Gk(a) {
        var b = null
          , c = null;
        this.showDismiss = !0;
        this.onDismiss = this.onClose = null;
        this.position = Gk.DEFAULT;
        this.modal = this.foremost = !1;
        this.open = function() {
            null === c && (this.modal ? (b = document.createElement("div"),
            b.className = "modal-backdrop",
            document.body.appendChild(b),
            c = document.createElement("div"),
            b.appendChild(c)) : (c = document.createElement("div"),
            document.body.appendChild(c)),
            this.update(a))
        }
        ;
        this.hide = function() {
            b ? Fk(b) : Fk(c)
        }
        ;
        this.unhide = function() {
            b ? Ek(b) : Ek(c)
        }
        ;
        this.update = function(a) {
            var b = this
              , d = this.showDismiss ? '<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>' : ""
              , g = function() {
                switch (b.position) {
                case Gk.TOP:
                    return "ui-top ui-center";
                case Gk.DEFAULT:
                    return "ui-upper-half-center";
                case Gk.CENTER:
                    return "ui-all-center";
                default:
                    return console.log("Invalid popup position: " + b.position),
                    "ui-all-center"
                }
            }();
            c.innerHTML = '\n       <div class="ext-popup ' + g + " " + (this.foremost ? "ui-foremost" : "") + '">\n         <div class="ext-popup-content">\n           ' + a + "\n         </div>" + d + "\n       </div>";
            Mc(c);
            this.showDismiss && (a = c.getElementsByClassName("ext-popup-close-button-panel")[0],
            Kc(a, function() {
                return b.dismiss()
            }))
        }
        ;
        this.getElementsByClassName = function(a) {
            return c.getElementsByClassName(a)
        }
        ;
        this.dismiss = function() {
            if (null !== c && (this.close(),
            this.onDismiss))
                this.onDismiss()
        }
        ;
        this.close = function() {
            if (null !== c && (this.modal ? (document.body.removeChild(b),
            b = null) : document.body.removeChild(c),
            c = null,
            this.onClose))
                this.onClose()
        }
    }
    Gk.CENTER = "center";
    Gk.DEFAULT = "default";
    Gk.TOP = "top";
    Dk = {
        removeChildren: function(a) {
            for (; a.firstChild; )
                a.removeChild(a.firstChild)
        },
        addChangeHandler: function(a, b) {
            document.getElementById(a).onchange = b
        },
        show: Ek,
        hide: Fk,
        setVisibility: function(a, b) {
            b ? Ek(a) : Fk(a)
        },
        setButtonHighlight: function(a, b) {
            b ? a.classList.add("ext-meeting-button-highlight") : a.classList.remove("ext-meeting-button-highlight")
        },
        highlightInput: function(a) {
            a.classList.add("ext-meeting-input-missing");
            window.setTimeout(function() {
                a.classList.remove("ext-meeting-input-missing")
            }, 200)
        },
        highlightText: function(a) {
            a.classList.add("ext-meeting-text-highlighted");
            window.setTimeout(function() {
                a.classList.remove("ext-meeting-text-highlighted")
            }, 200)
        },
        UiPopup: Gk,
        showMessage: function(a, b) {
            var c = "";
            b && (c = '<h3 class="ext-meeting-dialog-title">' + b + "</h3>");
            var d = new Gk(c + ('\n      <div class="ext-meeting-dialog-message">\n        ' + a + '\n      </div>\n      <div class="ext-meeting-dialog-buttons">\n        <button class="ext-meeting-button">\n          Close\n        </button>\n      </div>\n    '));
            d.showDismiss = !1;
            d.foremost = !0;
            d.modal = !0;
            d.open();
            d.getElementsByClassName("ext-meeting-button")[0].onclick = function() {
                d.close()
            }
        },
        showIframePopup: function(a, b, c) {
            var d = new Gk('\n      <div class="ext-meeting-dialog-iframe-container">\n        <h3 class="ext-meeting-dialog-title">' + a + '</h3>\n        <iframe src="' + b + '" class="ext-meeting-dialog-iframe">\n        </iframe>\n        <div>\n          <div class="ext-meeting-dialog-buttons">\n            <button class="ext-meeting-button">\n              Close\n            </button>\n          </div>\n        </div>\n      <div>\n    ');
            d.showDismiss = !1;
            d.position = Gk.CENTER;
            d.onClose = c;
            d.open();
            var e = d.getElementsByClassName("ext-meeting-dialog-iframe")[0];
            e.style.visibility = "hidden";
            e.onload = function() {
                e.style.visibility = "visible"
            }
            ;
            d.getElementsByClassName("ext-meeting-button")[0].onclick = function() {
                return d.close()
            }
        }
    };
    var Hk = {}
      , Ik = null;
    function Jk() {
        null === Ik && (Ik = new (window.AudioContext || window.webkitAudioContext));
        return Ik
    }
    function Kk(a, b, c) {
        this._frequencyDiv = b;
        this._noSoundThreshold = c;
        this._maxFrequencyIndex = this._minFrequencyIndex = -1;
        this._noSoundCalls = 0;
        this._source = null;
        this._analyser = Jk().createAnalyser();
        this._analyser.fftSize = 2 * this._frequencyDiv;
        this._analyser.smoothingTimeConstant = .5;
        a = new MediaStream([a.mediaStreamTrack]);
        this._source = Jk().createMediaStreamSource(a);
        this._source.connect(this._analyser);
        a = Jk().sampleRate / this._frequencyDiv;
        this._minFrequencyIndex = Math.floor(Kk._minVoiceFrequency / a);
        this._maxFrequencyIndex = Math.floor(Kk._maxVoiceFrequency / a);
        this._dataArray = new Uint8Array(this._maxFrequencyIndex + 1)
    }
    Kk.prototype.measureSoundVolume = function() {
        var a = this._getOverallSoundVolume();
        return this._shouldSkipNoSoundNotification(a) ? null : a
    }
    ;
    Kk.prototype.dispose = function() {
        null !== this._source && (this._source.disconnect(),
        this._source = null)
    }
    ;
    Kk.prototype._getOverallSoundVolume = function() {
        this._analyser.getByteFrequencyData(this._dataArray);
        for (var a = 0, b = this._minFrequencyIndex; b <= this._maxFrequencyIndex; b++)
            this._dataArray[b] > a && (a = this._dataArray[b]);
        return a
    }
    ;
    Kk.prototype._shouldSkipNoSoundNotification = function(a) {
        if (a < this._noSoundThreshold)
            return this._noSoundCalls++,
            this._noSoundCalls < Kk._skippedNoSoundCalls;
        this._noSoundCalls = 0;
        return !1
    }
    ;
    Kk._minVoiceFrequency = 85;
    Kk._maxVoiceFrequency = 350;
    Kk._skippedNoSoundCalls = 3;
    function Lk(a, b, c, d) {
        this._width = a;
        this._height = b;
        this._bottomMargin = void 0 !== d ? d : 0;
        this._volumeRect = null;
        this._rectId = Lk._baseRectId + Lk._counter;
        Lk._counter++;
        this._noSoundThreshold = c;
        this._lengthCoef = a / (255 - this._noSoundThreshold)
    }
    Lk.prototype.getHTML = function() {
        this._volumeRect = null;
        return '\n        <svg style="filter: drop-shadow(0px 0px 1px black);\n                    margin-bottom: ' + this._bottomMargin.toString() + 'px;"\n             width="' + this._width.toString() + 'px"\n             height="' + this._height.toString() + 'px">\n          <rect id="' + this._rectId + '"\n                x = "' + (this._width / 2 - 1).toString() + '" y = "0"\n                width="' + (1).toString() + '"\n                height="' + this._height.toString() + '"\n                fill="red"/>\n        </svg>\n      '
    }
    ;
    Lk.prototype.getEmptyHTML = function() {
        return '\n        <svg width="' + this._width.toString() + 'px"\n             height="' + this._height.toString() + 'px">\n        </svg>\n      '
    }
    ;
    Lk.prototype.update = function(a) {
        null === this._volumeRect && (this._volumeRect = document.getElementById(this._rectId));
        console.assert(null !== this._volumeRect, "Volume visualizer HTML not attached to any element");
        if (null !== a) {
            var b = this._getColor(a)
              , c = Math.max(Lk._minimalDisplayedValue, Math.max(a, this._noSoundThreshold) - this._noSoundThreshold);
            a = this._width / 2 - c * this._lengthCoef / 2;
            c *= this._lengthCoef;
            this._volumeRect.setAttribute("fill", b);
            this._volumeRect.setAttribute("x", a.toString());
            this._volumeRect.setAttribute("width", c.toString())
        }
    }
    ;
    Lk.prototype._getColor = function(a) {
        return a < this._noSoundThreshold ? "red" : a < Lk._lowSoundThreshold ? "orange" : "green"
    }
    ;
    Lk._counter = 0;
    Lk._baseRectId = "ext-meeting-mic-bar-";
    Lk._lowSoundThreshold = 180;
    Lk._minimalDisplayedValue = 20;
    Hk = {
        VolumeMeter: Kk,
        VolumeVisualizer: Lk
    };
    var Mk, Nk = {
        name: "mic"
    }, Ok = {
        name: "camera",
        facingMode: "user",
        width: 480,
        height: 360,
        frameRate: 24
    };
    function Pk(a, b) {
        return a ? b[0].toUpperCase() + b.slice(1) : b[0].toLowerCase() + b.slice(1)
    }
    function Qk(a, b) {
        var c = void 0 !== b;
        c = Pk(!0, a.name) + (c ? " and " + Pk(!1, b.name) : "");
        a = a.error.name;
        console.assert(void 0 === b || b.error.name === a);
        return "NotFoundError" === a ? c + " not found" : "NotAllowedError" === a ? c + " blocked" : "Error" === a ? "Error" : c + " not available"
    }
    function Rk(a, b) {
        var c = void 0 !== b
          , d = c ? "they are" : "it is"
          , e = c ? "them" : "it"
          , f = a.error.name;
        return "NotFoundError" === f ? "Check if your " + (Pk(!1, a.name) + (c ? " and " + Pk(!1, b.name) : "")) + " " + (c ? "are" : "is") + " properly connected." : "NotAllowedError" === f ? WALK.DETECTOR.mobile ? WALK.DETECTOR.ios ? "Unblock " + e + " by clicking " + (c ? a.unblockIcon + " and " + b.unblockIcon : "the " + a.unblockIcon) + " " + (c ? "buttons" : "button") + "." : "Unblock " + e + " in the browser settings for this webpage." : "Unblock " + e + " by clicking the " + (c ? b.unblockIcon : a.unblockIcon) + " button in the browser\u2019s address bar and refresh the webpage." : "Error" === f ? "Your browser doesn't support video meetings. Open the meeting link in another browser." : "If " + d + " connected, close all other applications using " + (e + " and refresh the webpage.")
    }
    function Sk(a, b, c, d) {
        this._firstErrorDiv = document.getElementById(a);
        this._secondErrorDiv = document.getElementById(b);
        this._devicePreview1 = c;
        this._devicePreview2 = d
    }
    Sk.prototype._reset = function() {
        this._devicePreview1.setErrorDiv(null);
        this._devicePreview2.setErrorDiv(null);
        Dk.removeChildren(this._firstErrorDiv);
        Dk.removeChildren(this._secondErrorDiv)
    }
    ;
    Sk.prototype._displayAndLogErrorMessage = function(a, b, c) {
        function d(a) {
            if (void 0 !== a)
                return a.device
        }
        var e = Qk(b.device, d(c))
          , f = Rk(b.device, d(c));
        a.innerHTML = '\n        <div class="ext-meeting-join-error-title">' + e + '</div>\n        <div class="ext-meeting-join-error-description">' + f + "</div>\n      ";
        b.setErrorDiv(a);
        b.device.logError();
        void 0 !== c && (c.setErrorDiv(a),
        c.device.logError())
    }
    ;
    Sk.prototype.update = function() {
        this._reset();
        var a = this._devicePreview1.device.error
          , b = this._devicePreview2.device.error;
        if (null !== a || null !== b)
            null !== a && null !== b ? a.name === b.name ? this._displayAndLogErrorMessage(this._firstErrorDiv, this._devicePreview1, this._devicePreview2) : (this._displayAndLogErrorMessage(this._firstErrorDiv, this._devicePreview1),
            this._displayAndLogErrorMessage(this._secondErrorDiv, this._devicePreview2)) : null !== a ? this._displayAndLogErrorMessage(this._firstErrorDiv, this._devicePreview1) : this._displayAndLogErrorMessage(this._firstErrorDiv, this._devicePreview2)
    }
    ;
    function Tk(a, b) {
        this._name = a;
        this._active = !1;
        this._unblockIcon = b;
        this._error = this._track = this._trackOptions = null
    }
    Tk.prototype.logError = function() {
        null !== this._error && WALK.log("Can't create local " + this.name + " track : " + (this._error.name + ", " + this._error.message))
    }
    ;
    Tk.prototype._getLabel = function() {
        return this._track ? this._track.mediaStreamTrack.label : null
    }
    ;
    Tk.prototype.getId = function() {
        return this._trackOptions && this._trackOptions.deviceId ? this._trackOptions.deviceId.exact : null
    }
    ;
    Tk.prototype.getErrorMessageInfo = function() {
        if (null === this._error)
            return null;
        var a = Qk(this)
          , b = Rk(this);
        return {
            title: a,
            description: b
        }
    }
    ;
    k.global.Object.defineProperties(Tk.prototype, {
        name: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._name
            }
        },
        track: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._track
            },
            set: function(a) {
                this._track = a
            }
        },
        active: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._active
            },
            set: function(a) {
                this._active = a
            }
        },
        unblockIcon: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._unblockIcon
            }
        },
        error: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._error
            },
            set: function(a) {
                this._error = a
            }
        },
        trackOptions: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._trackOptions
            },
            set: function(a) {
                this._trackOptions = a
            }
        }
    });
    function Uk(a, b, c, d, e, f, g) {
        this._device = new Tk(a,g);
        this._width = c;
        this._height = d;
        this._toggleButton = document.getElementById(e);
        this._previewContainer = document.getElementById(f);
        this._errorDiv = null;
        this._meetingStarter = b;
        Lc(this._toggleButton.id, this._onToggleButtonClicked.bind(this));
        this._onStoppedBound = this._onStopped.bind(this);
        this._twilioCreateTrackFunction = null
    }
    Uk.prototype.isAvailable = function() {
        return null !== this._device.track
    }
    ;
    Uk.prototype.dispose = function() {
        null !== this._device.track && this._device.track.removeListener("stopped", this._onStoppedBound);
        this._close()
    }
    ;
    Uk.prototype._pauseMonitoringTrackBeforeReset = function() {
        this._device.track.removeListener("stopped", this._onStoppedBound)
    }
    ;
    Uk.prototype._resumeMonitoringTrackAfterReset = function() {
        this._device.track.addListener("stopped", this._onStoppedBound)
    }
    ;
    Uk.prototype.setErrorDiv = function(a) {
        this._errorDiv = a
    }
    ;
    Uk.prototype.showInTestNeededMode = function() {
        this.setError({
            name: "Test needed"
        })
    }
    ;
    Uk.prototype.showInPreviewMode = function() {
        this.setError({
            name: "Initializing"
        });
        this.setToggleButtonVisibility(!0)
    }
    ;
    Uk.prototype.createTrack = function(a) {
        var b = this;
        return new Promise(function(c) {
            var d = a ? a : b._device.trackOptions;
            b._twilioCreateTrackFunction(WALK.cloneObject(d)).then(function(a) {
                b.setTrack(a, d)
            }).catch(function(a) {
                b.setTrack(null, d, a)
            }).finally(function() {
                b._toggleButton.disabled = !1;
                c()
            })
        }
        )
    }
    ;
    Uk.prototype.updateTrackDeviceId = function(a) {
        function b(a, b) {
            return (a = a.find(function(a) {
                return a.label === b
            })) ? a.deviceId : null
        }
        if (this._device.track && !this._device.trackOptions.deviceId) {
            var c = this._device._getLabel();
            a = b(a, c);
            console.assert(null !== a, "deviceId not found");
            this._device.trackOptions = {
                name: this._device.trackOptions.name,
                deviceId: {
                    exact: a
                }
            }
        }
    }
    ;
    Uk.prototype.setTrack = function(a, b, c) {
        b && (this._device.trackOptions = b);
        null !== a && void 0 !== c ? console.assert("Invalid setTrack parameters : track and error set") : null === a && void 0 === c && console.assert("Invalid setTrack parameters : track and error not set");
        this._disposeTrack();
        this._device.track = a;
        null !== this._device.track ? (this._device.track.on("stopped", this._onStoppedBound),
        this._device.active = !0,
        this._showTrack(),
        this.setError(null)) : (this._device.active = !1,
        this._hideTrack(),
        this.setError(c));
        this._meetingStarter.updateErrorMessage();
        this._updateToggleButtonState()
    }
    ;
    Uk.prototype.setError = function(a) {
        this._device.error = a
    }
    ;
    Uk.prototype.restartTrack = function(a) {
        var b = this;
        this._toggleButton.disabled = !0;
        this.isAvailable() ? (this._pauseMonitoringTrackBeforeReset(),
        this._device.trackOptions = a,
        this._device.track.restart(WALK.cloneObject(a)).then(function() {
            b._resumeMonitoringTrackAfterReset();
            b._meetingStarter.updateErrorMessage();
            b._toggleButton.disabled = !1
        }).catch(function() {
            WALK.log("Second attempt to create track,device: " + b._device.name);
            window.setTimeout(function() {
                return b.createTrack(a)
            }, 1E3)
        })) : this.createTrack(a)
    }
    ;
    Uk.prototype.setToggleButtonVisibility = function(a) {
        Dk.setVisibility(this._toggleButton, a)
    }
    ;
    Uk.prototype._updateToggleButtonState = function() {
        this._device.active ? (Dk.setButtonHighlight(this._toggleButton, !1),
        Dk.setVisibility(this._toggleButton.children[0], !0),
        Dk.setVisibility(this._toggleButton.children[1], !1)) : (Dk.setButtonHighlight(this._toggleButton, !0),
        Dk.setVisibility(this._toggleButton.children[0], !1),
        Dk.setVisibility(this._toggleButton.children[1], !0))
    }
    ;
    Uk.prototype._disposeTrack = function() {
        if (null !== this._device.track) {
            var a = this._device.track;
            a.removeListener("stopped", this._onStoppedBound);
            a.detach();
            a.stop()
        }
        this._device.track = null
    }
    ;
    Uk.prototype._onStopped = function() {
        null !== this._device.track && this.setTrack(null, null, {
            name: "NotReadableError",
            message: "Stopped"
        })
    }
    ;
    Uk.prototype._close = function() {
        Dk.removeChildren(this._previewContainer)
    }
    ;
    Uk.prototype._setPreviewInnerHTML = function(a) {
        this._close();
        this._previewContainer.innerHTML = a;
        Dk.show(this._previewContainer)
    }
    ;
    Uk.prototype._setPreviewElement = function(a) {
        this._close();
        null !== a && (a.style.width = this._width.toString() + "px",
        a.style.height = this._height.toString() + "px",
        this._previewContainer.appendChild(a),
        Dk.show(this._previewContainer))
    }
    ;
    Uk.prototype._showTrack = function() {
        this._device.active = !0;
        this._device.track.enable()
    }
    ;
    Uk.prototype._hideTrack = function() {
        this._device.active = !1
    }
    ;
    Uk.prototype._onToggleButtonClicked = function() {
        var a = this;
        this.isAvailable() ? (this._device.active ? this._onSwitchOff() : this._onSwitchOn(),
        this._updateToggleButtonState()) : this.createTrack().then(function() {
            a._device.error && Dk.highlightText(a._errorDiv)
        })
    }
    ;
    Uk.prototype._onSwitchOff = function() {
        this._hideTrack();
        this._device.track.disable()
    }
    ;
    Uk.prototype._onSwitchOn = function() {
        this._showTrack();
        this._device.track.enable()
    }
    ;
    k.global.Object.defineProperties(Uk.prototype, {
        device: {
            configurable: !0,
            enumerable: !0,
            get: function() {
                return this._device
            }
        }
    });
    function Vk(a, b, c, d, e) {
        Uk.call(this, "Camera", a, b, c, d, e, '<span class="fa-video-slash"></span>');
        this._twilioCreateTrackFunction = Twilio.Video.createLocalVideoTrack;
        this._device.trackOptions = Ok
    }
    k.inherits(Vk, Uk);
    Vk.prototype.showInTestNeededMode = function() {
        Uk.prototype.showInTestNeededMode.call(this);
        this._showPlaceholder()
    }
    ;
    Vk.prototype.showInPreviewMode = function() {
        Uk.prototype.showInPreviewMode.call(this);
        this._showPlaceholder()
    }
    ;
    Vk.prototype._showPlaceholder = function() {
        this._setPreviewInnerHTML('\n        <div class="ext-meeting-join-camera-preview-placeholder">\n          <span class="fa-video absolute-center"></span>\n        </div>\n      ')
    }
    ;
    Vk.prototype._hideTrack = function() {
        Uk.prototype._hideTrack.call(this);
        this._showPlaceholder()
    }
    ;
    Vk.prototype._showTrack = function() {
        Uk.prototype._showTrack.call(this);
        this._setPreviewElement(this._device.track.attach())
    }
    ;
    Vk.prototype._onSwitchOff = function() {
        Uk.prototype._onSwitchOff.call(this);
        this.setTrack(null, null, null)
    }
    ;
    function Wk(a, b, c, d, e) {
        Uk.call(this, "Microphone", a, b, c, d, e, '<span class="fa-microphone-slash"></span>');
        this._noSoundThreshold = 80;
        this._volumeVisualizer = new Hk.VolumeVisualizer(b,c,this._noSoundThreshold);
        this._measurementIntervalId = this._volumeMeter = null;
        this._twilioCreateTrackFunction = Twilio.Video.createLocalAudioTrack;
        this._device.trackOptions = Nk
    }
    k.inherits(Wk, Uk);
    Wk.prototype.showInTestNeededMode = function() {
        Uk.prototype.showInTestNeededMode.call(this);
        this._setPreviewElement(null)
    }
    ;
    Wk.prototype.showInPreviewMode = function() {
        Uk.prototype.showInPreviewMode.call(this);
        this._setPreviewElement(null)
    }
    ;
    Wk.prototype.dispose = function() {
        this._isMeasurementActive() && this._stopMeasurement();
        Uk.prototype.dispose.call(this)
    }
    ;
    Wk.prototype._measure = function() {
        this._volumeVisualizer.update(this._volumeMeter.measureSoundVolume())
    }
    ;
    Wk.prototype._hideTrack = function() {
        Uk.prototype._hideTrack.call(this);
        this._isMeasurementActive() && this._stopMeasurement();
        this._setPreviewElement(null)
    }
    ;
    Wk.prototype._showTrack = function() {
        Uk.prototype._showTrack.call(this);
        this._setPreviewInnerHTML(this._volumeVisualizer.getHTML());
        this._startMeasurement()
    }
    ;
    Wk.prototype._startMeasurement = function() {
        var a = this;
        this._volumeMeter = new Hk.VolumeMeter(this._device.track,512,this._noSoundThreshold);
        this._measurementIntervalId = setInterval(function() {
            return a._measure()
        })
    }
    ;
    Wk.prototype._stopMeasurement = function() {
        clearInterval(this._measurementIntervalId);
        this._measurementIntervalId = null;
        this._volumeMeter.dispose();
        this._volumeMeter = null
    }
    ;
    Wk.prototype._isMeasurementActive = function() {
        return null !== this._measurementIntervalId
    }
    ;
    Wk.prototype._pauseMonitoringTrackBeforeReset = function() {
        Uk.prototype._pauseMonitoringTrackBeforeReset.call(this);
        this._isMeasurementActive() && this._stopMeasurement()
    }
    ;
    Wk.prototype._resumeMonitoringTrackAfterReset = function() {
        Uk.prototype._resumeMonitoringTrackAfterReset.call(this);
        this._startMeasurement()
    }
    ;
    Wk.prototype._disposeTrack = function() {
        this._isMeasurementActive() && this._stopMeasurement();
        Uk.prototype._disposeTrack.call(this)
    }
    ;
    Mk = function(a, b) {
        this._onJoinCallback = a;
        this._joinMode = !1;
        this._dialog = null;
        this._mediaInitialized = this._preflightTestDone = !1;
        this._micVolumePreview = this._cameraPreview = null;
        this._cameraPreviewHeight = 198;
        this._cameraPreviewWidth = 264;
        this._micVolumePreviewHeight = 4;
        this._micVolumePreviewWidth = 40;
        this._onDevicesChangedBound = this._onDevicesChanged.bind(this);
        this._errorMessageActive = !0;
        this._runPrefilghtTest(b)
    }
    ;
    Mk.prototype.show = function() {
        var a = this;
        this._blurHelp();
        this._createDialog();
        this._cameraPreview = new Vk(this,this._cameraPreviewWidth,this._cameraPreviewHeight,"ext-meeting-join-camera-toggle","ext-meeting-join-camera-preview-container");
        this._micVolumePreview = new Wk(this,this._micVolumePreviewWidth,this._micVolumePreviewHeight,"ext-meeting-join-mic-toggle","ext-meeting-join-mic-volume-container");
        this._errorMessageGenerator = new Sk("ext-meeting-join-first-error","ext-meeting-join-second-error",this._micVolumePreview,this._cameraPreview);
        this._setupDevicesSelection();
        this._checkPermissions().then(function() {
            a._runPreviewMode(!1);
            a._createMediaTracksSeparately(Ok, Nk, function() {
                return a._onMediaInitialized()
            })
        }).catch(function(b) {
            void 0 !== b && WALK.log("Error checking audio/video devices permissions: " + b.name + ": " + b.message);
            a._runTestNeededMode()
        })
    }
    ;
    Mk.prototype._checkPermissions = function() {
        return new Promise(function(a, b) {
            return navigator.mediaDevices.enumerateDevices().then(function(c) {
                var d = c.filter(function(a) {
                    return "audioinput" === a.kind && "" !== a.deviceId && "" !== a.label
                });
                c = c.filter(function(a) {
                    return "videoinput" === a.kind && "" !== a.deviceId && "" !== a.label
                });
                0 < d.length || 0 < c.length ? a() : b()
            }).catch(function(a) {
                b(a)
            })
        }
        )
    }
    ;
    Mk.prototype._setupDevicesSelection = function() {
        var a = this;
        Dk.addChangeHandler("ext-meeting-join-select-camera", function(b) {
            a._cameraPreview.restartTrack({
                name: "camera",
                deviceId: {
                    exact: b.currentTarget.value
                }
            })
        });
        Dk.addChangeHandler("ext-meeting-join-select-microphone", function(b) {
            a._micVolumePreview.restartTrack({
                name: "mic",
                deviceId: {
                    exact: b.currentTarget.value
                }
            })
        });
        navigator.mediaDevices.addEventListener("devicechange", this._onDevicesChangedBound)
    }
    ;
    Mk.prototype._onDevicesChanged = function() {
        if (this._joinMode) {
            var a = this._cameraPreview.device.error
              , b = this._micVolumePreview.device.error;
            a || b ? this._createMediaTracksSeparately(a ? Ok : null, b ? Nk : null) : this._fillDevicesSelectControls()
        }
    }
    ;
    Mk.prototype._fillDevicesSelectControls = function() {
        var a = this;
        navigator.mediaDevices.enumerateDevices().then(function(b) {
            a._cameraPreview.updateTrackDeviceId(b);
            a._micVolumePreview.updateTrackDeviceId(b);
            var c = b.filter(function(a) {
                return "audioinput" === a.kind
            });
            a._fillDevicesSelectControl(c, "ext-meeting-join-select-microphone-container", "ext-meeting-join-select-microphone", a._micVolumePreview.device.getId());
            b = b.filter(function(a) {
                return "videoinput" === a.kind
            });
            a._fillDevicesSelectControl(b, "ext-meeting-join-select-camera-container", "ext-meeting-join-select-camera", a._cameraPreview.device.getId())
        })
    }
    ;
    Mk.prototype._fillDevicesSelectControl = function(a, b, c, d) {
        b = document.getElementById(b);
        var e = document.getElementById(c);
        Dk.setVisibility(b, 1 < a.length);
        Dk.removeChildren(e);
        1 < a.length && (a.forEach(function(a) {
            var b = document.createElement("option");
            b.value = "" + a.deviceId;
            WALK.setTextContent(b, "" + a.label);
            e.appendChild(b)
        }),
        e.value = d)
    }
    ;
    Mk.prototype._createDialog = function() {
        var a = this;
        this._dialog = new Dk.UiPopup('\n        <h3 class="ext-meeting-dialog-title">Join 3D meeting</h3>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-name-label">\n            Name:\n          </div>\n          <input type="text" id="ext-meeting-join-name"\n                 class="ext-meeting-join-input"\n                 autocomplete="off">\n          </input>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-main-container">\n            <div id="ext-meeting-join-error-container"\n                 class="absolute-vertical-center">\n              <div id="ext-meeting-join-first-error"></div>\n              <div id="ext-meeting-join-second-error"></div>\n            </div>\n            <div id="ext-meeting-join-camera-preview-container"></div>\n            <div id="ext-meeting-join-mic-volume-container"></div>\n            <div id="ext-meeting-join-preview-toggle-container"\n                 class="absolute-horizontal-center">\n              <button id="ext-meeting-join-mic-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-microphone" style="display: none"></span>\n                <span class="fa-microphone-slash"></span>\n              </button>\n              <button id="ext-meeting-join-camera-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-video" style="display: none"></span>\n                <span class="fa-video-slash"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-select-camera-container"\n               style="display: none">\n            Camera:\n            <select id="ext-meeting-join-select-camera"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n          <div id="ext-meeting-join-select-microphone-container"\n               style="display: none">\n            Microphone:\n            <select id="ext-meeting-join-select-microphone"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n        </div>\n        <div id="ext-meeting-join-network-error-container" style="display: none">\n          <div>Network issues detected.</div>\n          <div>\n            <a href="https://networktest.twilio.com/" style="color: white" target="_blank">\n              Diagnose your connection.\n            </a>\n          </div>\n        </div>\n        <div id="ext-meeting-join-button-container"\n             class="ext-meeting-join-row">\n          <button id="ext-meeting-join-button"\n                  class="ext-meeting-button ext-meeting-dialog-buttons">\n                  Join\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <span id="terms-of-service-link" class="ext-meeting-terms-link"><u>\n            Terms of Service </u></span> and\n          <span id="privacy-policy-link" class="ext-meeting-terms-link"><u>\n            Privacy Policy</u></span>.\n        </div>\n      ');
        this._dialog.showDismiss = !1;
        this._dialog.foremost = !0;
        this._dialog.open();
        document.getElementById("terms-of-service-link").onclick = function() {
            a._dialog.hide();
            Dk.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Terms of Service", "https://www.shapespark.com/terms#in-viewer", function() {
                return a._dialog.unhide()
            })
        }
        ;
        document.getElementById("privacy-policy-link").onclick = function() {
            a._dialog.hide();
            Dk.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Privacy Policy", "https://www.shapespark.com/privacy#in-viewer", function() {
                return a._dialog.unhide()
            })
        }
        ;
        this._initializeDisplayName()
    }
    ;
    Mk.prototype._createMediaTracksSeparately = function(a, b, c) {
        function d() {
            e._fillDevicesSelectControls();
            e._errorMessageActive = !0;
            e.updateErrorMessage();
            c && c()
        }
        var e = this;
        this._errorMessageActive = !1;
        a && b ? this._cameraPreview.createTrack(a).then(function() {
            return e._micVolumePreview.createTrack(b)
        }).then(function() {
            d()
        }) : a ? this._cameraPreview.createTrack(a).then(function() {
            d()
        }) : this._micVolumePreview.createTrack(b).then(function() {
            d()
        })
    }
    ;
    Mk.prototype._runTestNeededMode = function() {
        this._setTestNeededMode();
        this._cameraPreview.showInTestNeededMode();
        this._micVolumePreview.showInTestNeededMode()
    }
    ;
    Mk.prototype._runPreviewMode = function(a) {
        this._setPreviewMode(a);
        a ? (this._cameraPreview.setToggleButtonVisibility(!0),
        this._micVolumePreview.setToggleButtonVisibility(!0)) : (this._cameraPreview.showInPreviewMode(),
        this._micVolumePreview.showInPreviewMode())
    }
    ;
    Mk.prototype._onCreateMediaTracks = function(a, b, c) {
        var d = a.filter(function(a) {
            return "audio" === a.kind
        });
        a = a.filter(function(a) {
            return "video" === a.kind
        });
        this._errorMessageActive = !1;
        0 < d.length ? this._micVolumePreview.setTrack(d[0], b) : this._micVolumePreview.setTrack(null, b, {
            name: "Unknown error",
            message: ""
        });
        0 < a.length ? this._cameraPreview.setTrack(a[0], c) : this._cameraPreview.setTrack(null, c, {
            name: "Unknown error",
            message: ""
        });
        this._errorMessageActive = !0;
        this.updateErrorMessage();
        this._fillDevicesSelectControls();
        this._runPreviewMode(!0)
    }
    ;
    Mk.prototype._testCamera = function() {
        var a = this
          , b = {
            audio: WALK.cloneObject(Nk),
            video: WALK.cloneObject(Ok)
        };
        Twilio.Video.createLocalTracks(b).then(function(b) {
            a._onCreateMediaTracks(b)
        }).catch(function() {
            a._createMediaTracksSeparately(Ok, Nk, function() {
                return a._runPreviewMode(!0)
            })
        })
    }
    ;
    Mk.prototype._setTestNeededMode = function() {
        var a = this;
        this._joinMode = !1;
        var b = document.getElementById("ext-meeting-join-button-container");
        Dk.removeChildren(b);
        b.innerHTML = '\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-test-button">\n          Test camera\n        </button>\n      ';
        Lc("ext-meeting-test-button", function() {
            return a._testCamera()
        })
    }
    ;
    Mk.prototype._setPreviewMode = function(a) {
        var b = this;
        if (!this._joinMode) {
            this._joinMode = !0;
            var c = document.getElementById("ext-meeting-join-button-container");
            Dk.removeChildren(c);
            c.innerHTML = '\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-join-button">\n          Join\n        </button>\n      ';
            this._mediaInitialized = !0;
            this._updateJoinButtonState();
            Lc("ext-meeting-join-button", function() {
                return b._joinMeeting()
            });
            a || this._setMediaInitialized(!1)
        }
    }
    ;
    Mk.prototype._onMediaInitialized = function() {
        this._setMediaInitialized(!0)
    }
    ;
    Mk.prototype._updateJoinButtonState = function() {
        var a = document.getElementById("ext-meeting-join-button");
        a && (a.disabled = !(this._preflightTestDone && this._mediaInitialized))
    }
    ;
    Mk.prototype._setMediaInitialized = function(a) {
        this._mediaInitialized = a;
        this._updateJoinButtonState()
    }
    ;
    Mk.prototype._setPreflightTestDone = function() {
        this._preflightTestDone = !0;
        this._updateJoinButtonState()
    }
    ;
    Mk.prototype._initializeDisplayName = function() {
        var a = document.getElementById("ext-meeting-join-name")
          , b = localStorage.getItem("extMtgDisplayName");
        b && (a.value = b);
        a.focus();
        a.select()
    }
    ;
    Mk.prototype._checkDisplayName = function() {
        var a = document.getElementById("ext-meeting-join-name")
          , b = a.value.trim();
        if (b)
            return b;
        Dk.highlightInput(a)
    }
    ;
    Mk.prototype._blurHelp = function() {
        document.getElementById("help-and-primary-progress").classList.add("ui-blur")
    }
    ;
    Mk.prototype._unblurHelp = function() {
        var a = document.getElementById("help-and-primary-progress");
        a.classList.remove("ui-blur");
        a.classList.add("ui-unblur")
    }
    ;
    Mk.prototype._runPrefilghtTest = function(a) {
        var b = this;
        a = Twilio.Video.runPreflight(a, {
            duration: 2E3
        });
        a.on("failed", function(a) {
            console.error("Twilio test error:", a);
            a = document.getElementById("ext-meeting-join-network-error-container");
            Dk.show(a);
            b._setPreflightTestDone()
        });
        a.on("completed", function() {
            b._setPreflightTestDone()
        })
    }
    ;
    Mk.prototype._joinMeeting = function() {
        var a = this._checkDisplayName();
        if (void 0 !== a) {
            localStorage.setItem("extMtgDisplayName", a);
            var b = this._micVolumePreview.device
              , c = this._cameraPreview.device;
            this._dispose();
            this._onJoinCallback(a, b, c)
        }
    }
    ;
    Mk.prototype.updateErrorMessage = function() {
        this._errorMessageActive && this._errorMessageGenerator.update()
    }
    ;
    Mk.prototype._dispose = function() {
        this._dialog.close();
        this._unblurHelp();
        navigator.mediaDevices.removeEventListener("devicechange", this._onDevicesChangedBound);
        this._cameraPreview.dispose();
        this._micVolumePreview.dispose();
        this._micVolumePreview = this._cameraPreview = this._dialog = null
    }
    ;
    function Xk() {
        this._room = null;
        this._bars = [];
        this._crossLines = [];
        this._crossIsVisible = !1;
        this._updateBind = this._update.bind(this);
        this._qualityToBarIndex = [-1, 0, 0, 1, 2, 2];
        this._create()
    }
    Xk.prototype._create = function() {
        var a = document.getElementById("ext-meeting-quality-indicator-container");
        console.assert(null !== a, "Quality indicator container not found");
        var b = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        b.setAttribute("width", 13);
        b.setAttribute("height", 15);
        a.appendChild(b);
        for (a = 0; 3 > a; a++) {
            var c = 5 * (a + 1);
            this._addBar(b, 5 * a, 15 - c, 3, c)
        }
        this._addCrossLine(b, 2, 3, 11, 12);
        this._addCrossLine(b, 2, 12, 11, 3)
    }
    ;
    Xk.prototype._addBar = function(a, b, c, d, e) {
        var f = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        f.setAttribute("x", b);
        f.setAttribute("y", c);
        f.setAttribute("width", d);
        f.setAttribute("height", e);
        f.setAttribute("display", "none");
        a.appendChild(f);
        this._bars.push(f)
    }
    ;
    Xk.prototype._addCrossLine = function(a, b, c, d, e) {
        var f = document.createElementNS("http://www.w3.org/2000/svg", "line");
        f.setAttribute("x1", b);
        f.setAttribute("y1", c);
        f.setAttribute("x2", d);
        f.setAttribute("y2", e);
        f.setAttribute("stroke", "red");
        f.setAttribute("stroke-width", 2);
        f.setAttribute("display", "none");
        a.appendChild(f);
        this._crossLines.push(f)
    }
    ;
    Xk.prototype._hideBars = function() {
        this._bars.forEach(function(a) {
            a.setAttribute("display", "none")
        })
    }
    ;
    Xk.prototype._hideCross = function() {
        this._crossIsVisible && (this._crossLines.forEach(function(a) {
            a.setAttribute("display", "none")
        }),
        this._crossIsVisible = !1)
    }
    ;
    Xk.prototype._showBars = function() {
        this._bars.forEach(function(a) {
            a.setAttribute("display", "block")
        })
    }
    ;
    Xk.prototype._showCross = function() {
        this._crossIsVisible || (this._crossLines.forEach(function(a) {
            a.setAttribute("display", "block")
        }),
        this._crossIsVisible = !0)
    }
    ;
    Xk.prototype.onConnect = function(a) {
        console.assert(null === this._room);
        this._room = a;
        this._showBars();
        this._update(this._room.localParticipant.networkQualityLevel);
        a.localParticipant.on("networkQualityLevelChanged", this._updateBind)
    }
    ;
    Xk.prototype.onDisconnect = function() {
        console.assert(this._room);
        this._room.localParticipant.removeListener("networkQualityLevelChanged", this._updateBind);
        this._room = null;
        this._hideBars();
        this._hideCross()
    }
    ;
    Xk.prototype._getColor = function(a, b) {
        return a <= this._qualityToBarIndex[b] ? "white" : "dimgray"
    }
    ;
    Xk.prototype._update = function(a) {
        if (null !== a) {
            for (var b = 0; 3 > b; b++) {
                var c = this._getColor(b, a);
                this._bars[b].setAttribute("fill", c);
                this._bars[b].setAttribute("stroke", c)
            }
            0 === a ? this._showCross() : this._hideCross()
        }
    }
    ;
    function Yk() {
        function a() {
            var a = this;
            this._users = new Set;
            this._maxIntervalBetweenUpdates = 100;
            this._idleCallback = new WALK.DeferringExecutorInterval(function() {
                return a._execute()
            }
            ,this._maxIntervalBetweenUpdates);
            WALK.getViewer().onBeforeRender(function() {
                return a._onBeforeRender()
            })
        }
        function b() {
            var a = window.location.hostname;
            return a.endsWith(".shapespark.com") ? "https://cloud" + a.substr(a.indexOf(".")) : a.endsWith(".shapespark.com.cn") ? "https://cloud.shapespark.com.cn" : WALK.DEVEL_MEETING_CLOUD_URL || "https://cloud.shapespark.com"
        }
        function c(a) {
            a = new Date(a);
            var b = new Date;
            return b.getDate() === a.getDate() && b.getMonth() === a.getMonth() && b.getFullYear() === a.getFullYear() ? a.toLocaleTimeString() : a.toLocaleDateString() + " " + a.toLocaleTimeString()
        }
        function d(a, b, c, d) {
            var e = document.createElement("li");
            e.classList.add("ext-meeting-list-entry");
            var f = e.appendChild(document.createElement("span"));
            f.classList.add("ext-meeting-list-name");
            f.innerText = a;
            f.style.color = c;
            d && (Kc(e, d),
            e.style.cursor = "pointer");
            b && (e.appendChild(document.createElement("br")),
            a = e.appendChild(document.createElement("small")),
            a.innerText = b,
            a.style.color = "white");
            return e
        }
        function e(a, b, c) {
            return {
                color: "#0775e8",
                icon: "edit",
                opacity: 1,
                position: [a, b, c],
                radius: .07,
                type: "sphere"
            }
        }
        function f(a, b, c, d) {
            d = void 0 === d ? !1 : d;
            var e = new Dk.UiPopup("<div>\n        <h3>" + a + "</h3>\n      </div>\n      <div class ='ext-meeting-dialog-buttons'>\n        " + (b && c ? "<button class='ext-meeting-dialog-ok ext-meeting-button'>\n            " + b + "\n          </button>" : "") + "\n        " + (d ? "<button class='ext-meeting-dialog-cancel ext-meeting-button'>\n          Cancel\n        </button>" : "") + "\n      </div>");
            e.showDismiss = !1;
            e.open();
            d && (e.getElementsByClassName("ext-meeting-dialog-cancel")[0].onclick = function() {
                return e.dismiss()
            }
            );
            b && c && (e.getElementsByClassName("ext-meeting-dialog-ok")[0].onclick = function() {
                e.close();
                c()
            }
            )
        }
        function g(a, b) {
            b = b.attach();
            a = a.createTextureFromHtmlVideo(b);
            a.play();
            return a
        }
        function h(a) {
            a.detach().forEach(function(a) {
                return a.remove()
            })
        }
        function l(a) {
            return a && a.isStarted && a.isEnabled && !a.isStopped
        }
        function m(a, b, c) {
            this._viewer = a;
            this._uuid = b;
            a = parseInt(b.substring(2));
            this._color = WALK.AVATAR_COLORS[a % WALK.AVATAR_COLORS.length];
            this._twilioParticipant = this._avatar = this._displayName = null;
            this._lastRenderedPosition = [];
            this._lastRenderedPositionLength = 0;
            this._audioTrack = this._screenTrack = this._cameraTrack = this._micTrack = this._dataTrack = null;
            this._noSoundThreshold = 80;
            this._soundVolumeUpdatesScheduler = c;
            this._volumeVisualizer = new Hk.VolumeVisualizer(20,3,this._noSoundThreshold,3);
            this._volumeMeter = null
        }
        function n(a, b, c, d, e, f) {
            m.call(this, a, b, d, !0);
            this._displayName = c;
            this._setUpAvatar();
            this._avatar.hideBody();
            this._isPublishingTracksDuringConnecting = !1;
            this._dataTrack = new Twilio.Video.LocalDataTrack({
                name: "data",
                maxPacketLifeTime: 1E3
            });
            this._isCreatingCameraTrack = this._isCreatingMicTrack = !1;
            this._micDevice = e;
            this._cameraDevice = f;
            this._micTrack = this._micDevice.track;
            null !== this._micTrack && this._subscribeToMicEvents();
            this._updateSoundMeasurementState();
            this._cameraTrack = this._cameraDevice.track;
            null !== this._cameraTrack && (console.assert(this._cameraDevice.active, "Got inactive camera track from MeetingStarter"),
            this._subscribeToCameraEvents());
            this._lastPosition = null;
            this._positionMessage = [b, c, null];
            this._onCameraTrackStateChanged = this._onMicTrackStateChanged = this._resendInterval = null
        }
        function p(a, b, c, d) {
            m.call(this, a, b, c, !1);
            this._onUiRefreshNeeded = d;
            this._cameraTrackDisabledBound = this._cameraTrackEnabledBound = this._micTrackStateChangedBound = null;
            this._trackSubscribedBound = this._trackSubscribed.bind(this);
            this._trackUnsubscribedBound = this._trackUnsubscribed.bind(this);
            this._disposed = !1
        }
        function q(a, b, c, d, e, f) {
            var g = new PubNub({
                publishKey: b.publishKey,
                subscribeKey: b.subscribeKey,
                authKey: b.authKey,
                uuid: a.uuid,
                ssl: !0
            })
              , h = b.channel;
            g.subscribe({
                channels: [h],
                withPresence: !0
            });
            g.addListener({
                message: function(a) {
                    WALK.log("listener received message", a);
                    "SceneState" === a.message.type && e(a.message.state)
                },
                presence: function(b) {
                    b.uuid !== a.uuid && (WALK.log("listener presence event", b),
                    "join" === b.action ? c(b.uuid) : "leave" === b.action && d(b.uuid))
                },
                status: function(a) {
                    "PNAccessDeniedCategory" !== a.category && "PNNetworkIssuesCategory" !== a.category && "PNNetworkDownCategory" !== a.category && "PNTimeoutCategory" !== a.category || f(a.category)
                }
            });
            g.hereNow({
                channels: [h],
                includeUUIDs: !0,
                includeState: !0
            }, function(b, d) {
                WALK.log("herenow", b, d);
                d.channels[h].occupants.forEach(function(b) {
                    b.uuid !== a.uuid && c(b.uuid)
                })
            });
            this.dispose = function() {
                g.unsubscribeAll()
            }
        }
        function r(a, b, c, d, e, f, g, h, l, m) {
            function n(a) {
                var b = a.identity.match(/^u-\d+/);
                b = b && b[0];
                return b ? b : (WALK.warn("Unknown participant", a.identity),
                null)
            }
            function p(a) {
                WALK.log('Participant "%s" connected', a.identity);
                var b = n(a);
                b && c(b, a)
            }
            function q(a) {
                WALK.log('Participant "%s" disconnected', a.identity);
                var b = n(a);
                b && d(b, a)
            }
            function r(a) {
                a = null !== a ? n(a) : null;
                m(a)
            }
            function u(b) {
                y && (y = !1,
                x.participants.forEach(q),
                x = null,
                a.disconnectedFromTwilio(),
                l(),
                0 < z ? f("TReconnectionDisconnected" + (b.code ? " " + b.code : "")) : g())
            }
            var v = b.avToken
              , w = b.channel
              , M = ["NotAllowedError", "NotFoundError", "NotReadableError", "OverconstrainedError", "TypeError"]
              , x = null
              , y = !1
              , z = 0
              , A = WALK.urlHashContains("av-turn");
            this.isConnectingOrConnected = function() {
                return y
            }
            ;
            this.disconnect = function() {
                y && (y = !1,
                x && (x.disconnect(),
                x.participants.forEach(q),
                x = null,
                a.disconnectedFromTwilio(),
                l()))
            }
            ;
            this.dispose = function() {
                this.disconnect()
            }
            ;
            this.connect = function() {
                console.assert(!y);
                y = !0;
                a.startedConnectingToTwilio();
                WALK.log('Connecting to room "%s"', w);
                Twilio.Video.connect(v, {
                    name: w,
                    tracks: a.getAllTracks(),
                    preferredVideoCodecs: "auto",
                    iceTransportPolicy: A ? "relay" : "all",
                    region: I || "gll",
                    networkQuality: {
                        local: 1,
                        remote: 1
                    },
                    dominantSpeaker: !0
                }).then(function(b) {
                    x = b;
                    WALK.log("Connected to room");
                    x.participants.forEach(p);
                    x.on("participantConnected", p);
                    x.on("participantDisconnected", q);
                    x.on("dominantSpeakerChanged", r);
                    x.on("reconnecting", function() {
                        z += 1
                    });
                    x.on("reconnected", function() {
                        z = 0
                    });
                    x.once("disconnected", u);
                    a.connectedToTwilio(x.localParticipant);
                    h(x)
                }).catch(function(b) {
                    a.failedToConnectToTwilio();
                    M.includes(b.name) ? e(b) : f("T" + b.code)
                })
            }
        }
        function u(a) {
            function b(a, b) {
                var c = document.createElement("span");
                c.classList.add("ext-meeting-who-list-name");
                c.innerText = a;
                c.style.color = b;
                return c
            }
            function c(a) {
                var b = document.createElement("span");
                b.classList.add("ext-meeting-who-list-mic-indicator");
                a ? b.classList.add("fa-microphone") : b.classList.add("fa-microphone-slash");
                return b
            }
            function d() {
                var a = document.createElement("span");
                a.classList.add("ext-meeting-who-list-mic-indicator");
                a.classList.add("fa-file-audio-o");
                return a
            }
            function e(a) {
                console.assert(null !== a.volumeVisualizer, "volumeVisualizer not initialized");
                var b = document.createElement("span");
                a.isSoundMeasurementActive() ? b.innerHTML = a.volumeVisualizer.getHTML() : b.innerHTML = a.volumeVisualizer.getEmptyHTML();
                return b
            }
            function f() {
                var f = document.createElement("li");
                f.classList.add("ext-meeting-who-list-entry");
                f.appendChild(e(a));
                f.appendChild(b(a.displayName + " (me)", a.color));
                var g = l(a.micTrack);
                f.appendChild(c(g));
                a.audioTrack && f.appendChild(d(g));
                return f
            }
            var g = document.getElementById("ext-meeting-who-list-folder")
              , h = document.getElementById("ext-meeting-status");
            Mc(h);
            var m = document.getElementById("ext-meeting-who-list")
              , n = new WALK.Timeout(1E3)
              , p = new WALK.Timeout(3E3)
              , q = new WALK.Timeout(1E3,function() {
                m.style.overflowY = "auto"
            }
            );
            m.addEventListener("scroll", function() {
                n.isRunning() || p.start()
            });
            var r = !0;
            Kc(g, function() {
                q.isRunning() || (r ? (r = !1,
                m.style.maxHeight = 0,
                m.style.margin = 0,
                m.style.overflowY = "hidden",
                g.children[0].style.transform = "rotate(180deg)") : (g.children[0].style.transform = "",
                m.style.maxHeight = "",
                m.style.margin = "",
                q.start(),
                r = !0))
            });
            WALK.DETECTOR.firefox && (m.style.paddingRight = "16px");
            var u = null
              , v = new Map;
            this.onDominantSpeakerChanged = function(a) {
                u && a !== u && (u = null);
                if (!p.isRunning() && null !== a) {
                    var b = v.get(a);
                    b ? (b.scrollIntoView({
                        behavior: "smooth",
                        block: "nearest"
                    }),
                    n.start()) : u = a
                }
            }
            ;
            this.update = function(a) {
                v.clear();
                Dk.removeChildren(m);
                m.appendChild(f());
                a = k.makeIterator(Object.values(a));
                for (var g = a.next(); !g.done; g = a.next())
                    if (g = g.value,
                    g.hasDisplayName) {
                        var h = document.createElement("li");
                        h.classList.add("ext-meeting-who-list-entry");
                        h.appendChild(e(g));
                        var l = b(g.displayName, g.color);
                        l.style.cursor = "pointer";
                        h.appendChild(l);
                        var n = g.micTrack && g.micTrack.isEnabled;
                        h.appendChild(c(n));
                        g.audioTrack && h.appendChild(d(n));
                        Kc(l, g.seeAvatar.bind(g));
                        m.appendChild(h);
                        v.set(g, h)
                    }
                u && v.has(u) && (this.onDominantSpeakerChanged(u),
                u = null)
            }
            ;
            this.show = function() {
                Dk.show(h)
            }
            ;
            this.hide = function() {
                Dk.hide(h)
            }
            ;
            this.update([]);
            this.show()
        }
        function v(a) {
            return "\n      <div>\n        <textarea id='ext-meeting-note-text'\n          class='ext-meeeting-note-edit'\n          placeholder='" + a + "'></textarea>\n      </div>\n      <button id='ext-meeting-note-publish'\n        class='ext-meeting-button ext-meeting-dialog-buttons'>\n        Publish\n      </button>\n    "
        }
        function w(a, b) {
            function c(a) {
                var b = d;
                null !== a.location && (b += ":" + a.location.join(":"));
                return b
            }
            var d = "extMtg:" + a + ":" + b + ":";
            this.getTimeStampOfLastReadNoteAtLocation = function(a) {
                return localStorage.getItem(c(a)) || -1
            }
            ;
            this.isNoteRead = function(a) {
                return a.ts <= this.getTimeStampOfLastReadNoteAtLocation(a) || a.author === b
            }
            ;
            this.markAllNotesAtLocationAsRead = function(a) {
                localStorage.setItem(c(a), a.ts)
            }
        }
        function x(a, b, f, g, h, l) {
            function m(a) {
                if (a === b.displayName)
                    return b.color;
                for (var c = k.makeIterator(Object.values(f)), d = c.next(); !d.done; d = c.next())
                    if (d = d.value,
                    d.displayName === a)
                        return d.color;
                return "#ffffff"
            }
            function n() {
                w = !1;
                g.show();
                G.style.cursor = "default";
                x.dismiss();
                M.close()
            }
            function p(a) {
                return u.filter(function(b) {
                    b = b.location;
                    var c = a.location;
                    b = null === b || null === c ? !1 : WALK.deepEqual(b, c);
                    return b
                })
            }
            function q(f, g) {
                function n(d, e) {
                    if (!w) {
                        x.classList.remove("ext-meeting-note-list-unread");
                        x.classList.add("ext-meeting-note-list-selected");
                        e && x.scrollIntoView();
                        d.material.highlightMix = .7;
                        a.requestFrame();
                        var g = "";
                        e = new Map;
                        for (var n = h.getTimeStampOfLastReadNoteAtLocation(f), q = null, r = k.makeIterator(p(f)), u = r.next(); !u.done; u = r.next()) {
                            q = u.value;
                            u = "ext-meeting-note-text" + q.id;
                            var M = "ext-meeting-note-author" + q.id
                              , A = "ext-meeting-note-entry";
                            q.ts > n && q.author !== b.displayName && (A += " ext-meeting-note-unread");
                            g += "<div class='" + A + "'>\n               <strong id='" + M + "'\n                   style='color: " + m(q.author) + "'>\n               </strong> <span>" + c(q.ts) + "</span>\n               <div id='" + u + "'>\n               </div>\n             </div>";
                            e.set(u, q.text);
                            e.set(M, q.author)
                        }
                        g += v("Type your response");
                        y ? y.update(g) : (y = new Dk.UiPopup(g),
                        y.position = Dk.UiPopup.TOP,
                        y.onClose = function() {
                            x.classList.remove("ext-meeting-note-list-selected");
                            d.material.highlightMix = 0;
                            a.requestFrame();
                            y = null
                        }
                        );
                        h.markAllNotesAtLocationAsRead(q);
                        z = f.location;
                        y.open();
                        e.forEach(function(a, b) {
                            document.getElementById(b).innerText = a
                        });
                        Lc("ext-meeting-note-publish", function() {
                            var a = document.getElementById("ext-meeting-note-text")
                              , b = a.value.trim();
                            if (b) {
                                var c = d.position;
                                l(b, [c.x, c.y, c.z]);
                                a.value = ""
                            } else
                                Dk.highlightInput(a)
                        })
                    }
                }
                var q = a.addAnchor(e(f.location[0], f.location[1], f.location[2], "#0775e8"), function(a) {
                    return n(a, !0)
                });
                q.material.highlight = L;
                q.material.setUniforms();
                r.push(q);
                var u = f.author;
                var x = d(u, c(f.ts), m(u), function() {
                    a.seeItem(q);
                    n(q, !1)
                });
                h.isNoteRead(f) || x.classList.add("ext-meeting-note-list-unread");
                g.appendChild(x);
                null !== y && WALK.deepEqual(z, f.location) && n(q, !0)
            }
            var r = []
              , u = []
              , w = !1
              , x = new Dk.UiPopup("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");
            x.position = Dk.UiPopup.TOP;
            var M = new Dk.UiPopup(v("Type your note"));
            M.position = Dk.UiPopup.TOP;
            var y = null
              , z = null;
            Lc("ext-meeting-add-note", function() {
                w = !0;
                g.hide();
                G.style.cursor = "pointer";
                y && y.close();
                a.onNodeTypeClicked(D);
                x.onDismiss = function() {
                    a.removeOnNodeTypeClicked(D);
                    n()
                }
                ;
                x.open()
            });
            var A = new t.Vector3;
            var D = function(b, c) {
                G.style.cursor = "default";
                A.copy(c);
                te(A, a.getCameraPosition(), .1);
                a.removeOnNodeTypeClicked(D);
                var d = a.addAnchor(e(A.x, A.y, A.z));
                d.material.highlight = L;
                d.material.setUniforms();
                d.material.highlightMix = .7;
                x.close();
                M.onClose = function() {
                    a.removeAnchor(d);
                    n()
                }
                ;
                M.open();
                Lc("ext-meeting-note-publish", function() {
                    var a = document.getElementById("ext-meeting-note-text")
                      , b = a.value.trim();
                    b ? l(b, [A.x, A.y, A.z]) : Dk.highlightInput(a)
                });
                return !0
            };
            a.onApiUserStateChanged("MeetingNotes", function(b, c) {
                console.assert("MeetingNotes" === b);
                u = c.sort(function(a, b) {
                    var c = h.isNoteRead(a)
                      , d = h.isNoteRead(b);
                    return c !== d ? c ? -1 : 1 : a.ts - b.ts
                });
                n();
                b = k.makeIterator(r);
                for (c = b.next(); !c.done; c = b.next())
                    a.removeAnchor(c.value);
                r.length = 0;
                b = document.getElementById("ext-meeting-note-list");
                Dk.removeChildren(b);
                c = new Map;
                for (var d = u.length - 1; 0 <= d; d--) {
                    var e = u[d];
                    if (null !== e.location) {
                        var f = e.location.join("/");
                        c.has(f) || (c.set(f, d),
                        q(e, b),
                        b.lastChild.scrollIntoView())
                    }
                }
            })
        }
        function y(a, b) {
            function c() {
                h = g = null;
                f.pointerX = null;
                f.pointerY = null;
                f.pointerZ = null;
                a._enableControls()
            }
            function d() {
                f.isEnabled() ? (G.style.cursor = "default",
                c(),
                m.disable(),
                l.close(),
                b.show()) : (G.style.cursor = "pointer",
                l.open(),
                m.enable(),
                l.onDismiss = d,
                b.hide())
            }
            var e = this
              , f = this
              , g = null
              , h = null
              , l = new Dk.UiPopup("\n      <h2>\n        Point a place by clicking.\n      </h2>");
            l.position = Dk.UiPopup.TOP;
            var m = a._createPointerEventHelper(0);
            m.disable();
            this.pointerZ = this.pointerY = this.pointerX = null;
            this.isEnabled = function() {
                return m.isEnabled()
            }
            ;
            this.showPointer = function() {
                return null !== this.pointerX
            }
            ;
            a.onBeforeRender(function() {
                if (null !== g) {
                    var b = a._findIntersectionAtPosition(g, h);
                    Infinity !== b.distance && (e.pointerX = b.point.x,
                    e.pointerY = b.point.y,
                    e.pointerZ = b.point.z)
                }
            });
            m.callbacks.onPointerDown = function(b, c) {
                g = b;
                h = c;
                a._disableControls();
                a.requestFrame();
                return !0
            }
            ;
            m.callbacks.onPointerMove = function(b, c) {
                if (null === g)
                    return !1;
                g = b;
                h = c;
                a.requestFrame();
                return !0
            }
            ;
            m.callbacks.onPointerUp = function() {
                c();
                a.requestFrame();
                return !0
            }
            ;
            Lc("ext-meeting-pointer", function() {
                d()
            })
        }
        function z() {
            var a = [0, 0, 0, 0, 0]
              , b = [0, 0, 0, 0, 0, 0, 0, 0]
              , c = null
              , d = !1;
            this.newUpdateWithPointer = function() {
                d = !1;
                c !== b && (d = !0,
                c = b)
            }
            ;
            this.newUpdateNoPointer = function() {
                d = !1;
                c !== a && (d = !0,
                c = a)
            }
            ;
            this.set = function(a, b) {
                c[a] !== b && (c[a] = b,
                d = !0)
            }
            ;
            this.getFilledArray = function() {
                return d ? c : null
            }
        }
        function A() {
            function a(a) {
                Dk.setVisibility(a.children[0], !0);
                Dk.setVisibility(a.children[1], !1)
            }
            function b(a) {
                Dk.setVisibility(a.children[0], !1);
                Dk.setVisibility(a.children[1], !0)
            }
            var c = document.getElementById("ext-meeting-mic-toggle")
              , d = document.getElementById("ext-meeting-camera-toggle")
              , e = document.getElementById("ext-meeting-camera-preview");
            Mc(e);
            var f = null;
            this.refreshMicControls = function(d) {
                l(d) ? (Dk.setButtonHighlight(c, !1),
                a(c)) : (Dk.setButtonHighlight(c, !0),
                b(c))
            }
            ;
            this.refreshCameraControls = function(c) {
                l(c) ? (f || (f = c.attach(),
                e.appendChild(f)),
                Dk.show(e),
                Dk.setButtonHighlight(d, !1),
                a(d)) : (f && (c.detach(),
                f.remove(),
                f = null),
                Dk.hide(e),
                Dk.setButtonHighlight(d, !0),
                b(d))
            }
            ;
            this.setToggleButtonHandlers = function(a, b) {
                Kc(c, a);
                Kc(d, b)
            }
        }
        function B(c, d, e, g) {
            function h() {
                I.dispose();
                va.dispose();
                bb.dispose();
                for (var a = k.makeIterator(Object.values(ca)), b = a.next(); !b.done; b = a.next())
                    ca[b.value].dispose();
                L.dispose()
            }
            function l(a, b) {
                h();
                document.body.innerHTML = '<div id="cover-image"></div>';
                f(a, b, b ? function() {
                    return location.reload()
                }
                : void 0)
            }
            function m(a) {
                l("Meeting connection lost.</br>(Code: " + a + ").", "Join again")
            }
            function v(a, d) {
                a = {
                    meetingKey: Ga,
                    author: c,
                    text: a,
                    location: d
                };
                WALK.ajaxPost(b() + "/meetings/" + V + "/notes", "application/json", JSON.stringify(a), function() {
                    return WALK.log("Note added.")
                }, function() {
                    return WALK.log("Failed to add note")
                })
            }
            function M() {
                la.update(ca)
            }
            function B(a) {
                var b = ca[a];
                b || (b = new p(K,a,L,M),
                ca[a] = b);
                return b
            }
            function C(a) {
                a in ca && (ca[a].dispose(),
                delete ca[a],
                la.update(ca),
                va.isConnectingOrConnected() && 0 === Object.keys(ca).length && va.disconnect())
            }
            function F(a) {
                Ha = a;
                for (var b = k.makeIterator(Object.keys(a)), c = b.next(); !c.done; c = b.next())
                    c = c.value,
                    K.apiUserChangeState(c, a[c])
            }
            function O() {
                Qa.showPointer() ? (H.newUpdateWithPointer(),
                H.set(5, WALK.round(Qa.pointerX, 3)),
                H.set(6, WALK.round(Qa.pointerY, 3)),
                H.set(7, WALK.round(Qa.pointerZ, 3))) : H.newUpdateNoPointer();
                var a = K.getCameraPosition()
                  , b = K.getCameraRotation();
                H.set(0, WALK.round(a.x, 3));
                H.set(1, WALK.round(a.y, 3));
                H.set(2, WALK.round(a.z, 3));
                H.set(3, WALK.round(b.yaw, 1));
                H.set(4, WALK.round(b.pitch, 1));
                (a = H.getFilledArray()) && I.updatePosition(a)
            }
            function G() {
                l("The meeting has ended. Maximum duration of meeting reached.")
            }
            var K = WALK.getViewer()
              , H = new z
              , L = new a;
            this.myUuid = g.uuid;
            var I = new n(K,this.myUuid,c,L,d,e), ca = {}, la = new u(I,K), ya = new A, V = g.id, Ga = g.meetingKey, Ha;
            ya.setToggleButtonHandlers(function() {
                I.toggleMic()
            }, function() {
                I.toggleCamera()
            });
            I.setAvTracksStateHandlers(function(a) {
                ya.refreshMicControls(a);
                la.update(ca)
            }, function(a) {
                ya.refreshCameraControls(a)
            });
            ya.refreshMicControls(I.micTrack);
            ya.refreshCameraControls(I.cameraTrack);
            var Qa = new y(K,la);
            WALK.urlHashContains("meeting-notes") && (Dk.show(document.getElementById("ext-meeting-notes-preview")),
            x(K, I, ca, la, new w(V,c), v));
            null !== g.sceneState && F(g.sceneState);
            var bb = new q(I,g,function(a) {
                B(a);
                va.isConnectingOrConnected() || va.connect()
            }
            ,C,F,m);
            d = new Xk;
            var va = new r(I,g,function(a, b) {
                B(a).connectedToTwilio(b)
            }
            ,function(a) {
                C(a)
            }
            ,function(a) {
                Ba.info("Failed to acquire media.<br/>" + a.message, 6E3)
            }
            ,m,function() {
                l("The meeting has been ended.")
            }
            ,d.onConnect.bind(d),d.onDisconnect.bind(d),function(a) {
                la.onDominantSpeakerChanged(a in ca ? ca[a] : null)
            }
            );
            Lc("ext-meeting-leave", function() {
                f("Do you want to leave this meeting?", "Leave meeting", function() {
                    l("You have left the meeting", "Join again")
                }, !0)
            });
            K.onBeforeRender(O);
            O();
            K.onApiUserStateChanged(function(a, c) {
                Ha && WALK.deepEqual(c, Ha[a]) || (a = {
                    meetingKey: Ga,
                    key: a,
                    state: c
                },
                WALK.ajaxPost(b() + "/meetings/" + V + "/scene-state", "application/json", JSON.stringify(a), function() {
                    return WALK.log("State updated.")
                }, function() {
                    return WALK.log("Failed to update state.")
                }))
            });
            this.startShareScreen = function(a, b, c) {
                WALK.log("Screen share start requested");
                I.startShareScreen(a, b, c, function() {
                    return la.update(ca)
                })
            }
            ;
            this.stopShareScreen = function() {
                WALK.log("Screen share stop requested");
                I.stopShareScreen()
            }
            ;
            null !== g.remainingTimeSeconds && setTimeout(G, 1E3 * (g.remainingTimeSeconds + 5))
        }
        function H(a) {
            (new Mk(function(b, c, d) {
                b = new B(b,c,d,a);
                WALK.getViewer()._meetingJoined(b)
            }
            ,a.avToken)).show()
        }
        function C(a, b) {
            function c() {
                var b = a.split("/").slice(0, -1).join("/") + "/";
                fetch(a).then(function(a) {
                    return a.json()
                }).then(function(a) {
                    d(b, a)
                }).catch(function() {
                    return Ba.error("Failed to load the meeting")
                })
            }
            function d(a, c) {
                fetch(a + c.model).then(function(a) {
                    return a.text()
                }).then(function(d) {
                    var e = d
                      , f = /^[og]\s*(.+)?/
                      , g = /^mtllib /
                      , h = /^usemtl /
                      , l = /^usemap /;
                    d = new qh;
                    -1 !== e.indexOf("\r\n") && (e = e.replace(/\r\n/g, "\n"));
                    -1 !== e.indexOf("\\\n") && (e = e.replace(/\\\n/g, ""));
                    e = e.split("\n");
                    var m;
                    e = k.makeIterator(e);
                    for (m = e.next(); !m.done; m = e.next()) {
                        var n = m.value;
                        if (0 !== n.length && "\x00" !== n) {
                            var p = n.charAt(0);
                            if ("#" !== p)
                                if ("v" === p)
                                    switch (m = n.split(/\s+/),
                                    m[0]) {
                                    case "v":
                                        d.vertices.push(parseFloat(m[1]), parseFloat(m[2]), parseFloat(m[3]));
                                        7 <= m.length && console.assert(!1, "obj with vertex colors is not supported");
                                        break;
                                    case "vn":
                                        d.normals.push(parseFloat(m[1]), parseFloat(m[2]), parseFloat(m[3]));
                                        break;
                                    case "vt":
                                        d.uvs.push(parseFloat(m[1]), parseFloat(m[2]))
                                    }
                                else if ("f" === p) {
                                    n = n.substr(1).trim().split(/\s+/);
                                    m = [];
                                    n = k.makeIterator(n);
                                    for (p = n.next(); !p.done; p = n.next())
                                        p = p.value,
                                        0 < p.length && (p = p.split("/"),
                                        m.push(p));
                                    n = m[0];
                                    p = 1;
                                    for (var q = m.length - 1; p < q; p++) {
                                        var r = m[p]
                                          , u = m[p + 1];
                                        d.addFace(rh(n[0]), rh(r[0]), rh(u[0]), rh(n[1]), rh(r[1]), rh(u[1]), rh(n[2]), rh(r[2]), rh(u[2]))
                                    }
                                } else
                                    "l" === p ? console.assert(!1, "line geometry is not supported") : "p" === p ? console.assert(!1, "obj point geometry not supported") : null !== (m = f.exec(n)) ? (m = (" " + m[0].substr(1).trim()).substr(1),
                                    d.startObject(m)) : h.test(n) || g.test(n) || l.test(n) || "s" !== p && console.warn('OBJLoader: Unexpected line: "' + n + '"')
                        }
                    }
                    f = new Map;
                    d = k.makeIterator(d.objects);
                    for (g = d.next(); !g.done; g = d.next())
                        g = g.value,
                        0 !== g.vertices.length && (h = new t.BufferGeometry,
                        h.addAttribute("position", new WALK.BufferAttribute(new Float32Array(g.vertices),3)),
                        0 < g.normals.length && h.addAttribute("normal", new WALK.BufferAttribute(new Float32Array(g.normals),3)),
                        !0 === g.hasUvs && h.addAttribute("uv", new WALK.BufferAttribute(new Float32Array(g.uvs),2)),
                        h.convertNormalsToSpherical(),
                        h.computeBoundingBox(),
                        h.computeBoundingSphere(),
                        f.set(g.name, h));
                    WALK.setAvatarModel(a, c, f);
                    b()
                }).catch(function() {
                    return Ba.error("Failed to load the meeting")
                })
            }
            WALK.getViewer().onSceneLoadComplete(function() {
                void 0 === a && (a = WALK.getViewerAssetUrl("3dassets/avatar.json"));
                WALK.AVATAR_JSON_URL_OVERRIDE && (a = WALK.AVATAR_JSON_URL_OVERRIDE);
                c()
            })
        }
        WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");
        WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");
        var L = new t.Color(0,1,0)
          , G = document.getElementById("walk-canvas")
          , I = WALK.urlHashGetArgument("av-region");
        m.prototype = {
            constructor: m,
            _setUpAvatar: function() {
                console.assert(this._displayName, "Display name must be known to set up the avatar");
                WALK.log("Setting up avatar for %s:%s", this._uuid, this._displayName);
                this._avatar = this._viewer.addAvatar(this._uuid, {
                    displayName: this._displayName,
                    color: this._color
                })
            },
            get uuid() {
                return this._uuid
            },
            get color() {
                return this._color
            },
            get displayName() {
                return this._displayName
            },
            get hasDisplayName() {
                return null !== this._displayName
            },
            _positionChanged: function(a) {
                if (this._lastRenderedPositionLength !== a.length)
                    return !0;
                for (var b = 0; b < a.length; b++)
                    if (1E-5 < Math.abs(this._lastRenderedPosition[b] - a[b]))
                        return !0;
                return !1
            },
            _setLastRenderedPosition: function(a) {
                this._lastRenderedPositionLength = a.length;
                for (var b = 0; b < a.length; b++)
                    this._lastRenderedPosition[b] = a[b]
            },
            get volumeVisualizer() {
                return this._volumeVisualizer
            },
            updatePosition: function(a) {
                if (this.hasDisplayName && this._positionChanged(a)) {
                    this._setLastRenderedPosition(a);
                    var b = this._avatar;
                    b.setPositionFromArray(a);
                    b.rotate(a[3], a[4]);
                    6 <= a.length ? b.placePointer(a[5], a[6], a[7]) : b.hidePointer();
                    b.visible && (b.updateMatrixWorld(!0),
                    this._viewer.requestFrame())
                }
            },
            updateSoundVolumeVisualization: function() {
                console.assert(null !== this._volumeMeter, "this._voulmeMeter not created");
                var a = this._volumeMeter.measureSoundVolume();
                this._onSoundVolumeUpdated(a)
            },
            _onSoundVolumeUpdated: function(a) {
                this._volumeVisualizer.update(a)
            },
            dispose: function() {
                this.isSoundMeasurementActive() && this._stopSoundMeasurement();
                this._avatar && (this._viewer.removeAvatar(this._avatar),
                this._avatar = null,
                this._viewer.requestFrame())
            },
            _updateSoundMeasurementState: function() {
                null !== this._micTrack && this._micTrack.isEnabled ? this._startSoundMeasurement() : this._stopSoundMeasurement()
            },
            isSoundMeasurementActive: function() {
                return null !== this._volumeMeter
            },
            _startSoundMeasurement: function() {
                this.isSoundMeasurementActive() || (this._volumeMeter = new Hk.VolumeMeter(this._micTrack,512,this._noSoundThreshold),
                this._soundVolumeUpdatesScheduler.registerUser(this))
            },
            _stopSoundMeasurement: function() {
                this.isSoundMeasurementActive() && (this._soundVolumeUpdatesScheduler.unregisterUser(this),
                this._volumeMeter.dispose(),
                this._volumeMeter = null,
                this._avatar.onSoundSwitchedOff())
            }
        };
        Object.defineProperty(m.prototype, "micTrack", {
            get: function() {
                return this._micTrack
            }
        });
        Object.defineProperty(m.prototype, "cameraTrack", {
            get: function() {
                return this._cameraTrack
            }
        });
        Object.defineProperty(m.prototype, "audioTrack", {
            get: function() {
                return this._audioTrack
            }
        });
        n.prototype = Object.create(m.prototype);
        n.prototype.constructor = n;
        Object.defineProperty(n.prototype, "dataTrack", {
            get: function() {
                return this._dataTrack
            }
        });
        Object.defineProperty(n.prototype, "screenTrack", {
            get: function() {
                return this._screenTrack
            }
        });
        n.prototype.getAllTracks = function() {
            var a = [this._dataTrack];
            this._micTrack && a.push(this._micTrack);
            this._cameraTrack && a.push(this._cameraTrack);
            this._screenTrack && a.push(this._screenTrack);
            this._audioTrack && a.push(this._audioTrack);
            return a
        }
        ;
        n.prototype._sendPosition = function(a) {
            this._positionMessage[2] = a;
            this._dataTrack.send(JSON.stringify(this._positionMessage))
        }
        ;
        n.prototype._resendLastPosition = function() {
            null !== this._lastPosition && this._sendPosition(this._lastPosition)
        }
        ;
        n.prototype.startedConnectingToTwilio = function() {
            this._isPublishingTracksDuringConnecting = !0
        }
        ;
        n.prototype.failedToConnectToTwilio = function() {
            this._isPublishingTracksDuringConnecting = !1
        }
        ;
        n.prototype.connectedToTwilio = function(a) {
            var b = this;
            this._twilioParticipant = a;
            a.publishTracks(this.getAllTracks()).finally(function() {
                b._isPublishingTracksDuringConnecting = !1
            });
            this._resendLastPosition();
            this._resendInterval = setInterval(function() {
                return b._resendLastPosition()
            }, 1E3)
        }
        ;
        n.prototype.disconnectedFromTwilio = function() {
            this._twilioParticipant = null;
            clearInterval(this._resendInterval);
            this._resendInterval = null
        }
        ;
        Object.defineProperty(n.prototype, "isConnectedToTwilio", {
            get: function() {
                return null !== this._twilioParticipant
            }
        });
        n.prototype.updatePosition = function(a) {
            m.prototype.updatePosition.call(this, a);
            this._lastPosition = a;
            this.isConnectedToTwilio && this._sendPosition(a)
        }
        ;
        n.prototype.setAvTracksStateHandlers = function(a, b) {
            this._onMicTrackStateChanged = a;
            this._onCameraTrackStateChanged = b
        }
        ;
        n.prototype._removeStoppedMicTrack = function() {
            console.assert(this._micTrack && this._micTrack.isStopped);
            WALK.log("Removing stopped local mic track");
            this._twilioParticipant && (WALK.log("Unpublishing stopped local mic track"),
            this._twilioParticipant.unpublishTrack(this._micTrack));
            this._micTrack = null
        }
        ;
        n.prototype._subscribeToMicEvents = function() {
            function a() {
                b._updateSoundMeasurementState();
                b._onMicTrackStateChanged && b._onMicTrackStateChanged(b._micTrack)
            }
            var b = this;
            this._micTrack.on("started", a);
            this._micTrack.on("enabled", a);
            this._micTrack.on("disabled", a);
            this._micTrack.on("stopped", function() {
                a();
                b._removeStoppedMicTrack()
            })
        }
        ;
        n.prototype._createMicTrack = function() {
            var a = this;
            WALK.log("Creating local mic track");
            if (this._isCreatingMicTrack)
                WALK.log("Local mic track is already being created");
            else {
                this._isCreatingMicTrack = !0;
                var b = null;
                Twilio.Video.createLocalAudioTrack(this._micDevice.trackOptions).then(function(c) {
                    b = c;
                    if (a.isConnectedToTwilio)
                        return WALK.log("Publishing local mic track"),
                        a._twilioParticipant.publishTrack(b)
                }).then(function(c) {
                    c ? WALK.log("Local mic track created and published") : WALK.log("Local mic track created but not yet published");
                    a._micTrack = b;
                    a._subscribeToMicEvents();
                    a._onMicTrackStateChanged && a._onMicTrackStateChanged(a._micTrack);
                    a._isCreatingMicTrack = !1
                }).catch(function(c) {
                    b && b.stop();
                    a._micDevice.error = c;
                    a._showCreateTrackError(a._micDevice);
                    a._isCreatingMicTrack = !1
                })
            }
        }
        ;
        n.prototype.toggleMic = function() {
            this._micTrack ? this._micTrack.isEnabled ? (WALK.log("Disabling local mic track"),
            this._micTrack.disable()) : (WALK.log("Enabling local mic track"),
            this._micTrack.enable()) : this._createMicTrack()
        }
        ;
        n.prototype._removeStoppedCameraTrack = function() {
            console.assert(this._cameraTrack && this._cameraTrack.isStopped);
            WALK.log("Removing stopped local camera track");
            this._twilioParticipant && (WALK.log("Unpublishing stopped local camera track"),
            this._twilioParticipant.unpublishTrack(this._cameraTrack));
            this._cameraTrack = null
        }
        ;
        n.prototype._subscribeToCameraEvents = function() {
            function a() {
                b._onCameraTrackStateChanged && b._onCameraTrackStateChanged(b._cameraTrack)
            }
            var b = this;
            this._cameraTrack.on("started", a);
            this._cameraTrack.on("enabled", a);
            this._cameraTrack.on("disabled", a);
            this._cameraTrack.on("stopped", function() {
                a();
                b._removeStoppedCameraTrack()
            })
        }
        ;
        n.prototype._createCameraTrack = function() {
            var a = this;
            WALK.log("Creating local camera track");
            if (this._isCreatingCameraTrack)
                WALK.log("Local camera track is already being created");
            else {
                this._isCreatingCameraTrack = !0;
                var b = null;
                Twilio.Video.createLocalVideoTrack(this._cameraDevice.trackOptions).then(function(c) {
                    b = c;
                    if (a.isConnectedToTwilio)
                        return WALK.log("Publishing local camera track"),
                        a._twilioParticipant.publishTrack(b)
                }).then(function(c) {
                    c ? WALK.log("Local camera track created and published") : WALK.log("Local camera track created but not yet published");
                    a._cameraTrack = b;
                    a._subscribeToCameraEvents();
                    a._onCameraTrackStateChanged && a._onCameraTrackStateChanged(a._cameraTrack);
                    a._isCreatingCameraTrack = !1
                }).catch(function(c) {
                    b && b.stop();
                    a._cameraDevice.error = c;
                    a._showCreateTrackError(a._cameraDevice);
                    a._isCreatingCameraTrack = !1
                })
            }
        }
        ;
        n.prototype._showCreateTrackError = function(a) {
            a = a.getErrorMessageInfo();
            Dk.showMessage(a.description, a.title)
        }
        ;
        n.prototype.toggleCamera = function() {
            this._cameraTrack ? this._isPublishingTracksDuringConnecting ? WALK.log("Cannot disable the camera track during connection process") : this._cameraTrack.stop() : this._createCameraTrack()
        }
        ;
        n.prototype.startShareScreen = function(a, b, c, d) {
            var e = this;
            null !== this._screenTrack ? a() : (WALK.log("Share screen start"),
            navigator.mediaDevices.getDisplayMedia({
                video: !0,
                audio: !0
            }).then(function(c) {
                WALK.log("share screen - stream:", c);
                var f = new Twilio.Video.LocalVideoTrack(c.getVideoTracks()[0],{
                    name: "screen"
                });
                e._screenTrack = f;
                c = c.getAudioTracks();
                var l = null;
                0 < c.length ? (l = new Twilio.Video.LocalAudioTrack(c[0],{
                    name: "audio"
                }),
                e._audioTrack = l,
                d()) : console.log("Audio track not available for sharing");
                c = g(e._viewer, f);
                e._avatar.setVideoTexture1(c);
                e._viewer.requestFrame();
                e.isConnectedToTwilio && (e._twilioParticipant.publishTrack(f),
                l && e._twilioParticipant.publishTrack(l));
                a();
                f.once("stopped", function() {
                    WALK.log("Screen track stopped");
                    e.isConnectedToTwilio && (e._twilioParticipant.unpublishTrack(f),
                    null !== l && e._twilioParticipant.unpublishTrack(l));
                    e._avatar.setVideoTexture1(null);
                    h(f);
                    null !== l && h(l);
                    e._screenTrack = null;
                    e._audioTrack && (e._audioTrack = null,
                    d());
                    e._viewer.requestFrame();
                    b()
                })
            }).catch(function() {
                c()
            }))
        }
        ;
        n.prototype.stopShareScreen = function() {
            null !== this._screenTrack && (WALK.log("Share screen stop"),
            this._screenTrack.stop())
        }
        ;
        n.prototype.dispose = function() {
            this._micTrack && this._micTrack.stop();
            this._cameraTrack && this._cameraTrack.stop();
            this._screenTrack && this._screenTrack.stop();
            m.prototype.dispose.call(this)
        }
        ;
        p.prototype = Object.create(m.prototype);
        p.prototype.constructor = p;
        p.prototype._refreshUi = function() {
            this._onUiRefreshNeeded && this._onUiRefreshNeeded(this)
        }
        ;
        p.prototype._setUpMicTrack = function() {
            var a = this;
            WALK.log("Setting up remote mic track for %s:%s", this._uuid, this._displayName);
            this._micTrackStateChangedBound = function() {
                a._updateSoundMeasurementState();
                a._refreshUi()
            }
            ;
            this._micTrack.on("enabled", this._micTrackStateChangedBound);
            this._micTrack.on("disabled", this._micTrackStateChangedBound);
            this._updateSoundMeasurementState();
            this._micTrack.attach()
        }
        ;
        p.prototype._tearDownMicTrack = function() {
            WALK.log("Tearing down remote mic track for %s:%s", this._uuid, this._displayName);
            h(this._micTrack);
            this._micTrack.removeListener("enabled", this._micTrackStateChangedBound);
            this._micTrack.removeListener("disabled", this._micTrackStateChangedBound);
            this._micTrackStateChangedBound = null
        }
        ;
        p.prototype._setUpAudioTrack = function() {
            WALK.log("Setting up remote audio track for %s:%s", this._uuid, this._displayName);
            this._audioTrack.attach()
        }
        ;
        p.prototype._tearDownAudioTrack = function() {
            WALK.log("Tearing down remote audio track for %s:%s", this._uuid, this._displayName);
            h(this._audioTrack)
        }
        ;
        p.prototype._setUpCameraTrack = function() {
            var a = this;
            WALK.log("Setting up remote camera track for %s:%s", this._uuid, this._displayName);
            var b = g(this._viewer, this._cameraTrack);
            this._cameraTrackEnabledBound = function() {
                a._avatar.setVideoTexture0(b)
            }
            ;
            this._cameraTrackDisabledBound = function() {
                a._avatar.setVideoTexture0(null)
            }
            ;
            this._cameraTrack.on("enabled", this._cameraTrackEnabledBound);
            this._cameraTrack.on("disabled", this._cameraTrackDisabledBound);
            this._avatar.setVideoTexture0(b)
        }
        ;
        p.prototype._tearDownCameraTrack = function() {
            WALK.log("Tearing down remote camera track for %s:%s", this._uuid, this._displayName);
            this._avatar.setVideoTexture0(null);
            h(this._cameraTrack);
            this._cameraTrack.removeListener("enabled", this._cameraTrackEnabledBound);
            this._cameraTrack.removeListener("disabled", this._cameraTrackDisabledBound);
            this._cameraTrackDisabledBound = this._cameraTrackEnabledBound = null
        }
        ;
        p.prototype._setUpScreenTrack = function() {
            WALK.log("Setting up remote screen track for %s:%s", this._uuid, this._displayName);
            var a = g(this._viewer, this._screenTrack);
            this._avatar.setVideoTexture1(a)
        }
        ;
        p.prototype._tearDownScreenTrack = function() {
            WALK.log("Tearing down remote screen track for %s:%s", this._uuid, this._displayName);
            this._avatar.setVideoTexture1(null);
            h(this._screenTrack)
        }
        ;
        p.prototype._setDisplayName = function(a) {
            WALK.log("Remote display name known for %s:%s", this._uuid, a);
            this._displayName = a;
            this._setUpAvatar();
            this._micTrack && this._setUpMicTrack();
            this._cameraTrack && this._setUpCameraTrack();
            this._screenTrack && this._setUpScreenTrack();
            this._audioTrack && this._setUpAudioTrack();
            this._refreshUi()
        }
        ;
        p.prototype._trackSubscribed = function(a) {
            var b = this;
            WALK.log("Remote %s:%s track subscribed for %s:%s", a.kind, a.name, this._uuid, this._displayName);
            this._disposed || ("data" === a.kind && "data" === a.name ? this._dataTrack ? WALK.log("Ignoring duplicate data track") : (this._dataTrack = a,
            a.on("message", function(a) {
                a = JSON.parse(a);
                var c = a[1];
                a = a[2];
                b.hasDisplayName || b._setDisplayName(c);
                b.updatePosition(a)
            })) : "audio" === a.kind && "mic" === a.name ? this._micTrack ? WALK.log("Ignoring duplicate mic track") : (this._micTrack = a,
            this.hasDisplayName && (this._setUpMicTrack(),
            this._refreshUi())) : "video" === a.kind ? "camera" === a.name ? this._cameraTrack ? WALK.log("Ignoring duplicate camera track") : (this._cameraTrack = a,
            this._avatar && (this._setUpCameraTrack(),
            this._viewer.requestFrame())) : "screen" === a.name && (this._screenTrack ? WALK.log("Ignoring duplicate screen track") : (this._screenTrack = a,
            this._avatar && (this._setUpScreenTrack(),
            this._viewer.requestFrame()))) : "audio" === a.kind && "audio" === a.name && (this._audioTrack ? WALK.log("Ignoring duplicate audio track") : (this._audioTrack = a,
            this.hasDisplayName && (this._setUpAudioTrack(),
            this._refreshUi()))))
        }
        ;
        p.prototype._trackUnsubscribed = function(a) {
            WALK.log("Remote %s:%s track unsubscribed for %s:%s", a.kind, a.name, this._uuid, this._displayName);
            this._disposed || (a === this._dataTrack ? this._dataTrack = null : a === this._micTrack ? (this.hasDisplayName && this._tearDownMicTrack(),
            this._micTrack = null,
            this._refreshUi()) : a === this._cameraTrack ? (this._avatar && (this._tearDownCameraTrack(),
            this._viewer.requestFrame()),
            this._cameraTrack = null) : a === this._screenTrack ? (this._avatar && (this._tearDownScreenTrack(),
            this._viewer.requestFrame()),
            this._screenTrack = null) : a === this._audioTrack && (this.hasDisplayName && this._tearDownAudioTrack(),
            this._audioTrack = null,
            this._refreshUi()))
        }
        ;
        p.prototype.connectedToTwilio = function(a) {
            var b = this;
            this._twilioParticipant = a;
            a.on("trackSubscribed", this._trackSubscribedBound);
            a.on("trackUnsubscribed", this._trackUnsubscribedBound);
            a.tracks.forEach(function(a) {
                a.isSubscribed && b._trackSubscribed(a.track)
            })
        }
        ;
        p.prototype.seeAvatar = function() {
            this._avatar && this._viewer.seeItem(this._avatar)
        }
        ;
        p.prototype._onSoundVolumeUpdated = function(a) {
            m.prototype._onSoundVolumeUpdated.call(this, a);
            this._avatar.onSoundVolumeUpdated(a)
        }
        ;
        p.prototype.dispose = function() {
            this._onUiRefreshNeeded = null;
            this._micTrack && this._trackUnsubscribed(this._micTrack);
            this._cameraTrack && this._trackUnsubscribed(this._cameraTrack);
            this._screenTrack && this._trackUnsubscribed(this._screenTrack);
            this._audioTrack && this._trackUnsubscribed(this._audioTrack);
            this.isConnectedToTwilio && (this._twilioParticipant.removeListener("trackSubscribed", this._trackSubscribedBound),
            this._twilioParticipant.removeListener("trackUnsubscribed", this._trackUnsubscribedBound),
            this._twilioParticipant = null);
            m.prototype.dispose.call(this);
            this._disposed = !0
        }
        ;
        a.prototype.registerUser = function(a) {
            this._users.add(a)
        }
        ;
        a.prototype.unregisterUser = function(a) {
            this._users.delete(a)
        }
        ;
        a.prototype.dispose = function() {
            this._users.clear()
        }
        ;
        a.prototype._onBeforeRender = function() {
            this._execute();
            this._idleCallback.deferRun()
        }
        ;
        a.prototype._execute = function() {
            this._users.forEach(function(a) {
                return a.updateSoundVolumeVisualization()
            })
        }
        ;
        WALK.loadScriptsUrlAndExecute([WALK.getViewerAssetUrl("lib/pubnub.min.js"), WALK.getViewerAssetUrl("lib/twilio-video.min.js")], function() {
            var a = WALK.urlHashGetArgument("meeting")
              , c = WALK.urlHashGetArgument("meeting-key")
              , d = WALK.urlHashGetArgument("av-mode")
              , e = {
                url: WALK.DEVEL_MEETING_SCENE_URL || window.location.href
            };
            a && (e.meetingName = a);
            c && (e.meetingKey = c);
            d && (e.avMode = d);
            I && (e.avRegion = I);
            WALK.ajaxPost(b() + "/meetings/join", "application/json", JSON.stringify(e), function(a) {
                return C(a.avatarJsonUrl, function() {
                    return H(a)
                })
            }, function(a, b) {
                void 0 !== b ? Ba.error(b) : Ba.error("Failed to join the meeting. Is your link valid?")
            })
        }, function() {
            return Ba.error("Cannot load required library")
        });
        WALK.play()
    }
    WALK.getViewer()._isMeeting() && Yk();
}
).call(this);

